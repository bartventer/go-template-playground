import{c as U,E as W,a1 as F,aj as bo,U as Qe,aY as Ya,aZ as Gr,ae as qa,l as yo,a_ as Qa,T as oi,t as be,D as Me,o as xe,ax as Xn,a as ut,aV as Ci,ap as Xa,aD as Gs,Y as jr,a$ as wi,b0 as Ja,z as ke,N as So,b1 as ed,b2 as td,b3 as Lo,b4 as Do,b5 as id,a8 as js,ar as gt,i as nd,n as Ln,P as sd,b6 as No,b7 as Mo,aA as od,j as ri,b8 as Zr,M as li,f as rd,b9 as ad,ba as dd,bb as ld,bc as xo,a9 as hi,b as Kr,aE as Fi,af as Yr,bd as hd,a7 as et,be as qr,bf as Gt,bg as Qr,bh as Jn,bi as cd,bj as es,bk as ud,bl as Xr,bm as gd,bn as fd,ao as md,bo as _d,a0 as pd,k as Q,bp as $,bq as Zs,br as Fe,bs as Jr,bt as Ce,bu as ts,Z as fe,X as Dn,bv as I,bw as Ks,bx as vd,by as Cd,bz as Ro,bA as Ne,bB as Le,bC as ce,bD as Nn,bE as Ys,ag as Eo,bF as wd,bG as bd,al as To,bH as Gi,bI as qs,bJ as yd,am as Sd,bK as He,bL as ea,bM as Ld,bN as Io,bO as Oo,bP as Dd,bQ as Nd,bR as Md,bS as xd,bT as Rd,bU as ta,bV as Ed,bW as ai,$ as Td,bX as Id,bY as Ee,bZ as Od,b_ as ia,b$ as Ad,c0 as Pd,c1 as Wd}from"./monaco-editor-esm-vs-base-YIFfhEJQ.js";import{c as Hd}from"./monaco-editor-esm-vs-base-browser-defaultWorkerFactory-BatFPzyW.js";import{F as Ao,E as na,P as T,I as Mn,a as kd,b as Fd,c as Qs,d as Xs,M as Vd,L as ci,e as ee,D as xi,R as Js,f as A,g as Bd,h as Ud,W as zd,t as $d,i as Gd,j as jd,k as Zd,l as Kd,C as Yd,m as Rt,B as qd,n as Ii,o as Qd,V as Ri,p as Po,q as sa,r as Xd,s as Jd,u as el,A as tl,v as oa,S as we,w as il,x as nl,y as Wo,z as sl,T as eo,G as Jt,H as D,J as oe,K as Oi,N as ol,O as Ho,Q as ko,U as Fo,X as ra,Y as rl,Z as Vo,_ as to,$ as al,a0 as dl,a1 as ll,a2 as hl,a3 as cl,a4 as ul,a5 as gl,a6 as fl,a7 as ml,a8 as _l,a9 as pl,aa as vl,ab as Cl,ac as wl,ad as bl,ae as yl,af as Sl,ag as Ll,ah as Dl,ai as Nl,aj as Ml,ak as xl,al as Rl,am as El,an as Tl,ao as Il,ap as Ol,aq as Al,ar as Pl,as as Wl,at as Hl,au as Bn,av as kl,aw as Fl,ax as Vl,ay as Vi,az as Bl,aA as Be,aB as Bo,aC as Ul,aD as aa,aE as da,aF as la,aG as zl,aH as $l,aI as De,aJ as Gl,aK as jl,aL as Zl,aM as Kl,aN as Yl,aO as ql,aP as Uo,aQ as zo,aR as Oe,aS as Ql,aT as xn,aU as Xl,aV as $o,aW as Jl,aX as eh,aY as th,aZ as Go,a_ as ih,a$ as Ai,b0 as io,b1 as jo,b2 as nh,b3 as sh,b4 as Ze,b5 as oh,b6 as Zo,b7 as rh,b8 as ah,b9 as dh,ba as re,bb as Nt,bc as Ko,bd as lh,be as hh}from"./monaco-editor-esm-vs-editor-common-BH3S_Qrw.js";import{c as no,R as ch,M as se,I as Rn,a as ye,C as X,K as ha,b as En,d as jt,e as ca,f as me,A as bt,g as Tn,h as ua,i as so,j as In,k as yt,l as uh,m as gh,r as St,n as fh,o as ga,p as mh,q as _h,s as On,t as ph,E as Yo,u as vh,v as ui,w as is,x as Ch,y as wh,z as bh,B as qo,D as yh,S as An,F as Sh,G as fa,H as Lh,J as Dh,L as Nh,N as Mh,O as qt,P as ma,Q as xh,W as Rh,T as _a,U as Eh,V as Th,X as Ih,Y as Oh,Z as Ah,_ as Ph,$ as Wh,a0 as Hh,a1 as Ue,a2 as Mt,a3 as kh,a4 as Fh,a5 as Ve,a6 as Vh,a7 as Qo}from"./monaco-editor-esm-vs-platform-Dgi-XxQ2.js";import{m as Pn,c as oo,a as pa,i as Ct,k as bi,l as Bh,S as Uh,G as va,d as zh,D as Se,B as $h,f as Gh,n as Xo,o as jh,h as ns}from"./monaco-editor-esm-vs-base-browser-DUVYE87s.js";import{f as Zh,H as wt,W as Ca,g as G,$ as Bi,a as O,q as gi,R as Kh,l as Yh,t as qh,S as Qh,x as Xh,E as K,T as Jh,j as yi,U as Jo,K as ec,F as tc,k as Si,b as fi,V as ji,N as ic,X as nc,Y as sc,Z as oc,_ as er,a0 as rc,a1 as Pi,a2 as ac,J as tr,a3 as k,r as ss}from"./monaco-editor-esm-vs-base-browser-dom-CW6twH0t.js";import{W as wa,H as dc,a as lc,g as hc,s as ba,M as cc,b as kt,S as ya,A as uc,r as gc,c as os,d as fc,B as mc}from"./monaco-editor-esm-vs-base-browser-ui-vl4ek12j.js";import{r as _c}from"./monaco-editor-esm-vs-base-browser-markdownRenderer-BB65ORmS.js";import{S as rs}from"./monaco-editor-esm-vs-base-browser-keyboardEvent-PZwKEW7u.js";import{D as Sa,a as pc,b as vc,S as Cc,c as wc,d as bc,A as yc,e as Sc}from"./monaco-editor-esm-vs-editor-browser-widget-diffEditor-components-Bx_By8ox.js";import{F as Lc,c as V}from"./monaco-editor-esm-vs-base-browser-fastDomNode-Cxp74WKe.js";import{P as Zi}from"./monaco-editor-esm-vs-base-browser-pixelRatio-Bpk22H8X.js";import{i as Et}from"./monaco-editor-esm-vs-base-browser-performance-BOFkUl2Q.js";import{G as ro,E as qe}from"./monaco-editor-esm-vs-base-browser-touch-ENPaa6IX.js";function ge(a,e){a instanceof Lc?(a.setFontFamily(e.getMassagedFontFamily()),a.setFontWeight(e.fontWeight),a.setFontSize(e.fontSize),a.setFontFeatureSettings(e.fontFeatureSettings),a.setFontVariationSettings(e.fontVariationSettings),a.setLineHeight(e.lineHeight),a.setLetterSpacing(e.letterSpacing)):(a.style.fontFamily=e.getMassagedFontFamily(),a.style.fontWeight=e.fontWeight,a.style.fontSize=e.fontSize+"px",a.style.fontFeatureSettings=e.fontFeatureSettings,a.style.fontVariationSettings=e.fontVariationSettings,a.style.lineHeight=e.lineHeight+"px",a.style.letterSpacing=e.letterSpacing+"px")}class Dc{constructor(e,t){this.chr=e,this.type=t,this.width=0}fulfill(e){this.width=e}}class ao{constructor(e,t){this._bareFontInfo=e,this._requests=t,this._container=null,this._testElements=null}read(e){var t;this._createDomElements(),e.document.body.appendChild(this._container),this._readFromDomElements(),(t=this._container)==null||t.remove(),this._container=null,this._testElements=null}_createDomElements(){const e=document.createElement("div");e.style.position="absolute",e.style.top="-50000px",e.style.width="50000px";const t=document.createElement("div");ge(t,this._bareFontInfo),e.appendChild(t);const i=document.createElement("div");ge(i,this._bareFontInfo),i.style.fontWeight="bold",e.appendChild(i);const n=document.createElement("div");ge(n,this._bareFontInfo),n.style.fontStyle="italic",e.appendChild(n);const s=[];for(const o of this._requests){let r;o.type===0&&(r=t),o.type===2&&(r=i),o.type===1&&(r=n),r.appendChild(document.createElement("br"));const d=document.createElement("span");ao._render(d,o),r.appendChild(d),s.push(d)}this._container=e,this._testElements=s}static _render(e,t){if(t.chr===" "){let i=" ";for(let n=0;n<8;n++)i+=i;e.innerText=i}else{let i=t.chr;for(let n=0;n<8;n++)i+=i;e.textContent=i}}_readFromDomElements(){for(let e=0,t=this._requests.length;e<t;e++){const i=this._requests[e],n=this._testElements[e];i.fulfill(n.offsetWidth/256)}}}function Nc(a,e,t){new ao(e,t).read(a)}class Mc extends U{constructor(){super(...arguments),this._cache=new Map,this._evictUntrustedReadingsTimeout=-1,this._onDidChange=this._register(new W),this.onDidChange=this._onDidChange.event}dispose(){this._evictUntrustedReadingsTimeout!==-1&&(clearTimeout(this._evictUntrustedReadingsTimeout),this._evictUntrustedReadingsTimeout=-1),super.dispose()}clearAllFontInfos(){this._cache.clear(),this._onDidChange.fire()}_ensureCache(e){const t=Zh(e);let i=this._cache.get(t);return i||(i=new xc,this._cache.set(t,i)),i}_writeToCache(e,t,i){this._ensureCache(e).put(t,i),!i.isTrusted&&this._evictUntrustedReadingsTimeout===-1&&(this._evictUntrustedReadingsTimeout=e.setTimeout(()=>{this._evictUntrustedReadingsTimeout=-1,this._evictUntrustedReadings(e)},5e3))}_evictUntrustedReadings(e){const t=this._ensureCache(e),i=t.getValues();let n=!1;for(const s of i)s.isTrusted||(n=!0,t.remove(s));n&&this._onDidChange.fire()}readFontInfo(e,t){const i=this._ensureCache(e);if(!i.has(t)){let n=this._actualReadFontInfo(e,t);(n.typicalHalfwidthCharacterWidth<=2||n.typicalFullwidthCharacterWidth<=2||n.spaceWidth<=2||n.maxDigitWidth<=2)&&(n=new Ao({pixelRatio:Zi.getInstance(e).value,fontFamily:n.fontFamily,fontWeight:n.fontWeight,fontSize:n.fontSize,fontFeatureSettings:n.fontFeatureSettings,fontVariationSettings:n.fontVariationSettings,lineHeight:n.lineHeight,letterSpacing:n.letterSpacing,isMonospace:n.isMonospace,typicalHalfwidthCharacterWidth:Math.max(n.typicalHalfwidthCharacterWidth,5),typicalFullwidthCharacterWidth:Math.max(n.typicalFullwidthCharacterWidth,5),canUseHalfwidthRightwardsArrow:n.canUseHalfwidthRightwardsArrow,spaceWidth:Math.max(n.spaceWidth,5),middotWidth:Math.max(n.middotWidth,5),wsmiddotWidth:Math.max(n.wsmiddotWidth,5),maxDigitWidth:Math.max(n.maxDigitWidth,5)},!1)),this._writeToCache(e,t,n)}return i.get(t)}_createRequest(e,t,i,n){const s=new Dc(e,t);return i.push(s),n==null||n.push(s),s}_actualReadFontInfo(e,t){const i=[],n=[],s=this._createRequest("n",0,i,n),o=this._createRequest("ｍ",0,i,null),r=this._createRequest(" ",0,i,n),d=this._createRequest("0",0,i,n),l=this._createRequest("1",0,i,n),h=this._createRequest("2",0,i,n),c=this._createRequest("3",0,i,n),u=this._createRequest("4",0,i,n),f=this._createRequest("5",0,i,n),_=this._createRequest("6",0,i,n),C=this._createRequest("7",0,i,n),w=this._createRequest("8",0,i,n),p=this._createRequest("9",0,i,n),g=this._createRequest("→",0,i,n),v=this._createRequest("￫",0,i,null),m=this._createRequest("·",0,i,n),b=this._createRequest("⸱",0,i,null),y="|/-_ilm%";for(let x=0,M=y.length;x<M;x++)this._createRequest(y.charAt(x),0,i,n),this._createRequest(y.charAt(x),1,i,n),this._createRequest(y.charAt(x),2,i,n);Nc(e,t,i);const N=Math.max(d.width,l.width,h.width,c.width,u.width,f.width,_.width,C.width,w.width,p.width);let S=t.fontFeatureSettings===na.OFF;const L=n[0].width;for(let x=1,M=n.length;S&&x<M;x++){const P=L-n[x].width;if(P<-.001||P>.001){S=!1;break}}let R=!0;return S&&v.width!==L&&(R=!1),v.width>g.width&&(R=!1),new Ao({pixelRatio:Zi.getInstance(e).value,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontSize:t.fontSize,fontFeatureSettings:t.fontFeatureSettings,fontVariationSettings:t.fontVariationSettings,lineHeight:t.lineHeight,letterSpacing:t.letterSpacing,isMonospace:S,typicalHalfwidthCharacterWidth:s.width,typicalFullwidthCharacterWidth:o.width,canUseHalfwidthRightwardsArrow:R,spaceWidth:r.width,middotWidth:m.width,wsmiddotWidth:b.width,maxDigitWidth:N},!0)}}class xc{constructor(){this._keys=Object.create(null),this._values=Object.create(null)}has(e){const t=e.getId();return!!this._values[t]}get(e){const t=e.getId();return this._values[t]}put(e,t){const i=e.getId();this._keys[i]=e,this._values[i]=t}remove(e){const t=e.getId();delete this._keys[t],delete this._values[t]}getValues(){return Object.keys(this._keys).map(e=>this._values[e])}}const ir=new Mc,Re=no("codeEditorService");class Wn{constructor(e){this.id=e.id,this.precondition=e.precondition,this._kbOpts=e.kbOpts,this._menuOpts=e.menuOpts,this.metadata=e.metadata}register(){if(Array.isArray(this._menuOpts)?this._menuOpts.forEach(this._registerMenuItem,this):this._menuOpts&&this._registerMenuItem(this._menuOpts),this._kbOpts){const e=Array.isArray(this._kbOpts)?this._kbOpts:[this._kbOpts];for(const t of e){let i=t.kbExpr;this.precondition&&(i?i=X.and(i,this.precondition):i=this.precondition);const n={id:this.id,weight:t.weight,args:t.args,when:i,primary:t.primary,secondary:t.secondary,win:t.win,linux:t.linux,mac:t.mac};ha.registerKeybindingRule(n)}}En.registerCommand({id:this.id,handler:(e,t)=>this.runCommand(e,t),metadata:this.metadata})}_registerMenuItem(e){jt.appendMenuItem(e.menuId,{group:e.group,command:{id:this.id,title:e.title,icon:e.icon,precondition:this.precondition},when:e.when,order:e.order})}}class lo extends Wn{constructor(){super(...arguments),this._implementations=[]}addImplementation(e,t,i,n){return this._implementations.push({priority:e,name:t,implementation:i,when:n}),this._implementations.sort((s,o)=>o.priority-s.priority),{dispose:()=>{for(let s=0;s<this._implementations.length;s++)if(this._implementations[s].implementation===i){this._implementations.splice(s,1);return}}}}runCommand(e,t){const i=e.get(Rn),n=e.get(ye);i.trace(`Executing Command '${this.id}' which has ${this._implementations.length} bound.`);for(const s of this._implementations){if(s.when){const r=n.getContext(wt());if(!s.when.evaluate(r))continue}const o=s.implementation(e,t);if(o)return i.trace(`Command '${this.id}' was handled by '${s.name}'.`),typeof o=="boolean"?void 0:o}i.trace(`The Command '${this.id}' was not handled by any implementation.`)}}class La extends Wn{constructor(e,t){super(t),this.command=e}runCommand(e,t){return this.command.runCommand(e,t)}}class Zt extends Wn{static bindToContribution(e){return class extends Zt{constructor(i){super(i),this._callback=i.handler}runEditorCommand(i,n,s){const o=e(n);o&&this._callback(o,s)}}}static runEditorCommand(e,t,i,n){const s=e.get(Re),o=s.getFocusedCodeEditor()||s.getActiveCodeEditor();if(o)return o.invokeWithinContext(r=>{if(r.get(ye).contextMatchesRules(i??void 0))return n(r,o,t)})}runCommand(e,t){return Zt.runEditorCommand(e,t,this.precondition,(i,n,s)=>this.runEditorCommand(i,n,s))}}class ho extends Zt{static convertOptions(e){let t;Array.isArray(e.menuOpts)?t=e.menuOpts:e.menuOpts?t=[e.menuOpts]:t=[];function i(n){return n.menuId||(n.menuId=se.EditorContext),n.title||(n.title=e.label),n.when=X.and(e.precondition,n.when),n}return Array.isArray(e.contextMenuOpts)?t.push(...e.contextMenuOpts.map(i)):e.contextMenuOpts&&t.push(i(e.contextMenuOpts)),e.menuOpts=t,e}constructor(e){super(ho.convertOptions(e)),this.label=e.label,this.alias=e.alias}runEditorCommand(e,t,i){return this.reportTelemetry(e,t),this.run(e,t,i||{})}reportTelemetry(e,t){e.get(ca).publicLog2("editorActionInvoked",{name:this.label,id:this.id})}}class Zf extends ho{constructor(){super(...arguments),this._implementations=[]}addImplementation(e,t){return this._implementations.push([e,t]),this._implementations.sort((i,n)=>n[0]-i[0]),{dispose:()=>{for(let i=0;i<this._implementations.length;i++)if(this._implementations[i][1]===t){this._implementations.splice(i,1);return}}}}run(e,t,i){for(const n of this._implementations){const s=n[1](e,t,i);if(s)return typeof s=="boolean"?void 0:s}}}class Hn extends bt{run(e,...t){const i=e.get(Re),n=i.getFocusedCodeEditor()||i.getActiveCodeEditor();if(n)return n.invokeWithinContext(s=>{var l;const o=s.get(ye),r=s.get(Rn);if(!o.contextMatchesRules(this.desc.precondition??void 0)){r.debug("[EditorAction2] NOT running command because its precondition is FALSE",this.desc.id,(l=this.desc.precondition)==null?void 0:l.serialize());return}return this.runEditorCommand(s,n,...t)})}}function Kf(a,e){En.registerCommand(a,function(t,...i){const n=t.get(me),[s,o]=i;bo(Qe.isUri(s)),bo(T.isIPosition(o));const r=t.get(Mn).getModel(s);if(r){const d=T.lift(o);return n.invokeFunction(e,r,d,...i.slice(2))}return t.get(kd).createModelReference(s).then(d=>new Promise((l,h)=>{try{const c=n.invokeFunction(e,d.object.textEditorModel,T.lift(o),i.slice(2));l(c)}catch(c){h(c)}}).finally(()=>{d.dispose()}))})}function E(a){return ve.INSTANCE.registerEditorCommand(a),a}function Yf(a){const e=new a;return ve.INSTANCE.registerEditorAction(e),e}function qf(a){return ve.INSTANCE.registerEditorAction(a),a}function Qf(a){ve.INSTANCE.registerEditorAction(a)}function Rc(a,e,t){ve.INSTANCE.registerEditorContribution(a,e,t)}var Ft;(function(a){function e(o){return ve.INSTANCE.getEditorCommand(o)}a.getEditorCommand=e;function t(){return ve.INSTANCE.getEditorActions()}a.getEditorActions=t;function i(){return ve.INSTANCE.getEditorContributions()}a.getEditorContributions=i;function n(o){return ve.INSTANCE.getEditorContributions().filter(r=>o.indexOf(r.id)>=0)}a.getSomeEditorContributions=n;function s(){return ve.INSTANCE.getDiffEditorContributions()}a.getDiffEditorContributions=s})(Ft||(Ft={}));const Ec={EditorCommonContributions:"editor.contributions"},hn=class hn{constructor(){this.editorContributions=[],this.diffEditorContributions=[],this.editorActions=[],this.editorCommands=Object.create(null)}registerEditorContribution(e,t,i){this.editorContributions.push({id:e,ctor:t,instantiation:i})}getEditorContributions(){return this.editorContributions.slice(0)}getDiffEditorContributions(){return this.diffEditorContributions.slice(0)}registerEditorAction(e){e.register(),this.editorActions.push(e)}getEditorActions(){return this.editorActions}registerEditorCommand(e){e.register(),this.editorCommands[e.id]=e}getEditorCommand(e){return this.editorCommands[e]||null}};hn.INSTANCE=new hn;let ve=hn;ch.add(Ec.EditorCommonContributions,ve.INSTANCE);function Ei(a){return a.register(),a}const Da=Ei(new lo({id:"undo",precondition:void 0,kbOpts:{weight:0,primary:2104},menuOpts:[{menuId:se.MenubarEditMenu,group:"1_do",title:F({key:"miUndo",comment:["&& denotes a mnemonic"]},"&&Undo"),order:1},{menuId:se.CommandPalette,group:"",title:F("undo","Undo"),order:1}]}));Ei(new La(Da,{id:"default:undo",precondition:void 0}));const Na=Ei(new lo({id:"redo",precondition:void 0,kbOpts:{weight:0,primary:2103,secondary:[3128],mac:{primary:3128}},menuOpts:[{menuId:se.MenubarEditMenu,group:"1_do",title:F({key:"miRedo",comment:["&& denotes a mnemonic"]},"&&Redo"),order:2},{menuId:se.CommandPalette,group:"",title:F("redo","Redo"),order:1}]}));Ei(new La(Na,{id:"default:redo",precondition:void 0}));const Tc=Ei(new lo({id:"editor.action.selectAll",precondition:void 0,kbOpts:{weight:0,kbExpr:null,primary:2079},menuOpts:[{menuId:se.MenubarSelectionMenu,group:"1_basic",title:F({key:"miSelectAll",comment:["&& denotes a mnemonic"]},"&&Select All"),order:1},{menuId:se.CommandPalette,group:"",title:F("selectAll","Select All"),order:1}]}));var co=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},dt=function(a,e){return function(t,i){e(t,i,a)}};const nr=5*60*1e3;function lt(a,e){const t=a.getModel(e);return!(!t||t.isTooLargeForSyncing())}let sr=class extends U{constructor(e,t,i,n,s,o){super(),this._languageConfigurationService=s,this._modelService=t,this._workerManager=this._register(new as(e,this._modelService)),this._logService=n,this._register(o.linkProvider.register({language:"*",hasAccessToAllModels:!0},{provideLinks:async(r,d)=>{if(!lt(this._modelService,r.uri))return Promise.resolve({links:[]});const h=await(await this._workerWithResources([r.uri])).$computeLinks(r.uri.toString());return h&&{links:h}}})),this._register(o.completionProvider.register("*",new Ic(this._workerManager,i,this._modelService,this._languageConfigurationService)))}dispose(){super.dispose()}canComputeUnicodeHighlights(e){return lt(this._modelService,e)}async computedUnicodeHighlights(e,t,i){return(await this._workerWithResources([e])).$computeUnicodeHighlights(e.toString(),t,i)}async computeDiff(e,t,i,n){const o=await(await this._workerWithResources([e,t],!0)).$computeDiff(e.toString(),t.toString(),i,n);if(!o)return null;return{identical:o.identical,quitEarly:o.quitEarly,changes:d(o.changes),moves:o.moves.map(l=>new Vd(new ci(new ee(l[0],l[1]),new ee(l[2],l[3])),d(l[4])))};function d(l){return l.map(h=>{var c;return new xi(new ee(h[0],h[1]),new ee(h[2],h[3]),(c=h[4])==null?void 0:c.map(u=>new Js(new A(u[0],u[1],u[2],u[3]),new A(u[4],u[5],u[6],u[7]))))})}}async computeMoreMinimalEdits(e,t,i=!1){if(Ya(t)){if(!lt(this._modelService,e))return Promise.resolve(t);const n=Gr.create(),s=this._workerWithResources([e]).then(o=>o.$computeMoreMinimalEdits(e.toString(),t,i));return s.finally(()=>this._logService.trace("FORMAT#computeMoreMinimalEdits",e.toString(!0),n.elapsed())),Promise.race([s,qa(1e3).then(()=>t)])}else return Promise.resolve(void 0)}canNavigateValueSet(e){return lt(this._modelService,e)}async navigateValueSet(e,t,i){const n=this._modelService.getModel(e);if(!n)return null;const s=this._languageConfigurationService.getLanguageConfiguration(n.getLanguageId()).getWordDefinition(),o=s.source,r=s.flags;return(await this._workerWithResources([e])).$navigateValueSet(e.toString(),t,i,o,r)}canComputeWordRanges(e){return lt(this._modelService,e)}async computeWordRanges(e,t){const i=this._modelService.getModel(e);if(!i)return Promise.resolve(null);const n=this._languageConfigurationService.getLanguageConfiguration(i.getLanguageId()).getWordDefinition(),s=n.source,o=n.flags;return(await this._workerWithResources([e])).$computeWordRanges(e.toString(),t,s,o)}async findSectionHeaders(e,t){return(await this._workerWithResources([e])).$findSectionHeaders(e.toString(),t)}async computeDefaultDocumentColors(e){return(await this._workerWithResources([e])).$computeDefaultDocumentColors(e.toString())}async _workerWithResources(e,t=!1){return await(await this._workerManager.withWorker()).workerWithSyncedResources(e,t)}};sr=co([dt(1,Mn),dt(2,Fd),dt(3,Rn),dt(4,Qs),dt(5,Xs)],sr);class Ic{constructor(e,t,i,n){this.languageConfigurationService=n,this._debugDisplayName="wordbasedCompletions",this._workerManager=e,this._configurationService=t,this._modelService=i}async provideCompletionItems(e,t){const i=this._configurationService.getValue(e.uri,t,"editor");if(i.wordBasedSuggestions==="off")return;const n=[];if(i.wordBasedSuggestions==="currentDocument")lt(this._modelService,e.uri)&&n.push(e.uri);else for(const c of this._modelService.getModels())lt(this._modelService,c.uri)&&(c===e?n.unshift(c.uri):(i.wordBasedSuggestions==="allDocuments"||c.getLanguageId()===e.getLanguageId())&&n.push(c.uri));if(n.length===0)return;const s=this.languageConfigurationService.getLanguageConfiguration(e.getLanguageId()).getWordDefinition(),o=e.getWordAtPosition(t),r=o?new A(t.lineNumber,o.startColumn,t.lineNumber,o.endColumn):A.fromPositions(t),d=r.setEndPosition(t.lineNumber,t.column),h=await(await this._workerManager.withWorker()).textualSuggest(n,o==null?void 0:o.word,s);if(h)return{duration:h.duration,suggestions:h.words.map(c=>({kind:18,label:c,insertText:c,range:{insert:d,replace:r}}))}}}let as=class extends U{constructor(e,t){super(),this._workerDescriptor=e,this._modelService=t,this._editorWorkerClient=null,this._lastWorkerUsedTime=new Date().getTime(),this._register(new Ca).cancelAndSet(()=>this._checkStopIdleWorker(),Math.round(nr/2),Pn),this._register(this._modelService.onModelRemoved(n=>this._checkStopEmptyWorker()))}dispose(){this._editorWorkerClient&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null),super.dispose()}_checkStopEmptyWorker(){if(!this._editorWorkerClient)return;this._modelService.getModels().length===0&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null)}_checkStopIdleWorker(){if(!this._editorWorkerClient)return;new Date().getTime()-this._lastWorkerUsedTime>nr&&(this._editorWorkerClient.dispose(),this._editorWorkerClient=null)}withWorker(){return this._lastWorkerUsedTime=new Date().getTime(),this._editorWorkerClient||(this._editorWorkerClient=new ds(this._workerDescriptor,!1,this._modelService)),Promise.resolve(this._editorWorkerClient)}};as=co([dt(1,Mn)],as);class Oc{constructor(e){this._instance=e,this.proxy=this._instance}dispose(){this._instance.dispose()}setChannel(e,t){throw new Error("Not supported")}}let ds=class extends U{constructor(e,t,i){super(),this._workerDescriptor=e,this._disposed=!1,this._modelService=i,this._keepIdleModels=t,this._worker=null,this._modelManager=null}fhr(e,t){throw new Error("Not implemented!")}_getOrCreateWorker(){if(!this._worker)try{this._worker=this._register(Hd(this._workerDescriptor)),Bd.setChannel(this._worker,this._createEditorWorkerHost())}catch(e){yo(e),this._worker=this._createFallbackLocalWorker()}return this._worker}async _getProxy(){try{const e=this._getOrCreateWorker().proxy;return await e.$ping(),e}catch(e){return yo(e),this._worker=this._createFallbackLocalWorker(),this._worker.proxy}}_createFallbackLocalWorker(){return new Oc(new Ud(this._createEditorWorkerHost(),null))}_createEditorWorkerHost(){return{$fhr:(e,t)=>this.fhr(e,t)}}_getOrCreateModelManager(e){return this._modelManager||(this._modelManager=this._register(new zd(e,this._modelService,this._keepIdleModels))),this._modelManager}async workerWithSyncedResources(e,t=!1){if(this._disposed)return Promise.reject(Qa());const i=await this._getProxy();return this._getOrCreateModelManager(i).ensureSyncedResources(e,t),i}async textualSuggest(e,t,i){const n=await this.workerWithSyncedResources(e),s=i.source,o=i.flags;return n.$textualSuggest(e.map(r=>r.toString()),t,s,o)}dispose(){super.dispose(),this._disposed=!0}};ds=co([dt(2,Mn)],ds);var Ac=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Pc=function(a,e){return function(t,i){e(t,i,a)}};let or=class extends U{constructor(e){super(),this._themeService=e,this._onWillCreateCodeEditor=this._register(new W),this._onCodeEditorAdd=this._register(new W),this.onCodeEditorAdd=this._onCodeEditorAdd.event,this._onCodeEditorRemove=this._register(new W),this.onCodeEditorRemove=this._onCodeEditorRemove.event,this._onWillCreateDiffEditor=this._register(new W),this._onDiffEditorAdd=this._register(new W),this.onDiffEditorAdd=this._onDiffEditorAdd.event,this._onDiffEditorRemove=this._register(new W),this.onDiffEditorRemove=this._onDiffEditorRemove.event,this._decorationOptionProviders=new Map,this._codeEditorOpenHandlers=new oi,this._modelProperties=new Map,this._codeEditors=Object.create(null),this._diffEditors=Object.create(null),this._globalStyleSheet=null}willCreateCodeEditor(){this._onWillCreateCodeEditor.fire()}addCodeEditor(e){this._codeEditors[e.getId()]=e,this._onCodeEditorAdd.fire(e)}removeCodeEditor(e){delete this._codeEditors[e.getId()]&&this._onCodeEditorRemove.fire(e)}listCodeEditors(){return Object.keys(this._codeEditors).map(e=>this._codeEditors[e])}willCreateDiffEditor(){this._onWillCreateDiffEditor.fire()}addDiffEditor(e){this._diffEditors[e.getId()]=e,this._onDiffEditorAdd.fire(e)}listDiffEditors(){return Object.keys(this._diffEditors).map(e=>this._diffEditors[e])}getFocusedCodeEditor(){let e=null;const t=this.listCodeEditors();for(const i of t){if(i.hasTextFocus())return i;i.hasWidgetFocus()&&(e=i)}return e}removeDecorationType(e){const t=this._decorationOptionProviders.get(e);t&&(t.refCount--,t.refCount<=0&&(this._decorationOptionProviders.delete(e),t.dispose(),this.listCodeEditors().forEach(i=>i.removeDecorationsByType(e))))}setModelProperty(e,t,i){const n=e.toString();let s;this._modelProperties.has(n)?s=this._modelProperties.get(n):(s=new Map,this._modelProperties.set(n,s)),s.set(t,i)}getModelProperty(e,t){const i=e.toString();if(this._modelProperties.has(i))return this._modelProperties.get(i).get(t)}async openCodeEditor(e,t,i){for(const n of this._codeEditorOpenHandlers){const s=await n(e,t,i);if(s!==null)return s}return null}registerCodeEditorOpenHandler(e){const t=this._codeEditorOpenHandlers.unshift(e);return be(t)}};or=Ac([Pc(0,Tn)],or);var Wc=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},rr=function(a,e){return function(t,i){e(t,i,a)}},ls,mt;let hs=(mt=class{constructor(e,t,i){this._options=e,this._languageService=t,this._openerService=i,this._onDidRenderAsync=new W,this.onDidRenderAsync=this._onDidRenderAsync.event}dispose(){this._onDidRenderAsync.dispose()}render(e,t,i){if(!e)return{element:document.createElement("span"),dispose:()=>{}};const n=new Me,s=n.add(_c(e,{...this._getRenderOptions(e,n),...t},i));return s.element.classList.add("rendered-markdown"),{element:s.element,dispose:()=>n.dispose()}}_getRenderOptions(e,t){return{codeBlockRenderer:async(i,n)=>{var d,l;let s;i?s=this._languageService.getLanguageIdByLanguageName(i):this._options.editor&&(s=(d=this._options.editor.getModel())==null?void 0:d.getLanguageId()),s||(s=jd);const o=await $d(this._languageService,n,s),r=document.createElement("span");if(r.innerHTML=((l=ls._ttpTokenizer)==null?void 0:l.createHTML(o))??o,this._options.editor){const h=this._options.editor.getOption(50);ge(r,h)}else this._options.codeBlockFontFamily&&(r.style.fontFamily=this._options.codeBlockFontFamily);return this._options.codeBlockFontSize!==void 0&&(r.style.fontSize=this._options.codeBlockFontSize),r},asyncRenderCallback:()=>this._onDidRenderAsync.fire(),actionHandler:{callback:i=>Ma(this._openerService,i,e.isTrusted),disposables:t}}}},ls=mt,mt._ttpTokenizer=oo("tokenizeToString",{createHTML(e){return e}}),mt);hs=ls=Wc([rr(1,Gd),rr(2,ua)],hs);async function Ma(a,e,t){try{return await a.open(e,{fromUserGesture:!0,allowContributedOpeners:!0,allowCommands:Hc(t)})}catch(i){return xe(i),!1}}function Hc(a){return a===!0?!0:a&&Array.isArray(a.enabledCommands)?a.enabledCommands:!1}var kc=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},ei=function(a,e){return function(t,i){e(t,i,a)}};const We=Bi;let cs=class extends wa{get _targetWindow(){return G(this._target.targetElements[0])}get _targetDocumentElement(){return G(this._target.targetElements[0]).document.documentElement}get isDisposed(){return this._isDisposed}get isMouseIn(){return this._lockMouseTracker.isMouseIn}get domNode(){return this._hover.containerDomNode}get onDispose(){return this._onDispose.event}get onRequestLayout(){return this._onRequestLayout.event}get anchor(){return this._hoverPosition===2?0:1}get x(){return this._x}get y(){return this._y}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked!==e&&(this._isLocked=e,this._hoverContainer.classList.toggle("locked",this._isLocked))}constructor(e,t,i,n,s,o){var u,f,_,C,w,p,g;super(),this._keybindingService=t,this._configurationService=i,this._openerService=n,this._instantiationService=s,this._accessibilityService=o,this._messageListeners=new Me,this._isDisposed=!1,this._forcePosition=!1,this._x=0,this._y=0,this._isLocked=!1,this._enableFocusTraps=!1,this._addedFocusTrap=!1,this._onDispose=this._register(new W),this._onRequestLayout=this._register(new W),this._linkHandler=e.linkHandler||(v=>Ma(this._openerService,v,Xn(e.content)?e.content.isTrusted:void 0)),this._target="targetElements"in e.target?e.target:new Fc(e.target),this._hoverPointer=(u=e.appearance)!=null&&u.showPointer?We("div.workbench-hover-pointer"):void 0,this._hover=this._register(new dc),this._hover.containerDomNode.classList.add("workbench-hover","fadeIn"),(f=e.appearance)!=null&&f.compact&&this._hover.containerDomNode.classList.add("workbench-hover","compact"),(_=e.appearance)!=null&&_.skipFadeInAnimation&&this._hover.containerDomNode.classList.add("skip-fade-in"),e.additionalClasses&&this._hover.containerDomNode.classList.add(...e.additionalClasses),(C=e.position)!=null&&C.forcePosition&&(this._forcePosition=!0),e.trapFocus&&(this._enableFocusTraps=!0),this._hoverPosition=((w=e.position)==null?void 0:w.hoverPosition)??3,this.onmousedown(this._hover.containerDomNode,v=>v.stopPropagation()),this.onkeydown(this._hover.containerDomNode,v=>{v.equals(9)&&this.dispose()}),this._register(O(this._targetWindow,"blur",()=>this.dispose()));const r=We("div.hover-row.markdown-hover"),d=We("div.hover-contents");if(typeof e.content=="string")d.textContent=e.content,d.style.whiteSpace="pre-wrap";else if(gi(e.content))d.appendChild(e.content),d.classList.add("html-hover-contents");else{const v=e.content,m=this._instantiationService.createInstance(hs,{codeBlockFontFamily:this._configurationService.getValue("editor").fontFamily||Zd.fontFamily}),{element:b}=m.render(v,{actionHandler:{callback:y=>this._linkHandler(y),disposables:this._messageListeners},asyncRenderCallback:()=>{d.classList.add("code-hover-contents"),this.layout(),this._onRequestLayout.fire()}});d.appendChild(b)}if(r.appendChild(d),this._hover.contentsDomNode.appendChild(r),e.actions&&e.actions.length>0){const v=We("div.hover-row.status-bar"),m=We("div.actions");e.actions.forEach(b=>{const y=this._keybindingService.lookupKeybinding(b.commandId),N=y?y.getLabel():null;lc.render(m,{label:b.label,commandId:b.commandId,run:S=>{b.run(S),this.dispose()},iconClass:b.iconClass},N)}),v.appendChild(m),this._hover.containerDomNode.appendChild(v)}this._hoverContainer=We("div.workbench-hover-container"),this._hoverPointer&&this._hoverContainer.appendChild(this._hoverPointer),this._hoverContainer.appendChild(this._hover.containerDomNode);let l;if(e.actions&&e.actions.length>0?l=!1:((p=e.persistence)==null?void 0:p.hideOnHover)===void 0?l=typeof e.content=="string"||Xn(e.content)&&!e.content.value.includes("](")&&!e.content.value.includes("</a>"):l=e.persistence.hideOnHover,(g=e.appearance)!=null&&g.showHoverHint){const v=We("div.hover-row.status-bar"),m=We("div.info");m.textContent=F("hoverhint","Hold {0} key to mouse over",ut?"Option":"Alt"),v.appendChild(m),this._hover.containerDomNode.appendChild(v)}const h=[...this._target.targetElements];l||h.push(this._hoverContainer);const c=this._register(new ar(h));if(this._register(c.onMouseOut(()=>{this._isLocked||this.dispose()})),l){const v=[...this._target.targetElements,this._hoverContainer];this._lockMouseTracker=this._register(new ar(v)),this._register(this._lockMouseTracker.onMouseOut(()=>{this._isLocked||this.dispose()}))}else this._lockMouseTracker=c}addFocusTrap(){if(!this._enableFocusTraps||this._addedFocusTrap)return;this._addedFocusTrap=!0;const e=this._hover.containerDomNode,t=this.findLastFocusableChild(this._hover.containerDomNode);if(t){const i=Kh(this._hoverContainer,We("div")),n=Yh(this._hoverContainer,We("div"));i.tabIndex=0,n.tabIndex=0,this._register(O(n,"focus",s=>{e.focus(),s.preventDefault()})),this._register(O(i,"focus",s=>{t.focus(),s.preventDefault()}))}}findLastFocusableChild(e){if(e.hasChildNodes())for(let t=0;t<e.childNodes.length;t++){const i=e.childNodes.item(e.childNodes.length-t-1);if(i.nodeType===i.ELEMENT_NODE){const s=i;if(typeof s.tabIndex=="number"&&s.tabIndex>=0)return s}const n=this.findLastFocusableChild(i);if(n)return n}}render(e){var n;e.appendChild(this._hoverContainer);const i=this._hoverContainer.contains(this._hoverContainer.ownerDocument.activeElement)&&hc(this._configurationService.getValue("accessibility.verbosity.hover")===!0&&this._accessibilityService.isScreenReaderOptimized(),(n=this._keybindingService.lookupKeybinding("editor.action.accessibleView"))==null?void 0:n.getAriaLabel());i&&ba(i),this.layout(),this.addFocusTrap()}layout(){this._hover.containerDomNode.classList.remove("right-aligned"),this._hover.contentsDomNode.style.maxHeight="";const e=h=>{const c=qh(h),u=h.getBoundingClientRect();return{top:u.top*c,bottom:u.bottom*c,right:u.right*c,left:u.left*c}},t=this._target.targetElements.map(h=>e(h)),{top:i,right:n,bottom:s,left:o}=t[0],r=n-o,d=s-i,l={top:i,right:n,bottom:s,left:o,width:r,height:d,center:{x:o+r/2,y:i+d/2}};if(this.adjustHorizontalHoverPosition(l),this.adjustVerticalHoverPosition(l),this.adjustHoverMaxHeight(l),this._hoverContainer.style.padding="",this._hoverContainer.style.margin="",this._hoverPointer){switch(this._hoverPosition){case 1:l.left+=3,l.right+=3,this._hoverContainer.style.paddingLeft="3px",this._hoverContainer.style.marginLeft="-3px";break;case 0:l.left-=3,l.right-=3,this._hoverContainer.style.paddingRight="3px",this._hoverContainer.style.marginRight="-3px";break;case 2:l.top+=3,l.bottom+=3,this._hoverContainer.style.paddingTop="3px",this._hoverContainer.style.marginTop="-3px";break;case 3:l.top-=3,l.bottom-=3,this._hoverContainer.style.paddingBottom="3px",this._hoverContainer.style.marginBottom="-3px";break}l.center.x=l.left+r/2,l.center.y=l.top+d/2}this.computeXCordinate(l),this.computeYCordinate(l),this._hoverPointer&&(this._hoverPointer.classList.remove("top"),this._hoverPointer.classList.remove("left"),this._hoverPointer.classList.remove("right"),this._hoverPointer.classList.remove("bottom"),this.setHoverPointerPosition(l)),this._hover.onContentsChanged()}computeXCordinate(e){const t=this._hover.containerDomNode.clientWidth+2;this._target.x!==void 0?this._x=this._target.x:this._hoverPosition===1?this._x=e.right:this._hoverPosition===0?this._x=e.left-t:(this._hoverPointer?this._x=e.center.x-this._hover.containerDomNode.clientWidth/2:this._x=e.left,this._x+t>=this._targetDocumentElement.clientWidth&&(this._hover.containerDomNode.classList.add("right-aligned"),this._x=Math.max(this._targetDocumentElement.clientWidth-t-2,this._targetDocumentElement.clientLeft))),this._x<this._targetDocumentElement.clientLeft&&(this._x=e.left+2)}computeYCordinate(e){this._target.y!==void 0?this._y=this._target.y:this._hoverPosition===3?this._y=e.top:this._hoverPosition===2?this._y=e.bottom-2:this._hoverPointer?this._y=e.center.y+this._hover.containerDomNode.clientHeight/2:this._y=e.bottom,this._y>this._targetWindow.innerHeight&&(this._y=e.bottom)}adjustHorizontalHoverPosition(e){if(this._target.x!==void 0)return;const t=this._hoverPointer?3:0;if(this._forcePosition){const i=t+2;this._hoverPosition===1?this._hover.containerDomNode.style.maxWidth=`${this._targetDocumentElement.clientWidth-e.right-i}px`:this._hoverPosition===0&&(this._hover.containerDomNode.style.maxWidth=`${e.left-i}px`);return}this._hoverPosition===1?this._targetDocumentElement.clientWidth-e.right<this._hover.containerDomNode.clientWidth+t&&(e.left>=this._hover.containerDomNode.clientWidth+t?this._hoverPosition=0:this._hoverPosition=2):this._hoverPosition===0&&(e.left<this._hover.containerDomNode.clientWidth+t&&(this._targetDocumentElement.clientWidth-e.right>=this._hover.containerDomNode.clientWidth+t?this._hoverPosition=1:this._hoverPosition=2),e.left-this._hover.containerDomNode.clientWidth-t<=this._targetDocumentElement.clientLeft&&(this._hoverPosition=1))}adjustVerticalHoverPosition(e){if(this._target.y!==void 0||this._forcePosition)return;const t=this._hoverPointer?3:0;this._hoverPosition===3?e.top-this._hover.containerDomNode.clientHeight-t<0&&(this._hoverPosition=2):this._hoverPosition===2&&e.bottom+this._hover.containerDomNode.clientHeight+t>this._targetWindow.innerHeight&&(this._hoverPosition=3)}adjustHoverMaxHeight(e){let t=this._targetWindow.innerHeight/2;if(this._forcePosition){const i=(this._hoverPointer?3:0)+2;this._hoverPosition===3?t=Math.min(t,e.top-i):this._hoverPosition===2&&(t=Math.min(t,this._targetWindow.innerHeight-e.bottom-i))}if(this._hover.containerDomNode.style.maxHeight=`${t}px`,this._hover.contentsDomNode.clientHeight<this._hover.contentsDomNode.scrollHeight){const i=`${this._hover.scrollbar.options.verticalScrollbarSize}px`;this._hover.contentsDomNode.style.paddingRight!==i&&(this._hover.contentsDomNode.style.paddingRight=i)}}setHoverPointerPosition(e){if(this._hoverPointer)switch(this._hoverPosition){case 0:case 1:{this._hoverPointer.classList.add(this._hoverPosition===0?"right":"left");const t=this._hover.containerDomNode.clientHeight;t>e.height?this._hoverPointer.style.top=`${e.center.y-(this._y-t)-3}px`:this._hoverPointer.style.top=`${Math.round(t/2)-3}px`;break}case 3:case 2:{this._hoverPointer.classList.add(this._hoverPosition===3?"bottom":"top");const t=this._hover.containerDomNode.clientWidth;let i=Math.round(t/2)-3;const n=this._x+i;(n<e.left||n>e.right)&&(i=e.center.x-this._x-3),this._hoverPointer.style.left=`${i}px`;break}}}focus(){this._hover.containerDomNode.focus()}dispose(){this._isDisposed||(this._onDispose.fire(),this._hoverContainer.remove(),this._messageListeners.dispose(),this._target.dispose(),super.dispose()),this._isDisposed=!0}};cs=kc([ei(1,so),ei(2,In),ei(3,ua),ei(4,me),ei(5,yt)],cs);class ar extends wa{get onMouseOut(){return this._onMouseOut.event}get isMouseIn(){return this._isMouseIn}constructor(e){super(),this._elements=e,this._isMouseIn=!0,this._onMouseOut=this._register(new W),this._elements.forEach(t=>this.onmouseover(t,()=>this._onTargetMouseOver(t))),this._elements.forEach(t=>this.onmouseleave(t,()=>this._onTargetMouseLeave(t)))}_onTargetMouseOver(e){this._isMouseIn=!0,this._clearEvaluateMouseStateTimeout(e)}_onTargetMouseLeave(e){this._isMouseIn=!1,this._evaluateMouseState(e)}_evaluateMouseState(e){this._clearEvaluateMouseStateTimeout(e),this._mouseTimeout=G(e).setTimeout(()=>this._fireIfMouseOutside(),0)}_clearEvaluateMouseStateTimeout(e){this._mouseTimeout&&(G(e).clearTimeout(this._mouseTimeout),this._mouseTimeout=void 0)}_fireIfMouseOutside(){this._isMouseIn||this._onMouseOut.fire()}}class Fc{constructor(e){this._element=e,this.targetElements=[this._element]}dispose(){}}class Vc{constructor(e,t,i){this.hoverDelegate=e,this.target=t,this.fadeInAnimation=i}async update(e,t,i){if(this._cancellationTokenSource&&(this._cancellationTokenSource.dispose(!0),this._cancellationTokenSource=void 0),this.isDisposed)return;let n;if(e===void 0||Ci(e)||gi(e))n=e;else if(!Xa(e.markdown))n=e.markdown??e.markdownNotSupportedFallback;else{this._hoverWidget||this.show(F("iconLabel.loading","Loading..."),t,i),this._cancellationTokenSource=new Gs;const s=this._cancellationTokenSource.token;if(n=await e.markdown(s),n===void 0&&(n=e.markdownNotSupportedFallback),this.isDisposed||s.isCancellationRequested)return}this.show(n,t,i)}show(e,t,i){var s;const n=this._hoverWidget;if(this.hasContent(e)){const o={content:e,target:this.target,actions:i==null?void 0:i.actions,linkHandler:i==null?void 0:i.linkHandler,trapFocus:i==null?void 0:i.trapFocus,appearance:{showPointer:this.hoverDelegate.placement==="element",skipFadeInAnimation:!this.fadeInAnimation||!!n,showHoverHint:(s=i==null?void 0:i.appearance)==null?void 0:s.showHoverHint},position:{hoverPosition:2}};this._hoverWidget=this.hoverDelegate.showHover(o,t)}n==null||n.dispose()}hasContent(e){return e?Xn(e)?!!e.value:!0:!1}get isDisposed(){var e;return(e=this._hoverWidget)==null?void 0:e.isDisposed}dispose(){var e,t;(e=this._hoverWidget)==null||e.dispose(),(t=this._cancellationTokenSource)==null||t.dispose(!0),this._cancellationTokenSource=void 0}}var Bc=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},ti=function(a,e){return function(t,i){e(t,i,a)}};let us=class extends U{constructor(e,t,i,n,s){super(),this._instantiationService=e,this._keybindingService=i,this._layoutService=n,this._accessibilityService=s,this._managedHovers=new Map,t.onDidShowContextMenu(()=>this.hideHover()),this._contextViewHandler=this._register(new fh(this._layoutService))}showHover(e,t,i){var d,l,h,c;if(dr(this._currentHoverOptions)===dr(e)||this._currentHover&&((l=(d=this._currentHoverOptions)==null?void 0:d.persistence)!=null&&l.sticky))return;this._currentHoverOptions=e,this._lastHoverOptions=e;const n=e.trapFocus||this._accessibilityService.isScreenReaderOptimized(),s=wt();i||(n&&s?s.classList.contains("monaco-hover")||(this._lastFocusedElementBeforeOpen=s):this._lastFocusedElementBeforeOpen=void 0);const o=new Me,r=this._instantiationService.createInstance(cs,e);if((h=e.persistence)!=null&&h.sticky&&(r.isLocked=!0),r.onDispose(()=>{var f,_;((f=this._currentHover)==null?void 0:f.domNode)&&Qh(this._currentHover.domNode)&&((_=this._lastFocusedElementBeforeOpen)==null||_.focus()),this._currentHoverOptions===e&&(this._currentHoverOptions=void 0),o.dispose()},void 0,o),!e.container){const u=gi(e.target)?e.target:e.target.targetElements[0];e.container=this._layoutService.getContainer(G(u))}if(this._contextViewHandler.showContextView(new Uc(r,t),e.container),r.onRequestLayout(()=>this._contextViewHandler.layout(),void 0,o),(c=e.persistence)!=null&&c.sticky)o.add(O(G(e.container).document,K.MOUSE_DOWN,u=>{Xh(u.target,r.domNode)||this.doHideHover()}));else{if("targetElements"in e.target)for(const f of e.target.targetElements)o.add(O(f,K.CLICK,()=>this.hideHover()));else o.add(O(e.target,K.CLICK,()=>this.hideHover()));const u=wt();if(u){const f=G(u).document;o.add(O(u,K.KEY_DOWN,_=>{var C;return this._keyDown(_,r,!!((C=e.persistence)!=null&&C.hideOnKeyDown))})),o.add(O(f,K.KEY_DOWN,_=>{var C;return this._keyDown(_,r,!!((C=e.persistence)!=null&&C.hideOnKeyDown))})),o.add(O(u,K.KEY_UP,_=>this._keyUp(_,r))),o.add(O(f,K.KEY_UP,_=>this._keyUp(_,r)))}}if("IntersectionObserver"in Pn){const u=new IntersectionObserver(_=>this._intersectionChange(_,r),{threshold:0}),f="targetElements"in e.target?e.target.targetElements[0]:e.target;u.observe(f),o.add(be(()=>u.disconnect()))}return this._currentHover=r,r}hideHover(){var e;(e=this._currentHover)!=null&&e.isLocked||!this._currentHoverOptions||this.doHideHover()}doHideHover(){this._currentHover=void 0,this._currentHoverOptions=void 0,this._contextViewHandler.hideContextView()}_intersectionChange(e,t){e[e.length-1].isIntersecting||t.dispose()}showAndFocusLastHover(){this._lastHoverOptions&&this.showHover(this._lastHoverOptions,!0,!0)}_keyDown(e,t,i){var o,r;if(e.key==="Alt"){t.isLocked=!0;return}const n=new rs(e);this._keybindingService.resolveKeyboardEvent(n).getSingleModifierDispatchChords().some(d=>!!d)||this._keybindingService.softDispatch(n,n.target).kind!==0||i&&(!((o=this._currentHoverOptions)!=null&&o.trapFocus)||e.key!=="Tab")&&(this.hideHover(),(r=this._lastFocusedElementBeforeOpen)==null||r.focus())}_keyUp(e,t){var i;e.key==="Alt"&&(t.isLocked=!1,t.isMouseIn||(this.hideHover(),(i=this._lastFocusedElementBeforeOpen)==null||i.focus()))}setupManagedHover(e,t,i,n){t.setAttribute("custom-hover","true"),t.title!==""&&(console.warn("HTML element already has a title attribute, which will conflict with the custom hover. Please remove the title attribute."),console.trace("Stack trace:",t.title),t.title="");let s,o;const r=(v,m)=>{var y;const b=o!==void 0;v&&(o==null||o.dispose(),o=void 0),m&&(s==null||s.dispose(),s=void 0),b&&((y=e.onDidHideHover)==null||y.call(e),o=void 0)},d=(v,m,b,y)=>new jr(async()=>{(!o||o.isDisposed)&&(o=new Vc(e,b||t,v>0),await o.update(typeof i=="function"?i():i,m,{...n,trapFocus:y}))},v);let l=!1;const h=O(t,K.MOUSE_DOWN,()=>{l=!0,r(!0,!0)},!0),c=O(t,K.MOUSE_UP,()=>{l=!1},!0),u=O(t,K.MOUSE_LEAVE,v=>{l=!1,r(!1,v.fromElement===t)},!0),f=v=>{if(s)return;const m=new Me,b={targetElements:[t],dispose:()=>{}};if(e.placement===void 0||e.placement==="mouse"){const y=N=>{b.x=N.x+10,gi(N.target)&&lr(N.target,t)!==t&&r(!0,!0)};m.add(O(t,K.MOUSE_MOVE,y,!0))}s=m,!(gi(v.target)&&lr(v.target,t)!==t)&&m.add(d(e.delay,!1,b))},_=O(t,K.MOUSE_OVER,f,!0),C=()=>{if(l||s)return;const v={targetElements:[t],dispose:()=>{}},m=new Me,b=()=>r(!0,!0);m.add(O(t,K.BLUR,b,!0)),m.add(d(e.delay,!1,v)),s=m};let w;const p=t.tagName.toLowerCase();p!=="input"&&p!=="textarea"&&(w=O(t,K.FOCUS,C,!0));const g={show:v=>{r(!1,!0),d(0,v,void 0,v)},hide:()=>{r(!0,!0)},update:async(v,m)=>{i=v,await(o==null?void 0:o.update(i,void 0,m))},dispose:()=>{this._managedHovers.delete(t),_.dispose(),u.dispose(),h.dispose(),c.dispose(),w==null||w.dispose(),r(!0,!0)}};return this._managedHovers.set(t,g),g}showManagedHover(e){const t=this._managedHovers.get(e);t&&t.show(!0)}dispose(){this._managedHovers.forEach(e=>e.dispose()),super.dispose()}};us=Bc([ti(0,me),ti(1,uh),ti(2,so),ti(3,gh),ti(4,yt)],us);function dr(a){if(a!==void 0)return(a==null?void 0:a.id)??a}class Uc{get anchorPosition(){return this._hover.anchor}constructor(e,t=!1){this._hover=e,this._focus=t,this.layer=1}render(e){return this._hover.render(e),this._focus&&this._hover.focus(),this._hover}getAnchor(){return{x:this._hover.x,y:this._hover.y}}layout(){this._hover.layout()}}function lr(a,e){for(e=e??G(a).document.body;!a.hasAttribute("custom-hover")&&a!==e;)a=a.parentElement;return a}ga(mh,us,1);St((a,e)=>{const t=a.getColor(_h);t&&(e.addRule(`.monaco-workbench .workbench-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-workbench .workbench-hover hr { border-top: 1px solid ${t.transparent(.5)}; }`))});const sm=no("IWorkspaceEditService");class xa{constructor(e){this.metadata=e}static convert(e){return e.edits.map(t=>{if(Vt.is(t))return Vt.lift(t);if(Bt.is(t))return Bt.lift(t);throw new Error("Unsupported edit")})}}class Vt extends xa{static is(e){return e instanceof Vt?!0:wi(e)&&Qe.isUri(e.resource)&&wi(e.textEdit)}static lift(e){return e instanceof Vt?e:new Vt(e.resource,e.textEdit,e.versionId,e.metadata)}constructor(e,t,i=void 0,n){super(n),this.resource=e,this.textEdit=t,this.versionId=i}}class Bt extends xa{static is(e){return e instanceof Bt?!0:wi(e)&&(!!e.newResource||!!e.oldResource)}static lift(e){return e instanceof Bt?e:new Bt(e.oldResource,e.newResource,e.options,e.metadata)}constructor(e,t,i={},n){super(n),this.oldResource=e,this.newResource=t,this.options=i}}var uo=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Ki=function(a,e){return function(t,i){e(t,i,a)}};let gs=class{constructor(e){this._commandService=e}async open(e,t){if(!Ja(e,ke.command))return!1;if(!(t!=null&&t.allowCommands)||(typeof e=="string"&&(e=Qe.parse(e)),Array.isArray(t.allowCommands)&&!t.allowCommands.includes(e.path)))return!0;let i=[];try{i=So(decodeURIComponent(e.query))}catch{try{i=So(e.query)}catch{}}return Array.isArray(i)||(i=[i]),await this._commandService.executeCommand(e.path,...i),!0}};gs=uo([Ki(0,On)],gs);let fs=class{constructor(e){this._editorService=e}async open(e,t){typeof e=="string"&&(e=Qe.parse(e));const{selection:i,uri:n}=ph(e);return e=n,e.scheme===ke.file&&(e=ed(e)),await this._editorService.openCodeEditor({resource:e,options:{selection:i,source:t!=null&&t.fromUserGesture?Yo.USER:Yo.API,...t==null?void 0:t.editorOptions}},this._editorService.getFocusedCodeEditor(),t==null?void 0:t.openToSide),!0}};fs=uo([Ki(0,Re)],fs);let hr=class{constructor(e,t){this._openers=new oi,this._validators=new oi,this._resolvers=new oi,this._resolvedUriTargets=new td(i=>i.with({path:null,fragment:null,query:null}).toString()),this._externalOpeners=new oi,this._defaultExternalOpener={openExternal:async i=>(Lo(i,ke.http,ke.https)?Jh(i):Pn.location.href=i,!0)},this._openers.push({open:async(i,n)=>n!=null&&n.openExternal||Lo(i,ke.mailto,ke.http,ke.https,ke.vsls)?(await this._doOpenExternal(i,n),!0):!1}),this._openers.push(new gs(t)),this._openers.push(new fs(e))}registerOpener(e){return{dispose:this._openers.unshift(e)}}async open(e,t){const i=typeof e=="string"?Qe.parse(e):e,n=this._resolvedUriTargets.get(i)??e;for(const s of this._validators)if(!await s.shouldOpen(n,t))return!1;for(const s of this._openers)if(await s.open(e,t))return!0;return!1}async resolveExternalUri(e,t){for(const i of this._resolvers)try{const n=await i.resolveExternalUri(e,t);if(n)return this._resolvedUriTargets.has(n.resolved)||this._resolvedUriTargets.set(n.resolved,e),n}catch{}throw new Error("Could not resolve external URI: "+e.toString())}async _doOpenExternal(e,t){const i=typeof e=="string"?Qe.parse(e):e;let n;try{n=(await this.resolveExternalUri(i,t)).resolved}catch{n=i}let s;if(typeof e=="string"&&i.toString()===n.toString()?s=e:s=encodeURI(n.toString(!0)),t!=null&&t.allowContributedOpeners){const o=typeof(t==null?void 0:t.allowContributedOpeners)=="string"?t==null?void 0:t.allowContributedOpeners:void 0;for(const r of this._externalOpeners)if(await r.openExternal(s,{sourceUri:i,preferredOpenerId:o},Do.None))return!0}return this._defaultExternalOpener.openExternal(s,{sourceUri:i},Do.None)}dispose(){this._validators.clear()}};hr=uo([Ki(0,Re),Ki(1,On)],hr);var zc=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},$c=function(a,e){return function(t,i){e(t,i,a)}},$t;let Yi=($t=class{constructor(e,t){}dispose(){}},$t.ID="editor.contrib.markerDecorations",$t);Yi=zc([$c(1,Kd)],Yi);Rc(Yi.ID,Yi,0);class Ra extends U{constructor(e,t){super(),this._onDidChange=this._register(new W),this.onDidChange=this._onDidChange.event,this._referenceDomElement=e,this._width=-1,this._height=-1,this._resizeObserver=null,this.measureReferenceDomElement(!1,t)}dispose(){this.stopObserving(),super.dispose()}getWidth(){return this._width}getHeight(){return this._height}startObserving(){if(!this._resizeObserver&&this._referenceDomElement){let e=null;const t=()=>{e?this.observe({width:e.width,height:e.height}):this.observe()};let i=!1,n=!1;const s=()=>{if(i&&!n)try{i=!1,n=!0,t()}finally{yi(G(this._referenceDomElement),()=>{n=!1,s()})}};this._resizeObserver=new ResizeObserver(o=>{o&&o[0]&&o[0].contentRect?e={width:o[0].contentRect.width,height:o[0].contentRect.height}:e=null,i=!0,s()}),this._resizeObserver.observe(this._referenceDomElement)}}stopObserving(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}observe(e){this.measureReferenceDomElement(!0,e)}measureReferenceDomElement(e,t){let i=0,n=0;t?(i=t.width,n=t.height):this._referenceDomElement&&(i=this._referenceDomElement.clientWidth,n=this._referenceDomElement.clientHeight),i=Math.max(5,i),n=Math.max(5,n),(this._width!==i||this._height!==n)&&(this._width=i,this._height=n,e&&this._onDidChange.fire())}}const Pt=class Pt{constructor(e,t){this.key=e,this.migrate=t}apply(e){const t=Pt._read(e,this.key),i=s=>Pt._read(e,s),n=(s,o)=>Pt._write(e,s,o);this.migrate(t,i,n)}static _read(e,t){if(typeof e>"u")return;const i=t.indexOf(".");if(i>=0){const n=t.substring(0,i);return this._read(e[n],t.substring(i+1))}return e[t]}static _write(e,t,i){const n=t.indexOf(".");if(n>=0){const s=t.substring(0,n);e[s]=e[s]||{},this._write(e[s],t.substring(n+1),i);return}e[t]=i}};Pt.items=[];let Li=Pt;function Ae(a,e){Li.items.push(new Li(a,e))}function _e(a,e){Ae(a,(t,i,n)=>{if(typeof t<"u"){for(const[s,o]of e)if(t===s){n(a,o);return}}})}function Gc(a){Li.items.forEach(e=>e.apply(a))}_e("wordWrap",[[!0,"on"],[!1,"off"]]);_e("lineNumbers",[[!0,"on"],[!1,"off"]]);_e("cursorBlinking",[["visible","solid"]]);_e("renderWhitespace",[[!0,"boundary"],[!1,"none"]]);_e("renderLineHighlight",[[!0,"line"],[!1,"none"]]);_e("acceptSuggestionOnEnter",[[!0,"on"],[!1,"off"]]);_e("tabCompletion",[[!1,"off"],[!0,"onlySnippets"]]);_e("hover",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);_e("parameterHints",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);_e("autoIndent",[[!1,"advanced"],[!0,"full"]]);_e("matchBrackets",[[!0,"always"],[!1,"never"]]);_e("renderFinalNewline",[[!0,"on"],[!1,"off"]]);_e("cursorSmoothCaretAnimation",[[!0,"on"],[!1,"off"]]);_e("occurrencesHighlight",[[!0,"singleFile"],[!1,"off"]]);_e("wordBasedSuggestions",[[!0,"matchingDocuments"],[!1,"off"]]);Ae("autoClosingBrackets",(a,e,t)=>{a===!1&&(t("autoClosingBrackets","never"),typeof e("autoClosingQuotes")>"u"&&t("autoClosingQuotes","never"),typeof e("autoSurround")>"u"&&t("autoSurround","never"))});Ae("renderIndentGuides",(a,e,t)=>{typeof a<"u"&&(t("renderIndentGuides",void 0),typeof e("guides.indentation")>"u"&&t("guides.indentation",!!a))});Ae("highlightActiveIndentGuide",(a,e,t)=>{typeof a<"u"&&(t("highlightActiveIndentGuide",void 0),typeof e("guides.highlightActiveIndentation")>"u"&&t("guides.highlightActiveIndentation",!!a))});const jc={method:"showMethods",function:"showFunctions",constructor:"showConstructors",deprecated:"showDeprecated",field:"showFields",variable:"showVariables",class:"showClasses",struct:"showStructs",interface:"showInterfaces",module:"showModules",property:"showProperties",event:"showEvents",operator:"showOperators",unit:"showUnits",value:"showValues",constant:"showConstants",enum:"showEnums",enumMember:"showEnumMembers",keyword:"showKeywords",text:"showWords",color:"showColors",file:"showFiles",reference:"showReferences",folder:"showFolders",typeParameter:"showTypeParameters",snippet:"showSnippets"};Ae("suggest.filteredTypes",(a,e,t)=>{if(a&&typeof a=="object"){for(const i of Object.entries(jc))a[i[0]]===!1&&typeof e(`suggest.${i[1]}`)>"u"&&t(`suggest.${i[1]}`,!1);t("suggest.filteredTypes",void 0)}});Ae("quickSuggestions",(a,e,t)=>{if(typeof a=="boolean"){const i=a?"on":"off";t("quickSuggestions",{comments:i,strings:i,other:i})}});Ae("experimental.stickyScroll.enabled",(a,e,t)=>{typeof a=="boolean"&&(t("experimental.stickyScroll.enabled",void 0),typeof e("stickyScroll.enabled")>"u"&&t("stickyScroll.enabled",a))});Ae("experimental.stickyScroll.maxLineCount",(a,e,t)=>{typeof a=="number"&&(t("experimental.stickyScroll.maxLineCount",void 0),typeof e("stickyScroll.maxLineCount")>"u"&&t("stickyScroll.maxLineCount",a))});Ae("codeActionsOnSave",(a,e,t)=>{if(a&&typeof a=="object"){let i=!1;const n={};for(const s of Object.entries(a))typeof s[1]=="boolean"?(i=!0,n[s[0]]=s[1]?"explicit":"never"):n[s[0]]=s[1];i&&t("codeActionsOnSave",n)}});Ae("codeActionWidget.includeNearbyQuickfixes",(a,e,t)=>{typeof a=="boolean"&&(t("codeActionWidget.includeNearbyQuickfixes",void 0),typeof e("codeActionWidget.includeNearbyQuickFixes")>"u"&&t("codeActionWidget.includeNearbyQuickFixes",a))});Ae("lightbulb.enabled",(a,e,t)=>{typeof a=="boolean"&&t("lightbulb.enabled",a?void 0:"off")});class Zc{constructor(){this._tabFocus=!1,this._onDidChangeTabFocus=new W,this.onDidChangeTabFocus=this._onDidChangeTabFocus.event}getTabFocusMode(){return this._tabFocus}setTabFocusMode(e){this._tabFocus=e,this._onDidChangeTabFocus.fire(this._tabFocus)}}const qi=new Zc;var Kc=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Yc=function(a,e){return function(t,i){e(t,i,a)}};let ms=class extends U{constructor(e,t,i,n,s){super(),this._accessibilityService=s,this._onDidChange=this._register(new W),this.onDidChange=this._onDidChange.event,this._onDidChangeFast=this._register(new W),this.onDidChangeFast=this._onDidChangeFast.event,this._isDominatedByLongLines=!1,this._viewLineCount=1,this._lineNumbersDigitCount=1,this._reservedHeight=0,this._glyphMarginDecorationLaneCount=1,this._computeOptionsMemory=new Yd,this.isSimpleWidget=e,this.contextMenuId=t,this._containerObserver=this._register(new Ra(n,i.dimension)),this._targetWindowId=G(n).vscodeWindowId,this._rawOptions=cr(i),this._validatedOptions=tt.validateOptions(this._rawOptions),this.options=this._computeOptions(),this.options.get(13)&&this._containerObserver.startObserving(),this._register(Rt.onDidChangeZoomLevel(()=>this._recomputeOptions())),this._register(qi.onDidChangeTabFocus(()=>this._recomputeOptions())),this._register(this._containerObserver.onDidChange(()=>this._recomputeOptions())),this._register(ir.onDidChange(()=>this._recomputeOptions())),this._register(Zi.getInstance(G(n)).onDidChange(()=>this._recomputeOptions())),this._register(this._accessibilityService.onDidChangeScreenReaderOptimized(()=>this._recomputeOptions()))}_recomputeOptions(){const e=this._computeOptions(),t=tt.checkEquals(this.options,e);t!==null&&(this.options=e,this._onDidChangeFast.fire(t),this._onDidChange.fire(t))}_computeOptions(){const e=this._readEnvConfiguration(),t=qd.createFromValidatedSettings(this._validatedOptions,e.pixelRatio,this.isSimpleWidget),i=this._readFontInfo(t),n={memory:this._computeOptionsMemory,outerWidth:e.outerWidth,outerHeight:e.outerHeight-this._reservedHeight,fontInfo:i,extraEditorClassName:e.extraEditorClassName,isDominatedByLongLines:this._isDominatedByLongLines,viewLineCount:this._viewLineCount,lineNumbersDigitCount:this._lineNumbersDigitCount,emptySelectionClipboard:e.emptySelectionClipboard,pixelRatio:e.pixelRatio,tabFocusMode:qi.getTabFocusMode(),accessibilitySupport:e.accessibilitySupport,glyphMarginDecorationLaneCount:this._glyphMarginDecorationLaneCount};return tt.computeOptions(this._validatedOptions,n)}_readEnvConfiguration(){return{extraEditorClassName:Qc(),outerWidth:this._containerObserver.getWidth(),outerHeight:this._containerObserver.getHeight(),emptySelectionClipboard:pa||Ct,pixelRatio:Zi.getInstance(Jo(this._targetWindowId,!0).window).value,accessibilitySupport:this._accessibilityService.isScreenReaderOptimized()?2:this._accessibilityService.getAccessibilitySupport()}}_readFontInfo(e){return ir.readFontInfo(Jo(this._targetWindowId,!0).window,e)}getRawOptions(){return this._rawOptions}updateOptions(e){const t=cr(e);tt.applyUpdate(this._rawOptions,t)&&(this._validatedOptions=tt.validateOptions(this._rawOptions),this._recomputeOptions())}observeContainer(e){this._containerObserver.observe(e)}setIsDominatedByLongLines(e){this._isDominatedByLongLines!==e&&(this._isDominatedByLongLines=e,this._recomputeOptions())}setModelLineCount(e){const t=qc(e);this._lineNumbersDigitCount!==t&&(this._lineNumbersDigitCount=t,this._recomputeOptions())}setViewLineCount(e){this._viewLineCount!==e&&(this._viewLineCount=e,this._recomputeOptions())}setReservedHeight(e){this._reservedHeight!==e&&(this._reservedHeight=e,this._recomputeOptions())}setGlyphMarginDecorationLaneCount(e){this._glyphMarginDecorationLaneCount!==e&&(this._glyphMarginDecorationLaneCount=e,this._recomputeOptions())}};ms=Kc([Yc(4,yt)],ms);function qc(a){let e=0;for(;a;)a=Math.floor(a/10),e++;return e||1}function Qc(){let a="";return!bi&&!Bh&&(a+="no-user-select "),bi&&(a+="no-minimap-shadow ",a+="enable-user-select "),ut&&(a+="mac "),a}class Xc{constructor(){this._values=[]}_read(e){return this._values[e]}get(e){return this._values[e]}_write(e,t){this._values[e]=t}}class Jc{constructor(){this._values=[]}_read(e){if(e>=this._values.length)throw new Error("Cannot read uninitialized value");return this._values[e]}get(e){return this._read(e)}_write(e,t){this._values[e]=t}}class tt{static validateOptions(e){const t=new Xc;for(const i of Ii){const n=i.name==="_never_"?void 0:e[i.name];t._write(i.id,i.validate(n))}return t}static computeOptions(e,t){const i=new Jc;for(const n of Ii)i._write(n.id,n.compute(t,i,e._read(n.id)));return i}static _deepEquals(e,t){if(typeof e!="object"||typeof t!="object"||!e||!t)return e===t;if(Array.isArray(e)||Array.isArray(t))return Array.isArray(e)&&Array.isArray(t)?js(e,t):!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!tt._deepEquals(e[i],t[i]))return!1;return!0}static checkEquals(e,t){const i=[];let n=!1;for(const s of Ii){const o=!tt._deepEquals(e._read(s.id),t._read(s.id));i[s.id]=o,o&&(n=!0)}return n?new Qd(i):null}static applyUpdate(e,t){let i=!1;for(const n of Ii)if(t.hasOwnProperty(n.name)){const s=n.applyUpdate(e[n.name],t[n.name]);e[n.name]=s.newValue,i=i||s.didChange}return i}}function cr(a){const e=id(a);return Gc(e),e}class kn{constructor(e,t){this.x=e,this.y=t,this._pageCoordinatesBrand=void 0}toClientCoordinates(e){return new Ea(this.x-e.scrollX,this.y-e.scrollY)}}class Ea{constructor(e,t){this.clientX=e,this.clientY=t,this._clientCoordinatesBrand=void 0}toPageCoordinates(e){return new kn(this.clientX+e.scrollX,this.clientY+e.scrollY)}}class eu{constructor(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n,this._editorPagePositionBrand=void 0}}class tu{constructor(e,t){this.x=e,this.y=t,this._positionRelativeToEditorBrand=void 0}}function go(a){const e=Si(a);return new eu(e.left,e.top,e.width,e.height)}function fo(a,e,t){const i=e.width/a.offsetWidth,n=e.height/a.offsetHeight,s=(t.x-e.x)/i,o=(t.y-e.y)/n;return new tu(s,o)}class st extends Uh{constructor(e,t,i){super(G(i),e),this._editorMouseEventBrand=void 0,this.isFromPointerCapture=t,this.pos=new kn(this.posx,this.posy),this.editorPos=go(i),this.relativePos=fo(i,this.editorPos,this.pos)}}class iu{constructor(e){this._editorViewDomNode=e}_create(e){return new st(e,!1,this._editorViewDomNode)}onContextMenu(e,t){return O(e,"contextmenu",i=>{t(this._create(i))})}onMouseUp(e,t){return O(e,"mouseup",i=>{t(this._create(i))})}onMouseDown(e,t){return O(e,K.MOUSE_DOWN,i=>{t(this._create(i))})}onPointerDown(e,t){return O(e,K.POINTER_DOWN,i=>{t(this._create(i),i.pointerId)})}onMouseLeave(e,t){return O(e,K.MOUSE_LEAVE,i=>{t(this._create(i))})}onMouseMove(e,t){return O(e,"mousemove",i=>t(this._create(i)))}}class nu{constructor(e){this._editorViewDomNode=e}_create(e){return new st(e,!1,this._editorViewDomNode)}onPointerUp(e,t){return O(e,"pointerup",i=>{t(this._create(i))})}onPointerDown(e,t){return O(e,K.POINTER_DOWN,i=>{t(this._create(i),i.pointerId)})}onPointerLeave(e,t){return O(e,K.POINTER_LEAVE,i=>{t(this._create(i))})}onPointerMove(e,t){return O(e,"pointermove",i=>t(this._create(i)))}}class su extends U{constructor(e){super(),this._editorViewDomNode=e,this._globalPointerMoveMonitor=this._register(new va),this._keydownListener=null}startMonitoring(e,t,i,n,s){this._keydownListener=fi(e.ownerDocument,"keydown",o=>{o.toKeyCodeChord().isModifierKey()||this._globalPointerMoveMonitor.stopMonitoring(!0,o.browserEvent)},!0),this._globalPointerMoveMonitor.startMonitoring(e,t,i,o=>{n(new st(o,!0,this._editorViewDomNode))},o=>{this._keydownListener.dispose(),s(o)})}stopMonitoring(){this._globalPointerMoveMonitor.stopMonitoring(!0)}}const cn=class cn{constructor(e){this._editor=e,this._instanceId=++cn._idPool,this._counter=0,this._rules=new Map,this._garbageCollectionScheduler=new gt(()=>this.garbageCollect(),1e3)}createClassNameRef(e){const t=this.getOrCreateRule(e);return t.increaseRefCount(),{className:t.className,dispose:()=>{t.decreaseRefCount(),this._garbageCollectionScheduler.schedule()}}}getOrCreateRule(e){const t=this.computeUniqueKey(e);let i=this._rules.get(t);if(!i){const n=this._counter++;i=new ou(t,`dyn-rule-${this._instanceId}-${n}`,ec(this._editor.getContainerDomNode())?this._editor.getContainerDomNode():void 0,e),this._rules.set(t,i)}return i}computeUniqueKey(e){return JSON.stringify(e)}garbageCollect(){for(const e of this._rules.values())e.hasReferences()||(this._rules.delete(e.key),e.dispose())}};cn._idPool=0;let ur=cn;class ou{constructor(e,t,i,n){this.key=e,this.className=t,this.properties=n,this._referenceCount=0,this._styleElementDisposables=new Me,this._styleElement=tc(i,void 0,this._styleElementDisposables),this._styleElement.textContent=this.getCssText(this.className,this.properties)}getCssText(e,t){let i=`.${e} {`;for(const n in t){const s=t[n];let o;typeof s=="object"?o=vh(s.id):o=s;const r=ru(n);i+=`
	${r}: ${o};`}return i+=`
}`,i}dispose(){this._styleElementDisposables.dispose(),this._styleElement=void 0}increaseRefCount(){this._referenceCount++}decreaseRefCount(){this._referenceCount--}hasReferences(){return this._referenceCount>0}}function ru(a){return a.replace(/(^[A-Z])/,([e])=>e.toLowerCase()).replace(/([A-Z])/g,([e])=>`-${e.toLowerCase()}`)}class pe extends Ri{constructor(e){super(),this._context=e,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}}class Ie{static write(e,t){e.setAttribute("data-mprt",String(t))}static read(e){const t=e.getAttribute("data-mprt");return t===null?0:parseInt(t,10)}static collect(e,t){const i=[];let n=0;for(;e&&e!==e.ownerDocument.body&&e!==t;)e.nodeType===e.ELEMENT_NODE&&(i[n++]=this.read(e)),e=e.parentElement;const s=new Uint8Array(n);for(let o=0;o<n;o++)s[o]=i[n-o-1];return s}}class au{constructor(e,t){this._restrictedRenderingContextBrand=void 0,this._viewLayout=e,this.viewportData=t,this.scrollWidth=this._viewLayout.getScrollWidth(),this.scrollHeight=this._viewLayout.getScrollHeight(),this.visibleRange=this.viewportData.visibleRange,this.bigNumbersDelta=this.viewportData.bigNumbersDelta;const i=this._viewLayout.getCurrentViewport();this.scrollTop=i.top,this.scrollLeft=i.left,this.viewportWidth=i.width,this.viewportHeight=i.height}getScrolledTopFromAbsoluteTop(e){return e-this.scrollTop}getVerticalOffsetForLineNumber(e,t){return this._viewLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t){return this._viewLayout.getVerticalOffsetAfterLineNumber(e,t)}getDecorationsInViewport(){return this.viewportData.getDecorationsInViewport()}}class du extends au{constructor(e,t,i){super(e,t),this._renderingContextBrand=void 0,this._viewLines=i}linesVisibleRangesForRange(e,t){return this._viewLines.linesVisibleRangesForRange(e,t)}visibleRangeForPosition(e){return this._viewLines.visibleRangeForPosition(e)}}class lu{constructor(e,t,i,n){this.outsideRenderedLine=e,this.lineNumber=t,this.ranges=i,this.continuesOnNextLine=n}}class Fn{static from(e){const t=new Array(e.length);for(let i=0,n=e.length;i<n;i++){const s=e[i];t[i]=new Fn(s.left,s.width)}return t}constructor(e,t){this._horizontalRangeBrand=void 0,this.left=Math.round(e),this.width=Math.round(t)}toString(){return`[${this.left},${this.width}]`}}class ft{constructor(e,t){this._floatHorizontalRangeBrand=void 0,this.left=e,this.width=t}toString(){return`[${this.left},${this.width}]`}static compare(e,t){return e.left-t.left}}class hu{constructor(e,t){this.outsideRenderedLine=e,this.originalLeft=t,this.left=Math.round(this.originalLeft)}}class gr{constructor(e,t){this.outsideRenderedLine=e,this.ranges=t}}class Ui{static _createRange(){return this._handyReadyRange||(this._handyReadyRange=document.createRange()),this._handyReadyRange}static _detachRange(e,t){e.selectNodeContents(t)}static _readClientRects(e,t,i,n,s){const o=this._createRange();try{return o.setStart(e,t),o.setEnd(i,n),o.getClientRects()}catch{return null}finally{this._detachRange(o,s)}}static _mergeAdjacentRanges(e){if(e.length===1)return e;e.sort(ft.compare);const t=[];let i=0,n=e[0];for(let s=1,o=e.length;s<o;s++){const r=e[s];n.left+n.width+.9>=r.left?n.width=Math.max(n.width,r.left+r.width-n.left):(t[i++]=n,n=r)}return t[i++]=n,t}static _createHorizontalRangesFromClientRects(e,t,i){if(!e||e.length===0)return null;const n=[];for(let s=0,o=e.length;s<o;s++){const r=e[s];n[s]=new ft(Math.max(0,(r.left-t)/i),r.width/i)}return this._mergeAdjacentRanges(n)}static readHorizontalRanges(e,t,i,n,s,o){const d=e.children.length-1;if(0>d)return null;if(t=Math.min(d,Math.max(0,t)),n=Math.min(d,Math.max(0,n)),t===n&&i===s&&i===0&&!e.children[t].firstChild){const u=e.children[t].getClientRects();return o.markDidDomLayout(),this._createHorizontalRangesFromClientRects(u,o.clientRectDeltaLeft,o.clientRectScale)}t!==n&&n>0&&s===0&&(n--,s=1073741824);let l=e.children[t].firstChild,h=e.children[n].firstChild;if((!l||!h)&&(!l&&i===0&&t>0&&(l=e.children[t-1].firstChild,i=1073741824),!h&&s===0&&n>0&&(h=e.children[n-1].firstChild,s=1073741824)),!l||!h)return null;i=Math.min(l.textContent.length,Math.max(0,i)),s=Math.min(h.textContent.length,Math.max(0,s));const c=this._readClientRects(l,i,h,s,o.endNode);return o.markDidDomLayout(),this._createHorizontalRangesFromClientRects(c,o.clientRectDeltaLeft,o.clientRectScale)}}const cu=function(){return nd?!0:!(Ln||Ct||bi)}();let Ut=!0;class fr{constructor(e,t){this.themeType=t;const i=e.options,n=i.get(50);i.get(38)==="off"?this.renderWhitespace=i.get(100):this.renderWhitespace="none",this.renderControlCharacters=i.get(95),this.spaceWidth=n.spaceWidth,this.middotWidth=n.middotWidth,this.wsmiddotWidth=n.wsmiddotWidth,this.useMonospaceOptimizations=n.isMonospace&&!i.get(33),this.canUseHalfwidthRightwardsArrow=n.canUseHalfwidthRightwardsArrow,this.lineHeight=i.get(67),this.stopRenderingLineAfter=i.get(118),this.fontLigatures=i.get(51)}equals(e){return this.themeType===e.themeType&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.fontLigatures===e.fontLigatures}}const un=class un{constructor(e){this._options=e,this._isMaybeInvalid=!0,this._renderedViewLine=null}getDomNode(){return this._renderedViewLine&&this._renderedViewLine.domNode?this._renderedViewLine.domNode.domNode:null}setDomNode(e){if(this._renderedViewLine)this._renderedViewLine.domNode=V(e);else throw new Error("I have no rendered view line to set the dom node to...")}onContentChanged(){this._isMaybeInvalid=!0}onTokensChanged(){this._isMaybeInvalid=!0}onDecorationsChanged(){this._isMaybeInvalid=!0}onOptionsChanged(e){this._isMaybeInvalid=!0,this._options=e}onSelectionChanged(){return ui(this._options.themeType)||this._options.renderWhitespace==="selection"?(this._isMaybeInvalid=!0,!0):!1}renderLine(e,t,i,n,s){if(this._isMaybeInvalid===!1)return!1;this._isMaybeInvalid=!1;const o=n.getViewLineRenderingData(e),r=this._options,d=Po.filter(o.inlineDecorations,e,o.minColumn,o.maxColumn);let l=null;if(ui(r.themeType)||this._options.renderWhitespace==="selection"){const f=n.selections;for(const _ of f){if(_.endLineNumber<e||_.startLineNumber>e)continue;const C=_.startLineNumber===e?_.startColumn:o.minColumn,w=_.endLineNumber===e?_.endColumn:o.maxColumn;C<w&&(ui(r.themeType)&&d.push(new Po(C,w,"inline-selected-text",0)),this._options.renderWhitespace==="selection"&&(l||(l=[]),l.push(new sa(C-1,w-1))))}}const h=new Xd(r.useMonospaceOptimizations,r.canUseHalfwidthRightwardsArrow,o.content,o.continuesWithWrappedLine,o.isBasicASCII,o.containsRTL,o.minColumn-1,o.tokens,d,o.tabSize,o.startVisibleColumn,r.spaceWidth,r.middotWidth,r.wsmiddotWidth,r.stopRenderingLineAfter,r.renderWhitespace,r.renderControlCharacters,r.fontLigatures!==na.OFF,l);if(this._renderedViewLine&&this._renderedViewLine.input.equals(h))return!1;s.appendString('<div style="top:'),s.appendString(String(t)),s.appendString("px;height:"),s.appendString(String(i)),s.appendString('px;" class="'),s.appendString(un.CLASS_NAME),s.appendString('">');const c=Jd(h,s);s.appendString("</div>");let u=null;return Ut&&cu&&o.isBasicASCII&&r.useMonospaceOptimizations&&c.containsForeignElements===0&&(u=new Wi(this._renderedViewLine?this._renderedViewLine.domNode:null,h,c.characterMapping)),u||(u=Ia(this._renderedViewLine?this._renderedViewLine.domNode:null,h,c.characterMapping,c.containsRTL,c.containsForeignElements)),this._renderedViewLine=u,!0}layoutLine(e,t,i){this._renderedViewLine&&this._renderedViewLine.domNode&&(this._renderedViewLine.domNode.setTop(t),this._renderedViewLine.domNode.setHeight(i))}getWidth(e){return this._renderedViewLine?this._renderedViewLine.getWidth(e):0}getWidthIsFast(){return this._renderedViewLine?this._renderedViewLine.getWidthIsFast():!0}needsMonospaceFontCheck(){return this._renderedViewLine?this._renderedViewLine instanceof Wi:!1}monospaceAssumptionsAreValid(){return this._renderedViewLine&&this._renderedViewLine instanceof Wi?this._renderedViewLine.monospaceAssumptionsAreValid():Ut}onMonospaceAssumptionsInvalidated(){this._renderedViewLine&&this._renderedViewLine instanceof Wi&&(this._renderedViewLine=this._renderedViewLine.toSlowRenderedLine())}getVisibleRangesForRange(e,t,i,n){if(!this._renderedViewLine)return null;t=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,t)),i=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,i));const s=this._renderedViewLine.input.stopRenderingLineAfter;if(s!==-1&&t>s+1&&i>s+1)return new gr(!0,[new ft(this.getWidth(n),0)]);s!==-1&&t>s+1&&(t=s+1),s!==-1&&i>s+1&&(i=s+1);const o=this._renderedViewLine.getVisibleRangesForRange(e,t,i,n);return o&&o.length>0?new gr(!1,o):null}getColumnOfNodeOffset(e,t){return this._renderedViewLine?this._renderedViewLine.getColumnOfNodeOffset(e,t):1}};un.CLASS_NAME="view-line";let je=un;class Wi{constructor(e,t,i){this._cachedWidth=-1,this.domNode=e,this.input=t;const n=Math.floor(t.lineContent.length/300);if(n>0){this._keyColumnPixelOffsetCache=new Float32Array(n);for(let s=0;s<n;s++)this._keyColumnPixelOffsetCache[s]=-1}else this._keyColumnPixelOffsetCache=null;this._characterMapping=i,this._charWidth=t.spaceWidth}getWidth(e){if(!this.domNode||this.input.lineContent.length<300){const t=this._characterMapping.getHorizontalOffset(this._characterMapping.length);return Math.round(this._charWidth*t)}return this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e==null||e.markDidDomLayout()),this._cachedWidth}getWidthIsFast(){return this.input.lineContent.length<300||this._cachedWidth!==-1}monospaceAssumptionsAreValid(){if(!this.domNode)return Ut;if(this.input.lineContent.length<300){const e=this.getWidth(null),t=this.domNode.domNode.firstChild.offsetWidth;Math.abs(e-t)>=2&&(console.warn("monospace assumptions have been violated, therefore disabling monospace optimizations!"),Ut=!1)}return Ut}toSlowRenderedLine(){return Ia(this.domNode,this.input,this._characterMapping,!1,0)}getVisibleRangesForRange(e,t,i,n){const s=this._getColumnPixelOffset(e,t,n),o=this._getColumnPixelOffset(e,i,n);return[new ft(s,o-s)]}_getColumnPixelOffset(e,t,i){if(t<=300){const l=this._characterMapping.getHorizontalOffset(t);return this._charWidth*l}const n=Math.floor((t-1)/300)-1,s=(n+1)*300+1;let o=-1;if(this._keyColumnPixelOffsetCache&&(o=this._keyColumnPixelOffsetCache[n],o===-1&&(o=this._actualReadPixelOffset(e,s,i),this._keyColumnPixelOffsetCache[n]=o)),o===-1){const l=this._characterMapping.getHorizontalOffset(t);return this._charWidth*l}const r=this._characterMapping.getHorizontalOffset(s),d=this._characterMapping.getHorizontalOffset(t);return o+this._charWidth*(d-r)}_getReadingTarget(e){return e.domNode.firstChild}_actualReadPixelOffset(e,t,i){if(!this.domNode)return-1;const n=this._characterMapping.getDomPosition(t),s=Ui.readHorizontalRanges(this._getReadingTarget(this.domNode),n.partIndex,n.charIndex,n.partIndex,n.charIndex,i);return!s||s.length===0?-1:s[0].left}getColumnOfNodeOffset(e,t){return Oa(this._characterMapping,e,t)}}class Ta{constructor(e,t,i,n,s){if(this.domNode=e,this.input=t,this._characterMapping=i,this._isWhitespaceOnly=/^\s*$/.test(t.lineContent),this._containsForeignElements=s,this._cachedWidth=-1,this._pixelOffsetCache=null,!n||this._characterMapping.length===0){this._pixelOffsetCache=new Float32Array(Math.max(2,this._characterMapping.length+1));for(let o=0,r=this._characterMapping.length;o<=r;o++)this._pixelOffsetCache[o]=-1}}_getReadingTarget(e){return e.domNode.firstChild}getWidth(e){return this.domNode?(this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e==null||e.markDidDomLayout()),this._cachedWidth):0}getWidthIsFast(){return this._cachedWidth!==-1}getVisibleRangesForRange(e,t,i,n){if(!this.domNode)return null;if(this._pixelOffsetCache!==null){const s=this._readPixelOffset(this.domNode,e,t,n);if(s===-1)return null;const o=this._readPixelOffset(this.domNode,e,i,n);return o===-1?null:[new ft(s,o-s)]}return this._readVisibleRangesForRange(this.domNode,e,t,i,n)}_readVisibleRangesForRange(e,t,i,n,s){if(i===n){const o=this._readPixelOffset(e,t,i,s);return o===-1?null:[new ft(o,0)]}else return this._readRawVisibleRangesForRange(e,i,n,s)}_readPixelOffset(e,t,i,n){if(this._characterMapping.length===0){if(this._containsForeignElements===0||this._containsForeignElements===2)return 0;if(this._containsForeignElements===1)return this.getWidth(n);const s=this._getReadingTarget(e);return s.firstChild?(n.markDidDomLayout(),s.firstChild.offsetWidth):0}if(this._pixelOffsetCache!==null){const s=this._pixelOffsetCache[i];if(s!==-1)return s;const o=this._actualReadPixelOffset(e,t,i,n);return this._pixelOffsetCache[i]=o,o}return this._actualReadPixelOffset(e,t,i,n)}_actualReadPixelOffset(e,t,i,n){if(this._characterMapping.length===0){const d=Ui.readHorizontalRanges(this._getReadingTarget(e),0,0,0,0,n);return!d||d.length===0?-1:d[0].left}if(i===this._characterMapping.length&&this._isWhitespaceOnly&&this._containsForeignElements===0)return this.getWidth(n);const s=this._characterMapping.getDomPosition(i),o=Ui.readHorizontalRanges(this._getReadingTarget(e),s.partIndex,s.charIndex,s.partIndex,s.charIndex,n);if(!o||o.length===0)return-1;const r=o[0].left;if(this.input.isBasicASCII){const d=this._characterMapping.getHorizontalOffset(i),l=Math.round(this.input.spaceWidth*d);if(Math.abs(l-r)<=1)return l}return r}_readRawVisibleRangesForRange(e,t,i,n){if(t===1&&i===this._characterMapping.length)return[new ft(0,this.getWidth(n))];const s=this._characterMapping.getDomPosition(t),o=this._characterMapping.getDomPosition(i);return Ui.readHorizontalRanges(this._getReadingTarget(e),s.partIndex,s.charIndex,o.partIndex,o.charIndex,n)}getColumnOfNodeOffset(e,t){return Oa(this._characterMapping,e,t)}}class uu extends Ta{_readVisibleRangesForRange(e,t,i,n,s){const o=super._readVisibleRangesForRange(e,t,i,n,s);if(!o||o.length===0||i===n||i===1&&n===this._characterMapping.length)return o;if(!this.input.containsRTL){const r=this._readPixelOffset(e,t,n,s);if(r!==-1){const d=o[o.length-1];d.left<r&&(d.width=r-d.left)}}return o}}const Ia=function(){return pa?gu:fu}();function gu(a,e,t,i,n){return new uu(a,e,t,i,n)}function fu(a,e,t,i,n){return new Ta(a,e,t,i,n)}function Oa(a,e,t){const i=e.textContent.length;let n=-1;for(;e;)e=e.previousSibling,n++;return a.getColumn(new el(n,t),i)}class Xe{constructor(e=null){this.hitTarget=e,this.type=0}}class Aa{get hitTarget(){return this.spanNode}constructor(e,t,i){this.position=e,this.spanNode=t,this.injectedText=i,this.type=1}}var ht;(function(a){function e(t,i,n){const s=t.getPositionFromDOMInfo(i,n);return s?new Aa(s,i,null):new Xe(i)}a.createFromDOMInfo=e})(ht||(ht={}));class mu{constructor(e,t){this.lastViewCursorsRenderData=e,this.lastTextareaPosition=t}}class le{static _deduceRage(e,t=null){return!t&&e?new A(e.lineNumber,e.column,e.lineNumber,e.column):t??null}static createUnknown(e,t,i){return{type:0,element:e,mouseColumn:t,position:i,range:this._deduceRage(i)}}static createTextarea(e,t){return{type:1,element:e,mouseColumn:t,position:null,range:null}}static createMargin(e,t,i,n,s,o){return{type:e,element:t,mouseColumn:i,position:n,range:s,detail:o}}static createViewZone(e,t,i,n,s){return{type:e,element:t,mouseColumn:i,position:n,range:this._deduceRage(n),detail:s}}static createContentText(e,t,i,n,s){return{type:6,element:e,mouseColumn:t,position:i,range:this._deduceRage(i,n),detail:s}}static createContentEmpty(e,t,i,n){return{type:7,element:e,mouseColumn:t,position:i,range:this._deduceRage(i),detail:n}}static createContentWidget(e,t,i){return{type:9,element:e,mouseColumn:t,position:null,range:null,detail:i}}static createScrollbar(e,t,i){return{type:11,element:e,mouseColumn:t,position:i,range:this._deduceRage(i)}}static createOverlayWidget(e,t,i){return{type:12,element:e,mouseColumn:t,position:null,range:null,detail:i}}static createOutsideEditor(e,t,i,n){return{type:13,element:null,mouseColumn:e,position:t,range:this._deduceRage(t),outsidePosition:i,outsideDistance:n}}static _typeToString(e){return e===1?"TEXTAREA":e===2?"GUTTER_GLYPH_MARGIN":e===3?"GUTTER_LINE_NUMBERS":e===4?"GUTTER_LINE_DECORATIONS":e===5?"GUTTER_VIEW_ZONE":e===6?"CONTENT_TEXT":e===7?"CONTENT_EMPTY":e===8?"CONTENT_VIEW_ZONE":e===9?"CONTENT_WIDGET":e===10?"OVERVIEW_RULER":e===11?"SCROLLBAR":e===12?"OVERLAY_WIDGET":"UNKNOWN"}static toString(e){return this._typeToString(e.type)+": "+e.position+" - "+e.range+" - "+JSON.stringify(e.detail)}}class ue{static isTextArea(e){return e.length===2&&e[0]===3&&e[1]===7}static isChildOfViewLines(e){return e.length>=4&&e[0]===3&&e[3]===8}static isStrictChildOfViewLines(e){return e.length>4&&e[0]===3&&e[3]===8}static isChildOfScrollableElement(e){return e.length>=2&&e[0]===3&&e[1]===6}static isChildOfMinimap(e){return e.length>=2&&e[0]===3&&e[1]===9}static isChildOfContentWidgets(e){return e.length>=4&&e[0]===3&&e[3]===1}static isChildOfOverflowGuard(e){return e.length>=1&&e[0]===3}static isChildOfOverflowingContentWidgets(e){return e.length>=1&&e[0]===2}static isChildOfOverlayWidgets(e){return e.length>=2&&e[0]===3&&e[1]===4}static isChildOfOverflowingOverlayWidgets(e){return e.length>=1&&e[0]===5}}class Kt{constructor(e,t,i){this.viewModel=e.viewModel;const n=e.configuration.options;this.layoutInfo=n.get(146),this.viewDomNode=t.viewDomNode,this.lineHeight=n.get(67),this.stickyTabStops=n.get(117),this.typicalHalfwidthCharacterWidth=n.get(50).typicalHalfwidthCharacterWidth,this.lastRenderData=i,this._context=e,this._viewHelper=t}getZoneAtCoord(e){return Kt.getZoneAtCoord(this._context,e)}static getZoneAtCoord(e,t){const i=e.viewLayout.getWhitespaceAtVerticalOffset(t);if(i){const n=i.verticalOffset+i.height/2,s=e.viewModel.getLineCount();let o=null,r,d=null;return i.afterLineNumber!==s&&(d=new T(i.afterLineNumber+1,1)),i.afterLineNumber>0&&(o=new T(i.afterLineNumber,e.viewModel.getLineMaxColumn(i.afterLineNumber))),d===null?r=o:o===null?r=d:t<n?r=o:r=d,{viewZoneId:i.id,afterLineNumber:i.afterLineNumber,positionBefore:o,positionAfter:d,position:r}}return null}getFullLineRangeAtCoord(e){if(this._context.viewLayout.isAfterLines(e)){const n=this._context.viewModel.getLineCount(),s=this._context.viewModel.getLineMaxColumn(n);return{range:new A(n,s,n,s),isAfterLines:!0}}const t=this._context.viewLayout.getLineNumberAtVerticalOffset(e),i=this._context.viewModel.getLineMaxColumn(t);return{range:new A(t,1,t,i),isAfterLines:!1}}getLineNumberAtVerticalOffset(e){return this._context.viewLayout.getLineNumberAtVerticalOffset(e)}isAfterLines(e){return this._context.viewLayout.isAfterLines(e)}isInTopPadding(e){return this._context.viewLayout.isInTopPadding(e)}isInBottomPadding(e){return this._context.viewLayout.isInBottomPadding(e)}getVerticalOffsetForLineNumber(e){return this._context.viewLayout.getVerticalOffsetForLineNumber(e)}findAttribute(e,t){return Kt._findAttribute(e,t,this._viewHelper.viewDomNode)}static _findAttribute(e,t,i){for(;e&&e!==e.ownerDocument.body;){if(e.hasAttribute&&e.hasAttribute(t))return e.getAttribute(t);if(e===i)return null;e=e.parentNode}return null}getLineWidth(e){return this._viewHelper.getLineWidth(e)}visibleRangeForPosition(e,t){return this._viewHelper.visibleRangeForPosition(e,t)}getPositionFromDOMInfo(e,t){return this._viewHelper.getPositionFromDOMInfo(e,t)}getCurrentScrollTop(){return this._context.viewLayout.getCurrentScrollTop()}getCurrentScrollLeft(){return this._context.viewLayout.getCurrentScrollLeft()}}class _u{constructor(e,t,i,n){this.editorPos=t,this.pos=i,this.relativePos=n,this.mouseVerticalOffset=Math.max(0,e.getCurrentScrollTop()+this.relativePos.y),this.mouseContentHorizontalOffset=e.getCurrentScrollLeft()+this.relativePos.x-e.layoutInfo.contentLeft,this.isInMarginArea=this.relativePos.x<e.layoutInfo.contentLeft&&this.relativePos.x>=e.layoutInfo.glyphMarginLeft,this.isInContentArea=!this.isInMarginArea,this.mouseColumn=Math.max(0,de._getMouseColumn(this.mouseContentHorizontalOffset,e.typicalHalfwidthCharacterWidth))}}class pu extends _u{get target(){return this._useHitTestTarget?this.hitTestResult.value.hitTarget:this._eventTarget}get targetPath(){return this._targetPathCacheElement!==this.target&&(this._targetPathCacheElement=this.target,this._targetPathCacheValue=Ie.collect(this.target,this._ctx.viewDomNode)),this._targetPathCacheValue}constructor(e,t,i,n,s){super(e,t,i,n),this.hitTestResult=new sd(()=>de.doHitTest(this._ctx,this)),this._targetPathCacheElement=null,this._targetPathCacheValue=new Uint8Array(0),this._ctx=e,this._eventTarget=s;const o=!!this._eventTarget;this._useHitTestTarget=!o}toString(){return`pos(${this.pos.x},${this.pos.y}), editorPos(${this.editorPos.x},${this.editorPos.y}), relativePos(${this.relativePos.x},${this.relativePos.y}), mouseVerticalOffset: ${this.mouseVerticalOffset}, mouseContentHorizontalOffset: ${this.mouseContentHorizontalOffset}
	target: ${this.target?this.target.outerHTML:null}`}get wouldBenefitFromHitTestTargetSwitch(){return!this._useHitTestTarget&&this.hitTestResult.value.hitTarget!==null&&this.target!==this.hitTestResult.value.hitTarget}switchToHitTestTarget(){this._useHitTestTarget=!0}_getMouseColumn(e=null){return e&&e.column<this._ctx.viewModel.getLineMaxColumn(e.lineNumber)?oa.visibleColumnFromColumn(this._ctx.viewModel.getLineContent(e.lineNumber),e.column,this._ctx.viewModel.model.getOptions().tabSize)+1:this.mouseColumn}fulfillUnknown(e=null){return le.createUnknown(this.target,this._getMouseColumn(e),e)}fulfillTextarea(){return le.createTextarea(this.target,this._getMouseColumn())}fulfillMargin(e,t,i,n){return le.createMargin(e,this.target,this._getMouseColumn(t),t,i,n)}fulfillViewZone(e,t,i){return le.createViewZone(e,this.target,this._getMouseColumn(t),t,i)}fulfillContentText(e,t,i){return le.createContentText(this.target,this._getMouseColumn(e),e,t,i)}fulfillContentEmpty(e,t){return le.createContentEmpty(this.target,this._getMouseColumn(e),e,t)}fulfillContentWidget(e){return le.createContentWidget(this.target,this._getMouseColumn(),e)}fulfillScrollbar(e){return le.createScrollbar(this.target,this._getMouseColumn(e),e)}fulfillOverlayWidget(e){return le.createOverlayWidget(this.target,this._getMouseColumn(),e)}}const mr={isAfterLines:!0};function Un(a){return{isAfterLines:!1,horizontalDistanceToText:a}}class de{constructor(e,t){this._context=e,this._viewHelper=t}mouseTargetIsWidget(e){const t=e.target,i=Ie.collect(t,this._viewHelper.viewDomNode);return!!(ue.isChildOfContentWidgets(i)||ue.isChildOfOverflowingContentWidgets(i)||ue.isChildOfOverlayWidgets(i)||ue.isChildOfOverflowingOverlayWidgets(i))}createMouseTarget(e,t,i,n,s){const o=new Kt(this._context,this._viewHelper,e),r=new pu(o,t,i,n,s);try{const d=de._createMouseTarget(o,r);if(d.type===6&&o.stickyTabStops&&d.position!==null){const l=de._snapToSoftTabBoundary(d.position,o.viewModel),h=A.fromPositions(l,l).plusRange(d.range);return r.fulfillContentText(l,h,d.detail)}return d}catch{return r.fulfillUnknown()}}static _createMouseTarget(e,t){if(t.target===null)return t.fulfillUnknown();const i=t;let n=null;return!ue.isChildOfOverflowGuard(t.targetPath)&&!ue.isChildOfOverflowingContentWidgets(t.targetPath)&&!ue.isChildOfOverflowingOverlayWidgets(t.targetPath)&&(n=n||t.fulfillUnknown()),n=n||de._hitTestContentWidget(e,i),n=n||de._hitTestOverlayWidget(e,i),n=n||de._hitTestMinimap(e,i),n=n||de._hitTestScrollbarSlider(e,i),n=n||de._hitTestViewZone(e,i),n=n||de._hitTestMargin(e,i),n=n||de._hitTestViewCursor(e,i),n=n||de._hitTestTextArea(e,i),n=n||de._hitTestViewLines(e,i),n=n||de._hitTestScrollbar(e,i),n||t.fulfillUnknown()}static _hitTestContentWidget(e,t){if(ue.isChildOfContentWidgets(t.targetPath)||ue.isChildOfOverflowingContentWidgets(t.targetPath)){const i=e.findAttribute(t.target,"widgetId");return i?t.fulfillContentWidget(i):t.fulfillUnknown()}return null}static _hitTestOverlayWidget(e,t){if(ue.isChildOfOverlayWidgets(t.targetPath)||ue.isChildOfOverflowingOverlayWidgets(t.targetPath)){const i=e.findAttribute(t.target,"widgetId");return i?t.fulfillOverlayWidget(i):t.fulfillUnknown()}return null}static _hitTestViewCursor(e,t){if(t.target){const i=e.lastRenderData.lastViewCursorsRenderData;for(const n of i)if(t.target===n.domNode)return t.fulfillContentText(n.position,null,{mightBeForeignElement:!1,injectedText:null})}if(t.isInContentArea){const i=e.lastRenderData.lastViewCursorsRenderData,n=t.mouseContentHorizontalOffset,s=t.mouseVerticalOffset;for(const o of i){if(n<o.contentLeft||n>o.contentLeft+o.width)continue;const r=e.getVerticalOffsetForLineNumber(o.position.lineNumber);if(r<=s&&s<=r+o.height)return t.fulfillContentText(o.position,null,{mightBeForeignElement:!1,injectedText:null})}}return null}static _hitTestViewZone(e,t){const i=e.getZoneAtCoord(t.mouseVerticalOffset);if(i){const n=t.isInContentArea?8:5;return t.fulfillViewZone(n,i.position,i)}return null}static _hitTestTextArea(e,t){return ue.isTextArea(t.targetPath)?e.lastRenderData.lastTextareaPosition?t.fulfillContentText(e.lastRenderData.lastTextareaPosition,null,{mightBeForeignElement:!1,injectedText:null}):t.fulfillTextarea():null}static _hitTestMargin(e,t){if(t.isInMarginArea){const i=e.getFullLineRangeAtCoord(t.mouseVerticalOffset),n=i.range.getStartPosition();let s=Math.abs(t.relativePos.x);const o={isAfterLines:i.isAfterLines,glyphMarginLeft:e.layoutInfo.glyphMarginLeft,glyphMarginWidth:e.layoutInfo.glyphMarginWidth,lineNumbersWidth:e.layoutInfo.lineNumbersWidth,offsetX:s};if(s-=e.layoutInfo.glyphMarginLeft,s<=e.layoutInfo.glyphMarginWidth){const r=e.viewModel.coordinatesConverter.convertViewPositionToModelPosition(i.range.getStartPosition()),d=e.viewModel.glyphLanes.getLanesAtLine(r.lineNumber);return o.glyphMarginLane=d[Math.floor(s/e.lineHeight)],t.fulfillMargin(2,n,i.range,o)}return s-=e.layoutInfo.glyphMarginWidth,s<=e.layoutInfo.lineNumbersWidth?t.fulfillMargin(3,n,i.range,o):(s-=e.layoutInfo.lineNumbersWidth,t.fulfillMargin(4,n,i.range,o))}return null}static _hitTestViewLines(e,t){if(!ue.isChildOfViewLines(t.targetPath))return null;if(e.isInTopPadding(t.mouseVerticalOffset))return t.fulfillContentEmpty(new T(1,1),mr);if(e.isAfterLines(t.mouseVerticalOffset)||e.isInBottomPadding(t.mouseVerticalOffset)){const n=e.viewModel.getLineCount(),s=e.viewModel.getLineMaxColumn(n);return t.fulfillContentEmpty(new T(n,s),mr)}if(ue.isStrictChildOfViewLines(t.targetPath)){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset);if(e.viewModel.getLineLength(n)===0){const o=e.getLineWidth(n),r=Un(t.mouseContentHorizontalOffset-o);return t.fulfillContentEmpty(new T(n,1),r)}const s=e.getLineWidth(n);if(t.mouseContentHorizontalOffset>=s){const o=Un(t.mouseContentHorizontalOffset-s),r=new T(n,e.viewModel.getLineMaxColumn(n));return t.fulfillContentEmpty(r,o)}}const i=t.hitTestResult.value;return i.type===1?de.createMouseTargetFromHitTestPosition(e,t,i.spanNode,i.position,i.injectedText):t.wouldBenefitFromHitTestTargetSwitch?(t.switchToHitTestTarget(),this._createMouseTarget(e,t)):t.fulfillUnknown()}static _hitTestMinimap(e,t){if(ue.isChildOfMinimap(t.targetPath)){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.viewModel.getLineMaxColumn(i);return t.fulfillScrollbar(new T(i,n))}return null}static _hitTestScrollbarSlider(e,t){if(ue.isChildOfScrollableElement(t.targetPath)&&t.target&&t.target.nodeType===1){const i=t.target.className;if(i&&/\b(slider|scrollbar)\b/.test(i)){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),s=e.viewModel.getLineMaxColumn(n);return t.fulfillScrollbar(new T(n,s))}}return null}static _hitTestScrollbar(e,t){if(ue.isChildOfScrollableElement(t.targetPath)){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.viewModel.getLineMaxColumn(i);return t.fulfillScrollbar(new T(i,n))}return null}getMouseColumn(e){const t=this._context.configuration.options,i=t.get(146),n=this._context.viewLayout.getCurrentScrollLeft()+e.x-i.contentLeft;return de._getMouseColumn(n,t.get(50).typicalHalfwidthCharacterWidth)}static _getMouseColumn(e,t){return e<0?1:Math.round(e/t)+1}static createMouseTargetFromHitTestPosition(e,t,i,n,s){const o=n.lineNumber,r=n.column,d=e.getLineWidth(o);if(t.mouseContentHorizontalOffset>d){const p=Un(t.mouseContentHorizontalOffset-d);return t.fulfillContentEmpty(n,p)}const l=e.visibleRangeForPosition(o,r);if(!l)return t.fulfillUnknown(n);const h=l.left;if(Math.abs(t.mouseContentHorizontalOffset-h)<1)return t.fulfillContentText(n,null,{mightBeForeignElement:!!s,injectedText:s});const c=[];if(c.push({offset:l.left,column:r}),r>1){const p=e.visibleRangeForPosition(o,r-1);p&&c.push({offset:p.left,column:r-1})}const u=e.viewModel.getLineMaxColumn(o);if(r<u){const p=e.visibleRangeForPosition(o,r+1);p&&c.push({offset:p.left,column:r+1})}c.sort((p,g)=>p.offset-g.offset);const f=t.pos.toClientCoordinates(G(e.viewDomNode)),_=i.getBoundingClientRect(),C=_.left<=f.clientX&&f.clientX<=_.right;let w=null;for(let p=1;p<c.length;p++){const g=c[p-1],v=c[p];if(g.offset<=t.mouseContentHorizontalOffset&&t.mouseContentHorizontalOffset<=v.offset){w=new A(o,g.column,o,v.column);const m=Math.abs(g.offset-t.mouseContentHorizontalOffset),b=Math.abs(v.offset-t.mouseContentHorizontalOffset);n=m<b?new T(o,g.column):new T(o,v.column);break}}return t.fulfillContentText(n,w,{mightBeForeignElement:!C||!!s,injectedText:s})}static _doHitTestWithCaretRangeFromPoint(e,t){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.getVerticalOffsetForLineNumber(i),s=n+e.lineHeight;if(!(i===e.viewModel.getLineCount()&&t.mouseVerticalOffset>s)){const r=Math.floor((n+s)/2);let d=t.pos.y+(r-t.mouseVerticalOffset);d<=t.editorPos.y&&(d=t.editorPos.y+1),d>=t.editorPos.y+t.editorPos.height&&(d=t.editorPos.y+t.editorPos.height-1);const l=new kn(t.pos.x,d),h=this._actualDoHitTestWithCaretRangeFromPoint(e,l.toClientCoordinates(G(e.viewDomNode)));if(h.type===1)return h}return this._actualDoHitTestWithCaretRangeFromPoint(e,t.pos.toClientCoordinates(G(e.viewDomNode)))}static _actualDoHitTestWithCaretRangeFromPoint(e,t){const i=ji(e.viewDomNode);let n;if(i?typeof i.caretRangeFromPoint>"u"?n=vu(i,t.clientX,t.clientY):n=i.caretRangeFromPoint(t.clientX,t.clientY):n=e.viewDomNode.ownerDocument.caretRangeFromPoint(t.clientX,t.clientY),!n||!n.startContainer)return new Xe;const s=n.startContainer;if(s.nodeType===s.TEXT_NODE){const o=s.parentNode,r=o?o.parentNode:null,d=r?r.parentNode:null;return(d&&d.nodeType===d.ELEMENT_NODE?d.className:null)===je.CLASS_NAME?ht.createFromDOMInfo(e,o,n.startOffset):new Xe(s.parentNode)}else if(s.nodeType===s.ELEMENT_NODE){const o=s.parentNode,r=o?o.parentNode:null;return(r&&r.nodeType===r.ELEMENT_NODE?r.className:null)===je.CLASS_NAME?ht.createFromDOMInfo(e,s,s.textContent.length):new Xe(s)}return new Xe}static _doHitTestWithCaretPositionFromPoint(e,t){const i=e.viewDomNode.ownerDocument.caretPositionFromPoint(t.clientX,t.clientY);if(i.offsetNode.nodeType===i.offsetNode.TEXT_NODE){const n=i.offsetNode.parentNode,s=n?n.parentNode:null,o=s?s.parentNode:null;return(o&&o.nodeType===o.ELEMENT_NODE?o.className:null)===je.CLASS_NAME?ht.createFromDOMInfo(e,i.offsetNode.parentNode,i.offset):new Xe(i.offsetNode.parentNode)}if(i.offsetNode.nodeType===i.offsetNode.ELEMENT_NODE){const n=i.offsetNode.parentNode,s=n&&n.nodeType===n.ELEMENT_NODE?n.className:null,o=n?n.parentNode:null,r=o&&o.nodeType===o.ELEMENT_NODE?o.className:null;if(s===je.CLASS_NAME){const d=i.offsetNode.childNodes[Math.min(i.offset,i.offsetNode.childNodes.length-1)];if(d)return ht.createFromDOMInfo(e,d,0)}else if(r===je.CLASS_NAME)return ht.createFromDOMInfo(e,i.offsetNode,0)}return new Xe(i.offsetNode)}static _snapToSoftTabBoundary(e,t){const i=t.getLineContent(e.lineNumber),{tabSize:n}=t.model.getOptions(),s=tl.atomicPosition(i,e.column-1,n,2);return s!==-1?new T(e.lineNumber,s+1):e}static doHitTest(e,t){let i=new Xe;if(typeof e.viewDomNode.ownerDocument.caretRangeFromPoint=="function"?i=this._doHitTestWithCaretRangeFromPoint(e,t):e.viewDomNode.ownerDocument.caretPositionFromPoint&&(i=this._doHitTestWithCaretPositionFromPoint(e,t.pos.toClientCoordinates(G(e.viewDomNode)))),i.type===1){const n=e.viewModel.getInjectedTextAt(i.position),s=e.viewModel.normalizePosition(i.position,2);(n||!s.equals(i.position))&&(i=new Aa(s,i.spanNode,n))}return i}}function vu(a,e,t){const i=document.createRange();let n=a.elementFromPoint(e,t);if(n!==null){for(;n&&n.firstChild&&n.firstChild.nodeType!==n.firstChild.TEXT_NODE&&n.lastChild&&n.lastChild.firstChild;)n=n.lastChild;const s=n.getBoundingClientRect(),o=G(n),r=o.getComputedStyle(n,null).getPropertyValue("font-style"),d=o.getComputedStyle(n,null).getPropertyValue("font-variant"),l=o.getComputedStyle(n,null).getPropertyValue("font-weight"),h=o.getComputedStyle(n,null).getPropertyValue("font-size"),c=o.getComputedStyle(n,null).getPropertyValue("line-height"),u=o.getComputedStyle(n,null).getPropertyValue("font-family"),f=`${r} ${d} ${l} ${h}/${c} ${u}`,_=n.innerText;let C=s.left,w=0,p;if(e>s.left+s.width)w=_.length;else{const g=_s.getInstance();for(let v=0;v<_.length+1;v++){if(p=g.getCharWidth(_.charAt(v),f)/2,C+=p,e<C){w=v;break}C+=p}}i.setStart(n.firstChild,w),i.setEnd(n.firstChild,w)}return i}const ct=class ct{static getInstance(){return ct._INSTANCE||(ct._INSTANCE=new ct),ct._INSTANCE}constructor(){this._cache={},this._canvas=document.createElement("canvas")}getCharWidth(e,t){const i=e+t;if(this._cache[i])return this._cache[i];const n=this._canvas.getContext("2d");n.font=t;const o=n.measureText(e).width;return this._cache[i]=o,o}};ct._INSTANCE=null;let _s=ct;class mo extends Ri{constructor(e,t,i){super(),this._mouseLeaveMonitor=null,this._context=e,this.viewController=t,this.viewHelper=i,this.mouseTargetFactory=new de(this._context,i),this._mouseDownOperation=this._register(new Cu(this._context,this.viewController,this.viewHelper,this.mouseTargetFactory,(o,r)=>this._createMouseTarget(o,r),o=>this._getMouseColumn(o))),this.lastMouseLeaveTime=-1,this._height=this._context.configuration.options.get(146).height;const n=new iu(this.viewHelper.viewDomNode);this._register(n.onContextMenu(this.viewHelper.viewDomNode,o=>this._onContextMenu(o,!0))),this._register(n.onMouseMove(this.viewHelper.viewDomNode,o=>{this._onMouseMove(o),this._mouseLeaveMonitor||(this._mouseLeaveMonitor=O(this.viewHelper.viewDomNode.ownerDocument,"mousemove",r=>{this.viewHelper.viewDomNode.contains(r.target)||this._onMouseLeave(new st(r,!1,this.viewHelper.viewDomNode))}))})),this._register(n.onMouseUp(this.viewHelper.viewDomNode,o=>this._onMouseUp(o))),this._register(n.onMouseLeave(this.viewHelper.viewDomNode,o=>this._onMouseLeave(o)));let s=0;this._register(n.onPointerDown(this.viewHelper.viewDomNode,(o,r)=>{s=r})),this._register(O(this.viewHelper.viewDomNode,K.POINTER_UP,o=>{this._mouseDownOperation.onPointerUp()})),this._register(n.onMouseDown(this.viewHelper.viewDomNode,o=>this._onMouseDown(o,s))),this._setupMouseWheelZoomListener(),this._context.addEventHandler(this)}_setupMouseWheelZoomListener(){const e=cc.INSTANCE;let t=0,i=Rt.getZoomLevel(),n=!1,s=0;const o=d=>{if(this.viewController.emitMouseWheel(d),!this._context.configuration.options.get(76))return;const l=new zh(d);if(e.acceptStandardWheelEvent(l),e.isPhysicalMouseWheel()){if(r(d)){const h=Rt.getZoomLevel(),c=l.deltaY>0?1:-1;Rt.setZoomLevel(h+c),l.preventDefault(),l.stopPropagation()}}else Date.now()-t>50&&(i=Rt.getZoomLevel(),n=r(d),s=0),t=Date.now(),s+=l.deltaY,n&&(Rt.setZoomLevel(i+s/5),l.preventDefault(),l.stopPropagation())};this._register(O(this.viewHelper.viewDomNode,K.MOUSE_WHEEL,o,{capture:!0,passive:!1}));function r(d){return ut?(d.metaKey||d.ctrlKey)&&!d.shiftKey&&!d.altKey:d.ctrlKey&&!d.metaKey&&!d.shiftKey&&!d.altKey}}dispose(){this._context.removeEventHandler(this),this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),super.dispose()}onConfigurationChanged(e){if(e.hasChanged(146)){const t=this._context.configuration.options.get(146).height;this._height!==t&&(this._height=t,this._mouseDownOperation.onHeightChanged())}return!1}onCursorStateChanged(e){return this._mouseDownOperation.onCursorStateChanged(e),!1}onFocusChanged(e){return!1}getTargetAtClientPoint(e,t){const n=new Ea(e,t).toPageCoordinates(G(this.viewHelper.viewDomNode)),s=go(this.viewHelper.viewDomNode);if(n.y<s.y||n.y>s.y+s.height||n.x<s.x||n.x>s.x+s.width)return null;const o=fo(this.viewHelper.viewDomNode,s,n);return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),s,n,o,null)}_createMouseTarget(e,t){let i=e.target;if(!this.viewHelper.viewDomNode.contains(i)){const n=ji(this.viewHelper.viewDomNode);n&&(i=n.elementsFromPoint(e.posx,e.posy).find(s=>this.viewHelper.viewDomNode.contains(s)))}return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),e.editorPos,e.pos,e.relativePos,t?i:null)}_getMouseColumn(e){return this.mouseTargetFactory.getMouseColumn(e.relativePos)}_onContextMenu(e,t){this.viewController.emitContextMenu({event:e,target:this._createMouseTarget(e,t)})}_onMouseMove(e){this.mouseTargetFactory.mouseTargetIsWidget(e)||e.preventDefault(),!(this._mouseDownOperation.isActive()||e.timestamp<this.lastMouseLeaveTime)&&this.viewController.emitMouseMove({event:e,target:this._createMouseTarget(e,!0)})}_onMouseLeave(e){this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),this.lastMouseLeaveTime=new Date().getTime(),this.viewController.emitMouseLeave({event:e,target:null})}_onMouseUp(e){this.viewController.emitMouseUp({event:e,target:this._createMouseTarget(e,!0)})}_onMouseDown(e,t){const i=this._createMouseTarget(e,!0),n=i.type===6||i.type===7,s=i.type===2||i.type===3||i.type===4,o=i.type===3,r=this._context.configuration.options.get(110),d=i.type===8||i.type===5,l=i.type===9;let h=e.leftButton||e.middleButton;ut&&e.leftButton&&e.ctrlKey&&(h=!1);const c=()=>{e.preventDefault(),this.viewHelper.focusTextArea()};if(h&&(n||o&&r))c(),this._mouseDownOperation.start(i.type,e,t);else if(s)e.preventDefault();else if(d){const u=i.detail;h&&this.viewHelper.shouldSuppressMouseDownOnViewZone(u.viewZoneId)&&(c(),this._mouseDownOperation.start(i.type,e,t),e.preventDefault())}else l&&this.viewHelper.shouldSuppressMouseDownOnWidget(i.detail)&&(c(),e.preventDefault());this.viewController.emitMouseDown({event:e,target:i})}}class Cu extends U{constructor(e,t,i,n,s,o){super(),this._context=e,this._viewController=t,this._viewHelper=i,this._mouseTargetFactory=n,this._createMouseTarget=s,this._getMouseColumn=o,this._mouseMoveMonitor=this._register(new su(this._viewHelper.viewDomNode)),this._topBottomDragScrolling=this._register(new wu(this._context,this._viewHelper,this._mouseTargetFactory,(r,d,l)=>this._dispatchMouse(r,d,l))),this._mouseState=new ps,this._currentSelection=new we(1,1,1,1),this._isActive=!1,this._lastMouseEvent=null}dispose(){super.dispose()}isActive(){return this._isActive}_onMouseDownThenMove(e){this._lastMouseEvent=e,this._mouseState.setModifiers(e);const t=this._findMousePosition(e,!1);t&&(this._mouseState.isDragAndDrop?this._viewController.emitMouseDrag({event:e,target:t}):t.type===13&&(t.outsidePosition==="above"||t.outsidePosition==="below")?this._topBottomDragScrolling.start(t,e):(this._topBottomDragScrolling.stop(),this._dispatchMouse(t,!0,1)))}start(e,t,i){this._lastMouseEvent=t,this._mouseState.setStartedOnLineNumbers(e===3),this._mouseState.setStartButtons(t),this._mouseState.setModifiers(t);const n=this._findMousePosition(t,!0);if(!n||!n.position)return;this._mouseState.trySetCount(t.detail,n.position),t.detail=this._mouseState.count;const s=this._context.configuration.options;if(!s.get(92)&&s.get(35)&&!s.get(22)&&!this._mouseState.altKey&&t.detail<2&&!this._isActive&&!this._currentSelection.isEmpty()&&n.type===6&&n.position&&this._currentSelection.containsPosition(n.position)){this._mouseState.isDragAndDrop=!0,this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,t.buttons,o=>this._onMouseDownThenMove(o),o=>{const r=this._findMousePosition(this._lastMouseEvent,!1);ic(o)?this._viewController.emitMouseDropCanceled():this._viewController.emitMouseDrop({event:this._lastMouseEvent,target:r?this._createMouseTarget(this._lastMouseEvent,!0):null}),this._stop()});return}this._mouseState.isDragAndDrop=!1,this._dispatchMouse(n,t.shiftKey,1),this._isActive||(this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,t.buttons,o=>this._onMouseDownThenMove(o),()=>this._stop()))}_stop(){this._isActive=!1,this._topBottomDragScrolling.stop()}onHeightChanged(){this._mouseMoveMonitor.stopMonitoring()}onPointerUp(){this._mouseMoveMonitor.stopMonitoring()}onCursorStateChanged(e){this._currentSelection=e.selections[0]}_getPositionOutsideEditor(e){const t=e.editorPos,i=this._context.viewModel,n=this._context.viewLayout,s=this._getMouseColumn(e);if(e.posy<t.y){const r=t.y-e.posy,d=Math.max(n.getCurrentScrollTop()-r,0),l=Kt.getZoneAtCoord(this._context,d);if(l){const c=this._helpPositionJumpOverViewZone(l);if(c)return le.createOutsideEditor(s,c,"above",r)}const h=n.getLineNumberAtVerticalOffset(d);return le.createOutsideEditor(s,new T(h,1),"above",r)}if(e.posy>t.y+t.height){const r=e.posy-t.y-t.height,d=n.getCurrentScrollTop()+e.relativePos.y,l=Kt.getZoneAtCoord(this._context,d);if(l){const c=this._helpPositionJumpOverViewZone(l);if(c)return le.createOutsideEditor(s,c,"below",r)}const h=n.getLineNumberAtVerticalOffset(d);return le.createOutsideEditor(s,new T(h,i.getLineMaxColumn(h)),"below",r)}const o=n.getLineNumberAtVerticalOffset(n.getCurrentScrollTop()+e.relativePos.y);if(e.posx<t.x){const r=t.x-e.posx;return le.createOutsideEditor(s,new T(o,1),"left",r)}if(e.posx>t.x+t.width){const r=e.posx-t.x-t.width;return le.createOutsideEditor(s,new T(o,i.getLineMaxColumn(o)),"right",r)}return null}_findMousePosition(e,t){const i=this._getPositionOutsideEditor(e);if(i)return i;const n=this._createMouseTarget(e,t);if(!n.position)return null;if(n.type===8||n.type===5){const o=this._helpPositionJumpOverViewZone(n.detail);if(o)return le.createViewZone(n.type,n.element,n.mouseColumn,o,n.detail)}return n}_helpPositionJumpOverViewZone(e){const t=new T(this._currentSelection.selectionStartLineNumber,this._currentSelection.selectionStartColumn),i=e.positionBefore,n=e.positionAfter;return i&&n?i.isBefore(t)?i:n:null}_dispatchMouse(e,t,i){e.position&&this._viewController.dispatchMouse({position:e.position,mouseColumn:e.mouseColumn,startedOnLineNumbers:this._mouseState.startedOnLineNumbers,revealType:i,inSelectionMode:t,mouseDownCount:this._mouseState.count,altKey:this._mouseState.altKey,ctrlKey:this._mouseState.ctrlKey,metaKey:this._mouseState.metaKey,shiftKey:this._mouseState.shiftKey,leftButton:this._mouseState.leftButton,middleButton:this._mouseState.middleButton,onInjectedText:e.type===6&&e.detail.injectedText!==null})}}class wu extends U{constructor(e,t,i,n){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=i,this._dispatchMouse=n,this._operation=null}dispose(){super.dispose(),this.stop()}start(e,t){this._operation?this._operation.setPosition(e,t):this._operation=new bu(this._context,this._viewHelper,this._mouseTargetFactory,this._dispatchMouse,e,t)}stop(){this._operation&&(this._operation.dispose(),this._operation=null)}}class bu extends U{constructor(e,t,i,n,s,o){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=i,this._dispatchMouse=n,this._position=s,this._mouseEvent=o,this._lastTime=Date.now(),this._animationFrameDisposable=yi(G(o.browserEvent),()=>this._execute())}dispose(){this._animationFrameDisposable.dispose(),super.dispose()}setPosition(e,t){this._position=e,this._mouseEvent=t}_tick(){const e=Date.now(),t=e-this._lastTime;return this._lastTime=e,t}_getScrollSpeed(){const e=this._context.configuration.options.get(67),t=this._context.configuration.options.get(146).height/e,i=this._position.outsideDistance/e;return i<=1.5?Math.max(30,t*(1+i)):i<=3?Math.max(60,t*(2+i)):Math.max(200,t*(7+i))}_execute(){const e=this._context.configuration.options.get(67),t=this._getScrollSpeed(),i=this._tick(),n=t*(i/1e3)*e,s=this._position.outsidePosition==="above"?-n:n;this._context.viewModel.viewLayout.deltaScrollNow(0,s),this._viewHelper.renderNow();const o=this._context.viewLayout.getLinesViewportData(),r=this._position.outsidePosition==="above"?o.startLineNumber:o.endLineNumber;let d;{const l=go(this._viewHelper.viewDomNode),h=this._context.configuration.options.get(146).horizontalScrollbarHeight,c=new kn(this._mouseEvent.pos.x,l.y+l.height-h-.1),u=fo(this._viewHelper.viewDomNode,l,c);d=this._mouseTargetFactory.createMouseTarget(this._viewHelper.getLastRenderData(),l,c,u,null)}(!d.position||d.position.lineNumber!==r)&&(this._position.outsidePosition==="above"?d=le.createOutsideEditor(this._position.mouseColumn,new T(r,1),"above",this._position.outsideDistance):d=le.createOutsideEditor(this._position.mouseColumn,new T(r,this._context.viewModel.getLineMaxColumn(r)),"below",this._position.outsideDistance)),this._dispatchMouse(d,!0,2),this._animationFrameDisposable=yi(G(d.element),()=>this._execute())}}const gn=class gn{get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get metaKey(){return this._metaKey}get shiftKey(){return this._shiftKey}get leftButton(){return this._leftButton}get middleButton(){return this._middleButton}get startedOnLineNumbers(){return this._startedOnLineNumbers}constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._middleButton=!1,this._startedOnLineNumbers=!1,this._lastMouseDownPosition=null,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0,this.isDragAndDrop=!1}get count(){return this._lastMouseDownCount}setModifiers(e){this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey}setStartButtons(e){this._leftButton=e.leftButton,this._middleButton=e.middleButton}setStartedOnLineNumbers(e){this._startedOnLineNumbers=e}trySetCount(e,t){const i=new Date().getTime();i-this._lastSetMouseDownCountTime>gn.CLEAR_MOUSE_DOWN_COUNT_TIME&&(e=1),this._lastSetMouseDownCountTime=i,e>this._lastMouseDownCount+1&&(e=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(t)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=t,this._lastMouseDownCount=Math.min(e,this._lastMouseDownPositionEqualCount)}};gn.CLEAR_MOUSE_DOWN_COUNT_TIME=400;let ps=gn;const Wt=class Wt{constructor(e,t,i,n,s){this.value=e,this.selectionStart=t,this.selectionEnd=i,this.selection=n,this.newlineCountBeforeSelection=s}toString(){return`[ <${this.value}>, selectionStart: ${this.selectionStart}, selectionEnd: ${this.selectionEnd}]`}static readFromTextArea(e,t){const i=e.getValue(),n=e.getSelectionStart(),s=e.getSelectionEnd();let o;if(t){const r=i.substring(0,n),d=t.value.substring(0,t.selectionStart);r===d&&(o=t.newlineCountBeforeSelection)}return new Wt(i,n,s,null,o)}collapseSelection(){return this.selectionStart===this.value.length?this:new Wt(this.value,this.value.length,this.value.length,null,void 0)}writeToTextArea(e,t,i){t.setValue(e,this.value),i&&t.setSelectionRange(e,this.selectionStart,this.selectionEnd)}deduceEditorPosition(e){var n,s,o,r;if(e<=this.selectionStart){const d=this.value.substring(e,this.selectionStart);return this._finishDeduceEditorPosition(((n=this.selection)==null?void 0:n.getStartPosition())??null,d,-1)}if(e>=this.selectionEnd){const d=this.value.substring(this.selectionEnd,e);return this._finishDeduceEditorPosition(((s=this.selection)==null?void 0:s.getEndPosition())??null,d,1)}const t=this.value.substring(this.selectionStart,e);if(t.indexOf("…")===-1)return this._finishDeduceEditorPosition(((o=this.selection)==null?void 0:o.getStartPosition())??null,t,1);const i=this.value.substring(e,this.selectionEnd);return this._finishDeduceEditorPosition(((r=this.selection)==null?void 0:r.getEndPosition())??null,i,-1)}_finishDeduceEditorPosition(e,t,i){let n=0,s=-1;for(;(s=t.indexOf(`
`,s+1))!==-1;)n++;return[e,i*t.length,n]}static deduceInput(e,t,i){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};const n=Math.min(No(e.value,t.value),e.selectionStart,t.selectionStart),s=Math.min(Mo(e.value,t.value),e.value.length-e.selectionEnd,t.value.length-t.selectionEnd);e.value.substring(n,e.value.length-s);const o=t.value.substring(n,t.value.length-s),r=e.selectionStart-n,d=e.selectionEnd-n,l=t.selectionStart-n,h=t.selectionEnd-n;if(l===h){const u=e.selectionStart-n;return{text:o,replacePrevCharCnt:u,replaceNextCharCnt:0,positionDelta:0}}const c=d-r;return{text:o,replacePrevCharCnt:c,replaceNextCharCnt:0,positionDelta:0}}static deduceAndroidCompositionInput(e,t){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};if(e.value===t.value)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:t.selectionEnd-e.selectionEnd};const i=Math.min(No(e.value,t.value),e.selectionEnd),n=Math.min(Mo(e.value,t.value),e.value.length-e.selectionEnd),s=e.value.substring(i,e.value.length-n),o=t.value.substring(i,t.value.length-n);e.selectionStart-i;const r=e.selectionEnd-i;t.selectionStart-i;const d=t.selectionEnd-i;return{text:o,replacePrevCharCnt:r,replaceNextCharCnt:s.length-r,positionDelta:d-o.length}}};Wt.EMPTY=new Wt("",0,0,null,void 0);let he=Wt;class Tt{static _getPageOfLine(e,t){return Math.floor((e-1)/t)}static _getRangeForPage(e,t){const i=e*t,n=i+1,s=i+t;return new A(n,1,s+1,1)}static fromEditorSelection(e,t,i,n){const o=Tt._getPageOfLine(t.startLineNumber,i),r=Tt._getRangeForPage(o,i),d=Tt._getPageOfLine(t.endLineNumber,i),l=Tt._getRangeForPage(d,i);let h=r.intersectRanges(new A(1,1,t.startLineNumber,t.startColumn));if(n&&e.getValueLengthInRange(h,1)>500){const p=e.modifyPosition(h.getEndPosition(),-500);h=A.fromPositions(p,h.getEndPosition())}const c=e.getValueInRange(h,1),u=e.getLineCount(),f=e.getLineMaxColumn(u);let _=l.intersectRanges(new A(t.endLineNumber,t.endColumn,u,f));if(n&&e.getValueLengthInRange(_,1)>500){const p=e.modifyPosition(_.getStartPosition(),500);_=A.fromPositions(_.getStartPosition(),p)}const C=e.getValueInRange(_,1);let w;if(o===d||o+1===d)w=e.getValueInRange(t,1);else{const p=r.intersectRanges(t),g=l.intersectRanges(t);w=e.getValueInRange(p,1)+"…"+e.getValueInRange(g,1)}return n&&w.length>2*500&&(w=w.substring(0,500)+"…"+w.substring(w.length-500,w.length)),new he(c+w+C,c.length,c.length+w.length,t,h.endLineNumber-h.startLineNumber)}}var yu=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},_r=function(a,e){return function(t,i){e(t,i,a)}},Qi;(function(a){a.Tap="-monaco-textarea-synthetic-tap"})(Qi||(Qi={}));const Su={forceCopyWithSyntaxHighlighting:!1},fn=class fn{constructor(){this._lastState=null}set(e,t){this._lastState={lastCopiedValue:e,data:t}}get(e){return this._lastState&&this._lastState.lastCopiedValue===e?this._lastState.data:(this._lastState=null,null)}};fn.INSTANCE=new fn;let Xi=fn;class Lu{constructor(){this._lastTypeTextLength=0}handleCompositionUpdate(e){e=e||"";const t={text:e,replacePrevCharCnt:this._lastTypeTextLength,replaceNextCharCnt:0,positionDelta:0};return this._lastTypeTextLength=e.length,t}}let vs=class extends U{get textAreaState(){return this._textAreaState}constructor(e,t,i,n,s,o){super(),this._host=e,this._textArea=t,this._OS=i,this._browser=n,this._accessibilityService=s,this._logService=o,this._onFocus=this._register(new W),this.onFocus=this._onFocus.event,this._onBlur=this._register(new W),this.onBlur=this._onBlur.event,this._onKeyDown=this._register(new W),this.onKeyDown=this._onKeyDown.event,this._onKeyUp=this._register(new W),this.onKeyUp=this._onKeyUp.event,this._onCut=this._register(new W),this.onCut=this._onCut.event,this._onPaste=this._register(new W),this.onPaste=this._onPaste.event,this._onType=this._register(new W),this.onType=this._onType.event,this._onCompositionStart=this._register(new W),this.onCompositionStart=this._onCompositionStart.event,this._onCompositionUpdate=this._register(new W),this.onCompositionUpdate=this._onCompositionUpdate.event,this._onCompositionEnd=this._register(new W),this.onCompositionEnd=this._onCompositionEnd.event,this._onSelectionChangeRequest=this._register(new W),this.onSelectionChangeRequest=this._onSelectionChangeRequest.event,this._asyncFocusGainWriteScreenReaderContent=this._register(new od),this._asyncTriggerCut=this._register(new gt(()=>this._onCut.fire(),0)),this._textAreaState=he.EMPTY,this._selectionChangeListener=null,this._accessibilityService.isScreenReaderOptimized()&&this.writeNativeTextAreaContent("ctor"),this._register(ri.runAndSubscribe(this._accessibilityService.onDidChangeScreenReaderOptimized,()=>{this._accessibilityService.isScreenReaderOptimized()&&!this._asyncFocusGainWriteScreenReaderContent.value?this._asyncFocusGainWriteScreenReaderContent.value=this._register(new gt(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)):this._asyncFocusGainWriteScreenReaderContent.clear()})),this._hasFocus=!1,this._currentComposition=null;let r=null;this._register(this._textArea.onKeyDown(d=>{const l=new rs(d);(l.keyCode===114||this._currentComposition&&l.keyCode===1)&&l.stopPropagation(),l.equals(9)&&l.preventDefault(),r=l,this._onKeyDown.fire(l)})),this._register(this._textArea.onKeyUp(d=>{const l=new rs(d);this._onKeyUp.fire(l)})),this._register(this._textArea.onCompositionStart(d=>{const l=new Lu;if(this._currentComposition){this._currentComposition=l;return}if(this._currentComposition=l,this._OS===2&&r&&r.equals(114)&&this._textAreaState.selectionStart===this._textAreaState.selectionEnd&&this._textAreaState.selectionStart>0&&this._textAreaState.value.substr(this._textAreaState.selectionStart-1,1)===d.data&&(r.code==="ArrowRight"||r.code==="ArrowLeft")){l.handleCompositionUpdate("x"),this._onCompositionStart.fire({data:d.data});return}if(this._browser.isAndroid){this._onCompositionStart.fire({data:d.data});return}this._onCompositionStart.fire({data:d.data})})),this._register(this._textArea.onCompositionUpdate(d=>{const l=this._currentComposition;if(!l)return;if(this._browser.isAndroid){const c=he.readFromTextArea(this._textArea,this._textAreaState),u=he.deduceAndroidCompositionInput(this._textAreaState,c);this._textAreaState=c,this._onType.fire(u),this._onCompositionUpdate.fire(d);return}const h=l.handleCompositionUpdate(d.data);this._textAreaState=he.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(h),this._onCompositionUpdate.fire(d)})),this._register(this._textArea.onCompositionEnd(d=>{const l=this._currentComposition;if(!l)return;if(this._currentComposition=null,this._browser.isAndroid){const c=he.readFromTextArea(this._textArea,this._textAreaState),u=he.deduceAndroidCompositionInput(this._textAreaState,c);this._textAreaState=c,this._onType.fire(u),this._onCompositionEnd.fire();return}const h=l.handleCompositionUpdate(d.data);this._textAreaState=he.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(h),this._onCompositionEnd.fire()})),this._register(this._textArea.onInput(d=>{if(this._textArea.setIgnoreSelectionChangeTime("received input event"),this._currentComposition)return;const l=he.readFromTextArea(this._textArea,this._textAreaState),h=he.deduceInput(this._textAreaState,l,this._OS===2);h.replacePrevCharCnt===0&&h.text.length===1&&(Zr(h.text.charCodeAt(0))||h.text.charCodeAt(0)===127)||(this._textAreaState=l,(h.text!==""||h.replacePrevCharCnt!==0||h.replaceNextCharCnt!==0||h.positionDelta!==0)&&this._onType.fire(h))})),this._register(this._textArea.onCut(d=>{this._textArea.setIgnoreSelectionChangeTime("received cut event"),this._ensureClipboardGetsEditorSelection(d),this._asyncTriggerCut.schedule()})),this._register(this._textArea.onCopy(d=>{this._ensureClipboardGetsEditorSelection(d)})),this._register(this._textArea.onPaste(d=>{if(this._textArea.setIgnoreSelectionChangeTime("received paste event"),d.preventDefault(),!d.clipboardData)return;let[l,h]=pr.getTextData(d.clipboardData);l&&(h=h||Xi.INSTANCE.get(l),this._onPaste.fire({text:l,metadata:h}))})),this._register(this._textArea.onFocus(()=>{const d=this._hasFocus;this._setHasFocus(!0),this._accessibilityService.isScreenReaderOptimized()&&this._browser.isSafari&&!d&&this._hasFocus&&(this._asyncFocusGainWriteScreenReaderContent.value||(this._asyncFocusGainWriteScreenReaderContent.value=new gt(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)),this._asyncFocusGainWriteScreenReaderContent.value.schedule())})),this._register(this._textArea.onBlur(()=>{this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("blurWithoutCompositionEnd"),this._onCompositionEnd.fire()),this._setHasFocus(!1)})),this._register(this._textArea.onSyntheticTap(()=>{this._browser.isAndroid&&this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("tapWithoutCompositionEnd"),this._onCompositionEnd.fire())}))}_installSelectionChangeListener(){let e=0;return O(this._textArea.ownerDocument,"selectionchange",t=>{if(Et.onSelectionChange(),!this._hasFocus||this._currentComposition||!this._browser.isChrome)return;const i=Date.now(),n=i-e;if(e=i,n<5)return;const s=i-this._textArea.getIgnoreSelectionChangeTime();if(this._textArea.resetSelectionChangeTime(),s<100||!this._textAreaState.selection)return;const o=this._textArea.getValue();if(this._textAreaState.value!==o)return;const r=this._textArea.getSelectionStart(),d=this._textArea.getSelectionEnd();if(this._textAreaState.selectionStart===r&&this._textAreaState.selectionEnd===d)return;const l=this._textAreaState.deduceEditorPosition(r),h=this._host.deduceModelPosition(l[0],l[1],l[2]),c=this._textAreaState.deduceEditorPosition(d),u=this._host.deduceModelPosition(c[0],c[1],c[2]),f=new we(h.lineNumber,h.column,u.lineNumber,u.column);this._onSelectionChangeRequest.fire(f)})}dispose(){super.dispose(),this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null)}focusTextArea(){this._setHasFocus(!0),this.refreshFocusState()}isFocused(){return this._hasFocus}refreshFocusState(){this._setHasFocus(this._textArea.hasFocus())}_setHasFocus(e){this._hasFocus!==e&&(this._hasFocus=e,this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null),this._hasFocus&&(this._selectionChangeListener=this._installSelectionChangeListener()),this._hasFocus&&this.writeNativeTextAreaContent("focusgain"),this._hasFocus?this._onFocus.fire():this._onBlur.fire())}_setAndWriteTextAreaState(e,t){this._hasFocus||(t=t.collapseSelection()),t.writeToTextArea(e,this._textArea,this._hasFocus),this._textAreaState=t}writeNativeTextAreaContent(e){!this._accessibilityService.isScreenReaderOptimized()&&e==="render"||this._currentComposition||(this._logService.trace(`writeTextAreaState(reason: ${e})`),this._setAndWriteTextAreaState(e,this._host.getScreenReaderContent()))}_ensureClipboardGetsEditorSelection(e){const t=this._host.getDataToCopy(),i={version:1,isFromEmptySelection:t.isFromEmptySelection,multicursorText:t.multicursorText,mode:t.mode};Xi.INSTANCE.set(this._browser.isFirefox?t.text.replace(/\r\n/g,`
`):t.text,i),e.preventDefault(),e.clipboardData&&pr.setTextData(e.clipboardData,t.text,t.html,i)}};vs=yu([_r(4,yt),_r(5,Rn)],vs);const pr={getTextData(a){const e=a.getData(li.text);let t=null;const i=a.getData("vscode-editor-data");if(typeof i=="string")try{t=JSON.parse(i),t.version!==1&&(t=null)}catch{}return e.length===0&&t===null&&a.files.length>0?[Array.prototype.slice.call(a.files,0).map(s=>s.name).join(`
`),null]:[e,t]},setTextData(a,e,t,i){a.setData(li.text,e),typeof t=="string"&&a.setData("text/html",t),a.setData("vscode-editor-data",JSON.stringify(i))}};class Du extends U{get ownerDocument(){return this._actual.ownerDocument}constructor(e){super(),this._actual=e,this.onKeyDown=this._register(new Se(this._actual,"keydown")).event,this.onKeyUp=this._register(new Se(this._actual,"keyup")).event,this.onCompositionStart=this._register(new Se(this._actual,"compositionstart")).event,this.onCompositionUpdate=this._register(new Se(this._actual,"compositionupdate")).event,this.onCompositionEnd=this._register(new Se(this._actual,"compositionend")).event,this.onBeforeInput=this._register(new Se(this._actual,"beforeinput")).event,this.onInput=this._register(new Se(this._actual,"input")).event,this.onCut=this._register(new Se(this._actual,"cut")).event,this.onCopy=this._register(new Se(this._actual,"copy")).event,this.onPaste=this._register(new Se(this._actual,"paste")).event,this.onFocus=this._register(new Se(this._actual,"focus")).event,this.onBlur=this._register(new Se(this._actual,"blur")).event,this._onSyntheticTap=this._register(new W),this.onSyntheticTap=this._onSyntheticTap.event,this._ignoreSelectionChangeTime=0,this._register(this.onKeyDown(()=>Et.onKeyDown())),this._register(this.onBeforeInput(()=>Et.onBeforeInput())),this._register(this.onInput(()=>Et.onInput())),this._register(this.onKeyUp(()=>Et.onKeyUp())),this._register(O(this._actual,Qi.Tap,()=>this._onSyntheticTap.fire()))}hasFocus(){const e=ji(this._actual);return e?e.activeElement===this._actual:this._actual.isConnected?wt()===this._actual:!1}setIgnoreSelectionChangeTime(e){this._ignoreSelectionChangeTime=Date.now()}getIgnoreSelectionChangeTime(){return this._ignoreSelectionChangeTime}resetSelectionChangeTime(){this._ignoreSelectionChangeTime=0}getValue(){return this._actual.value}setValue(e,t){const i=this._actual;i.value!==t&&(this.setIgnoreSelectionChangeTime("setValue"),i.value=t)}getSelectionStart(){return this._actual.selectionDirection==="backward"?this._actual.selectionEnd:this._actual.selectionStart}getSelectionEnd(){return this._actual.selectionDirection==="backward"?this._actual.selectionStart:this._actual.selectionEnd}setSelectionRange(e,t,i){const n=this._actual;let s=null;const o=ji(n);o?s=o.activeElement:s=wt();const r=G(s),d=s===n,l=n.selectionStart,h=n.selectionEnd;if(d&&l===t&&h===i){Ct&&r.parent!==r&&n.focus();return}if(d){this.setIgnoreSelectionChangeTime("setSelectionRange"),n.setSelectionRange(t,i),Ct&&r.parent!==r&&n.focus();return}try{const c=nc(n);this.setIgnoreSelectionChangeTime("setSelectionRange"),n.focus(),n.setSelectionRange(t,i),sc(n,c)}catch{}}}class Nu extends mo{constructor(e,t,i){super(e,t,i),this._register(ro.addTarget(this.viewHelper.linesContentDomNode)),this._register(O(this.viewHelper.linesContentDomNode,qe.Tap,s=>this.onTap(s))),this._register(O(this.viewHelper.linesContentDomNode,qe.Change,s=>this.onChange(s))),this._register(O(this.viewHelper.linesContentDomNode,qe.Contextmenu,s=>this._onContextMenu(new st(s,!1,this.viewHelper.viewDomNode),!1))),this._lastPointerType="mouse",this._register(O(this.viewHelper.linesContentDomNode,"pointerdown",s=>{const o=s.pointerType;if(o==="mouse"){this._lastPointerType="mouse";return}else o==="touch"?this._lastPointerType="touch":this._lastPointerType="pen"}));const n=new nu(this.viewHelper.viewDomNode);this._register(n.onPointerMove(this.viewHelper.viewDomNode,s=>this._onMouseMove(s))),this._register(n.onPointerUp(this.viewHelper.viewDomNode,s=>this._onMouseUp(s))),this._register(n.onPointerLeave(this.viewHelper.viewDomNode,s=>this._onMouseLeave(s))),this._register(n.onPointerDown(this.viewHelper.viewDomNode,(s,o)=>this._onMouseDown(s,o)))}onTap(e){!e.initialTarget||!this.viewHelper.linesContentDomNode.contains(e.initialTarget)||(e.preventDefault(),this.viewHelper.focusTextArea(),this._dispatchGesture(e,!1))}onChange(e){this._lastPointerType==="touch"&&this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY),this._lastPointerType==="pen"&&this._dispatchGesture(e,!0)}_dispatchGesture(e,t){const i=this._createMouseTarget(new st(e,!1,this.viewHelper.viewDomNode),!1);i.position&&this.viewController.dispatchMouse({position:i.position,mouseColumn:i.position.column,startedOnLineNumbers:!1,revealType:1,mouseDownCount:e.tapCount,inSelectionMode:t,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,leftButton:!1,middleButton:!1,onInjectedText:i.type===6&&i.detail.injectedText!==null})}_onMouseDown(e,t){e.browserEvent.pointerType!=="touch"&&super._onMouseDown(e,t)}}class Mu extends mo{constructor(e,t,i){super(e,t,i),this._register(ro.addTarget(this.viewHelper.linesContentDomNode)),this._register(O(this.viewHelper.linesContentDomNode,qe.Tap,n=>this.onTap(n))),this._register(O(this.viewHelper.linesContentDomNode,qe.Change,n=>this.onChange(n))),this._register(O(this.viewHelper.linesContentDomNode,qe.Contextmenu,n=>this._onContextMenu(new st(n,!1,this.viewHelper.viewDomNode),!1)))}onTap(e){e.preventDefault(),this.viewHelper.focusTextArea();const t=this._createMouseTarget(new st(e,!1,this.viewHelper.viewDomNode),!1);if(t.position){const i=document.createEvent("CustomEvent");i.initEvent(Qi.Tap,!1,!0),this.viewHelper.dispatchTextAreaEvent(i),this.viewController.moveTo(t.position,1)}}onChange(e){this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY)}}class xu extends U{constructor(e,t,i){super(),(rd||ad&&dd)&&$h.pointerEvents?this.handler=this._register(new Nu(e,t,i)):Pn.TouchEvent?this.handler=this._register(new Mu(e,t,i)):this.handler=this._register(new mo(e,t,i))}getTargetAtClientPoint(e,t){return this.handler.getTargetAtClientPoint(e,t)}}class Lt extends Ri{}const mn=class mn extends Lt{constructor(e){super(),this._context=e,this._readConfig(),this._lastCursorModelPosition=new T(1,1),this._renderResult=null,this._activeLineNumber=1,this._context.addEventHandler(this)}_readConfig(){const e=this._context.configuration.options;this._lineHeight=e.get(67);const t=e.get(68);this._renderLineNumbers=t.renderType,this._renderCustomLineNumbers=t.renderFn,this._renderFinalNewline=e.get(96);const i=e.get(146);this._lineNumbersLeft=i.lineNumbersLeft,this._lineNumbersWidth=i.lineNumbersWidth}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return this._readConfig(),!0}onCursorStateChanged(e){const t=e.selections[0].getPosition();this._lastCursorModelPosition=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(t);let i=!1;return this._activeLineNumber!==t.lineNumber&&(this._activeLineNumber=t.lineNumber,i=!0),(this._renderLineNumbers===2||this._renderLineNumbers===3)&&(i=!0),i}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onDecorationsChanged(e){return e.affectsLineNumber}_getLineRenderLineNumber(e){const t=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new T(e,1));if(t.column!==1)return"";const i=t.lineNumber;if(this._renderCustomLineNumbers)return this._renderCustomLineNumbers(i);if(this._renderLineNumbers===2){const n=Math.abs(this._lastCursorModelPosition.lineNumber-i);return n===0?'<span class="relative-current-line-number">'+i+"</span>":String(n)}if(this._renderLineNumbers===3){if(this._lastCursorModelPosition.lineNumber===i||i%10===0)return String(i);const n=this._context.viewModel.getLineCount();return i===n?String(i):""}return String(i)}prepareRender(e){if(this._renderLineNumbers===0){this._renderResult=null;return}const t=Ln?this._lineHeight%2===0?" lh-even":" lh-odd":"",i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,s=this._context.viewModel.getDecorationsInViewport(e.visibleRange).filter(l=>!!l.options.lineNumberClassName);s.sort((l,h)=>A.compareRangesUsingEnds(l.range,h.range));let o=0;const r=this._context.viewModel.getLineCount(),d=[];for(let l=i;l<=n;l++){const h=l-i;let c=this._getLineRenderLineNumber(l),u="";for(;o<s.length&&s[o].range.endLineNumber<l;)o++;for(let f=o;f<s.length;f++){const{range:_,options:C}=s[f];_.startLineNumber<=l&&(u+=" "+C.lineNumberClassName)}if(!c&&!u){d[h]="";continue}l===r&&this._context.viewModel.getLineLength(l)===0&&(this._renderFinalNewline==="off"&&(c=""),this._renderFinalNewline==="dimmed"&&(u+=" dimmed-line-number")),l===this._activeLineNumber&&(u+=" active-line-number"),d[h]=`<div class="${mn.CLASS_NAME}${t}${u}" style="left:${this._lineNumbersLeft}px;width:${this._lineNumbersWidth}px;">${c}</div>`}this._renderResult=d}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}};mn.CLASS_NAME="line-numbers";let Ji=mn;St((a,e)=>{const t=a.getColor(il),i=a.getColor(nl);i?e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${i}; }`):t&&e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${t.transparent(.4)}; }`)});const Ht=class Ht extends pe{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._canUseLayerHinting=!t.get(32),this._contentLeft=i.contentLeft,this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._domNode=V(document.createElement("div")),this._domNode.setClassName(Ht.OUTER_CLASS_NAME),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._glyphMarginBackgroundDomNode=V(document.createElement("div")),this._glyphMarginBackgroundDomNode.setClassName(Ht.CLASS_NAME),this._domNode.appendChild(this._glyphMarginBackgroundDomNode)}dispose(){super.dispose()}getDomNode(){return this._domNode}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._canUseLayerHinting=!t.get(32),this._contentLeft=i.contentLeft,this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollTopChanged}prepareRender(e){}render(e){this._domNode.setLayerHinting(this._canUseLayerHinting),this._domNode.setContain("strict");const t=e.scrollTop-e.bigNumbersDelta;this._domNode.setTop(-t);const i=Math.min(e.scrollHeight,1e6);this._domNode.setHeight(i),this._domNode.setWidth(this._contentLeft),this._glyphMarginBackgroundDomNode.setLeft(this._glyphMarginLeft),this._glyphMarginBackgroundDomNode.setWidth(this._glyphMarginWidth),this._glyphMarginBackgroundDomNode.setHeight(i)}};Ht.CLASS_NAME="glyph-margin",Ht.OUTER_CLASS_NAME="margin";let en=Ht;var Ru=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},vr=function(a,e){return function(t,i){e(t,i,a)}};class Eu{constructor(e,t,i,n,s){this._context=e,this.modelLineNumber=t,this.distanceToModelLineStart=i,this.widthOfHiddenLineTextBefore=n,this.distanceToModelLineEnd=s,this._visibleTextAreaBrand=void 0,this.startPosition=null,this.endPosition=null,this.visibleTextareaStart=null,this.visibleTextareaEnd=null,this._previousPresentation=null}prepareRender(e){const t=new T(this.modelLineNumber,this.distanceToModelLineStart+1),i=new T(this.modelLineNumber,this._context.viewModel.model.getLineMaxColumn(this.modelLineNumber)-this.distanceToModelLineEnd);this.startPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t),this.endPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i),this.startPosition.lineNumber===this.endPosition.lineNumber?(this.visibleTextareaStart=e.visibleRangeForPosition(this.startPosition),this.visibleTextareaEnd=e.visibleRangeForPosition(this.endPosition)):(this.visibleTextareaStart=null,this.visibleTextareaEnd=null)}definePresentation(e){return this._previousPresentation||(e?this._previousPresentation=e:this._previousPresentation={foreground:1,italic:!1,bold:!1,underline:!1,strikethrough:!1}),this._previousPresentation}}const zn=Ct;let Cs=class extends pe{constructor(e,t,i,n,s){super(e),this._keybindingService=n,this._instantiationService=s,this._primaryCursorPosition=new T(1,1),this._primaryCursorVisibleRange=null,this._viewController=t,this._visibleRangeProvider=i,this._scrollLeft=0,this._scrollTop=0;const o=this._context.configuration.options,r=o.get(146);this._setAccessibilityOptions(o),this._contentLeft=r.contentLeft,this._contentWidth=r.contentWidth,this._contentHeight=r.height,this._fontInfo=o.get(50),this._lineHeight=o.get(67),this._emptySelectionClipboard=o.get(37),this._copyWithSyntaxHighlighting=o.get(25),this._visibleTextArea=null,this._selections=[new we(1,1,1,1)],this._modelSelections=[new we(1,1,1,1)],this._lastRenderPosition=null,this.textArea=V(document.createElement("textarea")),Ie.write(this.textArea,7),this.textArea.setClassName(`inputarea ${kt}`),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:d}=this._context.viewModel.model.getOptions();this.textArea.domNode.style.tabSize=`${d*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("autocorrect","off"),this.textArea.setAttribute("autocapitalize","off"),this.textArea.setAttribute("autocomplete","off"),this.textArea.setAttribute("spellcheck","false"),this.textArea.setAttribute("aria-label",this._getAriaLabel(o)),this.textArea.setAttribute("aria-required",o.get(5)?"true":"false"),this.textArea.setAttribute("tabindex",String(o.get(125))),this.textArea.setAttribute("role","textbox"),this.textArea.setAttribute("aria-roledescription",F("editor","editor")),this.textArea.setAttribute("aria-multiline","true"),this.textArea.setAttribute("aria-autocomplete",o.get(92)?"none":"both"),this._ensureReadOnlyAttribute(),this.textAreaCover=V(document.createElement("div")),this.textAreaCover.setPosition("absolute");const l={getLineCount:()=>this._context.viewModel.getLineCount(),getLineMaxColumn:u=>this._context.viewModel.getLineMaxColumn(u),getValueInRange:(u,f)=>this._context.viewModel.getValueInRange(u,f),getValueLengthInRange:(u,f)=>this._context.viewModel.getValueLengthInRange(u,f),modifyPosition:(u,f)=>this._context.viewModel.modifyPosition(u,f)},h={getDataToCopy:()=>{const u=this._context.viewModel.getPlainTextToCopy(this._modelSelections,this._emptySelectionClipboard,Kr),f=this._context.viewModel.model.getEOL(),_=this._emptySelectionClipboard&&this._modelSelections.length===1&&this._modelSelections[0].isEmpty(),C=Array.isArray(u)?u:null,w=Array.isArray(u)?u.join(f):u;let p,g=null;if(Su.forceCopyWithSyntaxHighlighting||this._copyWithSyntaxHighlighting&&w.length<65536){const v=this._context.viewModel.getRichTextToCopy(this._modelSelections,this._emptySelectionClipboard);v&&(p=v.html,g=v.mode)}return{isFromEmptySelection:_,multicursorText:C,text:w,html:p,mode:g}},getScreenReaderContent:()=>{if(this._accessibilitySupport===1){const u=this._selections[0];if(ut&&u.isEmpty()){const _=u.getStartPosition();let C=this._getWordBeforePosition(_);if(C.length===0&&(C=this._getCharacterBeforePosition(_)),C.length>0)return new he(C,C.length,C.length,A.fromPositions(_),0)}if(ut&&!u.isEmpty()&&l.getValueLengthInRange(u,0)<500){const _=l.getValueInRange(u,0);return new he(_,0,_.length,u,0)}if(bi&&!u.isEmpty()){const _="vscode-placeholder";return new he(_,0,_.length,null,void 0)}return he.EMPTY}if(Xo){const u=this._selections[0];if(u.isEmpty()){const f=u.getStartPosition(),[_,C]=this._getAndroidWordAtPosition(f);if(_.length>0)return new he(_,C,C,A.fromPositions(f),0)}return he.EMPTY}return Tt.fromEditorSelection(l,this._selections[0],this._accessibilityPageSize,this._accessibilitySupport===0)},deduceModelPosition:(u,f,_)=>this._context.viewModel.deduceModelPositionRelativeToViewPosition(u,f,_)},c=this._register(new Du(this.textArea.domNode));this._textAreaInput=this._register(this._instantiationService.createInstance(vs,h,c,ld,{isAndroid:Xo,isChrome:Gh,isFirefox:Ct,isSafari:bi})),this._register(this._textAreaInput.onKeyDown(u=>{this._viewController.emitKeyDown(u)})),this._register(this._textAreaInput.onKeyUp(u=>{this._viewController.emitKeyUp(u)})),this._register(this._textAreaInput.onPaste(u=>{let f=!1,_=null,C=null;u.metadata&&(f=this._emptySelectionClipboard&&!!u.metadata.isFromEmptySelection,_=typeof u.metadata.multicursorText<"u"?u.metadata.multicursorText:null,C=u.metadata.mode),this._viewController.paste(u.text,f,_,C)})),this._register(this._textAreaInput.onCut(()=>{this._viewController.cut()})),this._register(this._textAreaInput.onType(u=>{u.replacePrevCharCnt||u.replaceNextCharCnt||u.positionDelta?this._viewController.compositionType(u.text,u.replacePrevCharCnt,u.replaceNextCharCnt,u.positionDelta):this._viewController.type(u.text)})),this._register(this._textAreaInput.onSelectionChangeRequest(u=>{this._viewController.setSelection(u)})),this._register(this._textAreaInput.onCompositionStart(u=>{const f=this.textArea.domNode,_=this._modelSelections[0],{distanceToModelLineStart:C,widthOfHiddenTextBefore:w}=(()=>{const g=f.value.substring(0,Math.min(f.selectionStart,f.selectionEnd)),v=g.lastIndexOf(`
`),m=g.substring(v+1),b=m.lastIndexOf("	"),y=m.length-b-1,N=_.getStartPosition(),S=Math.min(N.column-1,y),L=N.column-1-S,R=m.substring(0,m.length-S),{tabSize:x}=this._context.viewModel.model.getOptions(),M=Tu(this.textArea.domNode.ownerDocument,R,this._fontInfo,x);return{distanceToModelLineStart:L,widthOfHiddenTextBefore:M}})(),{distanceToModelLineEnd:p}=(()=>{const g=f.value.substring(Math.max(f.selectionStart,f.selectionEnd)),v=g.indexOf(`
`),m=v===-1?g:g.substring(0,v),b=m.indexOf("	"),y=b===-1?m.length:m.length-b-1,N=_.getEndPosition(),S=Math.min(this._context.viewModel.model.getLineMaxColumn(N.lineNumber)-N.column,y);return{distanceToModelLineEnd:this._context.viewModel.model.getLineMaxColumn(N.lineNumber)-N.column-S}})();this._context.viewModel.revealRange("keyboard",!0,A.fromPositions(this._selections[0].getStartPosition()),0,1),this._visibleTextArea=new Eu(this._context,_.startLineNumber,C,w,p),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render(),this.textArea.setClassName(`inputarea ${kt} ime-input`),this._viewController.compositionStart(),this._context.viewModel.onCompositionStart()})),this._register(this._textAreaInput.onCompositionUpdate(u=>{this._visibleTextArea&&(this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render())})),this._register(this._textAreaInput.onCompositionEnd(()=>{this._visibleTextArea=null,this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._render(),this.textArea.setClassName(`inputarea ${kt}`),this._viewController.compositionEnd(),this._context.viewModel.onCompositionEnd()})),this._register(this._textAreaInput.onFocus(()=>{this._context.viewModel.setHasFocus(!0)})),this._register(this._textAreaInput.onBlur(()=>{this._context.viewModel.setHasFocus(!1)})),this._register(xo.onDidChange(()=>{this._ensureReadOnlyAttribute()}))}writeScreenReaderContent(e){this._textAreaInput.writeNativeTextAreaContent(e)}dispose(){super.dispose()}_getAndroidWordAtPosition(e){const t='`~!@#$%^&*()-=+[{]}\\|;:",.<>/?',i=this._context.viewModel.getLineContent(e.lineNumber),n=Wo(t,[]);let s=!0,o=e.column,r=!0,d=e.column,l=0;for(;l<50&&(s||r);){if(s&&o<=1&&(s=!1),s){const h=i.charCodeAt(o-2);n.get(h)!==0?s=!1:o--}if(r&&d>i.length&&(r=!1),r){const h=i.charCodeAt(d-1);n.get(h)!==0?r=!1:d++}l++}return[i.substring(o-1,d-1),e.column-o]}_getWordBeforePosition(e){const t=this._context.viewModel.getLineContent(e.lineNumber),i=Wo(this._context.configuration.options.get(132),[]);let n=e.column,s=0;for(;n>1;){const o=t.charCodeAt(n-2);if(i.get(o)!==0||s>50)return t.substring(n-1,e.column-1);s++,n--}return t.substring(0,e.column-1)}_getCharacterBeforePosition(e){if(e.column>1){const i=this._context.viewModel.getLineContent(e.lineNumber).charAt(e.column-2);if(!Zr(i.charCodeAt(0)))return i}return""}_getAriaLabel(e){var i,n,s;if(e.get(2)===1){const o=(i=this._keybindingService.lookupKeybinding("editor.action.toggleScreenReaderAccessibilityMode"))==null?void 0:i.getAriaLabel(),r=(n=this._keybindingService.lookupKeybinding("workbench.action.showCommands"))==null?void 0:n.getAriaLabel(),d=(s=this._keybindingService.lookupKeybinding("workbench.action.openGlobalKeybindings"))==null?void 0:s.getAriaLabel(),l=F("accessibilityModeOff","The editor is not accessible at this time.");return o?F("accessibilityOffAriaLabel","{0} To enable screen reader optimized mode, use {1}",l,o):r?F("accessibilityOffAriaLabelNoKb","{0} To enable screen reader optimized mode, open the quick pick with {1} and run the command Toggle Screen Reader Accessibility Mode, which is currently not triggerable via keyboard.",l,r):d?F("accessibilityOffAriaLabelNoKbs","{0} Please assign a keybinding for the command Toggle Screen Reader Accessibility Mode by accessing the keybindings editor with {1} and run it.",l,d):l}return e.get(4)}_setAccessibilityOptions(e){this._accessibilitySupport=e.get(2);const t=e.get(3);this._accessibilitySupport===2&&t===sl.accessibilityPageSize.defaultValue?this._accessibilityPageSize=500:this._accessibilityPageSize=t;const n=e.get(146).wrappingColumn;if(n!==-1&&this._accessibilitySupport!==1){const s=e.get(50);this._textAreaWrapping=!0,this._textAreaWidth=Math.round(n*s.typicalHalfwidthCharacterWidth)}else this._textAreaWrapping=!1,this._textAreaWidth=zn?0:1}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);this._setAccessibilityOptions(t),this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._contentHeight=i.height,this._fontInfo=t.get(50),this._lineHeight=t.get(67),this._emptySelectionClipboard=t.get(37),this._copyWithSyntaxHighlighting=t.get(25),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:n}=this._context.viewModel.model.getOptions();return this.textArea.domNode.style.tabSize=`${n*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("aria-label",this._getAriaLabel(t)),this.textArea.setAttribute("aria-required",t.get(5)?"true":"false"),this.textArea.setAttribute("tabindex",String(t.get(125))),(e.hasChanged(34)||e.hasChanged(92))&&this._ensureReadOnlyAttribute(),e.hasChanged(2)&&this._textAreaInput.writeNativeTextAreaContent("strategy changed"),!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),this._modelSelections=e.modelSelections.slice(0),this._textAreaInput.writeNativeTextAreaContent("selection changed"),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return this._scrollLeft=e.scrollLeft,this._scrollTop=e.scrollTop,!0}onZonesChanged(e){return!0}isFocused(){return this._textAreaInput.isFocused()}focusTextArea(){this._textAreaInput.focusTextArea()}getLastRenderData(){return this._lastRenderPosition}setAriaOptions(e){e.activeDescendant?(this.textArea.setAttribute("aria-haspopup","true"),this.textArea.setAttribute("aria-autocomplete","list"),this.textArea.setAttribute("aria-activedescendant",e.activeDescendant)):(this.textArea.setAttribute("aria-haspopup","false"),this.textArea.setAttribute("aria-autocomplete","both"),this.textArea.removeAttribute("aria-activedescendant")),e.role&&this.textArea.setAttribute("role",e.role)}_ensureReadOnlyAttribute(){const e=this._context.configuration.options;!xo.enabled||e.get(34)&&e.get(92)?this.textArea.setAttribute("readonly","true"):this.textArea.removeAttribute("readonly")}prepareRender(e){var t;this._primaryCursorPosition=new T(this._selections[0].positionLineNumber,this._selections[0].positionColumn),this._primaryCursorVisibleRange=e.visibleRangeForPosition(this._primaryCursorPosition),(t=this._visibleTextArea)==null||t.prepareRender(e)}render(e){this._textAreaInput.writeNativeTextAreaContent("render"),this._render()}_render(){if(this._visibleTextArea){const i=this._visibleTextArea.visibleTextareaStart,n=this._visibleTextArea.visibleTextareaEnd,s=this._visibleTextArea.startPosition,o=this._visibleTextArea.endPosition;if(s&&o&&i&&n&&n.left>=this._scrollLeft&&i.left<=this._scrollLeft+this._contentWidth){const r=this._context.viewLayout.getVerticalOffsetForLineNumber(this._primaryCursorPosition.lineNumber)-this._scrollTop,d=this._newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));let l=this._visibleTextArea.widthOfHiddenLineTextBefore,h=this._contentLeft+i.left-this._scrollLeft,c=n.left-i.left+1;if(h<this._contentLeft){const p=this._contentLeft-h;h+=p,l+=p,c-=p}c>this._contentWidth&&(c=this._contentWidth);const u=this._context.viewModel.getViewLineData(s.lineNumber),f=u.tokens.findTokenIndexAtOffset(s.column-1),_=u.tokens.findTokenIndexAtOffset(o.column-1),C=f===_,w=this._visibleTextArea.definePresentation(C?u.tokens.getPresentation(f):null);this.textArea.domNode.scrollTop=d*this._lineHeight,this.textArea.domNode.scrollLeft=l,this._doRender({lastRenderPosition:null,top:r,left:h,width:c,height:this._lineHeight,useCover:!1,color:(eo.getColorMap()||[])[w.foreground],italic:w.italic,bold:w.bold,underline:w.underline,strikethrough:w.strikethrough})}return}if(!this._primaryCursorVisibleRange){this._renderAtTopLeft();return}const e=this._contentLeft+this._primaryCursorVisibleRange.left-this._scrollLeft;if(e<this._contentLeft||e>this._contentLeft+this._contentWidth){this._renderAtTopLeft();return}const t=this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber)-this._scrollTop;if(t<0||t>this._contentHeight){this._renderAtTopLeft();return}if(ut||this._accessibilitySupport===2){this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:this._lineHeight,useCover:!1}),this.textArea.domNode.scrollLeft=this._primaryCursorVisibleRange.left;const i=this._textAreaInput.textAreaState.newlineCountBeforeSelection??this._newlinecount(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));this.textArea.domNode.scrollTop=i*this._lineHeight;return}this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:zn?0:1,useCover:!1})}_newlinecount(e){let t=0,i=-1;do{if(i=e.indexOf(`
`,i+1),i===-1)break;t++}while(!0);return t}_renderAtTopLeft(){this._doRender({lastRenderPosition:null,top:0,left:0,width:this._textAreaWidth,height:zn?0:1,useCover:!0})}_doRender(e){this._lastRenderPosition=e.lastRenderPosition;const t=this.textArea,i=this.textAreaCover;ge(t,this._fontInfo),t.setTop(e.top),t.setLeft(e.left),t.setWidth(e.width),t.setHeight(e.height),t.setColor(e.color?hi.Format.CSS.formatHex(e.color):""),t.setFontStyle(e.italic?"italic":""),e.bold&&t.setFontWeight("bold"),t.setTextDecoration(`${e.underline?" underline":""}${e.strikethrough?" line-through":""}`),i.setTop(e.useCover?e.top:0),i.setLeft(e.useCover?e.left:0),i.setWidth(e.useCover?e.width:0),i.setHeight(e.useCover?e.height:0);const n=this._context.configuration.options;n.get(57)?i.setClassName("monaco-editor-background textAreaCover "+en.OUTER_CLASS_NAME):n.get(68).renderType!==0?i.setClassName("monaco-editor-background textAreaCover "+Ji.CLASS_NAME):i.setClassName("monaco-editor-background textAreaCover")}};Cs=Ru([vr(3,so),vr(4,me)],Cs);function Tu(a,e,t,i){if(e.length===0)return 0;const n=a.createElement("div");n.style.position="absolute",n.style.top="-50000px",n.style.width="50000px";const s=a.createElement("span");ge(s,t),s.style.whiteSpace="pre",s.style.tabSize=`${i*t.spaceWidth}px`,s.append(e),n.appendChild(s),a.body.appendChild(n);const o=s.offsetWidth;return n.remove(),o}const H=0;class Z extends Zt{runEditorCommand(e,t,i){const n=t._getViewModel();n&&this.runCoreEditorCommand(n,i||{})}}var te;(function(a){const e=function(i){if(!wi(i))return!1;const n=i;return!(!Ci(n.to)||!Fi(n.by)&&!Ci(n.by)||!Fi(n.value)&&!Yr(n.value)||!Fi(n.revealCursor)&&!hd(n.revealCursor))};a.metadata={description:"Scroll editor in the given direction",args:[{name:"Editor scroll argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'to': A mandatory direction value.\n						```\n						'up', 'down'\n						```\n					* 'by': Unit to move. Default is computed based on 'to' value.\n						```\n						'line', 'wrappedLine', 'page', 'halfPage', 'editor'\n						```\n					* 'value': Number of units to move. Default is '1'.\n					* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\n				",constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["up","down"]},by:{type:"string",enum:["line","wrappedLine","page","halfPage","editor"]},value:{type:"number",default:1},revealCursor:{type:"boolean"}}}}]},a.RawDirection={Up:"up",Right:"right",Down:"down",Left:"left"},a.RawUnit={Line:"line",WrappedLine:"wrappedLine",Page:"page",HalfPage:"halfPage",Editor:"editor",Column:"column"};function t(i){let n;switch(i.to){case a.RawDirection.Up:n=1;break;case a.RawDirection.Right:n=2;break;case a.RawDirection.Down:n=3;break;case a.RawDirection.Left:n=4;break;default:return null}let s;switch(i.by){case a.RawUnit.Line:s=1;break;case a.RawUnit.WrappedLine:s=2;break;case a.RawUnit.Page:s=3;break;case a.RawUnit.HalfPage:s=4;break;case a.RawUnit.Editor:s=5;break;case a.RawUnit.Column:s=6;break;default:s=2}const o=Math.floor(i.value||1),r=!!i.revealCursor;return{direction:n,unit:s,value:o,revealCursor:r,select:!!i.select}}a.parse=t})(te||(te={}));var It;(function(a){const e=function(t){if(!wi(t))return!1;const i=t;return!(!Yr(i.lineNumber)&&!Ci(i.lineNumber)||!Fi(i.at)&&!Ci(i.at))};a.metadata={description:"Reveal the given line at the given logical position",args:[{name:"Reveal line argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'lineNumber': A mandatory line number value.\n					* 'at': Logical position at which line has to be revealed.\n						```\n						'top', 'center', 'bottom'\n						```\n				",constraint:e,schema:{type:"object",required:["lineNumber"],properties:{lineNumber:{type:["number","string"]},at:{type:"string",enum:["top","center","bottom"]}}}}]},a.RawAtArgument={Top:"top",Center:"center",Bottom:"bottom"}})(It||(It={}));class ws{constructor(e){e.addImplementation(1e4,"code-editor",(t,i)=>{const n=t.get(Re).getFocusedCodeEditor();return n&&n.hasTextFocus()?this._runEditorCommand(t,n,i):!1}),e.addImplementation(1e3,"generic-dom-input-textarea",(t,i)=>{const n=wt();return n&&["input","textarea"].indexOf(n.tagName.toLowerCase())>=0?(this.runDOMCommand(n),!0):!1}),e.addImplementation(0,"generic-dom",(t,i)=>{const n=t.get(Re).getActiveCodeEditor();return n?(n.focus(),this._runEditorCommand(t,n,i)):!1})}_runEditorCommand(e,t,i){const n=this.runEditorCommand(e,t,i);return n||!0}}var J;(function(a){class e extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){if(!v.position)return;g.model.pushStackElement(),g.setCursorStates(v.source,3,[oe.moveTo(g,g.getPrimaryCursorState(),this._inSelectionMode,v.position,v.viewPosition)])&&v.revealType!==2&&g.revealAllCursors(v.source,!0,!0)}}a.MoveTo=E(new e({id:"_moveTo",inSelectionMode:!1,precondition:void 0})),a.MoveToSelect=E(new e({id:"_moveToSelect",inSelectionMode:!0,precondition:void 0}));class t extends Z{runCoreEditorCommand(g,v){g.model.pushStackElement();const m=this._getColumnSelectResult(g,g.getPrimaryCursorState(),g.getCursorColumnSelectData(),v);m!==null&&(g.setCursorStates(v.source,3,m.viewStates.map(b=>Oi.fromViewState(b))),g.setCursorColumnSelectData({isReal:!0,fromViewLineNumber:m.fromLineNumber,fromViewVisualColumn:m.fromVisualColumn,toViewLineNumber:m.toLineNumber,toViewVisualColumn:m.toVisualColumn}),m.reversed?g.revealTopMostCursor(v.source):g.revealBottomMostCursor(v.source))}}a.ColumnSelect=E(new class extends t{constructor(){super({id:"columnSelect",precondition:void 0})}_getColumnSelectResult(p,g,v,m){if(typeof m.position>"u"||typeof m.viewPosition>"u"||typeof m.mouseColumn>"u")return null;const b=p.model.validatePosition(m.position),y=p.coordinatesConverter.validateViewPosition(new T(m.viewPosition.lineNumber,m.viewPosition.column),b),N=m.doColumnSelect?v.fromViewLineNumber:y.lineNumber,S=m.doColumnSelect?v.fromViewVisualColumn:m.mouseColumn-1;return Jt.columnSelect(p.cursorConfig,p,N,S,y.lineNumber,m.mouseColumn-1)}}),a.CursorColumnSelectLeft=E(new class extends t{constructor(){super({id:"cursorColumnSelectLeft",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:3599,linux:{primary:0}}})}_getColumnSelectResult(p,g,v,m){return Jt.columnSelectLeft(p.cursorConfig,p,v)}}),a.CursorColumnSelectRight=E(new class extends t{constructor(){super({id:"cursorColumnSelectRight",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:3601,linux:{primary:0}}})}_getColumnSelectResult(p,g,v,m){return Jt.columnSelectRight(p.cursorConfig,p,v)}});class i extends t{constructor(g){super(g),this._isPaged=g.isPaged}_getColumnSelectResult(g,v,m,b){return Jt.columnSelectUp(g.cursorConfig,g,m,this._isPaged)}}a.CursorColumnSelectUp=E(new i({isPaged:!1,id:"cursorColumnSelectUp",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:3600,linux:{primary:0}}})),a.CursorColumnSelectPageUp=E(new i({isPaged:!0,id:"cursorColumnSelectPageUp",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:3595,linux:{primary:0}}}));class n extends t{constructor(g){super(g),this._isPaged=g.isPaged}_getColumnSelectResult(g,v,m,b){return Jt.columnSelectDown(g.cursorConfig,g,m,this._isPaged)}}a.CursorColumnSelectDown=E(new n({isPaged:!1,id:"cursorColumnSelectDown",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:3602,linux:{primary:0}}})),a.CursorColumnSelectPageDown=E(new n({isPaged:!0,id:"cursorColumnSelectPageDown",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:3596,linux:{primary:0}}}));class s extends Z{constructor(){super({id:"cursorMove",precondition:void 0,metadata:Fo.metadata})}runCoreEditorCommand(g,v){const m=Fo.parse(v);m&&this._runCursorMove(g,v.source,m)}_runCursorMove(g,v,m){g.model.pushStackElement(),g.setCursorStates(v,3,s._move(g,g.getCursorStates(),m)),g.revealAllCursors(v,!0)}static _move(g,v,m){const b=m.select,y=m.value;switch(m.direction){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return oe.simpleMove(g,v,m.direction,b,y,m.unit);case 11:case 13:case 12:case 14:return oe.viewportMove(g,v,m.direction,b,y);default:return null}}}a.CursorMoveImpl=s,a.CursorMove=E(new s);class o extends Z{constructor(g){super(g),this._staticArgs=g.args}runCoreEditorCommand(g,v){let m=this._staticArgs;this._staticArgs.value===-1&&(m={direction:this._staticArgs.direction,unit:this._staticArgs.unit,select:this._staticArgs.select,value:v.pageSize||g.cursorConfig.pageSize}),g.model.pushStackElement(),g.setCursorStates(v.source,3,oe.simpleMove(g,g.getCursorStates(),m.direction,m.select,m.value,m.unit)),g.revealAllCursors(v.source,!0)}}a.CursorLeft=E(new o({args:{direction:0,unit:0,select:!1,value:1},id:"cursorLeft",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:15,mac:{primary:15,secondary:[288]}}})),a.CursorLeftSelect=E(new o({args:{direction:0,unit:0,select:!0,value:1},id:"cursorLeftSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:1039}})),a.CursorRight=E(new o({args:{direction:1,unit:0,select:!1,value:1},id:"cursorRight",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:17,mac:{primary:17,secondary:[292]}}})),a.CursorRightSelect=E(new o({args:{direction:1,unit:0,select:!0,value:1},id:"cursorRightSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:1041}})),a.CursorUp=E(new o({args:{direction:2,unit:2,select:!1,value:1},id:"cursorUp",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:16,mac:{primary:16,secondary:[302]}}})),a.CursorUpSelect=E(new o({args:{direction:2,unit:2,select:!0,value:1},id:"cursorUpSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:1040,secondary:[3088],mac:{primary:1040},linux:{primary:1040}}})),a.CursorPageUp=E(new o({args:{direction:2,unit:2,select:!1,value:-1},id:"cursorPageUp",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:11}})),a.CursorPageUpSelect=E(new o({args:{direction:2,unit:2,select:!0,value:-1},id:"cursorPageUpSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:1035}})),a.CursorDown=E(new o({args:{direction:3,unit:2,select:!1,value:1},id:"cursorDown",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:18,mac:{primary:18,secondary:[300]}}})),a.CursorDownSelect=E(new o({args:{direction:3,unit:2,select:!0,value:1},id:"cursorDownSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:1042,secondary:[3090],mac:{primary:1042},linux:{primary:1042}}})),a.CursorPageDown=E(new o({args:{direction:3,unit:2,select:!1,value:-1},id:"cursorPageDown",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:12}})),a.CursorPageDownSelect=E(new o({args:{direction:3,unit:2,select:!0,value:-1},id:"cursorPageDownSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:1036}})),a.CreateCursor=E(new class extends Z{constructor(){super({id:"createCursor",precondition:void 0})}runCoreEditorCommand(p,g){if(!g.position)return;let v;g.wholeLine?v=oe.line(p,p.getPrimaryCursorState(),!1,g.position,g.viewPosition):v=oe.moveTo(p,p.getPrimaryCursorState(),!1,g.position,g.viewPosition);const m=p.getCursorStates();if(m.length>1){const b=v.modelState?v.modelState.position:null,y=v.viewState?v.viewState.position:null;for(let N=0,S=m.length;N<S;N++){const L=m[N];if(!(b&&!L.modelState.selection.containsPosition(b))&&!(y&&!L.viewState.selection.containsPosition(y))){m.splice(N,1),p.model.pushStackElement(),p.setCursorStates(g.source,3,m);return}}}m.push(v),p.model.pushStackElement(),p.setCursorStates(g.source,3,m)}}),a.LastCursorMoveToSelect=E(new class extends Z{constructor(){super({id:"_lastCursorMoveToSelect",precondition:void 0})}runCoreEditorCommand(p,g){if(!g.position)return;const v=p.getLastAddedCursorIndex(),m=p.getCursorStates(),b=m.slice(0);b[v]=oe.moveTo(p,m[v],!0,g.position,g.viewPosition),p.model.pushStackElement(),p.setCursorStates(g.source,3,b)}});class r extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){g.model.pushStackElement(),g.setCursorStates(v.source,3,oe.moveToBeginningOfLine(g,g.getCursorStates(),this._inSelectionMode)),g.revealAllCursors(v.source,!0)}}a.CursorHome=E(new r({inSelectionMode:!1,id:"cursorHome",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:14,mac:{primary:14,secondary:[2063]}}})),a.CursorHomeSelect=E(new r({inSelectionMode:!0,id:"cursorHomeSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:1038,mac:{primary:1038,secondary:[3087]}}}));class d extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){g.model.pushStackElement(),g.setCursorStates(v.source,3,this._exec(g.getCursorStates())),g.revealAllCursors(v.source,!0)}_exec(g){const v=[];for(let m=0,b=g.length;m<b;m++){const y=g[m],N=y.modelState.position.lineNumber;v[m]=Oi.fromModelState(y.modelState.move(this._inSelectionMode,N,1,0))}return v}}a.CursorLineStart=E(new d({inSelectionMode:!1,id:"cursorLineStart",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:0,mac:{primary:287}}})),a.CursorLineStartSelect=E(new d({inSelectionMode:!0,id:"cursorLineStartSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:0,mac:{primary:1311}}}));class l extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){g.model.pushStackElement(),g.setCursorStates(v.source,3,oe.moveToEndOfLine(g,g.getCursorStates(),this._inSelectionMode,v.sticky||!1)),g.revealAllCursors(v.source,!0)}}a.CursorEnd=E(new l({inSelectionMode:!1,id:"cursorEnd",precondition:void 0,kbOpts:{args:{sticky:!1},weight:H,kbExpr:D.textInputFocus,primary:13,mac:{primary:13,secondary:[2065]}},metadata:{description:"Go to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:F("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}})),a.CursorEndSelect=E(new l({inSelectionMode:!0,id:"cursorEndSelect",precondition:void 0,kbOpts:{args:{sticky:!1},weight:H,kbExpr:D.textInputFocus,primary:1037,mac:{primary:1037,secondary:[3089]}},metadata:{description:"Select to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:F("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}}));class h extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){g.model.pushStackElement(),g.setCursorStates(v.source,3,this._exec(g,g.getCursorStates())),g.revealAllCursors(v.source,!0)}_exec(g,v){const m=[];for(let b=0,y=v.length;b<y;b++){const N=v[b],S=N.modelState.position.lineNumber,L=g.model.getLineMaxColumn(S);m[b]=Oi.fromModelState(N.modelState.move(this._inSelectionMode,S,L,0))}return m}}a.CursorLineEnd=E(new h({inSelectionMode:!1,id:"cursorLineEnd",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:0,mac:{primary:291}}})),a.CursorLineEndSelect=E(new h({inSelectionMode:!0,id:"cursorLineEndSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:0,mac:{primary:1315}}}));class c extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){g.model.pushStackElement(),g.setCursorStates(v.source,3,oe.moveToBeginningOfBuffer(g,g.getCursorStates(),this._inSelectionMode)),g.revealAllCursors(v.source,!0)}}a.CursorTop=E(new c({inSelectionMode:!1,id:"cursorTop",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:2062,mac:{primary:2064}}})),a.CursorTopSelect=E(new c({inSelectionMode:!0,id:"cursorTopSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:3086,mac:{primary:3088}}}));class u extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){g.model.pushStackElement(),g.setCursorStates(v.source,3,oe.moveToEndOfBuffer(g,g.getCursorStates(),this._inSelectionMode)),g.revealAllCursors(v.source,!0)}}a.CursorBottom=E(new u({inSelectionMode:!1,id:"cursorBottom",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:2061,mac:{primary:2066}}})),a.CursorBottomSelect=E(new u({inSelectionMode:!0,id:"cursorBottomSelect",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:3085,mac:{primary:3090}}}));class f extends Z{constructor(){super({id:"editorScroll",precondition:void 0,metadata:te.metadata})}determineScrollMethod(g){const v=[6],m=[1,2,3,4,5,6],b=[4,2],y=[1,3];return v.includes(g.unit)&&b.includes(g.direction)?this._runHorizontalEditorScroll.bind(this):m.includes(g.unit)&&y.includes(g.direction)?this._runVerticalEditorScroll.bind(this):null}runCoreEditorCommand(g,v){const m=te.parse(v);if(!m)return;const b=this.determineScrollMethod(m);b&&b(g,v.source,m)}_runVerticalEditorScroll(g,v,m){const b=this._computeDesiredScrollTop(g,m);if(m.revealCursor){const y=g.getCompletelyVisibleViewRangeAtScrollTop(b);g.setCursorStates(v,3,[oe.findPositionInViewportIfOutside(g,g.getPrimaryCursorState(),y,m.select)])}g.viewLayout.setScrollPosition({scrollTop:b},0)}_computeDesiredScrollTop(g,v){if(v.unit===1){const y=g.viewLayout.getFutureViewport(),N=g.getCompletelyVisibleViewRangeAtScrollTop(y.top),S=g.coordinatesConverter.convertViewRangeToModelRange(N);let L;v.direction===1?L=Math.max(1,S.startLineNumber-v.value):L=Math.min(g.model.getLineCount(),S.startLineNumber+v.value);const R=g.coordinatesConverter.convertModelPositionToViewPosition(new T(L,1));return g.viewLayout.getVerticalOffsetForLineNumber(R.lineNumber)}if(v.unit===5){let y=0;return v.direction===3&&(y=g.model.getLineCount()-g.cursorConfig.pageSize),g.viewLayout.getVerticalOffsetForLineNumber(y)}let m;v.unit===3?m=g.cursorConfig.pageSize*v.value:v.unit===4?m=Math.round(g.cursorConfig.pageSize/2)*v.value:m=v.value;const b=(v.direction===1?-1:1)*m;return g.viewLayout.getCurrentScrollTop()+b*g.cursorConfig.lineHeight}_runHorizontalEditorScroll(g,v,m){const b=this._computeDesiredScrollLeft(g,m);g.viewLayout.setScrollPosition({scrollLeft:b},0)}_computeDesiredScrollLeft(g,v){const m=(v.direction===4?-1:1)*v.value;return g.viewLayout.getCurrentScrollLeft()+m*g.cursorConfig.typicalHalfwidthCharacterWidth}}a.EditorScrollImpl=f,a.EditorScroll=E(new f),a.ScrollLineUp=E(new class extends Z{constructor(){super({id:"scrollLineUp",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:2064,mac:{primary:267}}})}runCoreEditorCommand(p,g){a.EditorScroll.runCoreEditorCommand(p,{to:te.RawDirection.Up,by:te.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:g.source})}}),a.ScrollPageUp=E(new class extends Z{constructor(){super({id:"scrollPageUp",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:2059,win:{primary:523},linux:{primary:523}}})}runCoreEditorCommand(p,g){a.EditorScroll.runCoreEditorCommand(p,{to:te.RawDirection.Up,by:te.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:g.source})}}),a.ScrollEditorTop=E(new class extends Z{constructor(){super({id:"scrollEditorTop",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus}})}runCoreEditorCommand(p,g){a.EditorScroll.runCoreEditorCommand(p,{to:te.RawDirection.Up,by:te.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:g.source})}}),a.ScrollLineDown=E(new class extends Z{constructor(){super({id:"scrollLineDown",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:2066,mac:{primary:268}}})}runCoreEditorCommand(p,g){a.EditorScroll.runCoreEditorCommand(p,{to:te.RawDirection.Down,by:te.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:g.source})}}),a.ScrollPageDown=E(new class extends Z{constructor(){super({id:"scrollPageDown",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:2060,win:{primary:524},linux:{primary:524}}})}runCoreEditorCommand(p,g){a.EditorScroll.runCoreEditorCommand(p,{to:te.RawDirection.Down,by:te.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:g.source})}}),a.ScrollEditorBottom=E(new class extends Z{constructor(){super({id:"scrollEditorBottom",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus}})}runCoreEditorCommand(p,g){a.EditorScroll.runCoreEditorCommand(p,{to:te.RawDirection.Down,by:te.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:g.source})}}),a.ScrollLeft=E(new class extends Z{constructor(){super({id:"scrollLeft",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus}})}runCoreEditorCommand(p,g){a.EditorScroll.runCoreEditorCommand(p,{to:te.RawDirection.Left,by:te.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:g.source})}}),a.ScrollRight=E(new class extends Z{constructor(){super({id:"scrollRight",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus}})}runCoreEditorCommand(p,g){a.EditorScroll.runCoreEditorCommand(p,{to:te.RawDirection.Right,by:te.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:g.source})}});class _ extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){v.position&&(g.model.pushStackElement(),g.setCursorStates(v.source,3,[oe.word(g,g.getPrimaryCursorState(),this._inSelectionMode,v.position)]),v.revealType!==2&&g.revealAllCursors(v.source,!0,!0))}}a.WordSelect=E(new _({inSelectionMode:!1,id:"_wordSelect",precondition:void 0})),a.WordSelectDrag=E(new _({inSelectionMode:!0,id:"_wordSelectDrag",precondition:void 0})),a.LastCursorWordSelect=E(new class extends Z{constructor(){super({id:"lastCursorWordSelect",precondition:void 0})}runCoreEditorCommand(p,g){if(!g.position)return;const v=p.getLastAddedCursorIndex(),m=p.getCursorStates(),b=m.slice(0),y=m[v];b[v]=oe.word(p,y,y.modelState.hasSelection(),g.position),p.model.pushStackElement(),p.setCursorStates(g.source,3,b)}});class C extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){v.position&&(g.model.pushStackElement(),g.setCursorStates(v.source,3,[oe.line(g,g.getPrimaryCursorState(),this._inSelectionMode,v.position,v.viewPosition)]),v.revealType!==2&&g.revealAllCursors(v.source,!1,!0))}}a.LineSelect=E(new C({inSelectionMode:!1,id:"_lineSelect",precondition:void 0})),a.LineSelectDrag=E(new C({inSelectionMode:!0,id:"_lineSelectDrag",precondition:void 0}));class w extends Z{constructor(g){super(g),this._inSelectionMode=g.inSelectionMode}runCoreEditorCommand(g,v){if(!v.position)return;const m=g.getLastAddedCursorIndex(),b=g.getCursorStates(),y=b.slice(0);y[m]=oe.line(g,b[m],this._inSelectionMode,v.position,v.viewPosition),g.model.pushStackElement(),g.setCursorStates(v.source,3,y)}}a.LastCursorLineSelect=E(new w({inSelectionMode:!1,id:"lastCursorLineSelect",precondition:void 0})),a.LastCursorLineSelectDrag=E(new w({inSelectionMode:!0,id:"lastCursorLineSelectDrag",precondition:void 0})),a.CancelSelection=E(new class extends Z{constructor(){super({id:"cancelSelection",precondition:D.hasNonEmptySelection,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(p,g){p.model.pushStackElement(),p.setCursorStates(g.source,3,[oe.cancelSelection(p,p.getPrimaryCursorState())]),p.revealAllCursors(g.source,!0)}}),a.RemoveSecondaryCursors=E(new class extends Z{constructor(){super({id:"removeSecondaryCursors",precondition:D.hasMultipleSelections,kbOpts:{weight:H+1,kbExpr:D.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(p,g){p.model.pushStackElement(),p.setCursorStates(g.source,3,[p.getPrimaryCursorState()]),p.revealAllCursors(g.source,!0),ba(F("removedCursor","Removed secondary cursors"))}}),a.RevealLine=E(new class extends Z{constructor(){super({id:"revealLine",precondition:void 0,metadata:It.metadata})}runCoreEditorCommand(p,g){const v=g,m=v.lineNumber||0;let b=typeof m=="number"?m+1:parseInt(m)+1;b<1&&(b=1);const y=p.model.getLineCount();b>y&&(b=y);const N=new A(b,1,b,p.model.getLineMaxColumn(b));let S=0;if(v.at)switch(v.at){case It.RawAtArgument.Top:S=3;break;case It.RawAtArgument.Center:S=1;break;case It.RawAtArgument.Bottom:S=4;break}const L=p.coordinatesConverter.convertModelRangeToViewRange(N);p.revealRange(g.source,!1,L,S,0)}}),a.SelectAll=new class extends ws{constructor(){super(Tc)}runDOMCommand(p){Ct&&(p.focus(),p.select()),p.ownerDocument.execCommand("selectAll")}runEditorCommand(p,g,v){const m=g._getViewModel();m&&this.runCoreEditorCommand(m,v)}runCoreEditorCommand(p,g){p.model.pushStackElement(),p.setCursorStates("keyboard",3,[oe.selectAll(p,p.getPrimaryCursorState())])}},a.SetSelection=E(new class extends Z{constructor(){super({id:"setSelection",precondition:void 0})}runCoreEditorCommand(p,g){g.selection&&(p.model.pushStackElement(),p.setCursorStates(g.source,3,[Oi.fromModelSelection(g.selection)]))}})})(J||(J={}));const Iu=X.and(D.textInputFocus,D.columnSelection);function Qt(a,e){ha.registerKeybindingRule({id:a,primary:e,when:Iu,weight:H+1})}Qt(J.CursorColumnSelectLeft.id,1039);Qt(J.CursorColumnSelectRight.id,1041);Qt(J.CursorColumnSelectUp.id,1040);Qt(J.CursorColumnSelectPageUp.id,1035);Qt(J.CursorColumnSelectDown.id,1042);Qt(J.CursorColumnSelectPageDown.id,1036);function Cr(a){return a.register(),a}var wr;(function(a){class e extends Zt{runEditorCommand(i,n,s){const o=n._getViewModel();o&&this.runCoreEditingCommand(n,o,s||{})}}a.CoreEditingCommand=e,a.LineBreakInsert=E(new class extends e{constructor(){super({id:"lineBreakInsert",precondition:D.writable,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:0,mac:{primary:301}}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,ol.lineBreakInsert(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection)))}}),a.Outdent=E(new class extends e{constructor(){super({id:"outdent",precondition:D.writable,kbOpts:{weight:H,kbExpr:X.and(D.editorTextFocus,D.tabDoesNotMoveFocus),primary:1026}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Ho.outdent(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection))),t.pushUndoStop()}}),a.Tab=E(new class extends e{constructor(){super({id:"tab",precondition:D.writable,kbOpts:{weight:H,kbExpr:X.and(D.editorTextFocus,D.tabDoesNotMoveFocus),primary:2}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Ho.tab(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection))),t.pushUndoStop()}}),a.DeleteLeft=E(new class extends e{constructor(){super({id:"deleteLeft",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:1,secondary:[1025],mac:{primary:1,secondary:[1025,294,257]}}})}runCoreEditingCommand(t,i,n){const[s,o]=ko.deleteLeft(i.getPrevEditOperationType(),i.cursorConfig,i.model,i.getCursorStates().map(r=>r.modelState.selection),i.getCursorAutoClosedCharacters());s&&t.pushUndoStop(),t.executeCommands(this.id,o),i.setPrevEditOperationType(2)}}),a.DeleteRight=E(new class extends e{constructor(){super({id:"deleteRight",precondition:void 0,kbOpts:{weight:H,kbExpr:D.textInputFocus,primary:20,mac:{primary:20,secondary:[290,276]}}})}runCoreEditingCommand(t,i,n){const[s,o]=ko.deleteRight(i.getPrevEditOperationType(),i.cursorConfig,i.model,i.getCursorStates().map(r=>r.modelState.selection));s&&t.pushUndoStop(),t.executeCommands(this.id,o),i.setPrevEditOperationType(3)}}),a.Undo=new class extends ws{constructor(){super(Da)}runDOMCommand(t){t.ownerDocument.execCommand("undo")}runEditorCommand(t,i,n){if(!(!i.hasModel()||i.getOption(92)===!0))return i.getModel().undo()}},a.Redo=new class extends ws{constructor(){super(Na)}runDOMCommand(t){t.ownerDocument.execCommand("redo")}runEditorCommand(t,i,n){if(!(!i.hasModel()||i.getOption(92)===!0))return i.getModel().redo()}}})(wr||(wr={}));class br extends Wn{constructor(e,t,i){super({id:e,precondition:void 0,metadata:i}),this._handlerId=t}runCommand(e,t){const i=e.get(Re).getFocusedCodeEditor();i&&i.trigger("keyboard",this._handlerId,t)}}function Dt(a,e){Cr(new br("default:"+a,a)),Cr(new br(a,a,e))}Dt("type",{description:"Type",args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{type:"string"}}}}]});Dt("replacePreviousChar");Dt("compositionType");Dt("compositionStart");Dt("compositionEnd");Dt("paste");Dt("cut");class Ou{constructor(e,t,i,n){this.configuration=e,this.viewModel=t,this.userInputEvents=i,this.commandDelegate=n}paste(e,t,i,n){this.commandDelegate.paste(e,t,i,n)}type(e){this.commandDelegate.type(e)}compositionType(e,t,i,n){this.commandDelegate.compositionType(e,t,i,n)}compositionStart(){this.commandDelegate.startComposition()}compositionEnd(){this.commandDelegate.endComposition()}cut(){this.commandDelegate.cut()}setSelection(e){J.SetSelection.runCoreEditorCommand(this.viewModel,{source:"keyboard",selection:e})}_validateViewColumn(e){const t=this.viewModel.getLineMinColumn(e.lineNumber);return e.column<t?new T(e.lineNumber,t):e}_hasMulticursorModifier(e){switch(this.configuration.options.get(78)){case"altKey":return e.altKey;case"ctrlKey":return e.ctrlKey;case"metaKey":return e.metaKey;default:return!1}}_hasNonMulticursorModifier(e){switch(this.configuration.options.get(78)){case"altKey":return e.ctrlKey||e.metaKey;case"ctrlKey":return e.altKey||e.metaKey;case"metaKey":return e.ctrlKey||e.altKey;default:return!1}}dispatchMouse(e){const t=this.configuration.options,i=Ln&&t.get(108),n=t.get(22);e.middleButton&&!i?this._columnSelect(e.position,e.mouseColumn,e.inSelectionMode):e.startedOnLineNumbers?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelect(e.position,e.revealType):this._createCursor(e.position,!0):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount>=4?this._selectAll():e.mouseDownCount===3?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelectDrag(e.position,e.revealType):this._lastCursorLineSelect(e.position,e.revealType):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount===2?e.onInjectedText||(this._hasMulticursorModifier(e)?this._lastCursorWordSelect(e.position,e.revealType):e.inSelectionMode?this._wordSelectDrag(e.position,e.revealType):this._wordSelect(e.position,e.revealType)):this._hasMulticursorModifier(e)?this._hasNonMulticursorModifier(e)||(e.shiftKey?this._columnSelect(e.position,e.mouseColumn,!0):e.inSelectionMode?this._lastCursorMoveToSelect(e.position,e.revealType):this._createCursor(e.position,!1)):e.inSelectionMode?e.altKey?this._columnSelect(e.position,e.mouseColumn,!0):n?this._columnSelect(e.position,e.mouseColumn,!0):this._moveToSelect(e.position,e.revealType):this.moveTo(e.position,e.revealType)}_usualArgs(e,t){return e=this._validateViewColumn(e),{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,revealType:t}}moveTo(e,t){J.MoveTo.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_moveToSelect(e,t){J.MoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_columnSelect(e,t,i){e=this._validateViewColumn(e),J.ColumnSelect.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,mouseColumn:t,doColumnSelect:i})}_createCursor(e,t){e=this._validateViewColumn(e),J.CreateCursor.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,wholeLine:t})}_lastCursorMoveToSelect(e,t){J.LastCursorMoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelect(e,t){J.WordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelectDrag(e,t){J.WordSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorWordSelect(e,t){J.LastCursorWordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelect(e,t){J.LineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelectDrag(e,t){J.LineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelect(e,t){J.LastCursorLineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelectDrag(e,t){J.LastCursorLineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_selectAll(){J.SelectAll.runCoreEditorCommand(this.viewModel,{source:"mouse"})}_convertViewToModelPosition(e){return this.viewModel.coordinatesConverter.convertViewPositionToModelPosition(e)}emitKeyDown(e){this.userInputEvents.emitKeyDown(e)}emitKeyUp(e){this.userInputEvents.emitKeyUp(e)}emitContextMenu(e){this.userInputEvents.emitContextMenu(e)}emitMouseMove(e){this.userInputEvents.emitMouseMove(e)}emitMouseLeave(e){this.userInputEvents.emitMouseLeave(e)}emitMouseUp(e){this.userInputEvents.emitMouseUp(e)}emitMouseDown(e){this.userInputEvents.emitMouseDown(e)}emitMouseDrag(e){this.userInputEvents.emitMouseDrag(e)}emitMouseDrop(e){this.userInputEvents.emitMouseDrop(e)}emitMouseDropCanceled(){this.userInputEvents.emitMouseDropCanceled()}emitMouseWheel(e){this.userInputEvents.emitMouseWheel(e)}}class Pa{constructor(e){this._lineFactory=e,this._set(1,[])}flush(){this._set(1,[])}_set(e,t){this._lines=t,this._rendLineNumberStart=e}_get(){return{rendLineNumberStart:this._rendLineNumberStart,lines:this._lines}}getStartLineNumber(){return this._rendLineNumberStart}getEndLineNumber(){return this._rendLineNumberStart+this._lines.length-1}getCount(){return this._lines.length}getLine(e){const t=e-this._rendLineNumberStart;if(t<0||t>=this._lines.length)throw new et("Illegal value for lineNumber");return this._lines[t]}onLinesDeleted(e,t){if(this.getCount()===0)return null;const i=this.getStartLineNumber(),n=this.getEndLineNumber();if(t<i){const d=t-e+1;return this._rendLineNumberStart-=d,null}if(e>n)return null;let s=0,o=0;for(let d=i;d<=n;d++){const l=d-this._rendLineNumberStart;e<=d&&d<=t&&(o===0?(s=l,o=1):o++)}if(e<i){let d=0;t<i?d=t-e+1:d=i-e,this._rendLineNumberStart-=d}return this._lines.splice(s,o)}onLinesChanged(e,t){const i=e+t-1;if(this.getCount()===0)return!1;const n=this.getStartLineNumber(),s=this.getEndLineNumber();let o=!1;for(let r=e;r<=i;r++)r>=n&&r<=s&&(this._lines[r-this._rendLineNumberStart].onContentChanged(),o=!0);return o}onLinesInserted(e,t){if(this.getCount()===0)return null;const i=t-e+1,n=this.getStartLineNumber(),s=this.getEndLineNumber();if(e<=n)return this._rendLineNumberStart+=i,null;if(e>s)return null;if(i+e>s)return this._lines.splice(e-this._rendLineNumberStart,s-e+1);const o=[];for(let c=0;c<i;c++)o[c]=this._lineFactory.createLine();const r=e-this._rendLineNumberStart,d=this._lines.slice(0,r),l=this._lines.slice(r,this._lines.length-i),h=this._lines.slice(this._lines.length-i,this._lines.length);return this._lines=d.concat(o).concat(l),h}onTokensChanged(e){if(this.getCount()===0)return!1;const t=this.getStartLineNumber(),i=this.getEndLineNumber();let n=!1;for(let s=0,o=e.length;s<o;s++){const r=e[s];if(r.toLineNumber<t||r.fromLineNumber>i)continue;const d=Math.max(t,r.fromLineNumber),l=Math.min(i,r.toLineNumber);for(let h=d;h<=l;h++){const c=h-this._rendLineNumberStart;this._lines[c].onTokensChanged(),n=!0}}return n}}class Wa{constructor(e){this._lineFactory=e,this.domNode=this._createDomNode(),this._linesCollection=new Pa(this._lineFactory)}_createDomNode(){const e=V(document.createElement("div"));return e.setClassName("view-layer"),e.setPosition("absolute"),e.domNode.setAttribute("role","presentation"),e.domNode.setAttribute("aria-hidden","true"),e}onConfigurationChanged(e){return!!e.hasChanged(146)}onFlushed(e){return this._linesCollection.flush(),!0}onLinesChanged(e){return this._linesCollection.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){const t=this._linesCollection.onLinesDeleted(e.fromLineNumber,e.toLineNumber);if(t)for(let i=0,n=t.length;i<n;i++){const s=t[i].getDomNode();s==null||s.remove()}return!0}onLinesInserted(e){const t=this._linesCollection.onLinesInserted(e.fromLineNumber,e.toLineNumber);if(t)for(let i=0,n=t.length;i<n;i++){const s=t[i].getDomNode();s==null||s.remove()}return!0}onScrollChanged(e){return e.scrollTopChanged}onTokensChanged(e){return this._linesCollection.onTokensChanged(e.ranges)}onZonesChanged(e){return!0}getStartLineNumber(){return this._linesCollection.getStartLineNumber()}getEndLineNumber(){return this._linesCollection.getEndLineNumber()}getVisibleLine(e){return this._linesCollection.getLine(e)}renderLines(e){const t=this._linesCollection._get(),i=new bs(this.domNode.domNode,this._lineFactory,e),n={rendLineNumberStart:t.rendLineNumberStart,lines:t.lines,linesLength:t.lines.length},s=i.render(n,e.startLineNumber,e.endLineNumber,e.relativeVerticalOffset);this._linesCollection._set(s.rendLineNumberStart,s.lines)}}const Ge=class Ge{constructor(e,t,i){this._domNode=e,this._lineFactory=t,this._viewportData=i}render(e,t,i,n){const s={rendLineNumberStart:e.rendLineNumberStart,lines:e.lines.slice(0),linesLength:e.linesLength};if(s.rendLineNumberStart+s.linesLength-1<t||i<s.rendLineNumberStart){s.rendLineNumberStart=t,s.linesLength=i-t+1,s.lines=[];for(let o=t;o<=i;o++)s.lines[o-t]=this._lineFactory.createLine();return this._finishRendering(s,!0,n),s}if(this._renderUntouchedLines(s,Math.max(t-s.rendLineNumberStart,0),Math.min(i-s.rendLineNumberStart,s.linesLength-1),n,t),s.rendLineNumberStart>t){const o=t,r=Math.min(i,s.rendLineNumberStart-1);o<=r&&(this._insertLinesBefore(s,o,r,n,t),s.linesLength+=r-o+1)}else if(s.rendLineNumberStart<t){const o=Math.min(s.linesLength,t-s.rendLineNumberStart);o>0&&(this._removeLinesBefore(s,o),s.linesLength-=o)}if(s.rendLineNumberStart=t,s.rendLineNumberStart+s.linesLength-1<i){const o=s.rendLineNumberStart+s.linesLength,r=i;o<=r&&(this._insertLinesAfter(s,o,r,n,t),s.linesLength+=r-o+1)}else if(s.rendLineNumberStart+s.linesLength-1>i){const o=Math.max(0,i-s.rendLineNumberStart+1),d=s.linesLength-1-o+1;d>0&&(this._removeLinesAfter(s,d),s.linesLength-=d)}return this._finishRendering(s,!1,n),s}_renderUntouchedLines(e,t,i,n,s){const o=e.rendLineNumberStart,r=e.lines;for(let d=t;d<=i;d++){const l=o+d;r[d].layoutLine(l,n[l-s],this._viewportData.lineHeight)}}_insertLinesBefore(e,t,i,n,s){const o=[];let r=0;for(let d=t;d<=i;d++)o[r++]=this._lineFactory.createLine();e.lines=o.concat(e.lines)}_removeLinesBefore(e,t){for(let i=0;i<t;i++){const n=e.lines[i].getDomNode();n==null||n.remove()}e.lines.splice(0,t)}_insertLinesAfter(e,t,i,n,s){const o=[];let r=0;for(let d=t;d<=i;d++)o[r++]=this._lineFactory.createLine();e.lines=e.lines.concat(o)}_removeLinesAfter(e,t){const i=e.linesLength-t;for(let n=0;n<t;n++){const s=e.lines[i+n].getDomNode();s==null||s.remove()}e.lines.splice(i,t)}_finishRenderingNewLines(e,t,i,n){Ge._ttPolicy&&(i=Ge._ttPolicy.createHTML(i));const s=this._domNode.lastChild;t||!s?this._domNode.innerHTML=i:s.insertAdjacentHTML("afterend",i);let o=this._domNode.lastChild;for(let r=e.linesLength-1;r>=0;r--){const d=e.lines[r];n[r]&&(d.setDomNode(o),o=o.previousSibling)}}_finishRenderingInvalidLines(e,t,i){const n=document.createElement("div");Ge._ttPolicy&&(t=Ge._ttPolicy.createHTML(t)),n.innerHTML=t;for(let s=0;s<e.linesLength;s++){const o=e.lines[s];if(i[s]){const r=n.firstChild,d=o.getDomNode();d.parentNode.replaceChild(r,d),o.setDomNode(r)}}}_finishRendering(e,t,i){const n=Ge._sb,s=e.linesLength,o=e.lines,r=e.rendLineNumberStart,d=[];{n.reset();let l=!1;for(let h=0;h<s;h++){const c=o[h];d[h]=!1,!(c.getDomNode()||!c.renderLine(h+r,i[h],this._viewportData.lineHeight,this._viewportData,n))&&(d[h]=!0,l=!0)}l&&this._finishRenderingNewLines(e,t,n.build(),d)}{n.reset();let l=!1;const h=[];for(let c=0;c<s;c++){const u=o[c];h[c]=!1,!(d[c]||!u.renderLine(c+r,i[c],this._viewportData.lineHeight,this._viewportData,n))&&(h[c]=!0,l=!0)}l&&this._finishRenderingInvalidLines(e,n.build(),h)}}};Ge._ttPolicy=oo("editorViewLayer",{createHTML:e=>e}),Ge._sb=new ra(1e5);let bs=Ge;class Ha extends pe{constructor(e){super(e),this._dynamicOverlays=[],this._isFocused=!1,this._visibleLines=new Wa({createLine:()=>new Au(this._dynamicOverlays)}),this.domNode=this._visibleLines.domNode;const i=this._context.configuration.options.get(50);ge(this.domNode,i),this.domNode.setClassName("view-overlays")}shouldRender(){if(super.shouldRender())return!0;for(let e=0,t=this._dynamicOverlays.length;e<t;e++)if(this._dynamicOverlays[e].shouldRender())return!0;return!1}dispose(){super.dispose();for(let e=0,t=this._dynamicOverlays.length;e<t;e++)this._dynamicOverlays[e].dispose();this._dynamicOverlays=[]}getDomNode(){return this.domNode}addDynamicOverlay(e){this._dynamicOverlays.push(e)}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e);const i=this._context.configuration.options.get(50);return ge(this.domNode,i),!0}onFlushed(e){return this._visibleLines.onFlushed(e)}onFocusChanged(e){return this._isFocused=e.isFocused,!0}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onScrollChanged(e){return this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._visibleLines.onZonesChanged(e)}prepareRender(e){const t=this._dynamicOverlays.filter(i=>i.shouldRender());for(let i=0,n=t.length;i<n;i++){const s=t[i];s.prepareRender(e),s.onDidRender()}}render(e){this._viewOverlaysRender(e),this.domNode.toggleClassName("focused",this._isFocused)}_viewOverlaysRender(e){this._visibleLines.renderLines(e.viewportData)}}class Au{constructor(e){this._dynamicOverlays=e,this._domNode=null,this._renderedContent=null}getDomNode(){return this._domNode?this._domNode.domNode:null}setDomNode(e){this._domNode=V(e)}onContentChanged(){}onTokensChanged(){}renderLine(e,t,i,n,s){let o="";for(let r=0,d=this._dynamicOverlays.length;r<d;r++){const l=this._dynamicOverlays[r];o+=l.render(n.startLineNumber,e)}return this._renderedContent===o?!1:(this._renderedContent=o,s.appendString('<div style="top:'),s.appendString(String(t)),s.appendString("px;height:"),s.appendString(String(i)),s.appendString('px;">'),s.appendString(o),s.appendString("</div>"),!0)}layoutLine(e,t,i){this._domNode&&(this._domNode.setTop(t),this._domNode.setHeight(i))}}class Pu extends Ha{constructor(e){super(e);const i=this._context.configuration.options.get(146);this._contentWidth=i.contentWidth,this.domNode.setHeight(0)}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._contentWidth=i.contentWidth,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollWidthChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e),this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth))}}class Wu extends Ha{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._contentLeft=i.contentLeft,this.domNode.setClassName("margin-view-overlays"),this.domNode.setWidth(1),ge(this.domNode,t.get(50))}onConfigurationChanged(e){const t=this._context.configuration.options;ge(this.domNode,t.get(50));const i=t.get(146);return this._contentLeft=i.contentLeft,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollHeightChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e);const t=Math.min(e.scrollHeight,1e6);this.domNode.setHeight(t),this.domNode.setWidth(this._contentLeft)}}class Vn{constructor(e){this.onKeyDown=null,this.onKeyUp=null,this.onContextMenu=null,this.onMouseMove=null,this.onMouseLeave=null,this.onMouseDown=null,this.onMouseUp=null,this.onMouseDrag=null,this.onMouseDrop=null,this.onMouseDropCanceled=null,this.onMouseWheel=null,this._coordinatesConverter=e}emitKeyDown(e){var t;(t=this.onKeyDown)==null||t.call(this,e)}emitKeyUp(e){var t;(t=this.onKeyUp)==null||t.call(this,e)}emitContextMenu(e){var t;(t=this.onContextMenu)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseMove(e){var t;(t=this.onMouseMove)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseLeave(e){var t;(t=this.onMouseLeave)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDown(e){var t;(t=this.onMouseDown)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseUp(e){var t;(t=this.onMouseUp)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDrag(e){var t;(t=this.onMouseDrag)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDrop(e){var t;(t=this.onMouseDrop)==null||t.call(this,this._convertViewToModelMouseEvent(e))}emitMouseDropCanceled(){var e;(e=this.onMouseDropCanceled)==null||e.call(this)}emitMouseWheel(e){var t;(t=this.onMouseWheel)==null||t.call(this,e)}_convertViewToModelMouseEvent(e){return e.target?{event:e.event,target:this._convertViewToModelMouseTarget(e.target)}:e}_convertViewToModelMouseTarget(e){return Vn.convertViewToModelMouseTarget(e,this._coordinatesConverter)}static convertViewToModelMouseTarget(e,t){const i={...e};return i.position&&(i.position=t.convertViewPositionToModelPosition(i.position)),i.range&&(i.range=t.convertViewRangeToModelRange(i.range)),(i.type===5||i.type===8)&&(i.detail=this.convertViewToModelViewZoneData(i.detail,t)),i}static convertViewToModelViewZoneData(e,t){return{viewZoneId:e.viewZoneId,positionBefore:e.positionBefore?t.convertViewPositionToModelPosition(e.positionBefore):e.positionBefore,positionAfter:e.positionAfter?t.convertViewPositionToModelPosition(e.positionAfter):e.positionAfter,position:t.convertViewPositionToModelPosition(e.position),afterLineNumber:t.convertViewPositionToModelPosition(new T(e.afterLineNumber,1)).lineNumber}}}class Hu extends pe{constructor(e){super(e),this.blocks=[],this.contentWidth=-1,this.contentLeft=0,this.domNode=V(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("blockDecorations-container"),this.update()}update(){let e=!1;const i=this._context.configuration.options.get(146),n=i.contentWidth-i.verticalScrollbarWidth;this.contentWidth!==n&&(this.contentWidth=n,e=!0);const s=i.contentLeft;return this.contentLeft!==s&&(this.contentLeft=s,e=!0),e}dispose(){super.dispose()}onConfigurationChanged(e){return this.update()}onScrollChanged(e){return e.scrollTopChanged||e.scrollLeftChanged}onDecorationsChanged(e){return!0}onZonesChanged(e){return!0}prepareRender(e){}render(e){let t=0;const i=e.getDecorationsInViewport();for(const n of i){if(!n.options.blockClassName)continue;let s=this.blocks[t];s||(s=this.blocks[t]=V(document.createElement("div")),this.domNode.appendChild(s));let o,r;n.options.blockIsAfterEnd?(o=e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!1),r=e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!0)):(o=e.getVerticalOffsetForLineNumber(n.range.startLineNumber,!0),r=n.range.isEmpty()&&!n.options.blockDoesNotCollapse?e.getVerticalOffsetForLineNumber(n.range.startLineNumber,!1):e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!0));const[d,l,h,c]=n.options.blockPadding??[0,0,0,0];s.setClassName("blockDecorations-block "+n.options.blockClassName),s.setLeft(this.contentLeft-c),s.setWidth(this.contentWidth+c+l),s.setTop(o-e.scrollTop-d),s.setHeight(r-o+d+h),t++}for(let n=t;n<this.blocks.length;n++)this.blocks[n].domNode.remove();this.blocks.length=t}}class ku extends pe{constructor(e,t){super(e),this._viewDomNode=t,this._widgets={},this.domNode=V(document.createElement("div")),Ie.write(this.domNode,1),this.domNode.setClassName("contentWidgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this.overflowingContentWidgetsDomNode=V(document.createElement("div")),Ie.write(this.overflowingContentWidgetsDomNode,2),this.overflowingContentWidgetsDomNode.setClassName("overflowingContentWidgets")}dispose(){super.dispose(),this._widgets={}}onConfigurationChanged(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].onConfigurationChanged(e);return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLineMappingChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesDeleted(e){return this._updateAnchorsViewPositions(),!0}onLinesInserted(e){return this._updateAnchorsViewPositions(),!0}onScrollChanged(e){return!0}onZonesChanged(e){return!0}_updateAnchorsViewPositions(){const e=Object.keys(this._widgets);for(const t of e)this._widgets[t].updateAnchorViewPosition()}addWidget(e){const t=new Fu(this._context,this._viewDomNode,e);this._widgets[t.id]=t,t.allowEditorOverflow?this.overflowingContentWidgetsDomNode.appendChild(t.domNode):this.domNode.appendChild(t.domNode),this.setShouldRender()}setWidgetPosition(e,t,i,n,s){this._widgets[e.getId()].setPosition(t,i,n,s),this.setShouldRender()}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const i=this._widgets[t];delete this._widgets[t];const n=i.domNode.domNode;n.remove(),n.removeAttribute("monaco-visible-content-widget"),this.setShouldRender()}}shouldSuppressMouseDownOnWidget(e){return this._widgets.hasOwnProperty(e)?this._widgets[e].suppressMouseDown:!1}onBeforeRender(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].onBeforeRender(e)}prepareRender(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].prepareRender(e)}render(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].render(e)}}class Fu{constructor(e,t,i){this._primaryAnchor=new ii(null,null),this._secondaryAnchor=new ii(null,null),this._context=e,this._viewDomNode=t,this._actual=i,this.domNode=V(this._actual.getDomNode()),this.id=this._actual.getId(),this.allowEditorOverflow=this._actual.allowEditorOverflow||!1,this.suppressMouseDown=this._actual.suppressMouseDown||!1;const n=this._context.configuration.options,s=n.get(146);this._fixedOverflowWidgets=n.get(42),this._contentWidth=s.contentWidth,this._contentLeft=s.contentLeft,this._lineHeight=n.get(67),this._affinity=null,this._preference=[],this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1,this._maxWidth=this._getMaxWidth(),this._isVisible=!1,this._renderData=null,this.domNode.setPosition(this._fixedOverflowWidgets&&this.allowEditorOverflow?"fixed":"absolute"),this.domNode.setDisplay("none"),this.domNode.setVisibility("hidden"),this.domNode.setAttribute("widgetId",this.id),this.domNode.setMaxWidth(this._maxWidth)}onConfigurationChanged(e){const t=this._context.configuration.options;if(this._lineHeight=t.get(67),e.hasChanged(146)){const i=t.get(146);this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._maxWidth=this._getMaxWidth()}}updateAnchorViewPosition(){this._setPosition(this._affinity,this._primaryAnchor.modelPosition,this._secondaryAnchor.modelPosition)}_setPosition(e,t,i){this._affinity=e,this._primaryAnchor=n(t,this._context.viewModel,this._affinity),this._secondaryAnchor=n(i,this._context.viewModel,this._affinity);function n(s,o,r){if(!s)return new ii(null,null);const d=o.model.validatePosition(s);if(o.coordinatesConverter.modelPositionIsVisible(d)){const l=o.coordinatesConverter.convertModelPositionToViewPosition(d,r??void 0);return new ii(s,l)}return new ii(s,null)}}_getMaxWidth(){const e=this.domNode.domNode.ownerDocument,t=e.defaultView;return this.allowEditorOverflow?(t==null?void 0:t.innerWidth)||e.documentElement.offsetWidth||e.body.offsetWidth:this._contentWidth}setPosition(e,t,i,n){this._setPosition(n,e,t),this._preference=i,this._primaryAnchor.viewPosition&&this._preference&&this._preference.length>0?this.domNode.setDisplay("block"):this.domNode.setDisplay("none"),this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1}_layoutBoxInViewport(e,t,i,n){const s=e.top,o=s,r=e.top+e.height,d=n.viewportHeight-r,l=s-i,h=o>=i,c=r,u=d>=i;let f=e.left;return f+t>n.scrollLeft+n.viewportWidth&&(f=n.scrollLeft+n.viewportWidth-t),f<n.scrollLeft&&(f=n.scrollLeft),{fitsAbove:h,aboveTop:l,fitsBelow:u,belowTop:c,left:f}}_layoutHorizontalSegmentInPage(e,t,i,n){const r=Math.max(15,t.left-n),d=Math.min(t.left+t.width+n,e.width-15),h=this._viewDomNode.domNode.ownerDocument.defaultView;let c=t.left+i-((h==null?void 0:h.scrollX)??0);if(c+n>d){const u=c-(d-n);c-=u,i-=u}if(c<r){const u=c-r;c-=u,i-=u}return[i,c]}_layoutBoxInPage(e,t,i,n){const s=e.top-i,o=e.top+e.height,r=Si(this._viewDomNode.domNode),d=this._viewDomNode.domNode.ownerDocument,l=d.defaultView,h=r.top+s-((l==null?void 0:l.scrollY)??0),c=r.top+o-((l==null?void 0:l.scrollY)??0),u=oc(d.body),[f,_]=this._layoutHorizontalSegmentInPage(u,r,e.left-n.scrollLeft+this._contentLeft,t),C=22,w=22,p=h>=C,g=c+i<=u.height-w;return this._fixedOverflowWidgets?{fitsAbove:p,aboveTop:Math.max(h,C),fitsBelow:g,belowTop:c,left:_}:{fitsAbove:p,aboveTop:s,fitsBelow:g,belowTop:o,left:f}}_prepareRenderWidgetAtExactPositionOverflowing(e){return new ni(e.top,e.left+this._contentLeft)}_getAnchorsCoordinates(e){var o,r;const t=s(this._primaryAnchor.viewPosition,this._affinity,this._lineHeight),i=((o=this._secondaryAnchor.viewPosition)==null?void 0:o.lineNumber)===((r=this._primaryAnchor.viewPosition)==null?void 0:r.lineNumber)?this._secondaryAnchor.viewPosition:null,n=s(i,this._affinity,this._lineHeight);return{primary:t,secondary:n};function s(d,l,h){if(!d)return null;const c=e.visibleRangeForPosition(d);if(!c)return null;const u=d.column===1&&l===3?0:c.left,f=e.getVerticalOffsetForLineNumber(d.lineNumber)-e.scrollTop;return new yr(f,u,h)}}_reduceAnchorCoordinates(e,t,i){if(!t)return e;const n=this._context.configuration.options.get(50);let s=t.left;return s<e.left?s=Math.max(s,e.left-i+n.typicalFullwidthCharacterWidth):s=Math.min(s,e.left+i-n.typicalFullwidthCharacterWidth),new yr(e.top,s,e.height)}_prepareRenderWidget(e){if(!this._preference||this._preference.length===0)return null;const{primary:t,secondary:i}=this._getAnchorsCoordinates(e);if(!t)return{kind:"offViewport",preserveFocus:this.domNode.domNode.contains(this.domNode.domNode.ownerDocument.activeElement)};if(this._cachedDomNodeOffsetWidth===-1||this._cachedDomNodeOffsetHeight===-1){let o=null;if(typeof this._actual.beforeRender=="function"&&(o=$n(this._actual.beforeRender,this._actual)),o)this._cachedDomNodeOffsetWidth=o.width,this._cachedDomNodeOffsetHeight=o.height;else{const d=this.domNode.domNode.getBoundingClientRect();this._cachedDomNodeOffsetWidth=Math.round(d.width),this._cachedDomNodeOffsetHeight=Math.round(d.height)}}const n=this._reduceAnchorCoordinates(t,i,this._cachedDomNodeOffsetWidth);let s;this.allowEditorOverflow?s=this._layoutBoxInPage(n,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e):s=this._layoutBoxInViewport(n,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e);for(let o=1;o<=2;o++)for(const r of this._preference)if(r===1){if(!s)return null;if(o===2||s.fitsAbove)return{kind:"inViewport",coordinate:new ni(s.aboveTop,s.left),position:1}}else if(r===2){if(!s)return null;if(o===2||s.fitsBelow)return{kind:"inViewport",coordinate:new ni(s.belowTop,s.left),position:2}}else return this.allowEditorOverflow?{kind:"inViewport",coordinate:this._prepareRenderWidgetAtExactPositionOverflowing(new ni(n.top,n.left)),position:0}:{kind:"inViewport",coordinate:new ni(n.top,n.left),position:0};return null}onBeforeRender(e){!this._primaryAnchor.viewPosition||!this._preference||this._primaryAnchor.viewPosition.lineNumber<e.startLineNumber||this._primaryAnchor.viewPosition.lineNumber>e.endLineNumber||this.domNode.setMaxWidth(this._maxWidth)}prepareRender(e){this._renderData=this._prepareRenderWidget(e)}render(e){var t;if(!this._renderData||this._renderData.kind==="offViewport"){this._isVisible&&(this.domNode.removeAttribute("monaco-visible-content-widget"),this._isVisible=!1,((t=this._renderData)==null?void 0:t.kind)==="offViewport"&&this._renderData.preserveFocus?this.domNode.setTop(-1e3):this.domNode.setVisibility("hidden")),typeof this._actual.afterRender=="function"&&$n(this._actual.afterRender,this._actual,null);return}this.allowEditorOverflow?(this.domNode.setTop(this._renderData.coordinate.top),this.domNode.setLeft(this._renderData.coordinate.left)):(this.domNode.setTop(this._renderData.coordinate.top+e.scrollTop-e.bigNumbersDelta),this.domNode.setLeft(this._renderData.coordinate.left)),this._isVisible||(this.domNode.setVisibility("inherit"),this.domNode.setAttribute("monaco-visible-content-widget","true"),this._isVisible=!0),typeof this._actual.afterRender=="function"&&$n(this._actual.afterRender,this._actual,this._renderData.position)}}class ii{constructor(e,t){this.modelPosition=e,this.viewPosition=t}}class ni{constructor(e,t){this.top=e,this.left=t,this._coordinateBrand=void 0}}class yr{constructor(e,t,i){this.top=e,this.left=t,this.height=i,this._anchorCoordinateBrand=void 0}}function $n(a,e,...t){try{return a.call(e,...t)}catch{return null}}class ka extends Lt{constructor(e){super(),this._context=e;const t=this._context.configuration.options,i=t.get(146);this._renderLineHighlight=t.get(97),this._renderLineHighlightOnlyWhenFocus=t.get(98),this._wordWrap=i.isViewportWrapping,this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._selectionIsEmpty=!0,this._focused=!1,this._cursorLineNumbers=[1],this._selections=[new we(1,1,1,1)],this._renderData=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}_readFromSelections(){let e=!1;const t=new Set;for(const s of this._selections)t.add(s.positionLineNumber);const i=Array.from(t);i.sort((s,o)=>s-o),js(this._cursorLineNumbers,i)||(this._cursorLineNumbers=i,e=!0);const n=this._selections.every(s=>s.isEmpty());return this._selectionIsEmpty!==n&&(this._selectionIsEmpty=n,e=!0),e}onThemeChanged(e){return this._readFromSelections()}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._renderLineHighlight=t.get(97),this._renderLineHighlightOnlyWhenFocus=t.get(98),this._wordWrap=i.isViewportWrapping,this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,!0}onCursorStateChanged(e){return this._selections=e.selections,this._readFromSelections()}onFlushed(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollWidthChanged||e.scrollTopChanged}onZonesChanged(e){return!0}onFocusChanged(e){return this._renderLineHighlightOnlyWhenFocus?(this._focused=e.isFocused,!0):!1}prepareRender(e){if(!this._shouldRenderThis()){this._renderData=null;return}const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=[];for(let o=t;o<=i;o++){const r=o-t;n[r]=""}if(this._wordWrap){const o=this._renderOne(e,!1);for(const r of this._cursorLineNumbers){const d=this._context.viewModel.coordinatesConverter,l=d.convertViewPositionToModelPosition(new T(r,1)).lineNumber,h=d.convertModelPositionToViewPosition(new T(l,1)).lineNumber,c=d.convertModelPositionToViewPosition(new T(l,this._context.viewModel.model.getLineMaxColumn(l))).lineNumber,u=Math.max(h,t),f=Math.min(c,i);for(let _=u;_<=f;_++){const C=_-t;n[C]=o}}}const s=this._renderOne(e,!0);for(const o of this._cursorLineNumbers){if(o<t||o>i)continue;const r=o-t;n[r]=s}this._renderData=n}render(e,t){if(!this._renderData)return"";const i=t-e;return i>=this._renderData.length?"":this._renderData[i]}_shouldRenderInMargin(){return(this._renderLineHighlight==="gutter"||this._renderLineHighlight==="all")&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}_shouldRenderInContent(){return(this._renderLineHighlight==="line"||this._renderLineHighlight==="all")&&this._selectionIsEmpty&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}}class Vu extends ka{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-both":"")+(t?" current-line-exact":"")}" style="width:${Math.max(e.scrollWidth,this._contentWidth)}px;"></div>`}_shouldRenderThis(){return this._shouldRenderInContent()}_shouldRenderOther(){return this._shouldRenderInMargin()}}class Bu extends ka{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-margin":"")+(this._shouldRenderOther()?" current-line-margin-both":"")+(this._shouldRenderInMargin()&&t?" current-line-exact-margin":"")}" style="width:${this._contentLeft}px"></div>`}_shouldRenderThis(){return!0}_shouldRenderOther(){return this._shouldRenderInContent()}}St((a,e)=>{const t=a.getColor(rl);if(t&&(e.addRule(`.monaco-editor .view-overlays .current-line { background-color: ${t}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-margin { background-color: ${t}; border: none; }`)),!t||t.isTransparent()||a.defines(Vo)){const i=a.getColor(Vo);i&&(e.addRule(`.monaco-editor .view-overlays .current-line-exact { border: 2px solid ${i}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-exact-margin { border: 2px solid ${i}; }`),ui(a.type)&&(e.addRule(".monaco-editor .view-overlays .current-line-exact { border-width: 1px; }"),e.addRule(".monaco-editor .margin-view-overlays .current-line-exact-margin { border-width: 1px; }")))}});class Uu extends Lt{constructor(e){super(),this._context=e;const t=this._context.configuration.options;this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}prepareRender(e){const t=e.getDecorationsInViewport();let i=[],n=0;for(let d=0,l=t.length;d<l;d++){const h=t[d];h.options.className&&(i[n++]=h)}i=i.sort((d,l)=>{if(d.options.zIndex<l.options.zIndex)return-1;if(d.options.zIndex>l.options.zIndex)return 1;const h=d.options.className,c=l.options.className;return h<c?-1:h>c?1:A.compareRangesUsingStarts(d.range,l.range)});const s=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber,r=[];for(let d=s;d<=o;d++){const l=d-s;r[l]=""}this._renderWholeLineDecorations(e,i,r),this._renderNormalDecorations(e,i,r),this._renderResult=r}_renderWholeLineDecorations(e,t,i){const n=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber;for(let o=0,r=t.length;o<r;o++){const d=t[o];if(!d.options.isWholeLine)continue;const l='<div class="cdr '+d.options.className+'" style="left:0;width:100%;"></div>',h=Math.max(d.range.startLineNumber,n),c=Math.min(d.range.endLineNumber,s);for(let u=h;u<=c;u++){const f=u-n;i[f]+=l}}}_renderNormalDecorations(e,t,i){const n=e.visibleRange.startLineNumber;let s=null,o=!1,r=null,d=!1;for(let l=0,h=t.length;l<h;l++){const c=t[l];if(c.options.isWholeLine)continue;const u=c.options.className,f=!!c.options.showIfCollapsed;let _=c.range;if(f&&_.endColumn===1&&_.endLineNumber!==_.startLineNumber&&(_=new A(_.startLineNumber,_.startColumn,_.endLineNumber-1,this._context.viewModel.getLineMaxColumn(_.endLineNumber-1))),s===u&&o===f&&A.areIntersectingOrTouching(r,_)){r=A.plusRange(r,_);continue}s!==null&&this._renderNormalDecoration(e,r,s,d,o,n,i),s=u,o=f,r=_,d=c.options.shouldFillLineOnLineBreak??!1}s!==null&&this._renderNormalDecoration(e,r,s,d,o,n,i)}_renderNormalDecoration(e,t,i,n,s,o,r){const d=e.linesVisibleRangesForRange(t,i==="findMatch");if(d)for(let l=0,h=d.length;l<h;l++){const c=d[l];if(c.outsideRenderedLine)continue;const u=c.lineNumber-o;if(s&&c.ranges.length===1){const f=c.ranges[0];if(f.width<this._typicalHalfwidthCharacterWidth){const _=Math.round(f.left+f.width/2),C=Math.max(0,Math.round(_-this._typicalHalfwidthCharacterWidth/2));c.ranges[0]=new Fn(C,this._typicalHalfwidthCharacterWidth)}}for(let f=0,_=c.ranges.length;f<_;f++){const C=n&&c.continuesOnNextLine&&_===1,w=c.ranges[f],p='<div class="cdr '+i+'" style="left:'+String(w.left)+"px;width:"+(C?"100%;":String(w.width)+"px;")+'"></div>';r[u]+=p}}}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}class zu extends pe{constructor(e,t,i,n){super(e);const s=this._context.configuration.options,o=s.get(104),r=s.get(75),d=s.get(40),l=s.get(107),h={listenOnDomNode:i.domNode,className:"editor-scrollable "+is(e.theme.type),useShadows:!1,lazyRender:!0,vertical:o.vertical,horizontal:o.horizontal,verticalHasArrows:o.verticalHasArrows,horizontalHasArrows:o.horizontalHasArrows,verticalScrollbarSize:o.verticalScrollbarSize,verticalSliderSize:o.verticalSliderSize,horizontalScrollbarSize:o.horizontalScrollbarSize,horizontalSliderSize:o.horizontalSliderSize,handleMouseWheel:o.handleMouseWheel,alwaysConsumeMouseWheel:o.alwaysConsumeMouseWheel,arrowSize:o.arrowSize,mouseWheelScrollSensitivity:r,fastScrollSensitivity:d,scrollPredominantAxis:l,scrollByPage:o.scrollByPage};this.scrollbar=this._register(new ya(t.domNode,h,this._context.viewLayout.getScrollable())),Ie.write(this.scrollbar.getDomNode(),6),this.scrollbarDomNode=V(this.scrollbar.getDomNode()),this.scrollbarDomNode.setPosition("absolute"),this._setLayout();const c=(u,f,_)=>{const C={};{const w=u.scrollTop;w&&(C.scrollTop=this._context.viewLayout.getCurrentScrollTop()+w,u.scrollTop=0)}if(_){const w=u.scrollLeft;w&&(C.scrollLeft=this._context.viewLayout.getCurrentScrollLeft()+w,u.scrollLeft=0)}this._context.viewModel.viewLayout.setScrollPosition(C,1)};this._register(O(i.domNode,"scroll",u=>c(i.domNode,!0,!0))),this._register(O(t.domNode,"scroll",u=>c(t.domNode,!0,!1))),this._register(O(n.domNode,"scroll",u=>c(n.domNode,!0,!1))),this._register(O(this.scrollbarDomNode.domNode,"scroll",u=>c(this.scrollbarDomNode.domNode,!0,!1)))}dispose(){super.dispose()}_setLayout(){const e=this._context.configuration.options,t=e.get(146);this.scrollbarDomNode.setLeft(t.contentLeft),e.get(73).side==="right"?this.scrollbarDomNode.setWidth(t.contentWidth+t.minimap.minimapWidth):this.scrollbarDomNode.setWidth(t.contentWidth),this.scrollbarDomNode.setHeight(t.height)}getOverviewRulerLayoutInfo(){return this.scrollbar.getOverviewRulerLayoutInfo()}getDomNode(){return this.scrollbarDomNode}delegateVerticalScrollbarPointerDown(e){this.scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this.scrollbar.delegateScrollFromMouseWheelEvent(e)}onConfigurationChanged(e){if(e.hasChanged(104)||e.hasChanged(75)||e.hasChanged(40)){const t=this._context.configuration.options,i=t.get(104),n=t.get(75),s=t.get(40),o=t.get(107),r={vertical:i.vertical,horizontal:i.horizontal,verticalScrollbarSize:i.verticalScrollbarSize,horizontalScrollbarSize:i.horizontalScrollbarSize,scrollByPage:i.scrollByPage,handleMouseWheel:i.handleMouseWheel,mouseWheelScrollSensitivity:n,fastScrollSensitivity:s,scrollPredominantAxis:o};this.scrollbar.updateOptions(r)}return e.hasChanged(146)&&this._setLayout(),!0}onScrollChanged(e){return!0}onThemeChanged(e){return this.scrollbar.updateClassName("editor-scrollable "+is(this._context.theme.type)),!0}prepareRender(e){}render(e){this.scrollbar.renderNow()}}class ys{constructor(e,t,i,n,s){this.startLineNumber=e,this.endLineNumber=t,this.className=i,this.tooltip=n,this._decorationToRenderBrand=void 0,this.zIndex=s??0}}class $u{constructor(e,t,i){this.className=e,this.zIndex=t,this.tooltip=i}}class Gu{constructor(){this.decorations=[]}add(e){this.decorations.push(e)}getDecorations(){return this.decorations}}class Fa extends Lt{_render(e,t,i){const n=[];for(let r=e;r<=t;r++){const d=r-e;n[d]=new Gu}if(i.length===0)return n;i.sort((r,d)=>r.className===d.className?r.startLineNumber===d.startLineNumber?r.endLineNumber-d.endLineNumber:r.startLineNumber-d.startLineNumber:r.className<d.className?-1:1);let s=null,o=0;for(let r=0,d=i.length;r<d;r++){const l=i[r],h=l.className,c=l.zIndex;let u=Math.max(l.startLineNumber,e)-e;const f=Math.min(l.endLineNumber,t)-e;s===h?(u=Math.max(o+1,u),o=Math.max(o,f)):(s=h,o=f);for(let _=u;_<=o;_++)n[_].add(new $u(h,c,l.tooltip))}return n}}class ju extends pe{constructor(e){super(e),this._widgets={},this._context=e;const t=this._context.configuration.options,i=t.get(146);this.domNode=V(document.createElement("div")),this.domNode.setClassName("glyph-margin-widgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this._lineHeight=t.get(67),this._glyphMargin=t.get(57),this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._glyphMarginDecorationLaneCount=i.glyphMarginDecorationLaneCount,this._managedDomNodes=[],this._decorationGlyphsToRender=[]}dispose(){this._managedDomNodes=[],this._decorationGlyphsToRender=[],this._widgets={},super.dispose()}getWidgets(){return Object.values(this._widgets)}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._lineHeight=t.get(67),this._glyphMargin=t.get(57),this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._glyphMarginDecorationLaneCount=i.glyphMarginDecorationLaneCount,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}addWidget(e){const t=V(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:e.getPosition(),domNode:t,renderInfo:null},t.setPosition("absolute"),t.setDisplay("none"),t.setAttribute("widgetId",e.getId()),this.domNode.appendChild(t),this.setShouldRender()}setWidgetPosition(e,t){const i=this._widgets[e.getId()];return i.preference.lane===t.lane&&i.preference.zIndex===t.zIndex&&A.equalsRange(i.preference.range,t.range)?!1:(i.preference=t,this.setShouldRender(),!0)}removeWidget(e){const t=e.getId();if(this._widgets[t]){const n=this._widgets[t].domNode.domNode;delete this._widgets[t],n.remove(),this.setShouldRender()}}_collectDecorationBasedGlyphRenderRequest(e,t){var o;const i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,s=e.getDecorationsInViewport();for(const r of s){const d=r.options.glyphMarginClassName;if(!d)continue;const l=Math.max(r.range.startLineNumber,i),h=Math.min(r.range.endLineNumber,n),c=((o=r.options.glyphMargin)==null?void 0:o.position)??to.Center,u=r.options.zIndex??0;for(let f=l;f<=h;f++){const _=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new T(f,0)),C=this._context.viewModel.glyphLanes.getLanesAtLine(_.lineNumber).indexOf(c);t.push(new Zu(f,C,u,d))}}}_collectWidgetBasedGlyphRenderRequest(e,t){const i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber;for(const s of Object.values(this._widgets)){const o=s.preference.range,{startLineNumber:r,endLineNumber:d}=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(A.lift(o));if(!r||!d||d<i||r>n)continue;const l=Math.max(r,i),h=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new T(l,0)),c=this._context.viewModel.glyphLanes.getLanesAtLine(h.lineNumber).indexOf(s.preference.lane);t.push(new Ku(l,c,s.preference.zIndex,s))}}_collectSortedGlyphRenderRequests(e){const t=[];return this._collectDecorationBasedGlyphRenderRequest(e,t),this._collectWidgetBasedGlyphRenderRequest(e,t),t.sort((i,n)=>i.lineNumber===n.lineNumber?i.laneIndex===n.laneIndex?i.zIndex===n.zIndex?n.type===i.type?i.type===0&&n.type===0?i.className<n.className?-1:1:0:n.type-i.type:n.zIndex-i.zIndex:i.laneIndex-n.laneIndex:i.lineNumber-n.lineNumber),t}prepareRender(e){if(!this._glyphMargin){this._decorationGlyphsToRender=[];return}for(const n of Object.values(this._widgets))n.renderInfo=null;const t=new qr(this._collectSortedGlyphRenderRequests(e)),i=[];for(;t.length>0;){const n=t.peek();if(!n)break;const s=t.takeWhile(r=>r.lineNumber===n.lineNumber&&r.laneIndex===n.laneIndex);if(!s||s.length===0)break;const o=s[0];if(o.type===0){const r=[];for(const d of s){if(d.zIndex!==o.zIndex||d.type!==o.type)break;(r.length===0||r[r.length-1]!==d.className)&&r.push(d.className)}i.push(o.accept(r.join(" ")))}else o.widget.renderInfo={lineNumber:o.lineNumber,laneIndex:o.laneIndex}}this._decorationGlyphsToRender=i}render(e){if(!this._glyphMargin){for(const i of Object.values(this._widgets))i.domNode.setDisplay("none");for(;this._managedDomNodes.length>0;){const i=this._managedDomNodes.pop();i==null||i.domNode.remove()}return}const t=Math.round(this._glyphMarginWidth/this._glyphMarginDecorationLaneCount);for(const i of Object.values(this._widgets))if(!i.renderInfo)i.domNode.setDisplay("none");else{const n=e.viewportData.relativeVerticalOffset[i.renderInfo.lineNumber-e.viewportData.startLineNumber],s=this._glyphMarginLeft+i.renderInfo.laneIndex*this._lineHeight;i.domNode.setDisplay("block"),i.domNode.setTop(n),i.domNode.setLeft(s),i.domNode.setWidth(t),i.domNode.setHeight(this._lineHeight)}for(let i=0;i<this._decorationGlyphsToRender.length;i++){const n=this._decorationGlyphsToRender[i],s=e.viewportData.relativeVerticalOffset[n.lineNumber-e.viewportData.startLineNumber],o=this._glyphMarginLeft+n.laneIndex*this._lineHeight;let r;i<this._managedDomNodes.length?r=this._managedDomNodes[i]:(r=V(document.createElement("div")),this._managedDomNodes.push(r),this.domNode.appendChild(r)),r.setClassName("cgmr codicon "+n.combinedClassName),r.setPosition("absolute"),r.setTop(s),r.setLeft(o),r.setWidth(t),r.setHeight(this._lineHeight)}for(;this._managedDomNodes.length>this._decorationGlyphsToRender.length;){const i=this._managedDomNodes.pop();i==null||i.domNode.remove()}}}class Zu{constructor(e,t,i,n){this.lineNumber=e,this.laneIndex=t,this.zIndex=i,this.className=n,this.type=0}accept(e){return new Yu(this.lineNumber,this.laneIndex,e)}}class Ku{constructor(e,t,i,n){this.lineNumber=e,this.laneIndex=t,this.zIndex=i,this.widget=n,this.type=1}}class Yu{constructor(e,t,i){this.lineNumber=e,this.laneIndex=t,this.combinedClassName=i}}class qu extends Lt{constructor(e){super(),this._context=e,this._primaryPosition=null;const t=this._context.configuration.options,i=t.get(147),n=t.get(50);this._spaceWidth=n.spaceWidth,this._maxIndentLeft=i.wrappingColumn===-1?-1:i.wrappingColumn*n.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(16),this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(147),n=t.get(50);return this._spaceWidth=n.spaceWidth,this._maxIndentLeft=i.wrappingColumn===-1?-1:i.wrappingColumn*n.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(16),!0}onCursorStateChanged(e){var n;const i=e.selections[0].getPosition();return(n=this._primaryPosition)!=null&&n.equals(i)?!1:(this._primaryPosition=i,!0)}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onLanguageConfigurationChanged(e){return!0}prepareRender(e){var d,l;if(!this._bracketPairGuideOptions.indentation&&this._bracketPairGuideOptions.bracketPairs===!1){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=e.scrollWidth,s=this._primaryPosition,o=this.getGuidesByLine(t,Math.min(i+1,this._context.viewModel.getLineCount()),s),r=[];for(let h=t;h<=i;h++){const c=h-t,u=o[c];let f="";const _=((d=e.visibleRangeForPosition(new T(h,1)))==null?void 0:d.left)??0;for(const C of u){const w=C.column===-1?_+(C.visibleColumn-1)*this._spaceWidth:e.visibleRangeForPosition(new T(h,C.column)).left;if(w>n||this._maxIndentLeft>0&&w>this._maxIndentLeft)break;const p=C.horizontalLine?C.horizontalLine.top?"horizontal-top":"horizontal-bottom":"vertical",g=C.horizontalLine?(((l=e.visibleRangeForPosition(new T(h,C.horizontalLine.endColumn)))==null?void 0:l.left)??w+this._spaceWidth)-w:this._spaceWidth;f+=`<div class="core-guide ${C.className} ${p}" style="left:${w}px;width:${g}px"></div>`}r[c]=f}this._renderResult=r}getGuidesByLine(e,t,i){const n=this._bracketPairGuideOptions.bracketPairs!==!1?this._context.viewModel.getBracketGuidesInRangeByLine(e,t,i,{highlightActive:this._bracketPairGuideOptions.highlightActiveBracketPair,horizontalGuides:this._bracketPairGuideOptions.bracketPairsHorizontal===!0?Bn.Enabled:this._bracketPairGuideOptions.bracketPairsHorizontal==="active"?Bn.EnabledForActive:Bn.Disabled,includeInactive:this._bracketPairGuideOptions.bracketPairs===!0}):null,s=this._bracketPairGuideOptions.indentation?this._context.viewModel.getLinesIndentGuides(e,t):null;let o=0,r=0,d=0;if(this._bracketPairGuideOptions.highlightActiveIndentation!==!1&&i){const c=this._context.viewModel.getActiveIndentGuide(i.lineNumber,e,t);o=c.startLineNumber,r=c.endLineNumber,d=c.indent}const{indentSize:l}=this._context.viewModel.model.getOptions(),h=[];for(let c=e;c<=t;c++){const u=new Array;h.push(u);const f=n?n[c-e]:[],_=new qr(f),C=s?s[c-e]:0;for(let w=1;w<=C;w++){const p=(w-1)*l+1,g=(this._bracketPairGuideOptions.highlightActiveIndentation==="always"||f.length===0)&&o<=c&&c<=r&&w===d;u.push(..._.takeWhile(m=>m.visibleColumn<p)||[]);const v=_.peek();(!v||v.visibleColumn!==p||v.horizontalLine)&&u.push(new kl(p,-1,`core-guide-indent lvl-${(w-1)%30}`+(g?" indent-active":""),null,-1,-1))}u.push(..._.takeWhile(w=>!0)||[])}return h}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}function xt(a){if(!(a&&a.isTransparent()))return a}St((a,e)=>{const t=[{bracketColor:ll,guideColor:dl,guideColorActive:al},{bracketColor:ul,guideColor:cl,guideColorActive:hl},{bracketColor:ml,guideColor:fl,guideColorActive:gl},{bracketColor:vl,guideColor:pl,guideColorActive:_l},{bracketColor:bl,guideColor:wl,guideColorActive:Cl},{bracketColor:Ll,guideColor:Sl,guideColorActive:yl}],i=new Hl,n=[{indentColor:Nl,indentColorActive:Dl},{indentColor:xl,indentColorActive:Ml},{indentColor:El,indentColorActive:Rl},{indentColor:Il,indentColorActive:Tl},{indentColor:Al,indentColorActive:Ol},{indentColor:Wl,indentColorActive:Pl}],s=t.map(r=>{const d=a.getColor(r.bracketColor),l=a.getColor(r.guideColor),h=a.getColor(r.guideColorActive),c=xt(xt(l)??(d==null?void 0:d.transparent(.3))),u=xt(xt(h)??d);if(!(!c||!u))return{guideColor:c,guideColorActive:u}}).filter(Gt),o=n.map(r=>{const d=a.getColor(r.indentColor),l=a.getColor(r.indentColorActive),h=xt(d),c=xt(l);if(!(!h||!c))return{indentColor:h,indentColorActive:c}}).filter(Gt);if(s.length>0){for(let r=0;r<30;r++){const d=s[r%s.length];e.addRule(`.monaco-editor .${i.getInlineClassNameOfLevel(r).replace(/ /g,".")} { --guide-color: ${d.guideColor}; --guide-color-active: ${d.guideColorActive}; }`)}e.addRule(".monaco-editor .vertical { box-shadow: 1px 0 0 0 var(--guide-color) inset; }"),e.addRule(".monaco-editor .horizontal-top { border-top: 1px solid var(--guide-color); }"),e.addRule(".monaco-editor .horizontal-bottom { border-bottom: 1px solid var(--guide-color); }"),e.addRule(`.monaco-editor .vertical.${i.activeClassName} { box-shadow: 1px 0 0 0 var(--guide-color-active) inset; }`),e.addRule(`.monaco-editor .horizontal-top.${i.activeClassName} { border-top: 1px solid var(--guide-color-active); }`),e.addRule(`.monaco-editor .horizontal-bottom.${i.activeClassName} { border-bottom: 1px solid var(--guide-color-active); }`)}if(o.length>0){for(let r=0;r<30;r++){const d=o[r%o.length];e.addRule(`.monaco-editor .lines-content .core-guide-indent.lvl-${r} { --indent-color: ${d.indentColor}; --indent-color-active: ${d.indentColorActive}; }`)}e.addRule(".monaco-editor .lines-content .core-guide-indent { box-shadow: 1px 0 0 0 var(--indent-color) inset; }"),e.addRule(".monaco-editor .lines-content .core-guide-indent.indent-active { box-shadow: 1px 0 0 0 var(--indent-color-active) inset; }")}});class Gn{get didDomLayout(){return this._didDomLayout}readClientRect(){if(!this._clientRectRead){this._clientRectRead=!0;const e=this._domNode.getBoundingClientRect();this.markDidDomLayout(),this._clientRectDeltaLeft=e.left,this._clientRectScale=e.width/this._domNode.offsetWidth}}get clientRectDeltaLeft(){return this._clientRectRead||this.readClientRect(),this._clientRectDeltaLeft}get clientRectScale(){return this._clientRectRead||this.readClientRect(),this._clientRectScale}constructor(e,t){this._domNode=e,this.endNode=t,this._didDomLayout=!1,this._clientRectDeltaLeft=0,this._clientRectScale=1,this._clientRectRead=!1}markDidDomLayout(){this._didDomLayout=!0}}class Qu{constructor(){this._currentVisibleRange=new A(1,1,1,1)}getCurrentVisibleRange(){return this._currentVisibleRange}setCurrentVisibleRange(e){this._currentVisibleRange=e}}class Xu{constructor(e,t,i,n,s,o,r){this.minimalReveal=e,this.lineNumber=t,this.startColumn=i,this.endColumn=n,this.startScrollTop=s,this.stopScrollTop=o,this.scrollType=r,this.type="range",this.minLineNumber=t,this.maxLineNumber=t}}class Ju{constructor(e,t,i,n,s){this.minimalReveal=e,this.selections=t,this.startScrollTop=i,this.stopScrollTop=n,this.scrollType=s,this.type="selections";let o=t[0].startLineNumber,r=t[0].endLineNumber;for(let d=1,l=t.length;d<l;d++){const h=t[d];o=Math.min(o,h.startLineNumber),r=Math.max(r,h.endLineNumber)}this.minLineNumber=o,this.maxLineNumber=r}}const _n=class _n extends pe{constructor(e,t){super(e);const i=this._context.configuration,n=this._context.configuration.options,s=n.get(50),o=n.get(147);this._lineHeight=n.get(67),this._typicalHalfwidthCharacterWidth=s.typicalHalfwidthCharacterWidth,this._isViewportWrapping=o.isViewportWrapping,this._revealHorizontalRightPadding=n.get(101),this._cursorSurroundingLines=n.get(29),this._cursorSurroundingLinesStyle=n.get(30),this._canUseLayerHinting=!n.get(32),this._viewLineOptions=new fr(i,this._context.theme.type),this._linesContent=t,this._textRangeRestingSpot=document.createElement("div"),this._visibleLines=new Wa({createLine:()=>new je(this._viewLineOptions)}),this.domNode=this._visibleLines.domNode,Ie.write(this.domNode,8),this.domNode.setClassName(`view-lines ${kt}`),ge(this.domNode,s),this._maxLineWidth=0,this._asyncUpdateLineWidths=new gt(()=>{this._updateLineWidthsSlow()},200),this._asyncCheckMonospaceFontAssumptions=new gt(()=>{this._checkMonospaceFontAssumptions()},2e3),this._lastRenderedData=new Qu,this._horizontalRevealRequest=null,this._stickyScrollEnabled=n.get(116).enabled,this._maxNumberStickyLines=n.get(116).maxLineCount}dispose(){this._asyncUpdateLineWidths.dispose(),this._asyncCheckMonospaceFontAssumptions.dispose(),super.dispose()}getDomNode(){return this.domNode}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e),e.hasChanged(147)&&(this._maxLineWidth=0);const t=this._context.configuration.options,i=t.get(50),n=t.get(147);return this._lineHeight=t.get(67),this._typicalHalfwidthCharacterWidth=i.typicalHalfwidthCharacterWidth,this._isViewportWrapping=n.isViewportWrapping,this._revealHorizontalRightPadding=t.get(101),this._cursorSurroundingLines=t.get(29),this._cursorSurroundingLinesStyle=t.get(30),this._canUseLayerHinting=!t.get(32),this._stickyScrollEnabled=t.get(116).enabled,this._maxNumberStickyLines=t.get(116).maxLineCount,ge(this.domNode,i),this._onOptionsMaybeChanged(),e.hasChanged(146)&&(this._maxLineWidth=0),!0}_onOptionsMaybeChanged(){const e=this._context.configuration,t=new fr(e,this._context.theme.type);if(!this._viewLineOptions.equals(t)){this._viewLineOptions=t;const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++)this._visibleLines.getVisibleLine(s).onOptionsChanged(this._viewLineOptions);return!0}return!1}onCursorStateChanged(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();let n=!1;for(let s=t;s<=i;s++)n=this._visibleLines.getVisibleLine(s).onSelectionChanged()||n;return n}onDecorationsChanged(e){{const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();for(let n=t;n<=i;n++)this._visibleLines.getVisibleLine(n).onDecorationsChanged()}return!0}onFlushed(e){const t=this._visibleLines.onFlushed(e);return this._maxLineWidth=0,t}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onRevealRangeRequest(e){const t=this._computeScrollTopToRevealRange(this._context.viewLayout.getFutureViewport(),e.source,e.minimalReveal,e.range,e.selections,e.verticalType);if(t===-1)return!1;let i=this._context.viewLayout.validateScrollPosition({scrollTop:t});e.revealHorizontal?e.range&&e.range.startLineNumber!==e.range.endLineNumber?i={scrollTop:i.scrollTop,scrollLeft:0}:e.range?this._horizontalRevealRequest=new Xu(e.minimalReveal,e.range.startLineNumber,e.range.startColumn,e.range.endColumn,this._context.viewLayout.getCurrentScrollTop(),i.scrollTop,e.scrollType):e.selections&&e.selections.length>0&&(this._horizontalRevealRequest=new Ju(e.minimalReveal,e.selections,this._context.viewLayout.getCurrentScrollTop(),i.scrollTop,e.scrollType)):this._horizontalRevealRequest=null;const s=Math.abs(this._context.viewLayout.getCurrentScrollTop()-i.scrollTop)<=this._lineHeight?1:e.scrollType;return this._context.viewModel.viewLayout.setScrollPosition(i,s),!0}onScrollChanged(e){if(this._horizontalRevealRequest&&e.scrollLeftChanged&&(this._horizontalRevealRequest=null),this._horizontalRevealRequest&&e.scrollTopChanged){const t=Math.min(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop),i=Math.max(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop);(e.scrollTop<t||e.scrollTop>i)&&(this._horizontalRevealRequest=null)}return this.domNode.setWidth(e.scrollWidth),this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth),this._visibleLines.onZonesChanged(e)}onThemeChanged(e){return this._onOptionsMaybeChanged()}getPositionFromDOMInfo(e,t){const i=this._getViewLineDomNode(e);if(i===null)return null;const n=this._getLineNumberFor(i);if(n===-1||n<1||n>this._context.viewModel.getLineCount())return null;if(this._context.viewModel.getLineMaxColumn(n)===1)return new T(n,1);const s=this._visibleLines.getStartLineNumber(),o=this._visibleLines.getEndLineNumber();if(n<s||n>o)return null;let r=this._visibleLines.getVisibleLine(n).getColumnOfNodeOffset(e,t);const d=this._context.viewModel.getLineMinColumn(n);return r<d&&(r=d),new T(n,r)}_getViewLineDomNode(e){for(;e&&e.nodeType===1;){if(e.className===je.CLASS_NAME)return e;e=e.parentElement}return null}_getLineNumberFor(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();for(let n=t;n<=i;n++){const s=this._visibleLines.getVisibleLine(n);if(e===s.getDomNode())return n}return-1}getLineWidth(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();if(e<t||e>i)return-1;const n=new Gn(this.domNode.domNode,this._textRangeRestingSpot),s=this._visibleLines.getVisibleLine(e).getWidth(n);return this._updateLineWidthsSlowIfDomDidLayout(n),s}linesVisibleRangesForRange(e,t){if(this.shouldRender())return null;const i=e.endLineNumber,n=A.intersectRanges(e,this._lastRenderedData.getCurrentVisibleRange());if(!n)return null;const s=[];let o=0;const r=new Gn(this.domNode.domNode,this._textRangeRestingSpot);let d=0;t&&(d=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new T(n.startLineNumber,1)).lineNumber);const l=this._visibleLines.getStartLineNumber(),h=this._visibleLines.getEndLineNumber();for(let c=n.startLineNumber;c<=n.endLineNumber;c++){if(c<l||c>h)continue;const u=c===n.startLineNumber?n.startColumn:1,f=c!==n.endLineNumber,_=f?this._context.viewModel.getLineMaxColumn(c):n.endColumn,C=this._visibleLines.getVisibleLine(c).getVisibleRangesForRange(c,u,_,r);if(C){if(t&&c<i){const w=d;d=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new T(c+1,1)).lineNumber,w!==d&&(C.ranges[C.ranges.length-1].width+=this._typicalHalfwidthCharacterWidth)}s[o++]=new lu(C.outsideRenderedLine,c,Fn.from(C.ranges),f)}}return this._updateLineWidthsSlowIfDomDidLayout(r),o===0?null:s}_visibleRangesForLineRange(e,t,i){if(this.shouldRender()||e<this._visibleLines.getStartLineNumber()||e>this._visibleLines.getEndLineNumber())return null;const n=new Gn(this.domNode.domNode,this._textRangeRestingSpot),s=this._visibleLines.getVisibleLine(e).getVisibleRangesForRange(e,t,i,n);return this._updateLineWidthsSlowIfDomDidLayout(n),s}visibleRangeForPosition(e){const t=this._visibleRangesForLineRange(e.lineNumber,e.column,e.column);return t?new hu(t.outsideRenderedLine,t.ranges[0].left):null}_updateLineWidthsFast(){return this._updateLineWidths(!0)}_updateLineWidthsSlow(){this._updateLineWidths(!1)}_updateLineWidthsSlowIfDomDidLayout(e){e.didDomLayout&&(this._asyncUpdateLineWidths.isScheduled()||(this._asyncUpdateLineWidths.cancel(),this._updateLineWidthsSlow()))}_updateLineWidths(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();let n=1,s=!0;for(let o=t;o<=i;o++){const r=this._visibleLines.getVisibleLine(o);if(e&&!r.getWidthIsFast()){s=!1;continue}n=Math.max(n,r.getWidth(null))}return s&&t===1&&i===this._context.viewModel.getLineCount()&&(this._maxLineWidth=0),this._ensureMaxLineWidth(n),s}_checkMonospaceFontAssumptions(){let e=-1,t=-1;const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++){const o=this._visibleLines.getVisibleLine(s);if(o.needsMonospaceFontCheck()){const r=o.getWidth(null);r>t&&(t=r,e=s)}}if(e!==-1&&!this._visibleLines.getVisibleLine(e).monospaceAssumptionsAreValid())for(let s=i;s<=n;s++)this._visibleLines.getVisibleLine(s).onMonospaceAssumptionsInvalidated()}prepareRender(){throw new Error("Not supported")}render(){throw new Error("Not supported")}renderText(e){if(this._visibleLines.renderLines(e),this._lastRenderedData.setCurrentVisibleRange(e.visibleRange),this.domNode.setWidth(this._context.viewLayout.getScrollWidth()),this.domNode.setHeight(Math.min(this._context.viewLayout.getScrollHeight(),1e6)),this._horizontalRevealRequest){const i=this._horizontalRevealRequest;if(e.startLineNumber<=i.minLineNumber&&i.maxLineNumber<=e.endLineNumber){this._horizontalRevealRequest=null,this.onDidRender();const n=this._computeScrollLeftToReveal(i);n&&(this._isViewportWrapping||this._ensureMaxLineWidth(n.maxHorizontalOffset),this._context.viewModel.viewLayout.setScrollPosition({scrollLeft:n.scrollLeft},i.scrollType))}}if(this._updateLineWidthsFast()?this._asyncUpdateLineWidths.cancel():this._asyncUpdateLineWidths.schedule(),Ln&&!this._asyncCheckMonospaceFontAssumptions.isScheduled()){const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++)if(this._visibleLines.getVisibleLine(s).needsMonospaceFontCheck()){this._asyncCheckMonospaceFontAssumptions.schedule();break}}this._linesContent.setLayerHinting(this._canUseLayerHinting),this._linesContent.setContain("strict");const t=this._context.viewLayout.getCurrentScrollTop()-e.bigNumbersDelta;this._linesContent.setTop(-t),this._linesContent.setLeft(-this._context.viewLayout.getCurrentScrollLeft())}_ensureMaxLineWidth(e){const t=Math.ceil(e);this._maxLineWidth<t&&(this._maxLineWidth=t,this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth))}_computeScrollTopToRevealRange(e,t,i,n,s,o){const r=e.top,d=e.height,l=r+d;let h,c,u;if(s&&s.length>0){let p=s[0].startLineNumber,g=s[0].endLineNumber;for(let v=1,m=s.length;v<m;v++){const b=s[v];p=Math.min(p,b.startLineNumber),g=Math.max(g,b.endLineNumber)}h=!1,c=this._context.viewLayout.getVerticalOffsetForLineNumber(p),u=this._context.viewLayout.getVerticalOffsetForLineNumber(g)+this._lineHeight}else if(n)h=!0,c=this._context.viewLayout.getVerticalOffsetForLineNumber(n.startLineNumber),u=this._context.viewLayout.getVerticalOffsetForLineNumber(n.endLineNumber)+this._lineHeight;else return-1;const f=(t==="mouse"||i)&&this._cursorSurroundingLinesStyle==="default";let _=0,C=0;if(f)i||(_=this._lineHeight);else{const p=d/this._lineHeight,g=Math.max(this._cursorSurroundingLines,this._stickyScrollEnabled?this._maxNumberStickyLines:0),v=Math.min(p/2,g);_=v*this._lineHeight,C=Math.max(0,v-1)*this._lineHeight}i||(o===0||o===4)&&(C+=this._lineHeight),c-=_,u+=C;let w;if(u-c>d){if(!h)return-1;w=c}else if(o===5||o===6)if(o===6&&r<=c&&u<=l)w=r;else{const p=Math.max(5*this._lineHeight,d*.2),g=c-p,v=u-d;w=Math.max(v,g)}else if(o===1||o===2)if(o===2&&r<=c&&u<=l)w=r;else{const p=(c+u)/2;w=Math.max(0,p-d/2)}else w=this._computeMinimumScrolling(r,l,c,u,o===3,o===4);return w}_computeScrollLeftToReveal(e){const t=this._context.viewLayout.getCurrentViewport(),i=this._context.configuration.options.get(146),n=t.left,s=n+t.width-i.verticalScrollbarWidth;let o=1073741824,r=0;if(e.type==="range"){const l=this._visibleRangesForLineRange(e.lineNumber,e.startColumn,e.endColumn);if(!l)return null;for(const h of l.ranges)o=Math.min(o,Math.round(h.left)),r=Math.max(r,Math.round(h.left+h.width))}else for(const l of e.selections){if(l.startLineNumber!==l.endLineNumber)return null;const h=this._visibleRangesForLineRange(l.startLineNumber,l.startColumn,l.endColumn);if(!h)return null;for(const c of h.ranges)o=Math.min(o,Math.round(c.left)),r=Math.max(r,Math.round(c.left+c.width))}return e.minimalReveal||(o=Math.max(0,o-_n.HORIZONTAL_EXTRA_PX),r+=this._revealHorizontalRightPadding),e.type==="selections"&&r-o>t.width?null:{scrollLeft:this._computeMinimumScrolling(n,s,o,r),maxHorizontalOffset:r}}_computeMinimumScrolling(e,t,i,n,s,o){e=e|0,t=t|0,i=i|0,n=n|0,s=!!s,o=!!o;const r=t-e;if(n-i<r){if(s)return i;if(o)return Math.max(0,n-r);if(i<e)return i;if(n>t)return Math.max(0,n-r)}else return i;return e}};_n.HORIZONTAL_EXTRA_PX=30;let Ss=_n;class eg extends Fa{constructor(e){super(),this._context=e;const i=this._context.configuration.options.get(146);this._decorationsLeft=i.decorationsLeft,this._decorationsWidth=i.decorationsWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._decorationsLeft=i.decorationsLeft,this._decorationsWidth=i.decorationsWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),i=[];let n=0;for(let s=0,o=t.length;s<o;s++){const r=t[s],d=r.options.linesDecorationsClassName,l=r.options.zIndex;d&&(i[n++]=new ys(r.range.startLineNumber,r.range.endLineNumber,d,r.options.linesDecorationsTooltip??null,l));const h=r.options.firstLineDecorationClassName;h&&(i[n++]=new ys(r.range.startLineNumber,r.range.startLineNumber,h,r.options.linesDecorationsTooltip??null,l))}return i}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=this._render(t,i,this._getDecorations(e)),s=this._decorationsLeft.toString(),o=this._decorationsWidth.toString(),r='" style="left:'+s+"px;width:"+o+'px;"></div>',d=[];for(let l=t;l<=i;l++){const h=l-t,c=n[h].getDecorations();let u="";for(const f of c){let _='<div class="cldr '+f.className;f.tooltip!==null&&(_+='" title="'+f.tooltip),_+=r,u+=_}d[h]=u}this._renderResult=d}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}class tg extends Fa{constructor(e){super(),this._context=e,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),i=[];let n=0;for(let s=0,o=t.length;s<o;s++){const r=t[s],d=r.options.marginClassName,l=r.options.zIndex;d&&(i[n++]=new ys(r.range.startLineNumber,r.range.endLineNumber,d,null,l))}return i}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=this._render(t,i,this._getDecorations(e)),s=[];for(let o=t;o<=i;o++){const r=o-t,d=n[r].getDecorations();let l="";for(const h of d)l+='<div class="cmdr '+h.className+'" style=""></div>';s[r]=l}this._renderResult=s}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}const ig=(()=>{const a=[];for(let e=32;e<=126;e++)a.push(e);return a.push(65533),a})(),ng=(a,e)=>(a-=32,a<0||a>96?e<=2?(a+96)%96:95:a);class Di{constructor(e,t){this.scale=t,this._minimapCharRendererBrand=void 0,this.charDataNormal=Di.soften(e,12/15),this.charDataLight=Di.soften(e,50/60)}static soften(e,t){const i=new Uint8ClampedArray(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=Qr(e[n]*t);return i}renderChar(e,t,i,n,s,o,r,d,l,h,c){const u=1*this.scale,f=2*this.scale,_=c?1:f;if(t+u>e.width||i+_>e.height){console.warn("bad render request outside image data");return}const C=h?this.charDataLight:this.charDataNormal,w=ng(n,l),p=e.width*4,g=r.r,v=r.g,m=r.b,b=s.r-g,y=s.g-v,N=s.b-m,S=Math.max(o,d),L=e.data;let R=w*u*f,x=i*p+t*4;for(let M=0;M<_;M++){let P=x;for(let z=0;z<u;z++){const B=C[R++]/255*(o/255);L[P++]=g+b*B,L[P++]=v+y*B,L[P++]=m+N*B,L[P++]=S}x+=p}}blockRenderChar(e,t,i,n,s,o,r,d){const l=1*this.scale,h=2*this.scale,c=d?1:h;if(t+l>e.width||i+c>e.height){console.warn("bad render request outside image data");return}const u=e.width*4,f=.5*(s/255),_=o.r,C=o.g,w=o.b,p=n.r-_,g=n.g-C,v=n.b-w,m=_+p*f,b=C+g*f,y=w+v*f,N=Math.max(s,r),S=e.data;let L=i*u+t*4;for(let R=0;R<c;R++){let x=L;for(let M=0;M<l;M++)S[x++]=m,S[x++]=b,S[x++]=y,S[x++]=N;L+=u}}}const Sr={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},Lr=a=>{const e=new Uint8ClampedArray(a.length/2);for(let t=0;t<a.length;t+=2)e[t>>1]=Sr[a[t]]<<4|Sr[a[t+1]]&15;return e},Dr={1:Jn(()=>Lr("0000511D6300CF609C709645A78432005642574171487021003C451900274D35D762755E8B629C5BA856AF57BA649530C167D1512A272A3F6038604460398526BCA2A968DB6F8957C768BE5FBE2FB467CF5D8D5B795DC7625B5DFF50DE64C466DB2FC47CD860A65E9A2EB96CB54CE06DA763AB2EA26860524D3763536601005116008177A8705E53AB738E6A982F88BAA35B5F5B626D9C636B449B737E5B7B678598869A662F6B5B8542706C704C80736A607578685B70594A49715A4522E792")),2:Jn(()=>Lr("000000000000000055394F383D2800008B8B1F210002000081B1CBCBCC820000847AAF6B9AAF2119BE08B8881AD60000A44FD07DCCF107015338130C00000000385972265F390B406E2437634B4B48031B12B8A0847000001E15B29A402F0000000000004B33460B00007A752C2A0000000000004D3900000084394B82013400ABA5CFC7AD9C0302A45A3E5A98AB000089A43382D97900008BA54AA087A70A0248A6A7AE6DBE0000BF6F94987EA40A01A06DCFA7A7A9030496C32F77891D0000A99FB1A0AFA80603B29AB9CA75930D010C0948354D3900000C0948354F37460D0028BE673D8400000000AF9D7B6E00002B007AA8933400007AA642675C2700007984CFB9C3985B768772A8A6B7B20000CAAECAAFC4B700009F94A6009F840009D09F9BA4CA9C0000CC8FC76DC87F0000C991C472A2000000A894A48CA7B501079BA2C9C69BA20000B19A5D3FA89000005CA6009DA2960901B0A7F0669FB200009D009E00B7890000DAD0F5D092820000D294D4C48BD10000B5A7A4A3B1A50402CAB6CBA6A2000000B5A7A4A3B1A8044FCDADD19D9CB00000B7778F7B8AAE0803C9AB5D3F5D3F00009EA09EA0BAB006039EA0989A8C7900009B9EF4D6B7C00000A9A7816CACA80000ABAC84705D3F000096DA635CDC8C00006F486F266F263D4784006124097B00374F6D2D6D2D6D4A3A95872322000000030000000000008D8939130000000000002E22A5C9CBC70600AB25C0B5C9B400061A2DB04CA67001082AA6BEBEBFC606002321DACBC19E03087AA08B6768380000282FBAC0B8CA7A88AD25BBA5A29900004C396C5894A6000040485A6E356E9442A32CD17EADA70000B4237923628600003E2DE9C1D7B500002F25BBA5A2990000231DB6AFB4A804023025C0B5CAB588062B2CBDBEC0C706882435A75CA20000002326BD6A82A908048B4B9A5A668000002423A09CB4BB060025259C9D8A7900001C1FCAB2C7C700002A2A9387ABA200002626A4A47D6E9D14333163A0C87500004B6F9C2D643A257049364936493647358A34438355497F1A0000A24C1D590000D38DFFBDD4CD3126"))};class mi{static create(e,t){if(this.lastCreated&&e===this.lastCreated.scale&&t===this.lastFontFamily)return this.lastCreated;let i;return Dr[e]?i=new Di(Dr[e](),e):i=mi.createFromSampleData(mi.createSampleData(t).data,e),this.lastFontFamily=t,this.lastCreated=i,i}static createSampleData(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.style.height="16px",t.height=16,t.width=96*10,t.style.width=96*10+"px",i.fillStyle="#ffffff",i.font=`bold 16px ${e}`,i.textBaseline="middle";let n=0;for(const s of ig)i.fillText(String.fromCharCode(s),n,16/2),n+=10;return i.getImageData(0,0,96*10,16)}static createFromSampleData(e,t){if(e.length!==61440)throw new Error("Unexpected source in MinimapCharRenderer");const n=mi._downsample(e,t);return new Di(n,t)}static _downsampleChar(e,t,i,n,s){const o=1*s,r=2*s;let d=n,l=0;for(let h=0;h<r;h++){const c=h/r*16,u=(h+1)/r*16;for(let f=0;f<o;f++){const _=f/o*10,C=(f+1)/o*10;let w=0,p=0;for(let v=c;v<u;v++){const m=t+Math.floor(v)*3840,b=1-(v-Math.floor(v));for(let y=_;y<C;y++){const N=1-(y-Math.floor(y)),S=m+Math.floor(y)*4,L=N*b;p+=L,w+=e[S]*e[S+3]/255*L}}const g=w/p;l=Math.max(l,g),i[d++]=Qr(g)}}return l}static _downsample(e,t){const i=2*t*1*t,n=i*96,s=new Uint8ClampedArray(n);let o=0,r=0,d=0;for(let l=0;l<96;l++)d=Math.max(d,this._downsampleChar(e,r,s,o,t)),o+=i,r+=10*4;if(d>0){const l=255/d;for(let h=0;h<n;h++)s[h]*=l}return s}}const sg=140,og=2;class zt{constructor(e,t,i){const n=e.options,s=n.get(144),o=n.get(146),r=o.minimap,d=n.get(50),l=n.get(73);this.renderMinimap=r.renderMinimap,this.size=l.size,this.minimapHeightIsEditorHeight=r.minimapHeightIsEditorHeight,this.scrollBeyondLastLine=n.get(106),this.paddingTop=n.get(84).top,this.paddingBottom=n.get(84).bottom,this.showSlider=l.showSlider,this.autohide=l.autohide,this.pixelRatio=s,this.typicalHalfwidthCharacterWidth=d.typicalHalfwidthCharacterWidth,this.lineHeight=n.get(67),this.minimapLeft=r.minimapLeft,this.minimapWidth=r.minimapWidth,this.minimapHeight=o.height,this.canvasInnerWidth=r.minimapCanvasInnerWidth,this.canvasInnerHeight=r.minimapCanvasInnerHeight,this.canvasOuterWidth=r.minimapCanvasOuterWidth,this.canvasOuterHeight=r.minimapCanvasOuterHeight,this.isSampling=r.minimapIsSampling,this.editorHeight=o.height,this.fontScale=r.minimapScale,this.minimapLineHeight=r.minimapLineHeight,this.minimapCharWidth=1*this.fontScale,this.sectionHeaderFontFamily=jh,this.sectionHeaderFontSize=l.sectionHeaderFontSize*s,this.sectionHeaderLetterSpacing=l.sectionHeaderLetterSpacing,this.sectionHeaderFontColor=zt._getSectionHeaderColor(t,i.getColor(1)),this.charRenderer=Jn(()=>mi.create(this.fontScale,d.fontFamily)),this.defaultBackgroundColor=i.getColor(2),this.backgroundColor=zt._getMinimapBackground(t,this.defaultBackgroundColor),this.foregroundAlpha=zt._getMinimapForegroundOpacity(t)}static _getMinimapBackground(e,t){const i=e.getColor(Ch);return i?new Vi(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}static _getMinimapForegroundOpacity(e){const t=e.getColor(wh);return t?Vi._clamp(Math.round(255*t.rgba.a)):255}static _getSectionHeaderColor(e,t){const i=e.getColor(bh);return i?new Vi(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}equals(e){return this.renderMinimap===e.renderMinimap&&this.size===e.size&&this.minimapHeightIsEditorHeight===e.minimapHeightIsEditorHeight&&this.scrollBeyondLastLine===e.scrollBeyondLastLine&&this.paddingTop===e.paddingTop&&this.paddingBottom===e.paddingBottom&&this.showSlider===e.showSlider&&this.autohide===e.autohide&&this.pixelRatio===e.pixelRatio&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.lineHeight===e.lineHeight&&this.minimapLeft===e.minimapLeft&&this.minimapWidth===e.minimapWidth&&this.minimapHeight===e.minimapHeight&&this.canvasInnerWidth===e.canvasInnerWidth&&this.canvasInnerHeight===e.canvasInnerHeight&&this.canvasOuterWidth===e.canvasOuterWidth&&this.canvasOuterHeight===e.canvasOuterHeight&&this.isSampling===e.isSampling&&this.editorHeight===e.editorHeight&&this.fontScale===e.fontScale&&this.minimapLineHeight===e.minimapLineHeight&&this.minimapCharWidth===e.minimapCharWidth&&this.sectionHeaderFontSize===e.sectionHeaderFontSize&&this.sectionHeaderLetterSpacing===e.sectionHeaderLetterSpacing&&this.defaultBackgroundColor&&this.defaultBackgroundColor.equals(e.defaultBackgroundColor)&&this.backgroundColor&&this.backgroundColor.equals(e.backgroundColor)&&this.foregroundAlpha===e.foregroundAlpha}}class _i{constructor(e,t,i,n,s,o,r,d,l){this.scrollTop=e,this.scrollHeight=t,this.sliderNeeded=i,this._computedSliderRatio=n,this.sliderTop=s,this.sliderHeight=o,this.topPaddingLineCount=r,this.startLineNumber=d,this.endLineNumber=l}getDesiredScrollTopFromDelta(e){return Math.round(this.scrollTop+e/this._computedSliderRatio)}getDesiredScrollTopFromTouchLocation(e){return Math.round((e-this.sliderHeight/2)/this._computedSliderRatio)}intersectWithViewport(e){const t=Math.max(this.startLineNumber,e.startLineNumber),i=Math.min(this.endLineNumber,e.endLineNumber);return t>i?null:[t,i]}getYForLineNumber(e,t){return+(e-this.startLineNumber+this.topPaddingLineCount)*t}static create(e,t,i,n,s,o,r,d,l,h,c){const u=e.pixelRatio,f=e.minimapLineHeight,_=Math.floor(e.canvasInnerHeight/f),C=e.lineHeight;if(e.minimapHeightIsEditorHeight){let y=d*e.lineHeight+e.paddingTop+e.paddingBottom;e.scrollBeyondLastLine&&(y+=Math.max(0,s-e.lineHeight-e.paddingBottom));const N=Math.max(1,Math.floor(s*s/y)),S=Math.max(0,e.minimapHeight-N),L=S/(h-s),R=l*L,x=S>0,M=Math.floor(e.canvasInnerHeight/e.minimapLineHeight),P=Math.floor(e.paddingTop/e.lineHeight);return new _i(l,h,x,L,R,N,P,1,Math.min(r,M))}let w;if(o&&i!==r){const y=i-t+1;w=Math.floor(y*f/u)}else{const y=s/C;w=Math.floor(y*f/u)}const p=Math.floor(e.paddingTop/C);let g=Math.floor(e.paddingBottom/C);if(e.scrollBeyondLastLine){const y=s/C;g=Math.max(g,y-1)}let v;if(g>0){const y=s/C;v=(p+r+g-y-1)*f/u}else v=Math.max(0,(p+r)*f/u-w);v=Math.min(e.minimapHeight-w,v);const m=v/(h-s),b=l*m;if(_>=p+r+g){const y=v>0;return new _i(l,h,y,m,b,w,p,1,r)}else{let y;t>1?y=t+p:y=Math.max(1,l/C);let N,S=Math.max(1,Math.floor(y-b*u/f));S<p?(N=p-S+1,S=1):(N=0,S=Math.max(1,S-p)),c&&c.scrollHeight===h&&(c.scrollTop>l&&(S=Math.min(S,c.startLineNumber),N=Math.max(N,c.topPaddingLineCount)),c.scrollTop<l&&(S=Math.max(S,c.startLineNumber),N=Math.min(N,c.topPaddingLineCount)));const L=Math.min(r,S-N+_-1),R=(l-n)/C;let x;return l>=e.paddingTop?x=(t-S+N+R)*f/u:x=l/e.paddingTop*(N+R)*f/u,new _i(l,h,!0,m,x,w,N,S,L)}}}const pn=class pn{constructor(e){this.dy=e}onContentChanged(){this.dy=-1}onTokensChanged(){this.dy=-1}};pn.INVALID=new pn(-1);let tn=pn;class Nr{constructor(e,t,i){this.renderedLayout=e,this._imageData=t,this._renderedLines=new Pa({createLine:()=>tn.INVALID}),this._renderedLines._set(e.startLineNumber,i)}linesEquals(e){if(!this.scrollEquals(e))return!1;const i=this._renderedLines._get().lines;for(let n=0,s=i.length;n<s;n++)if(i[n].dy===-1)return!1;return!0}scrollEquals(e){return this.renderedLayout.startLineNumber===e.startLineNumber&&this.renderedLayout.endLineNumber===e.endLineNumber}_get(){const e=this._renderedLines._get();return{imageData:this._imageData,rendLineNumberStart:e.rendLineNumberStart,lines:e.lines}}onLinesChanged(e,t){return this._renderedLines.onLinesChanged(e,t)}onLinesDeleted(e,t){this._renderedLines.onLinesDeleted(e,t)}onLinesInserted(e,t){this._renderedLines.onLinesInserted(e,t)}onTokensChanged(e){return this._renderedLines.onTokensChanged(e)}}class _o{constructor(e,t,i,n){this._backgroundFillData=_o._createBackgroundFillData(t,i,n),this._buffers=[e.createImageData(t,i),e.createImageData(t,i)],this._lastUsedBuffer=0}getBuffer(){this._lastUsedBuffer=1-this._lastUsedBuffer;const e=this._buffers[this._lastUsedBuffer];return e.data.set(this._backgroundFillData),e}static _createBackgroundFillData(e,t,i){const n=i.r,s=i.g,o=i.b,r=i.a,d=new Uint8ClampedArray(e*t*4);let l=0;for(let h=0;h<t;h++)for(let c=0;c<e;c++)d[l]=n,d[l+1]=s,d[l+2]=o,d[l+3]=r,l+=4;return d}}class Ni{static compute(e,t,i){if(e.renderMinimap===0||!e.isSampling)return[null,[]];const{minimapLineCount:n}=Bl.computeContainedMinimapLineCount({viewLineCount:t,scrollBeyondLastLine:e.scrollBeyondLastLine,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,height:e.editorHeight,lineHeight:e.lineHeight,pixelRatio:e.pixelRatio}),s=t/n,o=s/2;if(!i||i.minimapLines.length===0){const w=[];if(w[0]=1,n>1){for(let p=0,g=n-1;p<g;p++)w[p]=Math.round(p*s+o);w[n-1]=t}return[new Ni(s,w),[]]}const r=i.minimapLines,d=r.length,l=[];let h=0,c=0,u=1;const f=10;let _=[],C=null;for(let w=0;w<n;w++){const p=Math.max(u,Math.round(w*s)),g=Math.max(p,Math.round((w+1)*s));for(;h<d&&r[h]<p;){if(_.length<f){const m=h+1+c;C&&C.type==="deleted"&&C._oldIndex===h-1?C.deleteToLineNumber++:(C={type:"deleted",_oldIndex:h,deleteFromLineNumber:m,deleteToLineNumber:m},_.push(C)),c--}h++}let v;if(h<d&&r[h]<=g)v=r[h],h++;else if(w===0?v=1:w+1===n?v=t:v=Math.round(w*s+o),_.length<f){const m=h+1+c;C&&C.type==="inserted"&&C._i===w-1?C.insertToLineNumber++:(C={type:"inserted",_i:w,insertFromLineNumber:m,insertToLineNumber:m},_.push(C)),c++}l[w]=v,u=v}if(_.length<f)for(;h<d;){const w=h+1+c;C&&C.type==="deleted"&&C._oldIndex===h-1?C.deleteToLineNumber++:(C={type:"deleted",_oldIndex:h,deleteFromLineNumber:w,deleteToLineNumber:w},_.push(C)),c--,h++}else _=[{type:"flush"}];return[new Ni(s,l),_]}constructor(e,t){this.samplingRatio=e,this.minimapLines=t}modelLineToMinimapLine(e){return Math.min(this.minimapLines.length,Math.max(1,Math.round(e/this.samplingRatio)))}modelLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e)-1;for(;i>0&&this.minimapLines[i-1]>=e;)i--;let n=this.modelLineToMinimapLine(t)-1;for(;n+1<this.minimapLines.length&&this.minimapLines[n+1]<=t;)n++;if(i===n){const s=this.minimapLines[i];if(s<e||s>t)return null}return[i+1,n+1]}decorationLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e),n=this.modelLineToMinimapLine(t);return e!==t&&n===i&&(n===this.minimapLines.length?i>1&&i--:n++),[i,n]}onLinesDeleted(e){const t=e.toLineNumber-e.fromLineNumber+1;let i=this.minimapLines.length,n=0;for(let s=this.minimapLines.length-1;s>=0&&!(this.minimapLines[s]<e.fromLineNumber);s--)this.minimapLines[s]<=e.toLineNumber?(this.minimapLines[s]=Math.max(1,e.fromLineNumber-1),i=Math.min(i,s),n=Math.max(n,s)):this.minimapLines[s]-=t;return[i,n]}onLinesInserted(e){const t=e.toLineNumber-e.fromLineNumber+1;for(let i=this.minimapLines.length-1;i>=0&&!(this.minimapLines[i]<e.fromLineNumber);i--)this.minimapLines[i]+=t}}class rg extends pe{constructor(e){super(e),this._sectionHeaderCache=new cd(10,1.5),this.tokensColorTracker=Fl.getInstance(),this._selections=[],this._minimapSelections=null,this.options=new zt(this._context.configuration,this._context.theme,this.tokensColorTracker);const[t]=Ni.compute(this.options,this._context.viewModel.getLineCount(),null);this._samplingState=t,this._shouldCheckSampling=!1,this._actual=new Ot(e.theme,this)}dispose(){this._actual.dispose(),super.dispose()}getDomNode(){return this._actual.getDomNode()}_onOptionsMaybeChanged(){const e=new zt(this._context.configuration,this._context.theme,this.tokensColorTracker);return this.options.equals(e)?!1:(this.options=e,this._recreateLineSampling(),this._actual.onDidChangeOptions(),!0)}onConfigurationChanged(e){return this._onOptionsMaybeChanged()}onCursorStateChanged(e){return this._selections=e.selections,this._minimapSelections=null,this._actual.onSelectionChanged()}onDecorationsChanged(e){return e.affectsMinimap?this._actual.onDecorationsChanged():!1}onFlushed(e){return this._samplingState&&(this._shouldCheckSampling=!0),this._actual.onFlushed()}onLinesChanged(e){if(this._samplingState){const t=this._samplingState.modelLineRangeToMinimapLineRange(e.fromLineNumber,e.fromLineNumber+e.count-1);return t?this._actual.onLinesChanged(t[0],t[1]-t[0]+1):!1}else return this._actual.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){if(this._samplingState){const[t,i]=this._samplingState.onLinesDeleted(e);return t<=i&&this._actual.onLinesChanged(t+1,i-t+1),this._shouldCheckSampling=!0,!0}else return this._actual.onLinesDeleted(e.fromLineNumber,e.toLineNumber)}onLinesInserted(e){return this._samplingState?(this._samplingState.onLinesInserted(e),this._shouldCheckSampling=!0,!0):this._actual.onLinesInserted(e.fromLineNumber,e.toLineNumber)}onScrollChanged(e){return this._actual.onScrollChanged()}onThemeChanged(e){return this._actual.onThemeChanged(),this._onOptionsMaybeChanged(),!0}onTokensChanged(e){if(this._samplingState){const t=[];for(const i of e.ranges){const n=this._samplingState.modelLineRangeToMinimapLineRange(i.fromLineNumber,i.toLineNumber);n&&t.push({fromLineNumber:n[0],toLineNumber:n[1]})}return t.length?this._actual.onTokensChanged(t):!1}else return this._actual.onTokensChanged(e.ranges)}onTokensColorsChanged(e){return this._onOptionsMaybeChanged(),this._actual.onTokensColorsChanged()}onZonesChanged(e){return this._actual.onZonesChanged()}prepareRender(e){this._shouldCheckSampling&&(this._shouldCheckSampling=!1,this._recreateLineSampling())}render(e){let t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber;this._samplingState&&(t=this._samplingState.modelLineToMinimapLine(t),i=this._samplingState.modelLineToMinimapLine(i));const n={viewportContainsWhitespaceGaps:e.viewportData.whitespaceViewportData.length>0,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,viewportStartLineNumber:t,viewportEndLineNumber:i,viewportStartLineNumberVerticalOffset:e.getVerticalOffsetForLineNumber(t),scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight};this._actual.render(n)}_recreateLineSampling(){this._minimapSelections=null;const e=!!this._samplingState,[t,i]=Ni.compute(this.options,this._context.viewModel.getLineCount(),this._samplingState);if(this._samplingState=t,e&&this._samplingState)for(const n of i)switch(n.type){case"deleted":this._actual.onLinesDeleted(n.deleteFromLineNumber,n.deleteToLineNumber);break;case"inserted":this._actual.onLinesInserted(n.insertFromLineNumber,n.insertToLineNumber);break;case"flush":this._actual.onFlushed();break}}getLineCount(){return this._samplingState?this._samplingState.minimapLines.length:this._context.viewModel.getLineCount()}getRealLineCount(){return this._context.viewModel.getLineCount()}getLineContent(e){return this._samplingState?this._context.viewModel.getLineContent(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineContent(e)}getLineMaxColumn(e){return this._samplingState?this._context.viewModel.getLineMaxColumn(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineMaxColumn(e)}getMinimapLinesRenderingData(e,t,i){if(this._samplingState){const n=[];for(let s=0,o=t-e+1;s<o;s++)i[s]?n[s]=this._context.viewModel.getViewLineData(this._samplingState.minimapLines[e+s-1]):n[s]=null;return n}return this._context.viewModel.getMinimapLinesRenderingData(e,t,i).data}getSelections(){if(this._minimapSelections===null)if(this._samplingState){this._minimapSelections=[];for(const e of this._selections){const[t,i]=this._samplingState.decorationLineRangeToMinimapLineRange(e.startLineNumber,e.endLineNumber);this._minimapSelections.push(new we(t,e.startColumn,i,e.endColumn))}}else this._minimapSelections=this._selections;return this._minimapSelections}getMinimapDecorationsInViewport(e,t){const i=this._getMinimapDecorationsInViewport(e,t).filter(n=>{var s;return!((s=n.options.minimap)!=null&&s.sectionHeaderStyle)});if(this._samplingState){const n=[];for(const s of i){if(!s.options.minimap)continue;const o=s.range,r=this._samplingState.modelLineToMinimapLine(o.startLineNumber),d=this._samplingState.modelLineToMinimapLine(o.endLineNumber);n.push(new Vl(new A(r,o.startColumn,d,o.endColumn),s.options))}return n}return i}getSectionHeaderDecorationsInViewport(e,t){const i=this.options.minimapLineHeight,s=this.options.sectionHeaderFontSize/i;return e=Math.floor(Math.max(1,e-s)),this._getMinimapDecorationsInViewport(e,t).filter(o=>{var r;return!!((r=o.options.minimap)!=null&&r.sectionHeaderStyle)})}_getMinimapDecorationsInViewport(e,t){let i;if(this._samplingState){const n=this._samplingState.minimapLines[e-1],s=this._samplingState.minimapLines[t-1];i=new A(n,1,s,this._context.viewModel.getLineMaxColumn(s))}else i=new A(e,1,t,this._context.viewModel.getLineMaxColumn(t));return this._context.viewModel.getMinimapDecorationsInRange(i)}getSectionHeaderText(e,t){var o;const i=(o=e.options.minimap)==null?void 0:o.sectionHeaderText;if(!i)return null;const n=this._sectionHeaderCache.get(i);if(n)return n;const s=t(i);return this._sectionHeaderCache.set(i,s),s}getOptions(){return this._context.viewModel.model.getOptions()}revealLineNumber(e){this._samplingState&&(e=this._samplingState.minimapLines[e-1]),this._context.viewModel.revealRange("mouse",!1,new A(e,1,e,1),1,0)}setScrollTop(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e},1)}}class Ot extends U{constructor(e,t){super(),this._renderDecorations=!1,this._gestureInProgress=!1,this._theme=e,this._model=t,this._lastRenderData=null,this._buffers=null,this._selectionColor=this._theme.getColor(qo),this._domNode=V(document.createElement("div")),Ie.write(this._domNode,9),this._domNode.setClassName(this._getMinimapDomNodeClassName()),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._shadow=V(document.createElement("div")),this._shadow.setClassName("minimap-shadow-hidden"),this._domNode.appendChild(this._shadow),this._canvas=V(document.createElement("canvas")),this._canvas.setPosition("absolute"),this._canvas.setLeft(0),this._domNode.appendChild(this._canvas),this._decorationsCanvas=V(document.createElement("canvas")),this._decorationsCanvas.setPosition("absolute"),this._decorationsCanvas.setClassName("minimap-decorations-layer"),this._decorationsCanvas.setLeft(0),this._domNode.appendChild(this._decorationsCanvas),this._slider=V(document.createElement("div")),this._slider.setPosition("absolute"),this._slider.setClassName("minimap-slider"),this._slider.setLayerHinting(!0),this._slider.setContain("strict"),this._domNode.appendChild(this._slider),this._sliderHorizontal=V(document.createElement("div")),this._sliderHorizontal.setPosition("absolute"),this._sliderHorizontal.setClassName("minimap-slider-horizontal"),this._slider.appendChild(this._sliderHorizontal),this._applyLayout(),this._pointerDownListener=fi(this._domNode.domNode,K.POINTER_DOWN,i=>{if(i.preventDefault(),this._model.options.renderMinimap===0||!this._lastRenderData)return;if(this._model.options.size!=="proportional"){if(i.button===0&&this._lastRenderData){const l=Si(this._slider.domNode),h=l.top+l.height/2;this._startSliderDragging(i,h,this._lastRenderData.renderedLayout)}return}const s=this._model.options.minimapLineHeight,o=this._model.options.canvasInnerHeight/this._model.options.canvasOuterHeight*i.offsetY;let d=Math.floor(o/s)+this._lastRenderData.renderedLayout.startLineNumber-this._lastRenderData.renderedLayout.topPaddingLineCount;d=Math.min(d,this._model.getLineCount()),this._model.revealLineNumber(d)}),this._sliderPointerMoveMonitor=new va,this._sliderPointerDownListener=fi(this._slider.domNode,K.POINTER_DOWN,i=>{i.preventDefault(),i.stopPropagation(),i.button===0&&this._lastRenderData&&this._startSliderDragging(i,i.pageY,this._lastRenderData.renderedLayout)}),this._gestureDisposable=ro.addTarget(this._domNode.domNode),this._sliderTouchStartListener=O(this._domNode.domNode,qe.Start,i=>{i.preventDefault(),i.stopPropagation(),this._lastRenderData&&(this._slider.toggleClassName("active",!0),this._gestureInProgress=!0,this.scrollDueToTouchEvent(i))},{passive:!1}),this._sliderTouchMoveListener=O(this._domNode.domNode,qe.Change,i=>{i.preventDefault(),i.stopPropagation(),this._lastRenderData&&this._gestureInProgress&&this.scrollDueToTouchEvent(i)},{passive:!1}),this._sliderTouchEndListener=fi(this._domNode.domNode,qe.End,i=>{i.preventDefault(),i.stopPropagation(),this._gestureInProgress=!1,this._slider.toggleClassName("active",!1)})}_startSliderDragging(e,t,i){if(!e.target||!(e.target instanceof Element))return;const n=e.pageX;this._slider.toggleClassName("active",!0);const s=(o,r)=>{const d=Si(this._domNode.domNode),l=Math.min(Math.abs(r-n),Math.abs(r-d.left),Math.abs(r-d.left-d.width));if(Kr&&l>sg){this._model.setScrollTop(i.scrollTop);return}const h=o-t;this._model.setScrollTop(i.getDesiredScrollTopFromDelta(h))};e.pageY!==t&&s(e.pageY,n),this._sliderPointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,o=>s(o.pageY,o.pageX),()=>{this._slider.toggleClassName("active",!1)})}scrollDueToTouchEvent(e){const t=this._domNode.domNode.getBoundingClientRect().top,i=this._lastRenderData.renderedLayout.getDesiredScrollTopFromTouchLocation(e.pageY-t);this._model.setScrollTop(i)}dispose(){this._pointerDownListener.dispose(),this._sliderPointerMoveMonitor.dispose(),this._sliderPointerDownListener.dispose(),this._gestureDisposable.dispose(),this._sliderTouchStartListener.dispose(),this._sliderTouchMoveListener.dispose(),this._sliderTouchEndListener.dispose(),super.dispose()}_getMinimapDomNodeClassName(){const e=["minimap"];return this._model.options.showSlider==="always"?e.push("slider-always"):e.push("slider-mouseover"),this._model.options.autohide&&e.push("autohide"),e.join(" ")}getDomNode(){return this._domNode}_applyLayout(){this._domNode.setLeft(this._model.options.minimapLeft),this._domNode.setWidth(this._model.options.minimapWidth),this._domNode.setHeight(this._model.options.minimapHeight),this._shadow.setHeight(this._model.options.minimapHeight),this._canvas.setWidth(this._model.options.canvasOuterWidth),this._canvas.setHeight(this._model.options.canvasOuterHeight),this._canvas.domNode.width=this._model.options.canvasInnerWidth,this._canvas.domNode.height=this._model.options.canvasInnerHeight,this._decorationsCanvas.setWidth(this._model.options.canvasOuterWidth),this._decorationsCanvas.setHeight(this._model.options.canvasOuterHeight),this._decorationsCanvas.domNode.width=this._model.options.canvasInnerWidth,this._decorationsCanvas.domNode.height=this._model.options.canvasInnerHeight,this._slider.setWidth(this._model.options.minimapWidth)}_getBuffer(){return this._buffers||this._model.options.canvasInnerWidth>0&&this._model.options.canvasInnerHeight>0&&(this._buffers=new _o(this._canvas.domNode.getContext("2d"),this._model.options.canvasInnerWidth,this._model.options.canvasInnerHeight,this._model.options.backgroundColor)),this._buffers?this._buffers.getBuffer():null}onDidChangeOptions(){this._lastRenderData=null,this._buffers=null,this._applyLayout(),this._domNode.setClassName(this._getMinimapDomNodeClassName())}onSelectionChanged(){return this._renderDecorations=!0,!0}onDecorationsChanged(){return this._renderDecorations=!0,!0}onFlushed(){return this._lastRenderData=null,!0}onLinesChanged(e,t){return this._lastRenderData?this._lastRenderData.onLinesChanged(e,t):!1}onLinesDeleted(e,t){var i;return(i=this._lastRenderData)==null||i.onLinesDeleted(e,t),!0}onLinesInserted(e,t){var i;return(i=this._lastRenderData)==null||i.onLinesInserted(e,t),!0}onScrollChanged(){return this._renderDecorations=!0,!0}onThemeChanged(){return this._selectionColor=this._theme.getColor(qo),this._renderDecorations=!0,!0}onTokensChanged(e){return this._lastRenderData?this._lastRenderData.onTokensChanged(e):!1}onTokensColorsChanged(){return this._lastRenderData=null,this._buffers=null,!0}onZonesChanged(){return this._lastRenderData=null,!0}render(e){if(this._model.options.renderMinimap===0){this._shadow.setClassName("minimap-shadow-hidden"),this._sliderHorizontal.setWidth(0),this._sliderHorizontal.setHeight(0);return}e.scrollLeft+e.viewportWidth>=e.scrollWidth?this._shadow.setClassName("minimap-shadow-hidden"):this._shadow.setClassName("minimap-shadow-visible");const i=_i.create(this._model.options,e.viewportStartLineNumber,e.viewportEndLineNumber,e.viewportStartLineNumberVerticalOffset,e.viewportHeight,e.viewportContainsWhitespaceGaps,this._model.getLineCount(),this._model.getRealLineCount(),e.scrollTop,e.scrollHeight,this._lastRenderData?this._lastRenderData.renderedLayout:null);this._slider.setDisplay(i.sliderNeeded?"block":"none"),this._slider.setTop(i.sliderTop),this._slider.setHeight(i.sliderHeight),this._sliderHorizontal.setLeft(0),this._sliderHorizontal.setWidth(this._model.options.minimapWidth),this._sliderHorizontal.setTop(0),this._sliderHorizontal.setHeight(i.sliderHeight),this.renderDecorations(i),this._lastRenderData=this.renderLines(i)}renderDecorations(e){if(this._renderDecorations){this._renderDecorations=!1;const t=this._model.getSelections();t.sort(A.compareRangesUsingStarts);const i=this._model.getMinimapDecorationsInViewport(e.startLineNumber,e.endLineNumber);i.sort((u,f)=>(u.options.zIndex||0)-(f.options.zIndex||0));const{canvasInnerWidth:n,canvasInnerHeight:s}=this._model.options,o=this._model.options.minimapLineHeight,r=this._model.options.minimapCharWidth,d=this._model.getOptions().tabSize,l=this._decorationsCanvas.domNode.getContext("2d");l.clearRect(0,0,n,s);const h=new Mr(e.startLineNumber,e.endLineNumber,!1);this._renderSelectionLineHighlights(l,t,h,e,o),this._renderDecorationsLineHighlights(l,i,h,e,o);const c=new Mr(e.startLineNumber,e.endLineNumber,null);this._renderSelectionsHighlights(l,t,c,e,o,d,r,n),this._renderDecorationsHighlights(l,i,c,e,o,d,r,n),this._renderSectionHeaders(e)}}_renderSelectionLineHighlights(e,t,i,n,s){if(!this._selectionColor||this._selectionColor.isTransparent())return;e.fillStyle=this._selectionColor.transparent(.5).toString();let o=0,r=0;for(const d of t){const l=n.intersectWithViewport(d);if(!l)continue;const[h,c]=l;for(let _=h;_<=c;_++)i.set(_,!0);const u=n.getYForLineNumber(h,s),f=n.getYForLineNumber(c,s);r>=u||(r>o&&e.fillRect(Be,o,e.canvas.width,r-o),o=u),r=f}r>o&&e.fillRect(Be,o,e.canvas.width,r-o)}_renderDecorationsLineHighlights(e,t,i,n,s){const o=new Map;for(let r=t.length-1;r>=0;r--){const d=t[r],l=d.options.minimap;if(!l||l.position!==1)continue;const h=n.intersectWithViewport(d.range);if(!h)continue;const[c,u]=h,f=l.getColor(this._theme.value);if(!f||f.isTransparent())continue;let _=o.get(f.toString());_||(_=f.transparent(.5).toString(),o.set(f.toString(),_)),e.fillStyle=_;for(let C=c;C<=u;C++){if(i.has(C))continue;i.set(C,!0);const w=n.getYForLineNumber(c,s);e.fillRect(Be,w,e.canvas.width,s)}}}_renderSelectionsHighlights(e,t,i,n,s,o,r,d){if(!(!this._selectionColor||this._selectionColor.isTransparent()))for(const l of t){const h=n.intersectWithViewport(l);if(!h)continue;const[c,u]=h;for(let f=c;f<=u;f++)this.renderDecorationOnLine(e,i,l,this._selectionColor,n,f,s,s,o,r,d)}}_renderDecorationsHighlights(e,t,i,n,s,o,r,d){for(const l of t){const h=l.options.minimap;if(!h)continue;const c=n.intersectWithViewport(l.range);if(!c)continue;const[u,f]=c,_=h.getColor(this._theme.value);if(!(!_||_.isTransparent()))for(let C=u;C<=f;C++)switch(h.position){case 1:this.renderDecorationOnLine(e,i,l.range,_,n,C,s,s,o,r,d);continue;case 2:{const w=n.getYForLineNumber(C,s);this.renderDecoration(e,_,2,w,og,s);continue}}}}renderDecorationOnLine(e,t,i,n,s,o,r,d,l,h,c){const u=s.getYForLineNumber(o,d);if(u+r<0||u>this._model.options.canvasInnerHeight)return;const{startLineNumber:f,endLineNumber:_}=i,C=f===o?i.startColumn:1,w=_===o?i.endColumn:this._model.getLineMaxColumn(o),p=this.getXOffsetForPosition(t,o,C,l,h,c),g=this.getXOffsetForPosition(t,o,w,l,h,c);this.renderDecoration(e,n,p,u,g-p,r)}getXOffsetForPosition(e,t,i,n,s,o){if(i===1)return Be;if((i-1)*s>=o)return o;let d=e.get(t);if(!d){const l=this._model.getLineContent(t);d=[Be];let h=Be;for(let c=1;c<l.length+1;c++){const u=l.charCodeAt(c-1),f=u===9?n*s:es(u)?2*s:s,_=h+f;if(_>=o){d[c]=o;break}d[c]=_,h=_}e.set(t,d)}return i-1<d.length?d[i-1]:o}renderDecoration(e,t,i,n,s,o){e.fillStyle=t&&t.toString()||"",e.fillRect(i,n,s,o)}_renderSectionHeaders(e){var C;const t=this._model.options.minimapLineHeight,i=this._model.options.sectionHeaderFontSize,n=this._model.options.sectionHeaderLetterSpacing,s=i*1.5,{canvasInnerWidth:o}=this._model.options,r=this._model.options.backgroundColor,d=`rgb(${r.r} ${r.g} ${r.b} / .7)`,l=this._model.options.sectionHeaderFontColor,h=`rgb(${l.r} ${l.g} ${l.b})`,c=h,u=this._decorationsCanvas.domNode.getContext("2d");u.letterSpacing=n+"px",u.font="500 "+i+"px "+this._model.options.sectionHeaderFontFamily,u.strokeStyle=c,u.lineWidth=.2;const f=this._model.getSectionHeaderDecorationsInViewport(e.startLineNumber,e.endLineNumber);f.sort((w,p)=>w.range.startLineNumber-p.range.startLineNumber);const _=Ot._fitSectionHeader.bind(null,u,o-Be);for(const w of f){const p=e.getYForLineNumber(w.range.startLineNumber,t)+i,g=p-i,v=g+2,m=this._model.getSectionHeaderText(w,_);Ot._renderSectionLabel(u,m,((C=w.options.minimap)==null?void 0:C.sectionHeaderStyle)===2,d,h,o,g,s,p,v)}}static _fitSectionHeader(e,t,i){if(!i)return i;const n="…",s=e.measureText(i).width,o=e.measureText(n).width;if(s<=t||s<=o)return i;const r=i.length,d=s/i.length,l=Math.floor((t-o)/d)-1;let h=Math.ceil(l/2);for(;h>0&&/\s/.test(i[h-1]);)--h;return i.substring(0,h)+n+i.substring(r-(l-h))}static _renderSectionLabel(e,t,i,n,s,o,r,d,l,h){t&&(e.fillStyle=n,e.fillRect(0,r,o,d),e.fillStyle=s,e.fillText(t,Be,l)),i&&(e.beginPath(),e.moveTo(0,h),e.lineTo(o,h),e.closePath(),e.stroke())}renderLines(e){const t=e.startLineNumber,i=e.endLineNumber,n=this._model.options.minimapLineHeight;if(this._lastRenderData&&this._lastRenderData.linesEquals(e)){const B=this._lastRenderData._get();return new Nr(e,B.imageData,B.lines)}const s=this._getBuffer();if(!s)return null;const[o,r,d]=Ot._renderUntouchedLines(s,e.topPaddingLineCount,t,i,n,this._lastRenderData),l=this._model.getMinimapLinesRenderingData(t,i,d),h=this._model.getOptions().tabSize,c=this._model.options.defaultBackgroundColor,u=this._model.options.backgroundColor,f=this._model.options.foregroundAlpha,_=this._model.tokensColorTracker,C=_.backgroundIsLight(),w=this._model.options.renderMinimap,p=this._model.options.charRenderer(),g=this._model.options.fontScale,v=this._model.options.minimapCharWidth,b=(w===1?2:3)*g,y=n>b?Math.floor((n-b)/2):0,N=u.a/255,S=new Vi(Math.round((u.r-c.r)*N+c.r),Math.round((u.g-c.g)*N+c.g),Math.round((u.b-c.b)*N+c.b),255);let L=e.topPaddingLineCount*n;const R=[];for(let B=0,j=i-t+1;B<j;B++)d[B]&&Ot._renderLine(s,S,u.a,C,w,v,_,f,p,L,y,h,l[B],g,n),R[B]=new tn(L),L+=n;const x=o===-1?0:o,P=(r===-1?s.height:r)-x;return this._canvas.domNode.getContext("2d").putImageData(s,0,0,0,x,s.width,P),new Nr(e,s,R)}static _renderUntouchedLines(e,t,i,n,s,o){const r=[];if(!o){for(let L=0,R=n-i+1;L<R;L++)r[L]=!0;return[-1,-1,r]}const d=o._get(),l=d.imageData.data,h=d.rendLineNumberStart,c=d.lines,u=c.length,f=e.width,_=e.data,C=(n-i+1)*s*f*4;let w=-1,p=-1,g=-1,v=-1,m=-1,b=-1,y=t*s;for(let L=i;L<=n;L++){const R=L-i,x=L-h,M=x>=0&&x<u?c[x].dy:-1;if(M===-1){r[R]=!0,y+=s;continue}const P=M*f*4,z=(M+s)*f*4,B=y*f*4,j=(y+s)*f*4;v===P&&b===B?(v=z,b=j):(g!==-1&&(_.set(l.subarray(g,v),m),w===-1&&g===0&&g===m&&(w=v),p===-1&&v===C&&g===m&&(p=g)),g=P,v=z,m=B,b=j),r[R]=!1,y+=s}g!==-1&&(_.set(l.subarray(g,v),m),w===-1&&g===0&&g===m&&(w=v),p===-1&&v===C&&g===m&&(p=g));const N=w===-1?-1:w/(f*4),S=p===-1?-1:p/(f*4);return[N,S,r]}static _renderLine(e,t,i,n,s,o,r,d,l,h,c,u,f,_,C){const w=f.content,p=f.tokens,g=e.width-o,v=C===1;let m=Be,b=0,y=0;for(let N=0,S=p.getCount();N<S;N++){const L=p.getEndOffset(N),R=p.getForeground(N),x=r.getColor(R);for(;b<L;b++){if(m>g)return;const M=w.charCodeAt(b);if(M===9){const P=u-(b+y)%u;y+=P-1,m+=P*o}else if(M===32)m+=o;else{const P=es(M)?2:1;for(let z=0;z<P;z++)if(s===2?l.blockRenderChar(e,m,h+c,x,d,t,i,v):l.renderChar(e,m,h+c,M,x,d,t,i,_,n,v),m+=o,m>g)return}}}}}class Mr{constructor(e,t,i){this._startLineNumber=e,this._endLineNumber=t,this._defaultValue=i,this._values=[];for(let n=0,s=this._endLineNumber-this._startLineNumber+1;n<s;n++)this._values[n]=i}has(e){return this.get(e)!==this._defaultValue}set(e,t){e<this._startLineNumber||e>this._endLineNumber||(this._values[e-this._startLineNumber]=t)}get(e){return e<this._startLineNumber||e>this._endLineNumber?this._defaultValue:this._values[e-this._startLineNumber]}}class ag extends pe{constructor(e,t){super(e),this._viewDomNode=t;const n=this._context.configuration.options.get(146);this._widgets={},this._verticalScrollbarWidth=n.verticalScrollbarWidth,this._minimapWidth=n.minimap.minimapWidth,this._horizontalScrollbarHeight=n.horizontalScrollbarHeight,this._editorHeight=n.height,this._editorWidth=n.width,this._viewDomNodeRect={top:0,left:0,width:0,height:0},this._domNode=V(document.createElement("div")),Ie.write(this._domNode,4),this._domNode.setClassName("overlayWidgets"),this.overflowingOverlayWidgetsDomNode=V(document.createElement("div")),Ie.write(this.overflowingOverlayWidgetsDomNode,5),this.overflowingOverlayWidgetsDomNode.setClassName("overflowingOverlayWidgets")}dispose(){super.dispose(),this._widgets={}}getDomNode(){return this._domNode}onConfigurationChanged(e){const i=this._context.configuration.options.get(146);return this._verticalScrollbarWidth=i.verticalScrollbarWidth,this._minimapWidth=i.minimap.minimapWidth,this._horizontalScrollbarHeight=i.horizontalScrollbarHeight,this._editorHeight=i.height,this._editorWidth=i.width,!0}addWidget(e){const t=V(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:null,domNode:t},t.setPosition("absolute"),t.setAttribute("widgetId",e.getId()),e.allowEditorOverflow?this.overflowingOverlayWidgetsDomNode.appendChild(t):this._domNode.appendChild(t),this.setShouldRender(),this._updateMaxMinWidth()}setWidgetPosition(e,t){const i=this._widgets[e.getId()],n=t?t.preference:null,s=t==null?void 0:t.stackOridinal;return i.preference===n&&i.stack===s?(this._updateMaxMinWidth(),!1):(i.preference=n,i.stack=s,this.setShouldRender(),this._updateMaxMinWidth(),!0)}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const n=this._widgets[t].domNode.domNode;delete this._widgets[t],n.remove(),this.setShouldRender(),this._updateMaxMinWidth()}}_updateMaxMinWidth(){var i,n;let e=0;const t=Object.keys(this._widgets);for(let s=0,o=t.length;s<o;s++){const r=t[s],l=(n=(i=this._widgets[r].widget).getMinContentWidthInPx)==null?void 0:n.call(i);typeof l<"u"&&(e=Math.max(e,l))}this._context.viewLayout.setOverlayWidgetsMinWidth(e)}_renderWidget(e,t){const i=e.domNode;if(e.preference===null){i.setTop("");return}const n=2*this._verticalScrollbarWidth+this._minimapWidth;if(e.preference===0||e.preference===1){if(e.preference===1){const s=i.domNode.clientHeight;i.setTop(this._editorHeight-s-2*this._horizontalScrollbarHeight)}else i.setTop(0);e.stack!==void 0?(i.setTop(t[e.preference]),t[e.preference]+=i.domNode.clientWidth):i.setRight(n)}else if(e.preference===2)i.domNode.style.right="50%",e.stack!==void 0?(i.setTop(t[2]),t[2]+=i.domNode.clientHeight):i.setTop(0);else{const{top:s,left:o}=e.preference;if(this._context.configuration.options.get(42)&&e.widget.allowEditorOverflow){const d=this._viewDomNodeRect;i.setTop(s+d.top),i.setLeft(o+d.left),i.setPosition("fixed")}else i.setTop(s),i.setLeft(o),i.setPosition("absolute")}}prepareRender(e){this._viewDomNodeRect=Si(this._viewDomNode.domNode)}render(e){this._domNode.setWidth(this._editorWidth);const t=Object.keys(this._widgets),i=Array.from({length:3},()=>0);t.sort((n,s)=>(this._widgets[n].stack||0)-(this._widgets[s].stack||0));for(let n=0,s=t.length;n<s;n++){const o=t[n];this._renderWidget(this._widgets[o],i)}}}class dg{constructor(e,t){const i=e.options;this.lineHeight=i.get(67),this.pixelRatio=i.get(144),this.overviewRulerLanes=i.get(83),this.renderBorder=i.get(82);const n=t.getColor(Ul);this.borderColor=n?n.toString():null,this.hideCursor=i.get(59);const s=t.getColor(aa);this.cursorColorSingle=s?s.transparent(.7).toString():null;const o=t.getColor(da);this.cursorColorPrimary=o?o.transparent(.7).toString():null;const r=t.getColor(la);this.cursorColorSecondary=r?r.transparent(.7).toString():null,this.themeType=t.type;const d=i.get(73),l=d.enabled,h=d.side,c=t.getColor(zl),u=eo.getDefaultBackground();c?this.backgroundColor=c:l&&h==="right"?this.backgroundColor=u:this.backgroundColor=null;const _=i.get(146).overviewRuler;this.top=_.top,this.right=_.right,this.domWidth=_.width,this.domHeight=_.height,this.overviewRulerLanes===0?(this.canvasWidth=0,this.canvasHeight=0):(this.canvasWidth=this.domWidth*this.pixelRatio|0,this.canvasHeight=this.domHeight*this.pixelRatio|0);const[C,w]=this._initLanes(1,this.canvasWidth,this.overviewRulerLanes);this.x=C,this.w=w}_initLanes(e,t,i){const n=t-e;if(i>=3){const s=Math.floor(n/3),o=Math.floor(n/3),r=n-s-o,d=e,l=d+s,h=d+s+r;return[[0,d,l,d,h,d,l,d],[0,s,r,s+r,o,s+r+o,r+o,s+r+o]]}else if(i===2){const s=Math.floor(n/2),o=n-s,r=e,d=r+s;return[[0,r,r,r,d,r,r,r],[0,s,s,s,o,s+o,s+o,s+o]]}else{const s=e,o=n;return[[0,s,s,s,s,s,s,s],[0,o,o,o,o,o,o,o]]}}equals(e){return this.lineHeight===e.lineHeight&&this.pixelRatio===e.pixelRatio&&this.overviewRulerLanes===e.overviewRulerLanes&&this.renderBorder===e.renderBorder&&this.borderColor===e.borderColor&&this.hideCursor===e.hideCursor&&this.cursorColorSingle===e.cursorColorSingle&&this.cursorColorPrimary===e.cursorColorPrimary&&this.cursorColorSecondary===e.cursorColorSecondary&&this.themeType===e.themeType&&hi.equals(this.backgroundColor,e.backgroundColor)&&this.top===e.top&&this.right===e.right&&this.domWidth===e.domWidth&&this.domHeight===e.domHeight&&this.canvasWidth===e.canvasWidth&&this.canvasHeight===e.canvasHeight}}class lg extends pe{constructor(e){super(e),this._actualShouldRender=0,this._renderedDecorations=[],this._renderedCursorPositions=[],this._domNode=V(document.createElement("canvas")),this._domNode.setClassName("decorationsOverviewRuler"),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._domNode.setAttribute("aria-hidden","true"),this._updateSettings(!1),this._tokensColorTrackerListener=eo.onDidChange(t=>{t.changedColorMap&&this._updateSettings(!0)}),this._cursorPositions=[{position:new T(1,1),color:this._settings.cursorColorSingle}]}dispose(){super.dispose(),this._tokensColorTrackerListener.dispose()}_updateSettings(e){const t=new dg(this._context.configuration,this._context.theme);return this._settings&&this._settings.equals(t)?!1:(this._settings=t,this._domNode.setTop(this._settings.top),this._domNode.setRight(this._settings.right),this._domNode.setWidth(this._settings.domWidth),this._domNode.setHeight(this._settings.domHeight),this._domNode.domNode.width=this._settings.canvasWidth,this._domNode.domNode.height=this._settings.canvasHeight,e&&this._render(),!0)}_markRenderingIsNeeded(){return this._actualShouldRender=2,!0}_markRenderingIsMaybeNeeded(){return this._actualShouldRender=1,!0}onConfigurationChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}onCursorStateChanged(e){this._cursorPositions=[];for(let t=0,i=e.selections.length;t<i;t++){let n=this._settings.cursorColorSingle;i>1&&(n=t===0?this._settings.cursorColorPrimary:this._settings.cursorColorSecondary),this._cursorPositions.push({position:e.selections[t].getPosition(),color:n})}return this._cursorPositions.sort((t,i)=>T.compare(t.position,i.position)),this._markRenderingIsMaybeNeeded()}onDecorationsChanged(e){return e.affectsOverviewRuler?this._markRenderingIsMaybeNeeded():!1}onFlushed(e){return this._markRenderingIsNeeded()}onScrollChanged(e){return e.scrollHeightChanged?this._markRenderingIsNeeded():!1}onZonesChanged(e){return this._markRenderingIsNeeded()}onThemeChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}getDomNode(){return this._domNode.domNode}prepareRender(e){}render(e){this._render(),this._actualShouldRender=0}_render(){const e=this._settings.backgroundColor;if(this._settings.overviewRulerLanes===0){this._domNode.setBackgroundColor(e?hi.Format.CSS.formatHexA(e):""),this._domNode.setDisplay("none");return}const t=this._context.viewModel.getAllOverviewRulerDecorations(this._context.theme);if(t.sort(Bo.compareByRenderingProps),this._actualShouldRender===1&&!Bo.equalsArr(this._renderedDecorations,t)&&(this._actualShouldRender=2),this._actualShouldRender===1&&!js(this._renderedCursorPositions,this._cursorPositions,(_,C)=>_.position.lineNumber===C.position.lineNumber&&_.color===C.color)&&(this._actualShouldRender=2),this._actualShouldRender===1)return;this._renderedDecorations=t,this._renderedCursorPositions=this._cursorPositions,this._domNode.setDisplay("block");const i=this._settings.canvasWidth,n=this._settings.canvasHeight,s=this._settings.lineHeight,o=this._context.viewLayout,r=this._context.viewLayout.getScrollHeight(),d=n/r,l=6*this._settings.pixelRatio|0,h=l/2|0,c=this._domNode.domNode.getContext("2d");e?e.isOpaque()?(c.fillStyle=hi.Format.CSS.formatHexA(e),c.fillRect(0,0,i,n)):(c.clearRect(0,0,i,n),c.fillStyle=hi.Format.CSS.formatHexA(e),c.fillRect(0,0,i,n)):c.clearRect(0,0,i,n);const u=this._settings.x,f=this._settings.w;for(const _ of t){const C=_.color,w=_.data;c.fillStyle=C;let p=0,g=0,v=0;for(let m=0,b=w.length/3;m<b;m++){const y=w[3*m],N=w[3*m+1],S=w[3*m+2];let L=o.getVerticalOffsetForLineNumber(N)*d|0,R=(o.getVerticalOffsetForLineNumber(S)+s)*d|0;if(R-L<l){let M=(L+R)/2|0;M<h?M=h:M+h>n&&(M=n-h),L=M-h,R=M+h}L>v+1||y!==p?(m!==0&&c.fillRect(u[p],g,f[p],v-g),p=y,g=L,v=R):R>v&&(v=R)}c.fillRect(u[p],g,f[p],v-g)}if(!this._settings.hideCursor){const _=2*this._settings.pixelRatio|0,C=_/2|0,w=this._settings.x[7],p=this._settings.w[7];let g=-100,v=-100,m=null;for(let b=0,y=this._cursorPositions.length;b<y;b++){const N=this._cursorPositions[b].color;if(!N)continue;const S=this._cursorPositions[b].position;let L=o.getVerticalOffsetForLineNumber(S.lineNumber)*d|0;L<C?L=C:L+C>n&&(L=n-C);const R=L-C,x=R+_;R>v+1||N!==m?(b!==0&&m&&c.fillRect(w,g,p,v-g),g=R,v=x):x>v&&(v=x),m=N,c.fillStyle=N}m&&c.fillRect(w,g,p,v-g)}this._settings.renderBorder&&this._settings.borderColor&&this._settings.overviewRulerLanes>0&&(c.beginPath(),c.lineWidth=1,c.strokeStyle=this._settings.borderColor,c.moveTo(0,0),c.lineTo(0,n),c.moveTo(1,0),c.lineTo(i,0),c.stroke())}}class hg extends Ri{constructor(e,t){super(),this._context=e;const i=this._context.configuration.options;this._domNode=V(document.createElement("canvas")),this._domNode.setClassName(t),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._zoneManager=new $l(n=>this._context.viewLayout.getVerticalOffsetForLineNumber(n)),this._zoneManager.setDOMWidth(0),this._zoneManager.setDOMHeight(0),this._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight()),this._zoneManager.setLineHeight(i.get(67)),this._zoneManager.setPixelRatio(i.get(144)),this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return e.hasChanged(67)&&(this._zoneManager.setLineHeight(t.get(67)),this._render()),e.hasChanged(144)&&(this._zoneManager.setPixelRatio(t.get(144)),this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render()),!0}onFlushed(e){return this._render(),!0}onScrollChanged(e){return e.scrollHeightChanged&&(this._zoneManager.setOuterHeight(e.scrollHeight),this._render()),!0}onZonesChanged(e){return this._render(),!0}getDomNode(){return this._domNode.domNode}setLayout(e){this._domNode.setTop(e.top),this._domNode.setRight(e.right);let t=!1;t=this._zoneManager.setDOMWidth(e.width)||t,t=this._zoneManager.setDOMHeight(e.height)||t,t&&(this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render())}setZones(e){this._zoneManager.setZones(e),this._render()}_render(){if(this._zoneManager.getOuterHeight()===0)return!1;const e=this._zoneManager.getCanvasWidth(),t=this._zoneManager.getCanvasHeight(),i=this._zoneManager.resolveColorZones(),n=this._zoneManager.getId2Color(),s=this._domNode.domNode.getContext("2d");return s.clearRect(0,0,e,t),i.length>0&&this._renderOneLane(s,i,n,e),!0}_renderOneLane(e,t,i,n){let s=0,o=0,r=0;for(const d of t){const l=d.colorId,h=d.from,c=d.to;l!==s?(e.fillRect(0,o,n,r-o),s=l,e.fillStyle=i[s],o=h,r=c):r>=h?r=Math.max(r,c):(e.fillRect(0,o,n,r-o),o=h,r=c)}e.fillRect(0,o,n,r-o)}}class cg extends pe{constructor(e){super(e),this.domNode=V(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("view-rulers"),this._renderedRulers=[];const t=this._context.configuration.options;this._rulers=t.get(103),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth}dispose(){super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._rulers=t.get(103),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onScrollChanged(e){return e.scrollHeightChanged}prepareRender(e){}_ensureRulersCount(){const e=this._renderedRulers.length,t=this._rulers.length;if(e===t)return;if(e<t){const{tabSize:n}=this._context.viewModel.model.getOptions(),s=n;let o=t-e;for(;o>0;){const r=V(document.createElement("div"));r.setClassName("view-ruler"),r.setWidth(s),this.domNode.appendChild(r),this._renderedRulers.push(r),o--}return}let i=e-t;for(;i>0;){const n=this._renderedRulers.pop();this.domNode.removeChild(n),i--}}render(e){this._ensureRulersCount();for(let t=0,i=this._rulers.length;t<i;t++){const n=this._renderedRulers[t],s=this._rulers[t];n.setBoxShadow(s.color?`1px 0 0 0 ${s.color} inset`:""),n.setHeight(Math.min(e.scrollHeight,1e6)),n.setLeft(s.column*this._typicalHalfwidthCharacterWidth)}}}class ug extends pe{constructor(e){super(e),this._scrollTop=0,this._width=0,this._updateWidth(),this._shouldShow=!1;const i=this._context.configuration.options.get(104);this._useShadows=i.useShadows,this._domNode=V(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true")}dispose(){super.dispose()}_updateShouldShow(){const e=this._useShadows&&this._scrollTop>0;return this._shouldShow!==e?(this._shouldShow=e,!0):!1}getDomNode(){return this._domNode}_updateWidth(){const t=this._context.configuration.options.get(146);t.minimap.renderMinimap===0||t.minimap.minimapWidth>0&&t.minimap.minimapLeft===0?this._width=t.width:this._width=t.width-t.verticalScrollbarWidth}onConfigurationChanged(e){const i=this._context.configuration.options.get(104);return this._useShadows=i.useShadows,this._updateWidth(),this._updateShouldShow(),!0}onScrollChanged(e){return this._scrollTop=e.scrollTop,this._updateShouldShow()}prepareRender(e){}render(e){this._domNode.setWidth(this._width),this._domNode.setClassName(this._shouldShow?"scroll-decoration":"")}}class gg{constructor(e){this.left=e.left,this.width=e.width,this.startStyle=null,this.endStyle=null}}class fg{constructor(e,t){this.lineNumber=e,this.ranges=t}}function mg(a){return new gg(a)}function _g(a){return new fg(a.lineNumber,a.ranges.map(mg))}const q=class q extends Lt{constructor(e){super(),this._previousFrameVisibleRangesWithStyle=[],this._context=e;const t=this._context.configuration.options;this._roundedSelection=t.get(102),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,this._selections=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._roundedSelection=t.get(102),this._typicalHalfwidthCharacterWidth=t.get(50).typicalHalfwidthCharacterWidth,!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_visibleRangesHaveGaps(e){for(let t=0,i=e.length;t<i;t++)if(e[t].ranges.length>1)return!0;return!1}_enrichVisibleRangesWithStyle(e,t,i){const n=this._typicalHalfwidthCharacterWidth/4;let s=null,o=null;if(i&&i.length>0&&t.length>0){const r=t[0].lineNumber;if(r===e.startLineNumber)for(let l=0;!s&&l<i.length;l++)i[l].lineNumber===r&&(s=i[l].ranges[0]);const d=t[t.length-1].lineNumber;if(d===e.endLineNumber)for(let l=i.length-1;!o&&l>=0;l--)i[l].lineNumber===d&&(o=i[l].ranges[0]);s&&!s.startStyle&&(s=null),o&&!o.startStyle&&(o=null)}for(let r=0,d=t.length;r<d;r++){const l=t[r].ranges[0],h=l.left,c=l.left+l.width,u={top:0,bottom:0},f={top:0,bottom:0};if(r>0){const _=t[r-1].ranges[0].left,C=t[r-1].ranges[0].left+t[r-1].ranges[0].width;Hi(h-_)<n?u.top=2:h>_&&(u.top=1),Hi(c-C)<n?f.top=2:_<c&&c<C&&(f.top=1)}else s&&(u.top=s.startStyle.top,f.top=s.endStyle.top);if(r+1<d){const _=t[r+1].ranges[0].left,C=t[r+1].ranges[0].left+t[r+1].ranges[0].width;Hi(h-_)<n?u.bottom=2:_<h&&h<C&&(u.bottom=1),Hi(c-C)<n?f.bottom=2:c<C&&(f.bottom=1)}else o&&(u.bottom=o.startStyle.bottom,f.bottom=o.endStyle.bottom);l.startStyle=u,l.endStyle=f}}_getVisibleRangesWithStyle(e,t,i){const s=(t.linesVisibleRangesForRange(e,!0)||[]).map(_g);return!this._visibleRangesHaveGaps(s)&&this._roundedSelection&&this._enrichVisibleRangesWithStyle(t.visibleRange,s,i),s}_createSelectionPiece(e,t,i,n,s){return'<div class="cslr '+i+'" style="top:'+e.toString()+"px;bottom:"+t.toString()+"px;left:"+n.toString()+"px;width:"+s.toString()+'px;"></div>'}_actualRenderOneSelection(e,t,i,n){if(n.length===0)return;const s=!!n[0].ranges[0].startStyle,o=n[0].lineNumber,r=n[n.length-1].lineNumber;for(let d=0,l=n.length;d<l;d++){const h=n[d],c=h.lineNumber,u=c-t,f=i&&c===o?1:0,_=i&&c!==o&&c===r?1:0;let C="",w="";for(let p=0,g=h.ranges.length;p<g;p++){const v=h.ranges[p];if(s){const b=v.startStyle,y=v.endStyle;if(b.top===1||b.bottom===1){C+=this._createSelectionPiece(f,_,q.SELECTION_CLASS_NAME,v.left-q.ROUNDED_PIECE_WIDTH,q.ROUNDED_PIECE_WIDTH);let N=q.EDITOR_BACKGROUND_CLASS_NAME;b.top===1&&(N+=" "+q.SELECTION_TOP_RIGHT),b.bottom===1&&(N+=" "+q.SELECTION_BOTTOM_RIGHT),C+=this._createSelectionPiece(f,_,N,v.left-q.ROUNDED_PIECE_WIDTH,q.ROUNDED_PIECE_WIDTH)}if(y.top===1||y.bottom===1){C+=this._createSelectionPiece(f,_,q.SELECTION_CLASS_NAME,v.left+v.width,q.ROUNDED_PIECE_WIDTH);let N=q.EDITOR_BACKGROUND_CLASS_NAME;y.top===1&&(N+=" "+q.SELECTION_TOP_LEFT),y.bottom===1&&(N+=" "+q.SELECTION_BOTTOM_LEFT),C+=this._createSelectionPiece(f,_,N,v.left+v.width,q.ROUNDED_PIECE_WIDTH)}}let m=q.SELECTION_CLASS_NAME;if(s){const b=v.startStyle,y=v.endStyle;b.top===0&&(m+=" "+q.SELECTION_TOP_LEFT),b.bottom===0&&(m+=" "+q.SELECTION_BOTTOM_LEFT),y.top===0&&(m+=" "+q.SELECTION_TOP_RIGHT),y.bottom===0&&(m+=" "+q.SELECTION_BOTTOM_RIGHT)}w+=this._createSelectionPiece(f,_,m,v.left,v.width)}e[u][0]+=C,e[u][1]+=w}}prepareRender(e){const t=[],i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber;for(let o=i;o<=n;o++){const r=o-i;t[r]=["",""]}const s=[];for(let o=0,r=this._selections.length;o<r;o++){const d=this._selections[o];if(d.isEmpty()){s[o]=null;continue}const l=this._getVisibleRangesWithStyle(d,e,this._previousFrameVisibleRangesWithStyle[o]);s[o]=l,this._actualRenderOneSelection(t,i,this._selections.length>1,l)}this._previousFrameVisibleRangesWithStyle=s,this._renderResult=t.map(([o,r])=>o+r)}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}};q.SELECTION_CLASS_NAME="selected-text",q.SELECTION_TOP_LEFT="top-left-radius",q.SELECTION_BOTTOM_LEFT="bottom-left-radius",q.SELECTION_TOP_RIGHT="top-right-radius",q.SELECTION_BOTTOM_RIGHT="bottom-right-radius",q.EDITOR_BACKGROUND_CLASS_NAME="monaco-editor-background",q.ROUNDED_PIECE_WIDTH=10;let Ls=q;St((a,e)=>{const t=a.getColor(yh);t&&!t.isTransparent()&&e.addRule(`.monaco-editor .view-line span.inline-selected-text { color: ${t}; }`)});function Hi(a){return a<0?-a:a}class xr{constructor(e,t,i,n,s,o,r){this.top=e,this.left=t,this.paddingLeft=i,this.width=n,this.height=s,this.textContent=o,this.textContentClassName=r}}var Ke;(function(a){a[a.Single=0]="Single",a[a.MultiPrimary=1]="MultiPrimary",a[a.MultiSecondary=2]="MultiSecondary"})(Ke||(Ke={}));class Rr{constructor(e,t){this._context=e;const i=this._context.configuration.options,n=i.get(50);this._cursorStyle=i.get(28),this._lineHeight=i.get(67),this._typicalHalfwidthCharacterWidth=n.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(i.get(31),this._typicalHalfwidthCharacterWidth),this._isVisible=!0,this._domNode=V(document.createElement("div")),this._domNode.setClassName(`cursor ${kt}`),this._domNode.setHeight(this._lineHeight),this._domNode.setTop(0),this._domNode.setLeft(0),ge(this._domNode,n),this._domNode.setDisplay("none"),this._position=new T(1,1),this._pluralityClass="",this.setPlurality(t),this._lastRenderedContent="",this._renderData=null}getDomNode(){return this._domNode}getPosition(){return this._position}setPlurality(e){switch(e){default:case Ke.Single:this._pluralityClass="";break;case Ke.MultiPrimary:this._pluralityClass="cursor-primary";break;case Ke.MultiSecondary:this._pluralityClass="cursor-secondary";break}}show(){this._isVisible||(this._domNode.setVisibility("inherit"),this._isVisible=!0)}hide(){this._isVisible&&(this._domNode.setVisibility("hidden"),this._isVisible=!1)}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(50);return this._cursorStyle=t.get(28),this._lineHeight=t.get(67),this._typicalHalfwidthCharacterWidth=i.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(t.get(31),this._typicalHalfwidthCharacterWidth),ge(this._domNode,i),!0}onCursorPositionChanged(e,t){return t?this._domNode.domNode.style.transitionProperty="none":this._domNode.domNode.style.transitionProperty="",this._position=e,!0}_getGraphemeAwarePosition(){const{lineNumber:e,column:t}=this._position,i=this._context.viewModel.getLineContent(e),[n,s]=ud(i,t-1);return[new T(e,n+1),i.substring(n,s)]}_prepareRender(e){let t="",i="";const[n,s]=this._getGraphemeAwarePosition();if(this._cursorStyle===De.Line||this._cursorStyle===De.LineThin){const u=e.visibleRangeForPosition(n);if(!u||u.outsideRenderedLine)return null;const f=G(this._domNode.domNode);let _;this._cursorStyle===De.Line?(_=er(f,this._lineCursorWidth>0?this._lineCursorWidth:2),_>2&&(t=s,i=this._getTokenClassName(n))):_=er(f,1);let C=u.left,w=0;_>=2&&C>=1&&(w=1,C-=w);const p=e.getVerticalOffsetForLineNumber(n.lineNumber)-e.bigNumbersDelta;return new xr(p,C,w,_,this._lineHeight,t,i)}const o=e.linesVisibleRangesForRange(new A(n.lineNumber,n.column,n.lineNumber,n.column+s.length),!1);if(!o||o.length===0)return null;const r=o[0];if(r.outsideRenderedLine||r.ranges.length===0)return null;const d=r.ranges[0],l=s==="	"?this._typicalHalfwidthCharacterWidth:d.width<1?this._typicalHalfwidthCharacterWidth:d.width;this._cursorStyle===De.Block&&(t=s,i=this._getTokenClassName(n));let h=e.getVerticalOffsetForLineNumber(n.lineNumber)-e.bigNumbersDelta,c=this._lineHeight;return(this._cursorStyle===De.Underline||this._cursorStyle===De.UnderlineThin)&&(h+=this._lineHeight-2,c=2),new xr(h,d.left,0,l,c,t,i)}_getTokenClassName(e){const t=this._context.viewModel.getViewLineData(e.lineNumber),i=t.tokens.findTokenIndexAtOffset(e.column-1);return t.tokens.getClassName(i)}prepareRender(e){this._renderData=this._prepareRender(e)}render(e){return this._renderData?(this._lastRenderedContent!==this._renderData.textContent&&(this._lastRenderedContent=this._renderData.textContent,this._domNode.domNode.textContent=this._lastRenderedContent),this._domNode.setClassName(`cursor ${this._pluralityClass} ${kt} ${this._renderData.textContentClassName}`),this._domNode.setDisplay("block"),this._domNode.setTop(this._renderData.top),this._domNode.setLeft(this._renderData.left),this._domNode.setPaddingLeft(this._renderData.paddingLeft),this._domNode.setWidth(this._renderData.width),this._domNode.setLineHeight(this._renderData.height),this._domNode.setHeight(this._renderData.height),{domNode:this._domNode.domNode,position:this._position,contentLeft:this._renderData.left,height:this._renderData.height,width:2}):(this._domNode.setDisplay("none"),null)}}const pi=class pi extends pe{constructor(e){super(e);const t=this._context.configuration.options;this._readOnly=t.get(92),this._cursorBlinking=t.get(26),this._cursorStyle=t.get(28),this._cursorSmoothCaretAnimation=t.get(27),this._selectionIsEmpty=!0,this._isComposingInput=!1,this._isVisible=!1,this._primaryCursor=new Rr(this._context,Ke.Single),this._secondaryCursors=[],this._renderData=[],this._domNode=V(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._updateDomClassName(),this._domNode.appendChild(this._primaryCursor.getDomNode()),this._startCursorBlinkAnimation=new jr,this._cursorFlatBlinkInterval=new Ca,this._blinkingEnabled=!1,this._editorHasFocus=!1,this._updateBlinking()}dispose(){super.dispose(),this._startCursorBlinkAnimation.dispose(),this._cursorFlatBlinkInterval.dispose()}getDomNode(){return this._domNode}onCompositionStart(e){return this._isComposingInput=!0,this._updateBlinking(),!0}onCompositionEnd(e){return this._isComposingInput=!1,this._updateBlinking(),!0}onConfigurationChanged(e){const t=this._context.configuration.options;this._readOnly=t.get(92),this._cursorBlinking=t.get(26),this._cursorStyle=t.get(28),this._cursorSmoothCaretAnimation=t.get(27),this._updateBlinking(),this._updateDomClassName(),this._primaryCursor.onConfigurationChanged(e);for(let i=0,n=this._secondaryCursors.length;i<n;i++)this._secondaryCursors[i].onConfigurationChanged(e);return!0}_onCursorPositionChanged(e,t,i){const n=this._secondaryCursors.length!==t.length||this._cursorSmoothCaretAnimation==="explicit"&&i!==3;if(this._primaryCursor.setPlurality(t.length?Ke.MultiPrimary:Ke.Single),this._primaryCursor.onCursorPositionChanged(e,n),this._updateBlinking(),this._secondaryCursors.length<t.length){const s=t.length-this._secondaryCursors.length;for(let o=0;o<s;o++){const r=new Rr(this._context,Ke.MultiSecondary);this._domNode.domNode.insertBefore(r.getDomNode().domNode,this._primaryCursor.getDomNode().domNode.nextSibling),this._secondaryCursors.push(r)}}else if(this._secondaryCursors.length>t.length){const s=this._secondaryCursors.length-t.length;for(let o=0;o<s;o++)this._domNode.removeChild(this._secondaryCursors[0].getDomNode()),this._secondaryCursors.splice(0,1)}for(let s=0;s<t.length;s++)this._secondaryCursors[s].onCursorPositionChanged(t[s],n)}onCursorStateChanged(e){const t=[];for(let n=0,s=e.selections.length;n<s;n++)t[n]=e.selections[n].getPosition();this._onCursorPositionChanged(t[0],t.slice(1),e.reason);const i=e.selections[0].isEmpty();return this._selectionIsEmpty!==i&&(this._selectionIsEmpty=i,this._updateDomClassName()),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onFocusChanged(e){return this._editorHasFocus=e.isFocused,this._updateBlinking(),!1}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return!0}onTokensChanged(e){const t=i=>{for(let n=0,s=e.ranges.length;n<s;n++)if(e.ranges[n].fromLineNumber<=i.lineNumber&&i.lineNumber<=e.ranges[n].toLineNumber)return!0;return!1};if(t(this._primaryCursor.getPosition()))return!0;for(const i of this._secondaryCursors)if(t(i.getPosition()))return!0;return!1}onZonesChanged(e){return!0}_getCursorBlinking(){return this._isComposingInput||!this._editorHasFocus?0:this._readOnly?5:this._cursorBlinking}_updateBlinking(){this._startCursorBlinkAnimation.cancel(),this._cursorFlatBlinkInterval.cancel();const e=this._getCursorBlinking(),t=e===0,i=e===5;t?this._hide():this._show(),this._blinkingEnabled=!1,this._updateDomClassName(),!t&&!i&&(e===1?this._cursorFlatBlinkInterval.cancelAndSet(()=>{this._isVisible?this._hide():this._show()},pi.BLINK_INTERVAL,G(this._domNode.domNode)):this._startCursorBlinkAnimation.setIfNotSet(()=>{this._blinkingEnabled=!0,this._updateDomClassName()},pi.BLINK_INTERVAL))}_updateDomClassName(){this._domNode.setClassName(this._getClassName())}_getClassName(){let e="cursors-layer";switch(this._selectionIsEmpty||(e+=" has-selection"),this._cursorStyle){case De.Line:e+=" cursor-line-style";break;case De.Block:e+=" cursor-block-style";break;case De.Underline:e+=" cursor-underline-style";break;case De.LineThin:e+=" cursor-line-thin-style";break;case De.BlockOutline:e+=" cursor-block-outline-style";break;case De.UnderlineThin:e+=" cursor-underline-thin-style";break;default:e+=" cursor-line-style"}if(this._blinkingEnabled)switch(this._getCursorBlinking()){case 1:e+=" cursor-blink";break;case 2:e+=" cursor-smooth";break;case 3:e+=" cursor-phase";break;case 4:e+=" cursor-expand";break;case 5:e+=" cursor-solid";break;default:e+=" cursor-solid"}else e+=" cursor-solid";return(this._cursorSmoothCaretAnimation==="on"||this._cursorSmoothCaretAnimation==="explicit")&&(e+=" cursor-smooth-caret-animation"),e}_show(){this._primaryCursor.show();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].show();this._isVisible=!0}_hide(){this._primaryCursor.hide();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].hide();this._isVisible=!1}prepareRender(e){this._primaryCursor.prepareRender(e);for(let t=0,i=this._secondaryCursors.length;t<i;t++)this._secondaryCursors[t].prepareRender(e)}render(e){const t=[];let i=0;const n=this._primaryCursor.render(e);n&&(t[i++]=n);for(let s=0,o=this._secondaryCursors.length;s<o;s++){const r=this._secondaryCursors[s].render(e);r&&(t[i++]=r)}this._renderData=t}getLastRenderData(){return this._renderData}};pi.BLINK_INTERVAL=500;let Ds=pi;St((a,e)=>{const t=[{class:".cursor",foreground:aa,background:Gl},{class:".cursor-primary",foreground:da,background:jl},{class:".cursor-secondary",foreground:la,background:Zl}];for(const i of t){const n=a.getColor(i.foreground);if(n){let s=a.getColor(i.background);s||(s=n.opposite()),e.addRule(`.monaco-editor .cursors-layer ${i.class} { background-color: ${n}; border-color: ${n}; color: ${s}; }`),ui(a.type)&&e.addRule(`.monaco-editor .cursors-layer.has-selection ${i.class} { border-left: 1px solid ${s}; border-right: 1px solid ${s}; }`)}}});const jn=()=>{throw new Error("Invalid change accessor")};class pg extends pe{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(146);this._lineHeight=t.get(67),this._contentWidth=i.contentWidth,this._contentLeft=i.contentLeft,this.domNode=V(document.createElement("div")),this.domNode.setClassName("view-zones"),this.domNode.setPosition("absolute"),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.marginDomNode=V(document.createElement("div")),this.marginDomNode.setClassName("margin-view-zones"),this.marginDomNode.setPosition("absolute"),this.marginDomNode.setAttribute("role","presentation"),this.marginDomNode.setAttribute("aria-hidden","true"),this._zones={}}dispose(){super.dispose(),this._zones={}}_recomputeWhitespacesProps(){const e=this._context.viewLayout.getWhitespaces(),t=new Map;for(const n of e)t.set(n.id,n);let i=!1;return this._context.viewModel.changeWhitespace(n=>{const s=Object.keys(this._zones);for(let o=0,r=s.length;o<r;o++){const d=s[o],l=this._zones[d],h=this._computeWhitespaceProps(l.delegate);l.isInHiddenArea=h.isInHiddenArea;const c=t.get(d);c&&(c.afterLineNumber!==h.afterViewLineNumber||c.height!==h.heightInPx)&&(n.changeOneWhitespace(d,h.afterViewLineNumber,h.heightInPx),this._safeCallOnComputedHeight(l.delegate,h.heightInPx),i=!0)}}),i}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(146);return this._lineHeight=t.get(67),this._contentWidth=i.contentWidth,this._contentLeft=i.contentLeft,e.hasChanged(67)&&this._recomputeWhitespacesProps(),!0}onLineMappingChanged(e){return this._recomputeWhitespacesProps()}onLinesDeleted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}onLinesInserted(e){return!0}_getZoneOrdinal(e){return e.ordinal??e.afterColumn??1e4}_computeWhitespaceProps(e){if(e.afterLineNumber===0)return{isInHiddenArea:!1,afterViewLineNumber:0,heightInPx:this._heightInPixels(e),minWidthInPx:this._minWidthInPixels(e)};let t;if(typeof e.afterColumn<"u")t=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:e.afterColumn});else{const o=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:1}).lineNumber;t=new T(o,this._context.viewModel.model.getLineMaxColumn(o))}let i;t.column===this._context.viewModel.model.getLineMaxColumn(t.lineNumber)?i=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber+1,column:1}):i=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber,column:t.column+1});const n=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t,e.afterColumnAffinity,!0),s=e.showInHiddenAreas||this._context.viewModel.coordinatesConverter.modelPositionIsVisible(i);return{isInHiddenArea:!s,afterViewLineNumber:n.lineNumber,heightInPx:s?this._heightInPixels(e):0,minWidthInPx:this._minWidthInPixels(e)}}changeViewZones(e){let t=!1;return this._context.viewModel.changeWhitespace(i=>{const n={addZone:s=>(t=!0,this._addZone(i,s)),removeZone:s=>{s&&(t=this._removeZone(i,s)||t)},layoutZone:s=>{s&&(t=this._layoutZone(i,s)||t)}};vg(e,n),n.addZone=jn,n.removeZone=jn,n.layoutZone=jn}),t}_addZone(e,t){const i=this._computeWhitespaceProps(t),s={whitespaceId:e.insertWhitespace(i.afterViewLineNumber,this._getZoneOrdinal(t),i.heightInPx,i.minWidthInPx),delegate:t,isInHiddenArea:i.isInHiddenArea,isVisible:!1,domNode:V(t.domNode),marginDomNode:t.marginDomNode?V(t.marginDomNode):null};return this._safeCallOnComputedHeight(s.delegate,i.heightInPx),s.domNode.setPosition("absolute"),s.domNode.domNode.style.width="100%",s.domNode.setDisplay("none"),s.domNode.setAttribute("monaco-view-zone",s.whitespaceId),this.domNode.appendChild(s.domNode),s.marginDomNode&&(s.marginDomNode.setPosition("absolute"),s.marginDomNode.domNode.style.width="100%",s.marginDomNode.setDisplay("none"),s.marginDomNode.setAttribute("monaco-view-zone",s.whitespaceId),this.marginDomNode.appendChild(s.marginDomNode)),this._zones[s.whitespaceId]=s,this.setShouldRender(),s.whitespaceId}_removeZone(e,t){if(this._zones.hasOwnProperty(t)){const i=this._zones[t];return delete this._zones[t],e.removeWhitespace(i.whitespaceId),i.domNode.removeAttribute("monaco-visible-view-zone"),i.domNode.removeAttribute("monaco-view-zone"),i.domNode.domNode.remove(),i.marginDomNode&&(i.marginDomNode.removeAttribute("monaco-visible-view-zone"),i.marginDomNode.removeAttribute("monaco-view-zone"),i.marginDomNode.domNode.remove()),this.setShouldRender(),!0}return!1}_layoutZone(e,t){if(this._zones.hasOwnProperty(t)){const i=this._zones[t],n=this._computeWhitespaceProps(i.delegate);return i.isInHiddenArea=n.isInHiddenArea,e.changeOneWhitespace(i.whitespaceId,n.afterViewLineNumber,n.heightInPx),this._safeCallOnComputedHeight(i.delegate,n.heightInPx),this.setShouldRender(),!0}return!1}shouldSuppressMouseDownOnViewZone(e){return this._zones.hasOwnProperty(e)?!!this._zones[e].delegate.suppressMouseDown:!1}_heightInPixels(e){return typeof e.heightInPx=="number"?e.heightInPx:typeof e.heightInLines=="number"?this._lineHeight*e.heightInLines:this._lineHeight}_minWidthInPixels(e){return typeof e.minWidthInPx=="number"?e.minWidthInPx:0}_safeCallOnComputedHeight(e,t){if(typeof e.onComputedHeight=="function")try{e.onComputedHeight(t)}catch(i){xe(i)}}_safeCallOnDomNodeTop(e,t){if(typeof e.onDomNodeTop=="function")try{e.onDomNodeTop(t)}catch(i){xe(i)}}prepareRender(e){}render(e){const t=e.viewportData.whitespaceViewportData,i={};let n=!1;for(const o of t)this._zones[o.id].isInHiddenArea||(i[o.id]=o,n=!0);const s=Object.keys(this._zones);for(let o=0,r=s.length;o<r;o++){const d=s[o],l=this._zones[d];let h=0,c=0,u="none";i.hasOwnProperty(d)?(h=i[d].verticalOffset-e.bigNumbersDelta,c=i[d].height,u="block",l.isVisible||(l.domNode.setAttribute("monaco-visible-view-zone","true"),l.isVisible=!0),this._safeCallOnDomNodeTop(l.delegate,e.getScrolledTopFromAbsoluteTop(i[d].verticalOffset))):(l.isVisible&&(l.domNode.removeAttribute("monaco-visible-view-zone"),l.isVisible=!1),this._safeCallOnDomNodeTop(l.delegate,e.getScrolledTopFromAbsoluteTop(-1e6))),l.domNode.setTop(h),l.domNode.setHeight(c),l.domNode.setDisplay(u),l.marginDomNode&&(l.marginDomNode.setTop(h),l.marginDomNode.setHeight(c),l.marginDomNode.setDisplay(u))}n&&(this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth)),this.marginDomNode.setWidth(this._contentLeft))}}function vg(a,e){try{return a(e)}catch(t){xe(t)}}class Cg extends Lt{constructor(e){super(),this._context=e,this._options=new Er(this._context.configuration),this._selection=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=new Er(this._context.configuration);return this._options.equals(t)?e.hasChanged(146):(this._options=t,!0)}onCursorStateChanged(e){return this._selection=e.selections,this._options.renderWhitespace==="selection"}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}prepareRender(e){if(this._options.renderWhitespace==="none"){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber-t+1,s=new Array(n);for(let r=0;r<n;r++)s[r]=!0;const o=this._context.viewModel.getMinimapLinesRenderingData(e.viewportData.startLineNumber,e.viewportData.endLineNumber,s);this._renderResult=[];for(let r=e.viewportData.startLineNumber;r<=e.viewportData.endLineNumber;r++){const d=r-e.viewportData.startLineNumber,l=o.data[d];let h=null;if(this._options.renderWhitespace==="selection"){const c=this._selection;for(const u of c){if(u.endLineNumber<r||u.startLineNumber>r)continue;const f=u.startLineNumber===r?u.startColumn:l.minColumn,_=u.endLineNumber===r?u.endColumn:l.maxColumn;f<_&&(h||(h=[]),h.push(new sa(f-1,_-1)))}}this._renderResult[d]=this._applyRenderWhitespace(e,r,h,l)}}_applyRenderWhitespace(e,t,i,n){if(this._options.renderWhitespace==="selection"&&!i||this._options.renderWhitespace==="trailing"&&n.continuesWithWrappedLine)return"";const s=this._context.theme.getColor(Kl),o=this._options.renderWithSVG,r=n.content,d=this._options.stopRenderingLineAfter===-1?r.length:Math.min(this._options.stopRenderingLineAfter,r.length),l=n.continuesWithWrappedLine,h=n.minColumn-1,c=this._options.renderWhitespace==="boundary",u=this._options.renderWhitespace==="trailing",f=this._options.lineHeight,_=this._options.middotWidth,C=this._options.wsmiddotWidth,w=this._options.spaceWidth,p=Math.abs(C-w),g=Math.abs(_-w),v=p<g?11825:183,m=this._options.canUseHalfwidthRightwardsArrow;let b="",y=!1,N=Xr(r),S;N===-1?(y=!0,N=d,S=d):S=gd(r);let L=0,R=i&&i[L],x=0;for(let M=h;M<d;M++){const P=r.charCodeAt(M);if(R&&M>=R.endOffset&&(L++,R=i&&i[L]),P!==9&&P!==32||u&&!y&&M<=S)continue;if(c&&M>=N&&M<=S&&P===32){const B=M-1>=0?r.charCodeAt(M-1):0,j=M+1<d?r.charCodeAt(M+1):0;if(B!==32&&j!==32)continue}if(c&&l&&M===d-1){const B=M-1>=0?r.charCodeAt(M-1):0;if(P===32&&B!==32&&B!==9)continue}if(i&&(!R||R.startOffset>M||R.endOffset<=M))continue;const z=e.visibleRangeForPosition(new T(t,M+1));z&&(o?(x=Math.max(x,z.left),P===9?b+=this._renderArrow(f,w,z.left):b+=`<circle cx="${(z.left+w/2).toFixed(2)}" cy="${(f/2).toFixed(2)}" r="${(w/7).toFixed(2)}" />`):P===9?b+=`<div class="mwh" style="left:${z.left}px;height:${f}px;">${m?"￫":"→"}</div>`:b+=`<div class="mwh" style="left:${z.left}px;height:${f}px;">${String.fromCharCode(v)}</div>`)}return o?(x=Math.round(x+w),`<svg style="bottom:0;position:absolute;width:${x}px;height:${f}px" viewBox="0 0 ${x} ${f}" xmlns="http://www.w3.org/2000/svg" fill="${s}">`+b+"</svg>"):b}_renderArrow(e,t,i){const n=t/7,s=t,o=e/2,r=i,d={x:0,y:n/2},l={x:100/125*s,y:d.y},h={x:l.x-.2*l.x,y:l.y+.2*l.x},c={x:h.x+.1*l.x,y:h.y+.1*l.x},u={x:c.x+.35*l.x,y:c.y-.35*l.x},f={x:u.x,y:-u.y},_={x:c.x,y:-c.y},C={x:h.x,y:-h.y},w={x:l.x,y:-l.y},p={x:d.x,y:-d.y};return`<path d="M ${[d,l,h,c,u,f,_,C,w,p].map(m=>`${(r+m.x).toFixed(2)} ${(o+m.y).toFixed(2)}`).join(" L ")}" />`}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}class Er{constructor(e){const t=e.options,i=t.get(50),n=t.get(38);n==="off"?(this.renderWhitespace="none",this.renderWithSVG=!1):n==="svg"?(this.renderWhitespace=t.get(100),this.renderWithSVG=!0):(this.renderWhitespace=t.get(100),this.renderWithSVG=!1),this.spaceWidth=i.spaceWidth,this.middotWidth=i.middotWidth,this.wsmiddotWidth=i.wsmiddotWidth,this.canUseHalfwidthRightwardsArrow=i.canUseHalfwidthRightwardsArrow,this.lineHeight=t.get(67),this.stopRenderingLineAfter=t.get(118)}equals(e){return this.renderWhitespace===e.renderWhitespace&&this.renderWithSVG===e.renderWithSVG&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter}}var wg=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},bg=function(a,e){return function(t,i){e(t,i,a)}};let Ns=class extends Ri{constructor(e,t,i,n,s,o,r){super(),this._instantiationService=r,this._shouldRecomputeGlyphMarginLanes=!1,this._selections=[new we(1,1,1,1)],this._renderAnimationFrame=null;const d=new Ou(t,n,s,e);this._context=new Yl(t,i,n),this._context.addEventHandler(this),this._viewParts=[],this._textAreaHandler=this._instantiationService.createInstance(Cs,this._context,d,this._createTextAreaHandlerHelper()),this._viewParts.push(this._textAreaHandler),this._linesContent=V(document.createElement("div")),this._linesContent.setClassName("lines-content monaco-editor-background"),this._linesContent.setPosition("absolute"),this.domNode=V(document.createElement("div")),this.domNode.setClassName(this._getEditorClassName()),this.domNode.setAttribute("role","code"),this._overflowGuardContainer=V(document.createElement("div")),Ie.write(this._overflowGuardContainer,3),this._overflowGuardContainer.setClassName("overflow-guard"),this._scrollbar=new zu(this._context,this._linesContent,this.domNode,this._overflowGuardContainer),this._viewParts.push(this._scrollbar),this._viewLines=new Ss(this._context,this._linesContent),this._viewZones=new pg(this._context),this._viewParts.push(this._viewZones);const l=new lg(this._context);this._viewParts.push(l);const h=new ug(this._context);this._viewParts.push(h);const c=new Pu(this._context);this._viewParts.push(c),c.addDynamicOverlay(new Vu(this._context)),c.addDynamicOverlay(new Ls(this._context)),c.addDynamicOverlay(new qu(this._context)),c.addDynamicOverlay(new Uu(this._context)),c.addDynamicOverlay(new Cg(this._context));const u=new Wu(this._context);this._viewParts.push(u),u.addDynamicOverlay(new Bu(this._context)),u.addDynamicOverlay(new tg(this._context)),u.addDynamicOverlay(new eg(this._context)),u.addDynamicOverlay(new Ji(this._context)),this._glyphMarginWidgets=new ju(this._context),this._viewParts.push(this._glyphMarginWidgets);const f=new en(this._context);f.getDomNode().appendChild(this._viewZones.marginDomNode),f.getDomNode().appendChild(u.getDomNode()),f.getDomNode().appendChild(this._glyphMarginWidgets.domNode),this._viewParts.push(f),this._contentWidgets=new ku(this._context,this.domNode),this._viewParts.push(this._contentWidgets),this._viewCursors=new Ds(this._context),this._viewParts.push(this._viewCursors),this._overlayWidgets=new ag(this._context,this.domNode),this._viewParts.push(this._overlayWidgets);const _=new cg(this._context);this._viewParts.push(_);const C=new Hu(this._context);this._viewParts.push(C);const w=new rg(this._context);if(this._viewParts.push(w),l){const p=this._scrollbar.getOverviewRulerLayoutInfo();p.parent.insertBefore(l.getDomNode(),p.insertBefore)}this._linesContent.appendChild(c.getDomNode()),this._linesContent.appendChild(_.domNode),this._linesContent.appendChild(this._viewZones.domNode),this._linesContent.appendChild(this._viewLines.getDomNode()),this._linesContent.appendChild(this._contentWidgets.domNode),this._linesContent.appendChild(this._viewCursors.getDomNode()),this._overflowGuardContainer.appendChild(f.getDomNode()),this._overflowGuardContainer.appendChild(this._scrollbar.getDomNode()),this._overflowGuardContainer.appendChild(h.getDomNode()),this._overflowGuardContainer.appendChild(this._textAreaHandler.textArea),this._overflowGuardContainer.appendChild(this._textAreaHandler.textAreaCover),this._overflowGuardContainer.appendChild(this._overlayWidgets.getDomNode()),this._overflowGuardContainer.appendChild(w.getDomNode()),this._overflowGuardContainer.appendChild(C.domNode),this.domNode.appendChild(this._overflowGuardContainer),o?(o.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode.domNode),o.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode.domNode)):(this.domNode.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode),this.domNode.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode)),this._applyLayout(),this._pointerHandler=this._register(new xu(this._context,d,this._createPointerHandlerHelper()))}_computeGlyphMarginLanes(){const e=this._context.viewModel.model,t=this._context.viewModel.glyphLanes;let i=[],n=0;i=i.concat(e.getAllMarginDecorations().map(s=>{var r,d;const o=((r=s.options.glyphMargin)==null?void 0:r.position)??to.Center;return n=Math.max(n,s.range.endLineNumber),{range:s.range,lane:o,persist:(d=s.options.glyphMargin)==null?void 0:d.persistLane}})),i=i.concat(this._glyphMarginWidgets.getWidgets().map(s=>{const o=e.validateRange(s.preference.range);return n=Math.max(n,o.endLineNumber),{range:o,lane:s.preference.lane}})),i.sort((s,o)=>A.compareRangesUsingStarts(s.range,o.range)),t.reset(n);for(const s of i)t.push(s.lane,s.range,s.persist);return t}_createPointerHandlerHelper(){return{viewDomNode:this.domNode.domNode,linesContentDomNode:this._linesContent.domNode,viewLinesDomNode:this._viewLines.getDomNode().domNode,focusTextArea:()=>{this.focus()},dispatchTextAreaEvent:e=>{this._textAreaHandler.textArea.domNode.dispatchEvent(e)},getLastRenderData:()=>{const e=this._viewCursors.getLastRenderData()||[],t=this._textAreaHandler.getLastRenderData();return new mu(e,t)},renderNow:()=>{this.render(!0,!1)},shouldSuppressMouseDownOnViewZone:e=>this._viewZones.shouldSuppressMouseDownOnViewZone(e),shouldSuppressMouseDownOnWidget:e=>this._contentWidgets.shouldSuppressMouseDownOnWidget(e),getPositionFromDOMInfo:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getPositionFromDOMInfo(e,t)),visibleRangeForPosition:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(new T(e,t))),getLineWidth:e=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getLineWidth(e))}}_createTextAreaHandlerHelper(){return{visibleRangeForPosition:e=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(e))}}_applyLayout(){const t=this._context.configuration.options.get(146);this.domNode.setWidth(t.width),this.domNode.setHeight(t.height),this._overflowGuardContainer.setWidth(t.width),this._overflowGuardContainer.setHeight(t.height),this._linesContent.setWidth(16777216),this._linesContent.setHeight(16777216)}_getEditorClassName(){const e=this._textAreaHandler.isFocused()?" focused":"";return this._context.configuration.options.get(143)+" "+is(this._context.theme.type)+e}handleEvents(e){super.handleEvents(e),this._scheduleRender()}onConfigurationChanged(e){return this.domNode.setClassName(this._getEditorClassName()),this._applyLayout(),!1}onCursorStateChanged(e){return this._selections=e.selections,!1}onDecorationsChanged(e){return e.affectsGlyphMargin&&(this._shouldRecomputeGlyphMarginLanes=!0),!1}onFocusChanged(e){return this.domNode.setClassName(this._getEditorClassName()),!1}onThemeChanged(e){return this._context.theme.update(e.theme),this.domNode.setClassName(this._getEditorClassName()),!1}dispose(){this._renderAnimationFrame!==null&&(this._renderAnimationFrame.dispose(),this._renderAnimationFrame=null),this._contentWidgets.overflowingContentWidgetsDomNode.domNode.remove(),this._context.removeEventHandler(this),this._viewLines.dispose();for(const e of this._viewParts)e.dispose();super.dispose()}_scheduleRender(){var e;if(this._store.isDisposed)throw new et;if(this._renderAnimationFrame===null){const t=this._createCoordinatedRendering();this._renderAnimationFrame=Ms.INSTANCE.scheduleCoordinatedRendering({window:G((e=this.domNode)==null?void 0:e.domNode),prepareRenderText:()=>{if(this._store.isDisposed)throw new et;try{return t.prepareRenderText()}finally{this._renderAnimationFrame=null}},renderText:()=>{if(this._store.isDisposed)throw new et;return t.renderText()},prepareRender:(i,n)=>{if(this._store.isDisposed)throw new et;return t.prepareRender(i,n)},render:(i,n)=>{if(this._store.isDisposed)throw new et;return t.render(i,n)}})}}_flushAccumulatedAndRenderNow(){const e=this._createCoordinatedRendering();it(()=>e.prepareRenderText());const t=it(()=>e.renderText());if(t){const[i,n]=t;it(()=>e.prepareRender(i,n)),it(()=>e.render(i,n))}}_getViewPartsToRender(){const e=[];let t=0;for(const i of this._viewParts)i.shouldRender()&&(e[t++]=i);return e}_createCoordinatedRendering(){return{prepareRenderText:()=>{if(this._shouldRecomputeGlyphMarginLanes){this._shouldRecomputeGlyphMarginLanes=!1;const e=this._computeGlyphMarginLanes();this._context.configuration.setGlyphMarginDecorationLaneCount(e.requiredLanes)}Et.onRenderStart()},renderText:()=>{if(!this.domNode.domNode.isConnected)return null;let e=this._getViewPartsToRender();if(!this._viewLines.shouldRender()&&e.length===0)return null;const t=this._context.viewLayout.getLinesViewportData();this._context.viewModel.setViewport(t.startLineNumber,t.endLineNumber,t.centeredLineNumber);const i=new ql(this._selections,t,this._context.viewLayout.getWhitespaceViewportData(),this._context.viewModel);return this._contentWidgets.shouldRender()&&this._contentWidgets.onBeforeRender(i),this._viewLines.shouldRender()&&(this._viewLines.renderText(i),this._viewLines.onDidRender(),e=this._getViewPartsToRender()),[e,new du(this._context.viewLayout,i,this._viewLines)]},prepareRender:(e,t)=>{for(const i of e)i.prepareRender(t)},render:(e,t)=>{for(const i of e)i.render(t),i.onDidRender()}}}delegateVerticalScrollbarPointerDown(e){this._scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this._scrollbar.delegateScrollFromMouseWheelEvent(e)}restoreState(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft},1),this._context.viewModel.visibleLinesStabilized()}getOffsetForColumn(e,t){const i=this._context.viewModel.model.validatePosition({lineNumber:e,column:t}),n=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i);this._flushAccumulatedAndRenderNow();const s=this._viewLines.visibleRangeForPosition(new T(n.lineNumber,n.column));return s?s.left:-1}getTargetAtClientPoint(e,t){const i=this._pointerHandler.getTargetAtClientPoint(e,t);return i?Vn.convertViewToModelMouseTarget(i,this._context.viewModel.coordinatesConverter):null}createOverviewRuler(e){return new hg(this._context,e)}change(e){this._viewZones.changeViewZones(e),this._scheduleRender()}render(e,t){if(t){this._viewLines.forceShouldRender();for(const i of this._viewParts)i.forceShouldRender()}e?this._flushAccumulatedAndRenderNow():this._scheduleRender()}writeScreenReaderContent(e){this._textAreaHandler.writeScreenReaderContent(e)}focus(){this._textAreaHandler.focusTextArea()}isFocused(){return this._textAreaHandler.isFocused()}setAriaOptions(e){this._textAreaHandler.setAriaOptions(e)}addContentWidget(e){this._contentWidgets.addWidget(e.widget),this.layoutContentWidget(e),this._scheduleRender()}layoutContentWidget(e){var t,i,n,s;this._contentWidgets.setWidgetPosition(e.widget,((t=e.position)==null?void 0:t.position)??null,((i=e.position)==null?void 0:i.secondaryPosition)??null,((n=e.position)==null?void 0:n.preference)??null,((s=e.position)==null?void 0:s.positionAffinity)??null),this._scheduleRender()}removeContentWidget(e){this._contentWidgets.removeWidget(e.widget),this._scheduleRender()}addOverlayWidget(e){this._overlayWidgets.addWidget(e.widget),this.layoutOverlayWidget(e),this._scheduleRender()}layoutOverlayWidget(e){this._overlayWidgets.setWidgetPosition(e.widget,e.position)&&this._scheduleRender()}removeOverlayWidget(e){this._overlayWidgets.removeWidget(e.widget),this._scheduleRender()}addGlyphMarginWidget(e){this._glyphMarginWidgets.addWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}layoutGlyphMarginWidget(e){const t=e.position;this._glyphMarginWidgets.setWidgetPosition(e.widget,t)&&(this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender())}removeGlyphMarginWidget(e){this._glyphMarginWidgets.removeWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}};Ns=wg([bg(6,me)],Ns);function it(a){try{return a()}catch(e){return xe(e),null}}const vn=class vn{constructor(){this._coordinatedRenderings=[],this._animationFrameRunners=new Map}scheduleCoordinatedRendering(e){return this._coordinatedRenderings.push(e),this._scheduleRender(e.window),{dispose:()=>{const t=this._coordinatedRenderings.indexOf(e);if(t!==-1&&(this._coordinatedRenderings.splice(t,1),this._coordinatedRenderings.length===0)){for(const[i,n]of this._animationFrameRunners)n.dispose();this._animationFrameRunners.clear()}}}}_scheduleRender(e){if(!this._animationFrameRunners.has(e)){const t=()=>{this._animationFrameRunners.delete(e),this._onRenderScheduled()};this._animationFrameRunners.set(e,rc(e,t,100))}}_onRenderScheduled(){const e=this._coordinatedRenderings.slice(0);this._coordinatedRenderings=[];for(const i of e)it(()=>i.prepareRenderText());const t=[];for(let i=0,n=e.length;i<n;i++){const s=e[i];t[i]=it(()=>s.renderText())}for(let i=0,n=e.length;i<n;i++){const s=e[i],o=t[i];if(!o)continue;const[r,d]=o;it(()=>s.prepareRender(r,d))}for(let i=0,n=e.length;i<n;i++){const s=e[i],o=t[i];if(!o)continue;const[r,d]=o;it(()=>s.render(r,d))}}};vn.INSTANCE=new vn;let Ms=vn;const Zn=oo("domLineBreaksComputer",{createHTML:a=>a});class po{static create(e){return new po(new WeakRef(e))}constructor(e){this.targetWindow=e}createLineBreaksComputer(e,t,i,n,s){const o=[],r=[];return{addRequest:(d,l,h)=>{o.push(d),r.push(l)},finalize:()=>yg(fd(this.targetWindow.deref()),o,e,t,i,n,s,r)}}}function yg(a,e,t,i,n,s,o,r){function d(L){const R=r[L];if(R){const x=Uo.applyInjectedText(e[L],R),M=R.map(z=>z.options),P=R.map(z=>z.column-1);return new zo(P,M,[x.length],[],0)}else return null}if(n===-1){const L=[];for(let R=0,x=e.length;R<x;R++)L[R]=d(R);return L}const l=Math.round(n*t.typicalHalfwidthCharacterWidth),c=Math.round(i*(s===3?2:s===2?1:0)),u=Math.ceil(t.spaceWidth*c),f=document.createElement("div");ge(f,t);const _=new ra(1e4),C=[],w=[],p=[],g=[],v=[];for(let L=0;L<e.length;L++){const R=Uo.applyInjectedText(e[L],r[L]);let x=0,M=0,P=l;if(s!==0)if(x=Xr(R),x===-1)x=0;else{for(let ie=0;ie<x;ie++){const ne=R.charCodeAt(ie)===9?i-M%i:1;M+=ne}const j=Math.ceil(t.spaceWidth*M);j+t.typicalFullwidthCharacterWidth>l?(x=0,M=0):P=l-j}const z=R.substr(x),B=Sg(z,M,i,P,_,u);C[L]=x,w[L]=M,p[L]=z,g[L]=B[0],v[L]=B[1]}const m=_.build(),b=(Zn==null?void 0:Zn.createHTML(m))??m;f.innerHTML=b,f.style.position="absolute",f.style.top="10000",o==="keepAll"?(f.style.wordBreak="keep-all",f.style.overflowWrap="anywhere"):(f.style.wordBreak="inherit",f.style.overflowWrap="break-word"),a.document.body.appendChild(f);const y=document.createRange(),N=Array.prototype.slice.call(f.children,0),S=[];for(let L=0;L<e.length;L++){const R=N[L],x=Lg(y,R,p[L],g[L]);if(x===null){S[L]=d(L);continue}const M=C[L],P=w[L]+c,z=v[L],B=[];for(let Y=0,Pe=x.length;Y<Pe;Y++)B[Y]=z[x[Y]];if(M!==0)for(let Y=0,Pe=x.length;Y<Pe;Y++)x[Y]+=M;let j,ie;const ne=r[L];ne?(j=ne.map(Y=>Y.options),ie=ne.map(Y=>Y.column-1)):(j=null,ie=null),S[L]=new zo(ie,j,x,B,P)}return f.remove(),S}function Sg(a,e,t,i,n,s){if(s!==0){const u=String(s);n.appendString('<div style="text-indent: -'),n.appendString(u),n.appendString("px; padding-left: "),n.appendString(u),n.appendString("px; box-sizing: border-box; width:")}else n.appendString('<div style="width:');n.appendString(String(i)),n.appendString('px;">');const o=a.length;let r=e,d=0;const l=[],h=[];let c=0<o?a.charCodeAt(0):0;n.appendString("<span>");for(let u=0;u<o;u++){u!==0&&u%16384===0&&n.appendString("</span><span>"),l[u]=d,h[u]=r;const f=c;c=u+1<o?a.charCodeAt(u+1):0;let _=1,C=1;switch(f){case 9:_=t-r%t,C=_;for(let w=1;w<=_;w++)w<_?n.appendCharCode(160):n.appendASCIICharCode(32);break;case 32:c===32?n.appendCharCode(160):n.appendASCIICharCode(32);break;case 60:n.appendString("&lt;");break;case 62:n.appendString("&gt;");break;case 38:n.appendString("&amp;");break;case 0:n.appendString("&#00;");break;case 65279:case 8232:case 8233:case 133:n.appendCharCode(65533);break;default:es(f)&&C++,f<32?n.appendCharCode(9216+f):n.appendCharCode(f)}d+=_,r+=C}return n.appendString("</span>"),l[a.length]=d,h[a.length]=r,n.appendString("</div>"),[l,h]}function Lg(a,e,t,i){if(t.length<=1)return null;const n=Array.prototype.slice.call(e.children,0),s=[];try{xs(a,n,i,0,null,t.length-1,null,s)}catch(o){return console.log(o),null}return s.length===0?null:(s.push(t.length),s)}function xs(a,e,t,i,n,s,o,r){if(i===s||(n=n||Kn(a,e,t[i],t[i+1]),o=o||Kn(a,e,t[s],t[s+1]),Math.abs(n[0].top-o[0].top)<=.1))return;if(i+1===s){r.push(s);return}const d=i+(s-i)/2|0,l=Kn(a,e,t[d],t[d+1]);xs(a,e,t,i,n,d,l,r),xs(a,e,t,d,l,s,o,r)}function Kn(a,e,t,i){return a.setStart(e[t/16384|0].firstChild,t%16384),a.setEnd(e[i/16384|0].firstChild,i%16384),a.getClientRects()}class Dg extends U{constructor(){super(),this._editor=null,this._instantiationService=null,this._instances=this._register(new md),this._pending=new Map,this._finishedInstantiation=[],this._finishedInstantiation[0]=!1,this._finishedInstantiation[1]=!1,this._finishedInstantiation[2]=!1,this._finishedInstantiation[3]=!1}initialize(e,t,i){this._editor=e,this._instantiationService=i;for(const n of t){if(this._pending.has(n.id)){xe(new Error(`Cannot have two contributions with the same id ${n.id}`));continue}this._pending.set(n.id,n)}this._instantiateSome(0),this._register(Pi(G(this._editor.getDomNode()),()=>{this._instantiateSome(1)})),this._register(Pi(G(this._editor.getDomNode()),()=>{this._instantiateSome(2)})),this._register(Pi(G(this._editor.getDomNode()),()=>{this._instantiateSome(3)},5e3))}saveViewState(){const e={};for(const[t,i]of this._instances)typeof i.saveViewState=="function"&&(e[t]=i.saveViewState());return e}restoreViewState(e){for(const[t,i]of this._instances)typeof i.restoreViewState=="function"&&i.restoreViewState(e[t])}get(e){return this._instantiateById(e),this._instances.get(e)||null}onBeforeInteractionEvent(){this._instantiateSome(2)}onAfterModelAttached(){var e;return Pi(G((e=this._editor)==null?void 0:e.getDomNode()),()=>{this._instantiateSome(1)},50)}_instantiateSome(e){if(this._finishedInstantiation[e])return;this._finishedInstantiation[e]=!0;const t=this._findPendingContributionsByInstantiation(e);for(const i of t)this._instantiateById(i.id)}_findPendingContributionsByInstantiation(e){const t=[];for(const[,i]of this._pending)i.instantiation===e&&t.push(i);return t}_instantiateById(e){const t=this._pending.get(e);if(t){if(this._pending.delete(e),!this._instantiationService||!this._editor)throw new Error("Cannot instantiate contributions before being initialized!");try{const i=this._instantiationService.createInstance(t.ctor,this._editor);this._instances.set(t.id,i),typeof i.restoreViewState=="function"&&t.instantiation!==0&&console.warn(`Editor contribution '${t.id}' should be eager instantiated because it uses saveViewState / restoreViewState.`)}catch(i){xe(i)}}}}var Ng=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},ze=function(a,e){return function(t,i){e(t,i,a)}},rt,_t;let nn=(_t=class extends U{get isSimpleWidget(){return this._configuration.isSimpleWidget}get contextMenuId(){return this._configuration.contextMenuId}constructor(e,t,i,n,s,o,r,d,l,h,c,u){super(),this.languageConfigurationService=c,this._deliveryQueue=_d(),this._contributions=this._register(new Dg),this._onDidDispose=this._register(new W),this.onDidDispose=this._onDidDispose.event,this._onDidChangeModelContent=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelContent=this._onDidChangeModelContent.event,this._onDidChangeModelLanguage=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguage=this._onDidChangeModelLanguage.event,this._onDidChangeModelLanguageConfiguration=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguageConfiguration=this._onDidChangeModelLanguageConfiguration.event,this._onDidChangeModelOptions=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelOptions=this._onDidChangeModelOptions.event,this._onDidChangeModelDecorations=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelDecorations=this._onDidChangeModelDecorations.event,this._onDidChangeModelTokens=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelTokens=this._onDidChangeModelTokens.event,this._onDidChangeConfiguration=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeModel=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onWillChangeModel=this._onWillChangeModel.event,this._onDidChangeModel=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeModel=this._onDidChangeModel.event,this._onDidChangeCursorPosition=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorPosition=this._onDidChangeCursorPosition.event,this._onDidChangeCursorSelection=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorSelection=this._onDidChangeCursorSelection.event,this._onDidAttemptReadOnlyEdit=this._register(new ae(this._contributions,this._deliveryQueue)),this.onDidAttemptReadOnlyEdit=this._onDidAttemptReadOnlyEdit.event,this._onDidLayoutChange=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidLayoutChange=this._onDidLayoutChange.event,this._editorTextFocus=this._register(new Tr({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorText=this._editorTextFocus.onDidChangeToTrue,this.onDidBlurEditorText=this._editorTextFocus.onDidChangeToFalse,this._editorWidgetFocus=this._register(new Tr({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorWidget=this._editorWidgetFocus.onDidChangeToTrue,this.onDidBlurEditorWidget=this._editorWidgetFocus.onDidChangeToFalse,this._onWillType=this._register(new ae(this._contributions,this._deliveryQueue)),this.onWillType=this._onWillType.event,this._onDidType=this._register(new ae(this._contributions,this._deliveryQueue)),this.onDidType=this._onDidType.event,this._onDidCompositionStart=this._register(new ae(this._contributions,this._deliveryQueue)),this.onDidCompositionStart=this._onDidCompositionStart.event,this._onDidCompositionEnd=this._register(new ae(this._contributions,this._deliveryQueue)),this.onDidCompositionEnd=this._onDidCompositionEnd.event,this._onDidPaste=this._register(new ae(this._contributions,this._deliveryQueue)),this.onDidPaste=this._onDidPaste.event,this._onMouseUp=this._register(new ae(this._contributions,this._deliveryQueue)),this.onMouseUp=this._onMouseUp.event,this._onMouseDown=this._register(new ae(this._contributions,this._deliveryQueue)),this.onMouseDown=this._onMouseDown.event,this._onMouseDrag=this._register(new ae(this._contributions,this._deliveryQueue)),this.onMouseDrag=this._onMouseDrag.event,this._onMouseDrop=this._register(new ae(this._contributions,this._deliveryQueue)),this.onMouseDrop=this._onMouseDrop.event,this._onMouseDropCanceled=this._register(new ae(this._contributions,this._deliveryQueue)),this.onMouseDropCanceled=this._onMouseDropCanceled.event,this._onDropIntoEditor=this._register(new ae(this._contributions,this._deliveryQueue)),this.onDropIntoEditor=this._onDropIntoEditor.event,this._onContextMenu=this._register(new ae(this._contributions,this._deliveryQueue)),this.onContextMenu=this._onContextMenu.event,this._onMouseMove=this._register(new ae(this._contributions,this._deliveryQueue)),this.onMouseMove=this._onMouseMove.event,this._onMouseLeave=this._register(new ae(this._contributions,this._deliveryQueue)),this.onMouseLeave=this._onMouseLeave.event,this._onMouseWheel=this._register(new ae(this._contributions,this._deliveryQueue)),this.onMouseWheel=this._onMouseWheel.event,this._onKeyUp=this._register(new ae(this._contributions,this._deliveryQueue)),this.onKeyUp=this._onKeyUp.event,this._onKeyDown=this._register(new ae(this._contributions,this._deliveryQueue)),this.onKeyDown=this._onKeyDown.event,this._onDidContentSizeChange=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._onDidScrollChange=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidScrollChange=this._onDidScrollChange.event,this._onDidChangeViewZones=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeViewZones=this._onDidChangeViewZones.event,this._onDidChangeHiddenAreas=this._register(new W({deliveryQueue:this._deliveryQueue})),this.onDidChangeHiddenAreas=this._onDidChangeHiddenAreas.event,this._updateCounter=0,this._onBeginUpdate=this._register(new W),this.onBeginUpdate=this._onBeginUpdate.event,this._onEndUpdate=this._register(new W),this.onEndUpdate=this._onEndUpdate.event,this._actions=new Map,this._bannerDomNode=null,this._dropIntoEditorDecorations=this.createDecorationsCollection(),s.willCreateCodeEditor();const f={...t};this._domElement=e,this._overflowWidgetsDomNode=f.overflowWidgetsDomNode,delete f.overflowWidgetsDomNode,this._id=++Mg,this._decorationTypeKeysToIds={},this._decorationTypeSubtypes={},this._telemetryData=i.telemetryData,this._configuration=this._register(this._createConfiguration(i.isSimpleWidget||!1,i.contextMenuId??(i.isSimpleWidget?se.SimpleEditorContext:se.EditorContext),f,h)),this._register(this._configuration.onDidChange(w=>{this._onDidChangeConfiguration.fire(w);const p=this._configuration.options;if(w.hasChanged(146)){const g=p.get(146);this._onDidLayoutChange.fire(g)}})),this._contextKeyService=this._register(r.createScoped(this._domElement)),this._notificationService=l,this._codeEditorService=s,this._commandService=o,this._themeService=d,this._register(new Rg(this,this._contextKeyService)),this._register(new Eg(this,this._contextKeyService,u)),this._instantiationService=this._register(n.createChild(new An([ye,this._contextKeyService]))),this._modelData=null,this._focusTracker=new Tg(e,this._overflowWidgetsDomNode),this._register(this._focusTracker.onChange(()=>{this._editorWidgetFocus.setValue(this._focusTracker.hasFocus())})),this._contentWidgets={},this._overlayWidgets={},this._glyphMarginWidgets={};let _;Array.isArray(i.contributions)?_=i.contributions:_=Ft.getEditorContributions(),this._contributions.initialize(this,_,this._instantiationService);for(const w of Ft.getEditorActions()){if(this._actions.has(w.id)){xe(new Error(`Cannot have two actions with the same id ${w.id}`));continue}const p=new Ql(w.id,w.label,w.alias,w.metadata,w.precondition??void 0,g=>this._instantiationService.invokeFunction(v=>Promise.resolve(w.runEditorCommand(v,this,g))),this._contextKeyService);this._actions.set(p.id,p)}const C=()=>!this._configuration.options.get(92)&&this._configuration.options.get(36).enabled;this._register(new ac(this._domElement,{onDragOver:w=>{if(!C())return;const p=this.getTargetAtClientPoint(w.clientX,w.clientY);p!=null&&p.position&&this.showDropIndicatorAt(p.position)},onDrop:async w=>{if(!C()||(this.removeDropIndicator(),!w.dataTransfer))return;const p=this.getTargetAtClientPoint(w.clientX,w.clientY);p!=null&&p.position&&this._onDropIntoEditor.fire({position:p.position,event:w})},onDragLeave:()=>{this.removeDropIndicator()},onDragEnd:()=>{this.removeDropIndicator()}})),this._codeEditorService.addCodeEditor(this)}writeScreenReaderContent(e){var t;(t=this._modelData)==null||t.view.writeScreenReaderContent(e)}_createConfiguration(e,t,i,n){return new ms(e,t,i,this._domElement,n)}getId(){return this.getEditorType()+":"+this._id}getEditorType(){return xn.ICodeEditor}dispose(){this._codeEditorService.removeCodeEditor(this),this._focusTracker.dispose(),this._actions.clear(),this._contentWidgets={},this._overlayWidgets={},this._removeDecorationTypes(),this._postDetachModelCleanup(this._detachModel()),this._onDidDispose.fire(),super.dispose()}invokeWithinContext(e){return this._instantiationService.invokeFunction(e)}updateOptions(e){this._configuration.updateOptions(e||{})}getOptions(){return this._configuration.options}getOption(e){return this._configuration.options.get(e)}getRawOptions(){return this._configuration.getRawOptions()}getOverflowWidgetsDomNode(){return this._overflowWidgetsDomNode}getConfiguredWordAtPosition(e){return this._modelData?Xl.getWordAtPosition(this._modelData.model,this._configuration.options.get(132),this._configuration.options.get(131),e):null}getValue(e=null){if(!this._modelData)return"";const t=!!(e&&e.preserveBOM);let i=0;return e&&e.lineEnding&&e.lineEnding===`
`?i=1:e&&e.lineEnding&&e.lineEnding===`\r
`&&(i=2),this._modelData.model.getValue(i,t)}setValue(e){try{if(this._beginUpdate(),!this._modelData)return;this._modelData.model.setValue(e)}finally{this._endUpdate()}}getModel(){return this._modelData?this._modelData.model:null}setModel(e=null){var t;try{this._beginUpdate();const i=e;if(this._modelData===null&&i===null||this._modelData&&this._modelData.model===i)return;const n={oldModelUrl:((t=this._modelData)==null?void 0:t.model.uri)||null,newModelUrl:(i==null?void 0:i.uri)||null};this._onWillChangeModel.fire(n);const s=this.hasTextFocus(),o=this._detachModel();this._attachModel(i),s&&this.hasModel()&&this.focus(),this._removeDecorationTypes(),this._onDidChangeModel.fire(n),this._postDetachModelCleanup(o),this._contributionsDisposable=this._contributions.onAfterModelAttached()}finally{this._endUpdate()}}_removeDecorationTypes(){if(this._decorationTypeKeysToIds={},this._decorationTypeSubtypes){for(const e in this._decorationTypeSubtypes){const t=this._decorationTypeSubtypes[e];for(const i in t)this._removeDecorationType(e+"-"+i)}this._decorationTypeSubtypes={}}}getVisibleRanges(){return this._modelData?this._modelData.viewModel.getVisibleRanges():[]}getVisibleRangesPlusViewportAboveBelow(){return this._modelData?this._modelData.viewModel.getVisibleRangesPlusViewportAboveBelow():[]}getWhitespaces(){return this._modelData?this._modelData.viewModel.viewLayout.getWhitespaces():[]}static _getVerticalOffsetAfterPosition(e,t,i,n){const s=e.model.validatePosition({lineNumber:t,column:i}),o=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);return e.viewModel.viewLayout.getVerticalOffsetAfterLineNumber(o.lineNumber,n)}getTopForLineNumber(e,t=!1){return this._modelData?rt._getVerticalOffsetForPosition(this._modelData,e,1,t):-1}getTopForPosition(e,t){return this._modelData?rt._getVerticalOffsetForPosition(this._modelData,e,t,!1):-1}static _getVerticalOffsetForPosition(e,t,i,n=!1){const s=e.model.validatePosition({lineNumber:t,column:i}),o=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);return e.viewModel.viewLayout.getVerticalOffsetForLineNumber(o.lineNumber,n)}getBottomForLineNumber(e,t=!1){if(!this._modelData)return-1;const i=this._modelData.model.getLineMaxColumn(e);return rt._getVerticalOffsetAfterPosition(this._modelData,e,i,t)}setHiddenAreas(e,t){var i;(i=this._modelData)==null||i.viewModel.setHiddenAreas(e.map(n=>A.lift(n)),t)}getVisibleColumnFromPosition(e){if(!this._modelData)return e.column;const t=this._modelData.model.validatePosition(e),i=this._modelData.model.getOptions().tabSize;return oa.visibleColumnFromColumn(this._modelData.model.getLineContent(t.lineNumber),t.column,i)+1}getPosition(){return this._modelData?this._modelData.viewModel.getPosition():null}setPosition(e,t="api"){if(this._modelData){if(!T.isIPosition(e))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,[{selectionStartLineNumber:e.lineNumber,selectionStartColumn:e.column,positionLineNumber:e.lineNumber,positionColumn:e.column}])}}_sendRevealRange(e,t,i,n){if(!this._modelData)return;if(!A.isIRange(e))throw new Error("Invalid arguments");const s=this._modelData.model.validateRange(e),o=this._modelData.viewModel.coordinatesConverter.convertModelRangeToViewRange(s);this._modelData.viewModel.revealRange("api",i,o,t,n)}revealLine(e,t=0){this._revealLine(e,0,t)}revealLineInCenter(e,t=0){this._revealLine(e,1,t)}revealLineInCenterIfOutsideViewport(e,t=0){this._revealLine(e,2,t)}revealLineNearTop(e,t=0){this._revealLine(e,5,t)}_revealLine(e,t,i){if(typeof e!="number")throw new Error("Invalid arguments");this._sendRevealRange(new A(e,1,e,1),t,!1,i)}revealPosition(e,t=0){this._revealPosition(e,0,!0,t)}revealPositionInCenter(e,t=0){this._revealPosition(e,1,!0,t)}revealPositionInCenterIfOutsideViewport(e,t=0){this._revealPosition(e,2,!0,t)}revealPositionNearTop(e,t=0){this._revealPosition(e,5,!0,t)}_revealPosition(e,t,i,n){if(!T.isIPosition(e))throw new Error("Invalid arguments");this._sendRevealRange(new A(e.lineNumber,e.column,e.lineNumber,e.column),t,i,n)}getSelection(){return this._modelData?this._modelData.viewModel.getSelection():null}getSelections(){return this._modelData?this._modelData.viewModel.getSelections():null}setSelection(e,t="api"){const i=we.isISelection(e),n=A.isIRange(e);if(!i&&!n)throw new Error("Invalid arguments");if(i)this._setSelectionImpl(e,t);else if(n){const s={selectionStartLineNumber:e.startLineNumber,selectionStartColumn:e.startColumn,positionLineNumber:e.endLineNumber,positionColumn:e.endColumn};this._setSelectionImpl(s,t)}}_setSelectionImpl(e,t){if(!this._modelData)return;const i=new we(e.selectionStartLineNumber,e.selectionStartColumn,e.positionLineNumber,e.positionColumn);this._modelData.viewModel.setSelections(t,[i])}revealLines(e,t,i=0){this._revealLines(e,t,0,i)}revealLinesInCenter(e,t,i=0){this._revealLines(e,t,1,i)}revealLinesInCenterIfOutsideViewport(e,t,i=0){this._revealLines(e,t,2,i)}revealLinesNearTop(e,t,i=0){this._revealLines(e,t,5,i)}_revealLines(e,t,i,n){if(typeof e!="number"||typeof t!="number")throw new Error("Invalid arguments");this._sendRevealRange(new A(e,1,t,1),i,!1,n)}revealRange(e,t=0,i=!1,n=!0){this._revealRange(e,i?1:0,n,t)}revealRangeInCenter(e,t=0){this._revealRange(e,1,!0,t)}revealRangeInCenterIfOutsideViewport(e,t=0){this._revealRange(e,2,!0,t)}revealRangeNearTop(e,t=0){this._revealRange(e,5,!0,t)}revealRangeNearTopIfOutsideViewport(e,t=0){this._revealRange(e,6,!0,t)}revealRangeAtTop(e,t=0){this._revealRange(e,3,!0,t)}_revealRange(e,t,i,n){if(!A.isIRange(e))throw new Error("Invalid arguments");this._sendRevealRange(A.lift(e),t,i,n)}setSelections(e,t="api",i=0){if(this._modelData){if(!e||e.length===0)throw new Error("Invalid arguments");for(let n=0,s=e.length;n<s;n++)if(!we.isISelection(e[n]))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,e,i)}}getContentWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getContentWidth():-1}getScrollWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollWidth():-1}getScrollLeft(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollLeft():-1}getContentHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getContentHeight():-1}getScrollHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollHeight():-1}getScrollTop(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollTop():-1}setScrollLeft(e,t=1){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollLeft:e},t)}}setScrollTop(e,t=1){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollTop:e},t)}}setScrollPosition(e,t=1){this._modelData&&this._modelData.viewModel.viewLayout.setScrollPosition(e,t)}hasPendingScrollAnimation(){return this._modelData?this._modelData.viewModel.viewLayout.hasPendingScrollAnimation():!1}saveViewState(){if(!this._modelData)return null;const e=this._contributions.saveViewState(),t=this._modelData.viewModel.saveCursorState(),i=this._modelData.viewModel.saveState();return{cursorState:t,viewState:i,contributionsState:e}}restoreViewState(e){if(!this._modelData||!this._modelData.hasRealView)return;const t=e;if(t&&t.cursorState&&t.viewState){const i=t.cursorState;Array.isArray(i)?i.length>0&&this._modelData.viewModel.restoreCursorState(i):this._modelData.viewModel.restoreCursorState([i]),this._contributions.restoreViewState(t.contributionsState||{});const n=this._modelData.viewModel.reduceRestoreState(t.viewState);this._modelData.view.restoreState(n)}}handleInitialized(){var e;(e=this._getViewModel())==null||e.visibleLinesStabilized()}getContribution(e){return this._contributions.get(e)}getActions(){return Array.from(this._actions.values())}getSupportedActions(){let e=this.getActions();return e=e.filter(t=>t.isSupported()),e}getAction(e){return this._actions.get(e)||null}trigger(e,t,i){i=i||{};try{switch(this._beginUpdate(),t){case"compositionStart":this._startComposition();return;case"compositionEnd":this._endComposition(e);return;case"type":{const s=i;this._type(e,s.text||"");return}case"replacePreviousChar":{const s=i;this._compositionType(e,s.text||"",s.replaceCharCnt||0,0,0);return}case"compositionType":{const s=i;this._compositionType(e,s.text||"",s.replacePrevCharCnt||0,s.replaceNextCharCnt||0,s.positionDelta||0);return}case"paste":{const s=i;this._paste(e,s.text||"",s.pasteOnNewLine||!1,s.multicursorText||null,s.mode||null,s.clipboardEvent);return}case"cut":this._cut(e);return}const n=this.getAction(t);if(n){Promise.resolve(n.run(i)).then(void 0,xe);return}if(!this._modelData||this._triggerEditorCommand(e,t,i))return;this._triggerCommand(t,i)}finally{this._endUpdate()}}_triggerCommand(e,t){this._commandService.executeCommand(e,t)}_startComposition(){this._modelData&&(this._modelData.viewModel.startComposition(),this._onDidCompositionStart.fire())}_endComposition(e){this._modelData&&(this._modelData.viewModel.endComposition(e),this._onDidCompositionEnd.fire())}_type(e,t){!this._modelData||t.length===0||(e==="keyboard"&&this._onWillType.fire(t),this._modelData.viewModel.type(t,e),e==="keyboard"&&this._onDidType.fire(t))}_compositionType(e,t,i,n,s){this._modelData&&this._modelData.viewModel.compositionType(t,i,n,s,e)}_paste(e,t,i,n,s,o){if(!this._modelData)return;const r=this._modelData.viewModel,d=r.getSelection().getStartPosition();r.paste(t,i,n,e);const l=r.getSelection().getStartPosition();e==="keyboard"&&this._onDidPaste.fire({clipboardEvent:o,range:new A(d.lineNumber,d.column,l.lineNumber,l.column),languageId:s})}_cut(e){this._modelData&&this._modelData.viewModel.cut(e)}_triggerEditorCommand(e,t,i){const n=Ft.getEditorCommand(t);return n?(i=i||{},i.source=e,this._instantiationService.invokeFunction(s=>{Promise.resolve(n.runEditorCommand(s,this,i)).then(void 0,xe)}),!0):!1}_getViewModel(){return this._modelData?this._modelData.viewModel:null}pushUndoStop(){return!this._modelData||this._configuration.options.get(92)?!1:(this._modelData.model.pushStackElement(),!0)}popUndoStop(){return!this._modelData||this._configuration.options.get(92)?!1:(this._modelData.model.popStackElement(),!0)}executeEdits(e,t,i){if(!this._modelData||this._configuration.options.get(92))return!1;let n;return i?Array.isArray(i)?n=()=>i:n=i:n=()=>null,this._modelData.viewModel.executeEdits(e,t,n),!0}executeCommand(e,t){this._modelData&&this._modelData.viewModel.executeCommand(t,e)}executeCommands(e,t){this._modelData&&this._modelData.viewModel.executeCommands(t,e)}createDecorationsCollection(e){return new Ig(this,e)}changeDecorations(e){return this._modelData?this._modelData.model.changeDecorations(e,this._id):null}getLineDecorations(e){return this._modelData?this._modelData.model.getLineDecorations(e,this._id,$o(this._configuration.options)):null}getDecorationsInRange(e){return this._modelData?this._modelData.model.getDecorationsInRange(e,this._id,$o(this._configuration.options)):null}deltaDecorations(e,t){return this._modelData?e.length===0&&t.length===0?e:this._modelData.model.deltaDecorations(e,t,this._id):[]}removeDecorations(e){!this._modelData||e.length===0||this._modelData.model.changeDecorations(t=>{t.deltaDecorations(e,[])})}removeDecorationsByType(e){const t=this._decorationTypeKeysToIds[e];t&&this.changeDecorations(i=>i.deltaDecorations(t,[])),this._decorationTypeKeysToIds.hasOwnProperty(e)&&delete this._decorationTypeKeysToIds[e],this._decorationTypeSubtypes.hasOwnProperty(e)&&delete this._decorationTypeSubtypes[e]}getLayoutInfo(){return this._configuration.options.get(146)}createOverviewRuler(e){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.createOverviewRuler(e)}getContainerDomNode(){return this._domElement}getDomNode(){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.domNode.domNode}delegateVerticalScrollbarPointerDown(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateScrollFromMouseWheelEvent(e)}layout(e,t=!1){this._configuration.observeContainer(e),t||this.render()}focus(){!this._modelData||!this._modelData.hasRealView||this._modelData.view.focus()}hasTextFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isFocused()}hasWidgetFocus(){return this._focusTracker&&this._focusTracker.hasFocus()}addContentWidget(e){const t={widget:e,position:e.getPosition()};this._contentWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a content widget with the same id:"+e.getId()),this._contentWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addContentWidget(t)}layoutContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const i=this._contentWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutContentWidget(i)}}removeContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const i=this._contentWidgets[t];delete this._contentWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeContentWidget(i)}}addOverlayWidget(e){const t={widget:e,position:e.getPosition()};this._overlayWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting an overlay widget with the same id."),this._overlayWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addOverlayWidget(t)}layoutOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const i=this._overlayWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutOverlayWidget(i)}}removeOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const i=this._overlayWidgets[t];delete this._overlayWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeOverlayWidget(i)}}addGlyphMarginWidget(e){const t={widget:e,position:e.getPosition()};this._glyphMarginWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a glyph margin widget with the same id."),this._glyphMarginWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addGlyphMarginWidget(t)}layoutGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const i=this._glyphMarginWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutGlyphMarginWidget(i)}}removeGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const i=this._glyphMarginWidgets[t];delete this._glyphMarginWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeGlyphMarginWidget(i)}}changeViewZones(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.change(e)}getTargetAtClientPoint(e,t){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.getTargetAtClientPoint(e,t)}getScrolledVisiblePosition(e){if(!this._modelData||!this._modelData.hasRealView)return null;const t=this._modelData.model.validatePosition(e),i=this._configuration.options,n=i.get(146),s=rt._getVerticalOffsetForPosition(this._modelData,t.lineNumber,t.column)-this.getScrollTop(),o=this._modelData.view.getOffsetForColumn(t.lineNumber,t.column)+n.glyphMarginWidth+n.lineNumbersWidth+n.decorationsWidth-this.getScrollLeft();return{top:s,left:o,height:i.get(67)}}getOffsetForColumn(e,t){return!this._modelData||!this._modelData.hasRealView?-1:this._modelData.view.getOffsetForColumn(e,t)}render(e=!1){!this._modelData||!this._modelData.hasRealView||this._modelData.viewModel.batchEvents(()=>{this._modelData.view.render(!0,e)})}setAriaOptions(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.setAriaOptions(e)}applyFontInfo(e){ge(e,this._configuration.options.get(50))}setBanner(e,t){this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),this._bannerDomNode=e,this._configuration.setReservedHeight(e?t:0),this._bannerDomNode&&this._domElement.prepend(this._bannerDomNode)}_attachModel(e){if(!e){this._modelData=null;return}const t=[];this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._configuration.setIsDominatedByLongLines(e.isDominatedByLongLines()),this._configuration.setModelLineCount(e.getLineCount());const i=e.onBeforeAttached(),n=new Jl(this._id,this._configuration,e,po.create(G(this._domElement)),eh.create(this._configuration.options),r=>yi(G(this._domElement),r),this.languageConfigurationService,this._themeService,i,{batchChanges:r=>{try{return this._beginUpdate(),r()}finally{this._endUpdate()}}});t.push(e.onWillDispose(()=>this.setModel(null))),t.push(n.onEvent(r=>{switch(r.kind){case 0:this._onDidContentSizeChange.fire(r);break;case 1:this._editorTextFocus.setValue(r.hasFocus);break;case 2:this._onDidScrollChange.fire(r);break;case 3:this._onDidChangeViewZones.fire();break;case 4:this._onDidChangeHiddenAreas.fire();break;case 5:this._onDidAttemptReadOnlyEdit.fire();break;case 6:{if(r.reachedMaxCursorCount){const c=this.getOption(80),u=F("cursors.maximum","The number of cursors has been limited to {0}. Consider using [find and replace](https://code.visualstudio.com/docs/editor/codebasics#_find-and-replace) for larger changes or increase the editor multi cursor limit setting.",c);this._notificationService.prompt(Sh.Warning,u,[{label:"Find and Replace",run:()=>{this._commandService.executeCommand("editor.action.startFindReplaceAction")}},{label:F("goToSetting","Increase Multi Cursor Limit"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings2",{query:"editor.multiCursorLimit"})}}])}const d=[];for(let c=0,u=r.selections.length;c<u;c++)d[c]=r.selections[c].getPosition();const l={position:d[0],secondaryPositions:d.slice(1),reason:r.reason,source:r.source};this._onDidChangeCursorPosition.fire(l);const h={selection:r.selections[0],secondarySelections:r.selections.slice(1),modelVersionId:r.modelVersionId,oldSelections:r.oldSelections,oldModelVersionId:r.oldModelVersionId,source:r.source,reason:r.reason};this._onDidChangeCursorSelection.fire(h);break}case 7:this._onDidChangeModelDecorations.fire(r.event);break;case 8:this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._onDidChangeModelLanguage.fire(r.event);break;case 9:this._onDidChangeModelLanguageConfiguration.fire(r.event);break;case 10:this._onDidChangeModelContent.fire(r.event);break;case 11:this._onDidChangeModelOptions.fire(r.event);break;case 12:this._onDidChangeModelTokens.fire(r.event);break}}));const[s,o]=this._createView(n);if(o){this._domElement.appendChild(s.domNode.domNode);let r=Object.keys(this._contentWidgets);for(let d=0,l=r.length;d<l;d++){const h=r[d];s.addContentWidget(this._contentWidgets[h])}r=Object.keys(this._overlayWidgets);for(let d=0,l=r.length;d<l;d++){const h=r[d];s.addOverlayWidget(this._overlayWidgets[h])}r=Object.keys(this._glyphMarginWidgets);for(let d=0,l=r.length;d<l;d++){const h=r[d];s.addGlyphMarginWidget(this._glyphMarginWidgets[h])}s.render(!1,!0),s.domNode.domNode.setAttribute("data-uri",e.uri.toString())}this._modelData=new xg(e,n,s,o,t,i)}_createView(e){let t;this.isSimpleWidget?t={paste:(s,o,r,d)=>{this._paste("keyboard",s,o,r,d)},type:s=>{this._type("keyboard",s)},compositionType:(s,o,r,d)=>{this._compositionType("keyboard",s,o,r,d)},startComposition:()=>{this._startComposition()},endComposition:()=>{this._endComposition("keyboard")},cut:()=>{this._cut("keyboard")}}:t={paste:(s,o,r,d)=>{const l={text:s,pasteOnNewLine:o,multicursorText:r,mode:d};this._commandService.executeCommand("paste",l)},type:s=>{const o={text:s};this._commandService.executeCommand("type",o)},compositionType:(s,o,r,d)=>{if(r||d){const l={text:s,replacePrevCharCnt:o,replaceNextCharCnt:r,positionDelta:d};this._commandService.executeCommand("compositionType",l)}else{const l={text:s,replaceCharCnt:o};this._commandService.executeCommand("replacePreviousChar",l)}},startComposition:()=>{this._commandService.executeCommand("compositionStart",{})},endComposition:()=>{this._commandService.executeCommand("compositionEnd",{})},cut:()=>{this._commandService.executeCommand("cut",{})}};const i=new Vn(e.coordinatesConverter);return i.onKeyDown=s=>this._onKeyDown.fire(s),i.onKeyUp=s=>this._onKeyUp.fire(s),i.onContextMenu=s=>this._onContextMenu.fire(s),i.onMouseMove=s=>this._onMouseMove.fire(s),i.onMouseLeave=s=>this._onMouseLeave.fire(s),i.onMouseDown=s=>this._onMouseDown.fire(s),i.onMouseUp=s=>this._onMouseUp.fire(s),i.onMouseDrag=s=>this._onMouseDrag.fire(s),i.onMouseDrop=s=>this._onMouseDrop.fire(s),i.onMouseDropCanceled=s=>this._onMouseDropCanceled.fire(s),i.onMouseWheel=s=>this._onMouseWheel.fire(s),[new Ns(t,this._configuration,this._themeService.getColorTheme(),e,i,this._overflowWidgetsDomNode,this._instantiationService),!0]}_postDetachModelCleanup(e){e==null||e.removeAllDecorationsWithOwnerId(this._id)}_detachModel(){var i;if((i=this._contributionsDisposable)==null||i.dispose(),this._contributionsDisposable=void 0,!this._modelData)return null;const e=this._modelData.model,t=this._modelData.hasRealView?this._modelData.view.domNode.domNode:null;return this._modelData.dispose(),this._modelData=null,this._domElement.removeAttribute("data-mode-id"),t&&this._domElement.contains(t)&&t.remove(),this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),e}_removeDecorationType(e){this._codeEditorService.removeDecorationType(e)}hasModel(){return this._modelData!==null}showDropIndicatorAt(e){const t=[{range:new A(e.lineNumber,e.column,e.lineNumber,e.column),options:rt.dropIntoEditorDecorationOptions}];this._dropIntoEditorDecorations.set(t),this.revealPosition(e,1)}removeDropIndicator(){this._dropIntoEditorDecorations.clear()}setContextValue(e,t){this._contextKeyService.createKey(e,t)}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&this._onBeginUpdate.fire()}_endUpdate(){this._updateCounter--,this._updateCounter===0&&this._onEndUpdate.fire()}},rt=_t,_t.dropIntoEditorDecorationOptions=Oe.register({description:"workbench-dnd-target",className:"dnd-target"}),_t);nn=rt=Ng([ze(3,me),ze(4,Re),ze(5,On),ze(6,ye),ze(7,Tn),ze(8,fa),ze(9,yt),ze(10,Qs),ze(11,Xs)],nn);let Mg=0;class xg{constructor(e,t,i,n,s,o){this.model=e,this.viewModel=t,this.view=i,this.hasRealView=n,this.listenersToRemove=s,this.attachedView=o}dispose(){pd(this.listenersToRemove),this.model.onBeforeDetached(this.attachedView),this.hasRealView&&this.view.dispose(),this.viewModel.dispose()}}class Tr extends U{constructor(e){super(),this._emitterOptions=e,this._onDidChangeToTrue=this._register(new W(this._emitterOptions)),this.onDidChangeToTrue=this._onDidChangeToTrue.event,this._onDidChangeToFalse=this._register(new W(this._emitterOptions)),this.onDidChangeToFalse=this._onDidChangeToFalse.event,this._value=0}setValue(e){const t=e?2:1;this._value!==t&&(this._value=t,this._value===2?this._onDidChangeToTrue.fire():this._value===1&&this._onDidChangeToFalse.fire())}}class ae extends W{constructor(e,t){super({deliveryQueue:t}),this._contributions=e}fire(e){this._contributions.onBeforeInteractionEvent(),super.fire(e)}}class Rg extends U{constructor(e,t){super(),this._editor=e,t.createKey("editorId",e.getId()),this._editorSimpleInput=D.editorSimpleInput.bindTo(t),this._editorFocus=D.focus.bindTo(t),this._textInputFocus=D.textInputFocus.bindTo(t),this._editorTextFocus=D.editorTextFocus.bindTo(t),this._tabMovesFocus=D.tabMovesFocus.bindTo(t),this._editorReadonly=D.readOnly.bindTo(t),this._inDiffEditor=D.inDiffEditor.bindTo(t),this._editorColumnSelection=D.columnSelection.bindTo(t),this._hasMultipleSelections=D.hasMultipleSelections.bindTo(t),this._hasNonEmptySelection=D.hasNonEmptySelection.bindTo(t),this._canUndo=D.canUndo.bindTo(t),this._canRedo=D.canRedo.bindTo(t),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromConfig())),this._register(this._editor.onDidChangeCursorSelection(()=>this._updateFromSelection())),this._register(this._editor.onDidFocusEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidFocusEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidChangeModel(()=>this._updateFromModel())),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromModel())),this._register(qi.onDidChangeTabFocus(i=>this._tabMovesFocus.set(i))),this._updateFromConfig(),this._updateFromSelection(),this._updateFromFocus(),this._updateFromModel(),this._editorSimpleInput.set(this._editor.isSimpleWidget)}_updateFromConfig(){const e=this._editor.getOptions();this._tabMovesFocus.set(qi.getTabFocusMode()),this._editorReadonly.set(e.get(92)),this._inDiffEditor.set(e.get(61)),this._editorColumnSelection.set(e.get(22))}_updateFromSelection(){const e=this._editor.getSelections();e?(this._hasMultipleSelections.set(e.length>1),this._hasNonEmptySelection.set(e.some(t=>!t.isEmpty()))):(this._hasMultipleSelections.reset(),this._hasNonEmptySelection.reset())}_updateFromFocus(){this._editorFocus.set(this._editor.hasWidgetFocus()&&!this._editor.isSimpleWidget),this._editorTextFocus.set(this._editor.hasTextFocus()&&!this._editor.isSimpleWidget),this._textInputFocus.set(this._editor.hasTextFocus())}_updateFromModel(){const e=this._editor.getModel();this._canUndo.set(!!(e&&e.canUndo())),this._canRedo.set(!!(e&&e.canRedo()))}}class Eg extends U{constructor(e,t,i){super(),this._editor=e,this._contextKeyService=t,this._languageFeaturesService=i,this._langId=D.languageId.bindTo(t),this._hasCompletionItemProvider=D.hasCompletionItemProvider.bindTo(t),this._hasCodeActionsProvider=D.hasCodeActionsProvider.bindTo(t),this._hasCodeLensProvider=D.hasCodeLensProvider.bindTo(t),this._hasDefinitionProvider=D.hasDefinitionProvider.bindTo(t),this._hasDeclarationProvider=D.hasDeclarationProvider.bindTo(t),this._hasImplementationProvider=D.hasImplementationProvider.bindTo(t),this._hasTypeDefinitionProvider=D.hasTypeDefinitionProvider.bindTo(t),this._hasHoverProvider=D.hasHoverProvider.bindTo(t),this._hasDocumentHighlightProvider=D.hasDocumentHighlightProvider.bindTo(t),this._hasDocumentSymbolProvider=D.hasDocumentSymbolProvider.bindTo(t),this._hasReferenceProvider=D.hasReferenceProvider.bindTo(t),this._hasRenameProvider=D.hasRenameProvider.bindTo(t),this._hasSignatureHelpProvider=D.hasSignatureHelpProvider.bindTo(t),this._hasInlayHintsProvider=D.hasInlayHintsProvider.bindTo(t),this._hasDocumentFormattingProvider=D.hasDocumentFormattingProvider.bindTo(t),this._hasDocumentSelectionFormattingProvider=D.hasDocumentSelectionFormattingProvider.bindTo(t),this._hasMultipleDocumentFormattingProvider=D.hasMultipleDocumentFormattingProvider.bindTo(t),this._hasMultipleDocumentSelectionFormattingProvider=D.hasMultipleDocumentSelectionFormattingProvider.bindTo(t),this._isInEmbeddedEditor=D.isInEmbeddedEditor.bindTo(t);const n=()=>this._update();this._register(e.onDidChangeModel(n)),this._register(e.onDidChangeModelLanguage(n)),this._register(i.completionProvider.onDidChange(n)),this._register(i.codeActionProvider.onDidChange(n)),this._register(i.codeLensProvider.onDidChange(n)),this._register(i.definitionProvider.onDidChange(n)),this._register(i.declarationProvider.onDidChange(n)),this._register(i.implementationProvider.onDidChange(n)),this._register(i.typeDefinitionProvider.onDidChange(n)),this._register(i.hoverProvider.onDidChange(n)),this._register(i.documentHighlightProvider.onDidChange(n)),this._register(i.documentSymbolProvider.onDidChange(n)),this._register(i.referenceProvider.onDidChange(n)),this._register(i.renameProvider.onDidChange(n)),this._register(i.documentFormattingEditProvider.onDidChange(n)),this._register(i.documentRangeFormattingEditProvider.onDidChange(n)),this._register(i.signatureHelpProvider.onDidChange(n)),this._register(i.inlayHintsProvider.onDidChange(n)),n()}dispose(){super.dispose()}reset(){this._contextKeyService.bufferChangeEvents(()=>{this._langId.reset(),this._hasCompletionItemProvider.reset(),this._hasCodeActionsProvider.reset(),this._hasCodeLensProvider.reset(),this._hasDefinitionProvider.reset(),this._hasDeclarationProvider.reset(),this._hasImplementationProvider.reset(),this._hasTypeDefinitionProvider.reset(),this._hasHoverProvider.reset(),this._hasDocumentHighlightProvider.reset(),this._hasDocumentSymbolProvider.reset(),this._hasReferenceProvider.reset(),this._hasRenameProvider.reset(),this._hasDocumentFormattingProvider.reset(),this._hasDocumentSelectionFormattingProvider.reset(),this._hasSignatureHelpProvider.reset(),this._isInEmbeddedEditor.reset()})}_update(){const e=this._editor.getModel();if(!e){this.reset();return}this._contextKeyService.bufferChangeEvents(()=>{this._langId.set(e.getLanguageId()),this._hasCompletionItemProvider.set(this._languageFeaturesService.completionProvider.has(e)),this._hasCodeActionsProvider.set(this._languageFeaturesService.codeActionProvider.has(e)),this._hasCodeLensProvider.set(this._languageFeaturesService.codeLensProvider.has(e)),this._hasDefinitionProvider.set(this._languageFeaturesService.definitionProvider.has(e)),this._hasDeclarationProvider.set(this._languageFeaturesService.declarationProvider.has(e)),this._hasImplementationProvider.set(this._languageFeaturesService.implementationProvider.has(e)),this._hasTypeDefinitionProvider.set(this._languageFeaturesService.typeDefinitionProvider.has(e)),this._hasHoverProvider.set(this._languageFeaturesService.hoverProvider.has(e)),this._hasDocumentHighlightProvider.set(this._languageFeaturesService.documentHighlightProvider.has(e)),this._hasDocumentSymbolProvider.set(this._languageFeaturesService.documentSymbolProvider.has(e)),this._hasReferenceProvider.set(this._languageFeaturesService.referenceProvider.has(e)),this._hasRenameProvider.set(this._languageFeaturesService.renameProvider.has(e)),this._hasSignatureHelpProvider.set(this._languageFeaturesService.signatureHelpProvider.has(e)),this._hasInlayHintsProvider.set(this._languageFeaturesService.inlayHintsProvider.has(e)),this._hasDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.has(e)||this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasMultipleDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.all(e).length+this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._hasMultipleDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._isInEmbeddedEditor.set(e.uri.scheme===ke.walkThroughSnippet||e.uri.scheme===ke.vscodeChatCodeBlock)})}}class Tg extends U{constructor(e,t){super(),this._onChange=this._register(new W),this.onChange=this._onChange.event,this._hadFocus=void 0,this._hasDomElementFocus=!1,this._domFocusTracker=this._register(tr(e)),this._overflowWidgetsDomNodeHasFocus=!1,this._register(this._domFocusTracker.onDidFocus(()=>{this._hasDomElementFocus=!0,this._update()})),this._register(this._domFocusTracker.onDidBlur(()=>{this._hasDomElementFocus=!1,this._update()})),t&&(this._overflowWidgetsDomNode=this._register(tr(t)),this._register(this._overflowWidgetsDomNode.onDidFocus(()=>{this._overflowWidgetsDomNodeHasFocus=!0,this._update()})),this._register(this._overflowWidgetsDomNode.onDidBlur(()=>{this._overflowWidgetsDomNodeHasFocus=!1,this._update()})))}_update(){const e=this._hasDomElementFocus||this._overflowWidgetsDomNodeHasFocus;this._hadFocus!==e&&(this._hadFocus=e,this._onChange.fire(void 0))}hasFocus(){return this._hadFocus??!1}}class Ig{get length(){return this._decorationIds.length}constructor(e,t){this._editor=e,this._decorationIds=[],this._isChangingDecorations=!1,Array.isArray(t)&&t.length>0&&this.set(t)}onDidChange(e,t,i){return this._editor.onDidChangeModelDecorations(n=>{this._isChangingDecorations||e.call(t,n)},i)}getRange(e){return!this._editor.hasModel()||e>=this._decorationIds.length?null:this._editor.getModel().getDecorationRange(this._decorationIds[e])}getRanges(){if(!this._editor.hasModel())return[];const e=this._editor.getModel(),t=[];for(const i of this._decorationIds){const n=e.getDecorationRange(i);n&&t.push(n)}return t}has(e){return this._decorationIds.includes(e.id)}clear(){this._decorationIds.length!==0&&this.set([])}set(e){try{this._isChangingDecorations=!0,this._editor.changeDecorations(t=>{this._decorationIds=t.deltaDecorations(this._decorationIds,e)})}finally{this._isChangingDecorations=!1}return this._decorationIds}append(e){let t=[];try{this._isChangingDecorations=!0,this._editor.changeDecorations(i=>{t=i.deltaDecorations([],e),this._decorationIds=this._decorationIds.concat(t)})}finally{this._isChangingDecorations=!1}return t}}const Og=encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 3' enable-background='new 0 0 6 3' height='3' width='6'><g fill='"),Ag=encodeURIComponent("'><polygon points='5.5,0 2.5,3 1.1,3 4.1,0'/><polygon points='4,0 6,2 6,0.6 5.4,0'/><polygon points='0,2 1,3 2.4,3 0,0.6'/></g></svg>");function Yn(a){return Og+encodeURIComponent(a.toString())+Ag}const Pg=encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" height="3" width="12"><g fill="'),Wg=encodeURIComponent('"><circle cx="1" cy="1" r="1"/><circle cx="5" cy="1" r="1"/><circle cx="9" cy="1" r="1"/></g></svg>');function Hg(a){return Pg+encodeURIComponent(a.toString())+Wg}St((a,e)=>{const t=a.getColor(Lh);t&&e.addRule(`.monaco-editor .squiggly-error { background: url("data:image/svg+xml,${Yn(t)}") repeat-x bottom left; }`);const i=a.getColor(Dh);i&&e.addRule(`.monaco-editor .squiggly-warning { background: url("data:image/svg+xml,${Yn(i)}") repeat-x bottom left; }`);const n=a.getColor(Nh);n&&e.addRule(`.monaco-editor .squiggly-info { background: url("data:image/svg+xml,${Yn(n)}") repeat-x bottom left; }`);const s=a.getColor(Mh);s&&e.addRule(`.monaco-editor .squiggly-hint { background: url("data:image/svg+xml,${Hg(s)}") no-repeat bottom left; }`);const o=a.getColor(th);o&&e.addRule(`.monaco-editor.showUnused .squiggly-inline-unnecessary { opacity: ${o.rgba.a}; }`)});class sn{static capture(e){if(e.getScrollTop()===0||e.hasPendingScrollAnimation())return new sn(e.getScrollTop(),e.getContentHeight(),null,0,null);let t=null,i=0;const n=e.getVisibleRanges();if(n.length>0){t=n[0].getStartPosition();const s=e.getTopForPosition(t.lineNumber,t.column);i=e.getScrollTop()-s}return new sn(e.getScrollTop(),e.getContentHeight(),t,i,e.getPosition())}constructor(e,t,i,n,s){this._initialScrollTop=e,this._initialContentHeight=t,this._visiblePosition=i,this._visiblePositionScrollDelta=n,this._cursorPosition=s}restore(e){if(!(this._initialContentHeight===e.getContentHeight()&&this._initialScrollTop===e.getScrollTop())&&this._visiblePosition){const t=e.getTopForPosition(this._visiblePosition.lineNumber,this._visiblePosition.column);e.setScrollTop(t+this._visiblePositionScrollDelta)}}restoreRelativeVerticalPositionOfCursor(e){if(this._initialContentHeight===e.getContentHeight()&&this._initialScrollTop===e.getScrollTop())return;const t=e.getPosition();if(!this._cursorPosition||!t)return;const i=e.getTopForLineNumber(t.lineNumber)-e.getTopForLineNumber(this._cursorPosition.lineNumber);e.setScrollTop(e.getScrollTop()+i,1)}}function um(a,e,t,i){if(a.length===0)return e;if(e.length===0)return a;const n=[];let s=0,o=0;for(;s<a.length&&o<e.length;){const r=a[s],d=e[o],l=t(r),h=t(d);l<h?(n.push(r),s++):l>h?(n.push(d),o++):(n.push(i(r,d)),s++,o++)}for(;s<a.length;)n.push(a[s]),s++;for(;o<e.length;)n.push(e[o]),o++;return n}function Ir(a,e){const t=new Me,i=a.createDecorationsCollection();return t.add(Jr({debugName:()=>`Apply decorations from ${e.debugName}`},n=>{const s=e.read(n);i.set(s)})),t.add({dispose:()=>{i.clear()}}),t}function di(a,e){return a.appendChild(e),be(()=>{e.remove()})}function kg(a,e){return a.prepend(e),be(()=>{e.remove()})}class Va extends U{get width(){return this._width}get height(){return this._height}get automaticLayout(){return this._automaticLayout}constructor(e,t){super(),this._automaticLayout=!1,this.elementSizeObserver=this._register(new Ra(e,t)),this._width=$(this,this.elementSizeObserver.getWidth()),this._height=$(this,this.elementSizeObserver.getHeight()),this._register(this.elementSizeObserver.onDidChange(i=>Ce(n=>{this._width.set(this.elementSizeObserver.getWidth(),n),this._height.set(this.elementSizeObserver.getHeight(),n)})))}observe(e){this.elementSizeObserver.observe(e)}setAutomaticLayout(e){this._automaticLayout=e,e?this.elementSizeObserver.startObserving():this.elementSizeObserver.stopObserving()}}function gm(a,e,t){let i=e.get(),n=i,s=i;const o=$("animatedValue",i);let r=-1;const d=300;let l;t.add(Zs({createEmptyChangeSummary:()=>({animate:!1}),handleChange:(c,u)=>(c.didChange(e)&&(u.animate=u.animate||c.change),!0)},(c,u)=>{l!==void 0&&(a.cancelAnimationFrame(l),l=void 0),n=s,i=e.read(c),r=Date.now()-(u.animate?0:d),h()}));function h(){const c=Date.now()-r;s=Math.floor(Fg(c,n,i-n,d)),c<d?l=a.requestAnimationFrame(h):s=i,o.set(s,void 0)}return o}function Fg(a,e,t,i){return a===i?e+t:t*(-Math.pow(2,-10*a/i)+1)+e}class vo extends U{constructor(e,t,i){super(),this._register(new Rs(e,i)),this._register(Yt(i,{height:t.actualHeight,top:t.actualTop}))}}class At{get afterLineNumber(){return this._afterLineNumber.get()}constructor(e,t){this._afterLineNumber=e,this.heightInPx=t,this.domNode=document.createElement("div"),this._actualTop=$(this,void 0),this._actualHeight=$(this,void 0),this.actualTop=this._actualTop,this.actualHeight=this._actualHeight,this.showInHiddenAreas=!0,this.onChange=this._afterLineNumber,this.onDomNodeTop=i=>{this._actualTop.set(i,void 0)},this.onComputedHeight=i=>{this._actualHeight.set(i,void 0)}}}const Cn=class Cn{constructor(e,t){this._editor=e,this._domElement=t,this._overlayWidgetId=`managedOverlayWidget-${Cn._counter++}`,this._overlayWidget={getId:()=>this._overlayWidgetId,getDomNode:()=>this._domElement,getPosition:()=>null},this._editor.addOverlayWidget(this._overlayWidget)}dispose(){this._editor.removeOverlayWidget(this._overlayWidget)}};Cn._counter=0;let Rs=Cn;function Yt(a,e){return Q(t=>{for(let[i,n]of Object.entries(e))n&&typeof n=="object"&&"read"in n&&(n=n.read(t)),typeof n=="number"&&(n=`${n}px`),i=i.replace(/[A-Z]/g,s=>"-"+s.toLowerCase()),a.style[i]=n})}function on(a,e,t,i){const n=new Me,s=[];return n.add(Fe((o,r)=>{const d=e.read(o),l=new Map,h=new Map;t&&t(!0),a.changeViewZones(c=>{for(const u of s)c.removeZone(u),i==null||i.delete(u);s.length=0;for(const u of d){const f=c.addZone(u);u.setZoneId&&u.setZoneId(f),s.push(f),i==null||i.add(f),l.set(u,f)}}),t&&t(!1),r.add(Zs({createEmptyChangeSummary(){return{zoneIds:[]}},handleChange(c,u){const f=h.get(c.changedObservable);return f!==void 0&&u.zoneIds.push(f),!0}},(c,u)=>{for(const f of d)f.onChange&&(h.set(f.onChange,l.get(f)),f.onChange.read(c));t&&t(!0),a.changeViewZones(f=>{for(const _ of u.zoneIds)f.layoutZone(_)}),t&&t(!1)}))})),n.add({dispose(){t&&t(!0),a.changeViewZones(o=>{for(const r of s)o.removeZone(r)}),i==null||i.clear(),t&&t(!1)}}),n}class fm extends Gs{dispose(){super.dispose(!0)}}function Or(a,e){const t=ts(e,n=>n.original.startLineNumber<=a.lineNumber);if(!t)return A.fromPositions(a);if(t.original.endLineNumberExclusive<=a.lineNumber){const n=a.lineNumber-t.original.endLineNumberExclusive+t.modified.endLineNumberExclusive;return A.fromPositions(new T(n,a.column))}if(!t.innerChanges)return A.fromPositions(new T(t.modified.startLineNumber,1));const i=ts(t.innerChanges,n=>n.originalRange.getStartPosition().isBeforeOrEqual(a));if(!i){const n=a.lineNumber-t.original.startLineNumber+t.modified.startLineNumber;return A.fromPositions(new T(n,a.column))}if(i.originalRange.containsPosition(a))return i.modifiedRange;{const n=Vg(i.originalRange.getEndPosition(),a);return A.fromPositions(n.addToPosition(i.modifiedRange.getEndPosition()))}}function Vg(a,e){return a.lineNumber===e.lineNumber?new Go(0,e.column-a.column):new Go(e.lineNumber-a.lineNumber,e.column-1)}function Bg(a,e){let t;return a.filter(i=>{const n=e(i,t);return t=i,n})}class rn{static create(e,t=void 0){return new Ar(e,e,t)}static createWithDisposable(e,t,i=void 0){const n=new Me;return n.add(t),n.add(e),new Ar(e,n,i)}}class Ar extends rn{constructor(e,t,i){super(),this.object=e,this._disposable=t,this._debugOwner=i,this._refCount=1,this._isDisposed=!1,this._owners=[],i&&this._addOwner(i)}_addOwner(e){e&&this._owners.push(e)}createNewRef(e){return this._refCount++,e&&this._addOwner(e),new Ug(this,e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._decreaseRefCount(this._debugOwner))}_decreaseRefCount(e){if(this._refCount--,this._refCount===0&&this._disposable.dispose(),e){const t=this._owners.indexOf(e);t!==-1&&this._owners.splice(t,1)}}}class Ug extends rn{constructor(e,t){super(),this._base=e,this._debugOwner=t,this._isDisposed=!1}get object(){return this._base.object}createNewRef(e){return this._base.createNewRef(e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._base._decreaseRefCount(this._debugOwner))}}qt("diffEditor.move.border","#8b8b8b9c",F("diffEditor.move.border","The border color for text that got moved in the diff editor."));qt("diffEditor.moveActive.border","#FFA500",F("diffEditor.moveActive.border","The active border color for text that got moved in the diff editor."));qt("diffEditor.unchangedRegionShadow",{dark:"#000000",light:"#737373BF",hcDark:"#000000",hcLight:"#737373BF"},F("diffEditor.unchangedRegionShadow","The color of the shadow around unchanged region widgets."));const zg=ma("diff-insert",fe.add,F("diffInsertIcon","Line decoration for inserts in the diff editor.")),$g=ma("diff-remove",fe.remove,F("diffRemoveIcon","Line decoration for removals in the diff editor.")),mm=Oe.register({className:"line-insert",description:"line-insert",isWholeLine:!0,linesDecorationsClassName:"insert-sign "+Dn.asClassName(zg),marginClassName:"gutter-insert"}),_m=Oe.register({className:"line-delete",description:"line-delete",isWholeLine:!0,linesDecorationsClassName:"delete-sign "+Dn.asClassName($g),marginClassName:"gutter-delete"}),pm=Oe.register({className:"line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),vm=Oe.register({className:"line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),Cm=Oe.register({className:"char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),wm=Oe.register({className:"char-insert",description:"char-insert",isWholeLine:!0}),bm=Oe.register({className:"char-insert diff-range-empty",description:"char-insert diff-range-empty"}),ym=Oe.register({className:"char-delete",description:"char-delete",shouldFillLineOnLineBreak:!0}),Sm=Oe.register({className:"char-delete",description:"char-delete",isWholeLine:!0}),Lm=Oe.register({className:"char-delete diff-range-empty",description:"char-delete diff-range-empty"});var Ba=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Es=function(a,e){return function(t,i){e(t,i,a)}},at;const Ua=no("diffProviderFactoryService");let Ts=class{constructor(e){this.instantiationService=e}createDiffProvider(e){return this.instantiationService.createInstance(Is,e)}};Ts=Ba([Es(0,me)],Ts);ga(Ua,Ts,1);var pt;let Is=(pt=class{constructor(e,t,i){this.editorWorkerService=t,this.telemetryService=i,this.onDidChangeEventEmitter=new W,this.onDidChange=this.onDidChangeEventEmitter.event,this.diffAlgorithm="advanced",this.diffAlgorithmOnDidChangeSubscription=void 0,this.setOptions(e)}dispose(){var e;(e=this.diffAlgorithmOnDidChangeSubscription)==null||e.dispose()}async computeDiff(e,t,i,n){if(typeof this.diffAlgorithm!="string")return this.diffAlgorithm.computeDiff(e,t,i,n);if(e.isDisposed()||t.isDisposed())return{changes:[],identical:!0,quitEarly:!1,moves:[]};if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return t.getLineCount()===1&&t.getLineMaxColumn(1)===1?{changes:[],identical:!0,quitEarly:!1,moves:[]}:{changes:[new xi(new ee(1,2),new ee(1,t.getLineCount()+1),[new Js(e.getFullModelRange(),t.getFullModelRange())])],identical:!1,quitEarly:!1,moves:[]};const s=JSON.stringify([e.uri.toString(),t.uri.toString()]),o=JSON.stringify([e.id,t.id,e.getAlternativeVersionId(),t.getAlternativeVersionId(),JSON.stringify(i)]),r=at.diffCache.get(s);if(r&&r.context===o)return r.result;const d=Gr.create(),l=await this.editorWorkerService.computeDiff(e.uri,t.uri,i,this.diffAlgorithm),h=d.elapsed();if(this.telemetryService.publicLog2("diffEditor.computeDiff",{timeMs:h,timedOut:(l==null?void 0:l.quitEarly)??!0,detectedMoves:i.computeMoves?(l==null?void 0:l.moves.length)??0:-1}),n.isCancellationRequested)return{changes:[],identical:!1,quitEarly:!0,moves:[]};if(!l)throw new Error("no diff result available");return at.diffCache.size>10&&at.diffCache.delete(at.diffCache.keys().next().value),at.diffCache.set(s,{result:l,context:o}),l}setOptions(e){var i;let t=!1;e.diffAlgorithm&&this.diffAlgorithm!==e.diffAlgorithm&&((i=this.diffAlgorithmOnDidChangeSubscription)==null||i.dispose(),this.diffAlgorithmOnDidChangeSubscription=void 0,this.diffAlgorithm=e.diffAlgorithm,typeof e.diffAlgorithm!="string"&&(this.diffAlgorithmOnDidChangeSubscription=e.diffAlgorithm.onDidChange(()=>this.onDidChangeEventEmitter.fire())),t=!0),t&&this.onDidChangeEventEmitter.fire()}},at=pt,pt.diffCache=new Map,pt);Is=at=Ba([Es(1,ih),Es(2,ca)],Is);var Gg=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},jg=function(a,e){return function(t,i){e(t,i,a)}};let Os=class extends U{setActiveMovedText(e){this._activeMovedText.set(e,void 0)}constructor(e,t,i){super(),this.model=e,this._options=t,this._diffProviderFactoryService=i,this._isDiffUpToDate=$(this,!1),this.isDiffUpToDate=this._isDiffUpToDate,this._diff=$(this,void 0),this.diff=this._diff,this._unchangedRegions=$(this,void 0),this.unchangedRegions=I(this,r=>{var d;return this._options.hideUnchangedRegions.read(r)?((d=this._unchangedRegions.read(r))==null?void 0:d.regions)??[]:(Ce(l=>{var h;for(const c of((h=this._unchangedRegions.get())==null?void 0:h.regions)||[])c.collapseAll(l)}),[])}),this.movedTextToCompare=$(this,void 0),this._activeMovedText=$(this,void 0),this._hoveredMovedText=$(this,void 0),this.activeMovedText=I(this,r=>this.movedTextToCompare.read(r)??this._hoveredMovedText.read(r)??this._activeMovedText.read(r)),this._cancellationTokenSource=new Gs,this._diffProvider=I(this,r=>{const d=this._diffProviderFactoryService.createDiffProvider({diffAlgorithm:this._options.diffAlgorithm.read(r)}),l=Ne("onDidChange",d.onDidChange);return{diffProvider:d,onChangeSignal:l}}),this._register(be(()=>this._cancellationTokenSource.cancel()));const n=Ks("contentChangedSignal"),s=this._register(new gt(()=>n.trigger(void 0),200));this._register(Q(r=>{const d=this._unchangedRegions.read(r);if(!d||d.regions.some(_=>_.isDragged.read(r)))return;const l=d.originalDecorationIds.map(_=>e.original.getDecorationRange(_)).map(_=>_?ee.fromRangeInclusive(_):void 0),h=d.modifiedDecorationIds.map(_=>e.modified.getDecorationRange(_)).map(_=>_?ee.fromRangeInclusive(_):void 0),c=d.regions.map((_,C)=>!l[C]||!h[C]?void 0:new nt(l[C].startLineNumber,h[C].startLineNumber,l[C].length,_.visibleLineCountTop.read(r),_.visibleLineCountBottom.read(r))).filter(Gt),u=[];let f=!1;for(const _ of vd(c,(C,w)=>C.getHiddenModifiedRange(r).endLineNumberExclusive===w.getHiddenModifiedRange(r).startLineNumber))if(_.length>1){f=!0;const C=_.reduce((p,g)=>p+g.lineCount,0),w=new nt(_[0].originalLineNumber,_[0].modifiedLineNumber,C,_[0].visibleLineCountTop.get(),_[_.length-1].visibleLineCountBottom.get());u.push(w)}else u.push(_[0]);if(f){const _=e.original.deltaDecorations(d.originalDecorationIds,u.map(w=>({range:w.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),C=e.modified.deltaDecorations(d.modifiedDecorationIds,u.map(w=>({range:w.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));Ce(w=>{this._unchangedRegions.set({regions:u,originalDecorationIds:_,modifiedDecorationIds:C},w)})}}));const o=(r,d,l)=>{const h=nt.fromDiffs(r.changes,e.original.getLineCount(),e.modified.getLineCount(),this._options.hideUnchangedRegionsMinimumLineCount.read(l),this._options.hideUnchangedRegionsContextLineCount.read(l));let c;const u=this._unchangedRegions.get();if(u){const w=u.originalDecorationIds.map(m=>e.original.getDecorationRange(m)).map(m=>m?ee.fromRangeInclusive(m):void 0),p=u.modifiedDecorationIds.map(m=>e.modified.getDecorationRange(m)).map(m=>m?ee.fromRangeInclusive(m):void 0);let v=Bg(u.regions.map((m,b)=>{if(!w[b]||!p[b])return;const y=w[b].length;return new nt(w[b].startLineNumber,p[b].startLineNumber,y,Math.min(m.visibleLineCountTop.get(),y),Math.min(m.visibleLineCountBottom.get(),y-m.visibleLineCountTop.get()))}).filter(Gt),(m,b)=>!b||m.modifiedLineNumber>=b.modifiedLineNumber+b.lineCount&&m.originalLineNumber>=b.originalLineNumber+b.lineCount).map(m=>new ci(m.getHiddenOriginalRange(l),m.getHiddenModifiedRange(l)));v=ci.clip(v,ee.ofLength(1,e.original.getLineCount()),ee.ofLength(1,e.modified.getLineCount())),c=ci.inverse(v,e.original.getLineCount(),e.modified.getLineCount())}const f=[];if(c)for(const w of h){const p=c.filter(g=>g.original.intersectsStrict(w.originalUnchangedRange)&&g.modified.intersectsStrict(w.modifiedUnchangedRange));f.push(...w.setVisibleRanges(p,d))}else f.push(...h);const _=e.original.deltaDecorations((u==null?void 0:u.originalDecorationIds)||[],f.map(w=>({range:w.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),C=e.modified.deltaDecorations((u==null?void 0:u.modifiedDecorationIds)||[],f.map(w=>({range:w.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));this._unchangedRegions.set({regions:f,originalDecorationIds:_,modifiedDecorationIds:C},d)};this._register(e.modified.onDidChangeContent(r=>{if(this._diff.get()){const l=Ai.fromModelContentChanges(r.changes);this._lastDiff,e.original,e.modified}this._isDiffUpToDate.set(!1,void 0),s.schedule()})),this._register(e.original.onDidChangeContent(r=>{if(this._diff.get()){const l=Ai.fromModelContentChanges(r.changes);this._lastDiff,e.original,e.modified}this._isDiffUpToDate.set(!1,void 0),s.schedule()})),this._register(Fe(async(r,d)=>{this._options.hideUnchangedRegionsMinimumLineCount.read(r),this._options.hideUnchangedRegionsContextLineCount.read(r),s.cancel(),n.read(r);const l=this._diffProvider.read(r);l.onChangeSignal.read(r),Le(nh,r),Le(sh,r),this._isDiffUpToDate.set(!1,void 0);let h=[];d.add(e.original.onDidChangeContent(f=>{const _=Ai.fromModelContentChanges(f.changes);h=jo(h,_)}));let c=[];d.add(e.modified.onDidChangeContent(f=>{const _=Ai.fromModelContentChanges(f.changes);c=jo(c,_)}));let u=await l.diffProvider.computeDiff(e.original,e.modified,{ignoreTrimWhitespace:this._options.ignoreTrimWhitespace.read(r),maxComputationTimeMs:this._options.maxComputationTimeMs.read(r),computeMoves:this._options.showMoves.read(r)},this._cancellationTokenSource.token);this._cancellationTokenSource.token.isCancellationRequested||e.original.isDisposed()||e.modified.isDisposed()||(u=Zg(u,e.original,e.modified),u=(e.original,e.modified,void 0)??u,u=(e.original,e.modified,void 0)??u,Ce(f=>{o(u,f),this._lastDiff=u;const _=Co.fromDiffResult(u);this._diff.set(_,f),this._isDiffUpToDate.set(!0,f);const C=this.movedTextToCompare.get();this.movedTextToCompare.set(C?this._lastDiff.moves.find(w=>w.lineRangeMapping.modified.intersect(C.lineRangeMapping.modified)):void 0,f)}))}))}ensureModifiedLineIsVisible(e,t,i){var s,o;if(((s=this.diff.get())==null?void 0:s.mappings.length)===0)return;const n=((o=this._unchangedRegions.get())==null?void 0:o.regions)||[];for(const r of n)if(r.getHiddenModifiedRange(void 0).contains(e)){r.showModifiedLine(e,t,i);return}}ensureOriginalLineIsVisible(e,t,i){var s,o;if(((s=this.diff.get())==null?void 0:s.mappings.length)===0)return;const n=((o=this._unchangedRegions.get())==null?void 0:o.regions)||[];for(const r of n)if(r.getHiddenOriginalRange(void 0).contains(e)){r.showOriginalLine(e,t,i);return}}async waitForDiff(){await Cd(this.isDiffUpToDate,e=>e)}serializeState(){const e=this._unchangedRegions.get();return{collapsedRegions:e==null?void 0:e.regions.map(t=>({range:t.getHiddenModifiedRange(void 0).serialize()}))}}restoreSerializedState(e){var n;const t=(n=e.collapsedRegions)==null?void 0:n.map(s=>ee.deserialize(s.range)),i=this._unchangedRegions.get();!i||!t||Ce(s=>{for(const o of i.regions)for(const r of t)if(o.modifiedUnchangedRange.intersect(r)){o.setHiddenModifiedRange(r,s);break}})}};Os=Gg([jg(2,Ua)],Os);function Zg(a,e,t){return{changes:a.changes.map(i=>new xi(i.original,i.modified,i.innerChanges?i.innerChanges.map(n=>Kg(n,e,t)):void 0)),moves:a.moves,identical:a.identical,quitEarly:a.quitEarly}}function Kg(a,e,t){let i=a.originalRange,n=a.modifiedRange;return i.startColumn===1&&n.startColumn===1&&(i.endColumn!==1||n.endColumn!==1)&&i.endColumn===e.getLineMaxColumn(i.endLineNumber)&&n.endColumn===t.getLineMaxColumn(n.endLineNumber)&&i.endLineNumber<e.getLineCount()&&n.endLineNumber<t.getLineCount()&&(i=i.setEndPosition(i.endLineNumber+1,1),n=n.setEndPosition(n.endLineNumber+1,1)),new Js(i,n)}class Co{static fromDiffResult(e){return new Co(e.changes.map(t=>new Yg(t)),e.moves||[],e.identical,e.quitEarly)}constructor(e,t,i,n){this.mappings=e,this.movedTexts=t,this.identical=i,this.quitEarly=n}}class Yg{constructor(e){this.lineRangeMapping=e}}class nt{static fromDiffs(e,t,i,n,s){const o=xi.inverse(e,t,i),r=[];for(const d of o){let l=d.original.startLineNumber,h=d.modified.startLineNumber,c=d.original.length;const u=l===1&&h===1,f=l+c===t+1&&h+c===i+1;(u||f)&&c>=s+n?(u&&!f&&(c-=s),f&&!u&&(l+=s,h+=s,c-=s),r.push(new nt(l,h,c,0,0))):c>=s*2+n&&(l+=s,h+=s,c-=s*2,r.push(new nt(l,h,c,0,0)))}return r}get originalUnchangedRange(){return ee.ofLength(this.originalLineNumber,this.lineCount)}get modifiedUnchangedRange(){return ee.ofLength(this.modifiedLineNumber,this.lineCount)}constructor(e,t,i,n,s){this.originalLineNumber=e,this.modifiedLineNumber=t,this.lineCount=i,this._visibleLineCountTop=$(this,0),this.visibleLineCountTop=this._visibleLineCountTop,this._visibleLineCountBottom=$(this,0),this.visibleLineCountBottom=this._visibleLineCountBottom,this._shouldHideControls=I(this,d=>this.visibleLineCountTop.read(d)+this.visibleLineCountBottom.read(d)===this.lineCount&&!this.isDragged.read(d)),this.isDragged=$(this,void 0);const o=Math.max(Math.min(n,this.lineCount),0),r=Math.max(Math.min(s,this.lineCount-n),0);Ro(n===o),Ro(s===r),this._visibleLineCountTop.set(o,void 0),this._visibleLineCountBottom.set(r,void 0)}setVisibleRanges(e,t){const i=[],n=new io(e.map(d=>d.modified)).subtractFrom(this.modifiedUnchangedRange);let s=this.originalLineNumber,o=this.modifiedLineNumber;const r=this.modifiedLineNumber+this.lineCount;if(n.ranges.length===0)this.showAll(t),i.push(this);else{let d=0;for(const l of n.ranges){const h=d===n.ranges.length-1;d++;const c=(h?r:l.endLineNumberExclusive)-o,u=new nt(s,o,c,0,0);u.setHiddenModifiedRange(l,t),i.push(u),s=u.originalUnchangedRange.endLineNumberExclusive,o=u.modifiedUnchangedRange.endLineNumberExclusive}}return i}shouldHideControls(e){return this._shouldHideControls.read(e)}getHiddenOriginalRange(e){return ee.ofLength(this.originalLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}getHiddenModifiedRange(e){return ee.ofLength(this.modifiedLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}setHiddenModifiedRange(e,t){const i=e.startLineNumber-this.modifiedLineNumber,n=this.modifiedLineNumber+this.lineCount-e.endLineNumberExclusive;this.setState(i,n,t)}getMaxVisibleLineCountTop(){return this.lineCount-this._visibleLineCountBottom.get()}getMaxVisibleLineCountBottom(){return this.lineCount-this._visibleLineCountTop.get()}showMoreAbove(e=10,t){const i=this.getMaxVisibleLineCountTop();this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+e,i),t)}showMoreBelow(e=10,t){const i=this.lineCount-this._visibleLineCountTop.get();this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+e,i),t)}showAll(e){this._visibleLineCountBottom.set(this.lineCount-this._visibleLineCountTop.get(),e)}showModifiedLine(e,t,i){const n=e+1-(this.modifiedLineNumber+this._visibleLineCountTop.get()),s=this.modifiedLineNumber-this._visibleLineCountBottom.get()+this.lineCount-e;t===0&&n<s||t===1?this._visibleLineCountTop.set(this._visibleLineCountTop.get()+n,i):this._visibleLineCountBottom.set(this._visibleLineCountBottom.get()+s,i)}showOriginalLine(e,t,i){const n=e-this.originalLineNumber,s=this.originalLineNumber+this.lineCount-e;t===0&&n<s||t===1?this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+s-n,this.getMaxVisibleLineCountTop()),i):this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+n-s,this.getMaxVisibleLineCountBottom()),i)}collapseAll(e){this._visibleLineCountTop.set(0,e),this._visibleLineCountBottom.set(0,e)}setState(e,t,i){e=Math.max(Math.min(e,this.lineCount),0),t=Math.max(Math.min(t,this.lineCount-e),0),this._visibleLineCountTop.set(e,i),this._visibleLineCountBottom.set(t,i)}}const vi=class vi extends U{constructor(e,t,i,n,s){super(),this._rootElement=e,this._diffModel=t,this._originalEditorLayoutInfo=i,this._modifiedEditorLayoutInfo=n,this._editors=s,this._originalScrollTop=ce(this,this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=ce(this,this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._viewZonesChanged=Ne("onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this.width=$(this,0),this._modifiedViewZonesChangedSignal=Ne("modified.onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this._originalViewZonesChangedSignal=Ne("original.onDidChangeViewZones",this._editors.original.onDidChangeViewZones),this._state=Nn(this,(h,c)=>{var N;this._element.replaceChildren();const u=this._diffModel.read(h),f=(N=u==null?void 0:u.diff.read(h))==null?void 0:N.movedTexts;if(!f||f.length===0){this.width.set(0,void 0);return}this._viewZonesChanged.read(h);const _=this._originalEditorLayoutInfo.read(h),C=this._modifiedEditorLayoutInfo.read(h);if(!_||!C){this.width.set(0,void 0);return}this._modifiedViewZonesChangedSignal.read(h),this._originalViewZonesChangedSignal.read(h);const w=f.map(S=>{function L(ne,Y){const Pe=Y.getTopForLineNumber(ne.startLineNumber,!0),Ka=Y.getTopForLineNumber(ne.endLineNumberExclusive,!0);return(Pe+Ka)/2}const R=L(S.lineRangeMapping.original,this._editors.original),x=this._originalScrollTop.read(h),M=L(S.lineRangeMapping.modified,this._editors.modified),P=this._modifiedScrollTop.read(h),z=R-x,B=M-P,j=Math.min(R,M),ie=Math.max(R,M);return{range:new Ze(j,ie),from:z,to:B,fromWithoutScroll:R,toWithoutScroll:M,move:S}});w.sort(wd(Gi(S=>S.fromWithoutScroll>S.toWithoutScroll,yd),Gi(S=>S.fromWithoutScroll>S.toWithoutScroll?S.fromWithoutScroll:-S.toWithoutScroll,qs)));const p=wo.compute(w.map(S=>S.range)),g=10,v=_.verticalScrollbarWidth,m=(p.getTrackCount()-1)*10+g*2,b=v+m+(C.contentLeft-vi.movedCodeBlockPadding);let y=0;for(const S of w){const L=p.getTrack(y),R=v+g+L*10,x=15,M=15,P=b,z=C.glyphMarginWidth+C.lineNumbersWidth,B=18,j=document.createElementNS("http://www.w3.org/2000/svg","rect");j.classList.add("arrow-rectangle"),j.setAttribute("x",`${P-z}`),j.setAttribute("y",`${S.to-B/2}`),j.setAttribute("width",`${z}`),j.setAttribute("height",`${B}`),this._element.appendChild(j);const ie=document.createElementNS("http://www.w3.org/2000/svg","g"),ne=document.createElementNS("http://www.w3.org/2000/svg","path");ne.setAttribute("d",`M 0 ${S.from} L ${R} ${S.from} L ${R} ${S.to} L ${P-M} ${S.to}`),ne.setAttribute("fill","none"),ie.appendChild(ne);const Y=document.createElementNS("http://www.w3.org/2000/svg","polygon");Y.classList.add("arrow"),c.add(Q(Pe=>{ne.classList.toggle("currentMove",S.move===u.activeMovedText.read(Pe)),Y.classList.toggle("currentMove",S.move===u.activeMovedText.read(Pe))})),Y.setAttribute("points",`${P-M},${S.to-x/2} ${P},${S.to} ${P-M},${S.to+x/2}`),ie.appendChild(Y),this._element.appendChild(ie),y++}this.width.set(m,void 0)}),this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("class","moved-blocks-lines"),this._rootElement.appendChild(this._element),this._register(be(()=>this._element.remove())),this._register(Q(h=>{const c=this._originalEditorLayoutInfo.read(h),u=this._modifiedEditorLayoutInfo.read(h);!c||!u||(this._element.style.left=`${c.width-c.verticalScrollbarWidth}px`,this._element.style.height=`${c.height}px`,this._element.style.width=`${c.verticalScrollbarWidth+c.contentLeft-vi.movedCodeBlockPadding+this.width.read(h)}px`)})),this._register(Ys(this._state));const o=I(h=>{const c=this._diffModel.read(h),u=c==null?void 0:c.diff.read(h);return u?u.movedTexts.map(f=>({move:f,original:new At(Eo(f.lineRangeMapping.original.startLineNumber-1),18),modified:new At(Eo(f.lineRangeMapping.modified.startLineNumber-1),18)})):[]});this._register(on(this._editors.original,o.map(h=>h.map(c=>c.original)))),this._register(on(this._editors.modified,o.map(h=>h.map(c=>c.modified)))),this._register(Fe((h,c)=>{const u=o.read(h);for(const f of u)c.add(new Pr(this._editors.original,f.original,f.move,"original",this._diffModel.get())),c.add(new Pr(this._editors.modified,f.modified,f.move,"modified",this._diffModel.get()))}));const r=Ne("original.onDidFocusEditorWidget",h=>this._editors.original.onDidFocusEditorWidget(()=>setTimeout(()=>h(void 0),0))),d=Ne("modified.onDidFocusEditorWidget",h=>this._editors.modified.onDidFocusEditorWidget(()=>setTimeout(()=>h(void 0),0)));let l="modified";this._register(Zs({createEmptyChangeSummary:()=>{},handleChange:(h,c)=>(h.didChange(r)&&(l="original"),h.didChange(d)&&(l="modified"),!0)},h=>{r.read(h),d.read(h);const c=this._diffModel.read(h);if(!c)return;const u=c.diff.read(h);let f;if(u&&l==="original"){const _=this._editors.originalCursor.read(h);_&&(f=u.movedTexts.find(C=>C.lineRangeMapping.original.contains(_.lineNumber)))}if(u&&l==="modified"){const _=this._editors.modifiedCursor.read(h);_&&(f=u.movedTexts.find(C=>C.lineRangeMapping.modified.contains(_.lineNumber)))}f!==c.movedTextToCompare.get()&&c.movedTextToCompare.set(void 0,void 0),c.setActiveMovedText(f)}))}};vi.movedCodeBlockPadding=4;let As=vi;class wo{static compute(e){const t=[],i=[];for(const n of e){let s=t.findIndex(o=>!o.intersectsStrict(n));s===-1&&(t.length>=6?s=bd(t,Gi(r=>r.intersectWithRangeLength(n),qs)):(s=t.length,t.push(new oh))),t[s].addRange(n),i.push(s)}return new wo(t.length,i)}constructor(e,t){this._trackCount=e,this.trackPerLineIdx=t}getTrack(e){return this.trackPerLineIdx[e]}getTrackCount(){return this._trackCount}}class Pr extends vo{constructor(e,t,i,n,s){const o=k("div.diff-hidden-lines-widget");super(e,t,o.root),this._editor=e,this._move=i,this._kind=n,this._diffModel=s,this._nodes=k("div.diff-moved-code-block",{style:{marginRight:"4px"}},[k("div.text-content@textContent"),k("div.action-bar@actionBar")]),o.root.appendChild(this._nodes.root);const r=ce(this._editor.onDidLayoutChange,()=>this._editor.getLayoutInfo());this._register(Yt(this._nodes.root,{paddingRight:r.map(u=>u.verticalScrollbarWidth)}));let d;i.changes.length>0?d=this._kind==="original"?F("codeMovedToWithChanges","Code moved with changes to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):F("codeMovedFromWithChanges","Code moved with changes from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1):d=this._kind==="original"?F("codeMovedTo","Code moved to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):F("codeMovedFrom","Code moved from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1);const l=this._register(new uc(this._nodes.actionBar,{highlightToggledItems:!0})),h=new To("",d,"",!1);l.push(h,{icon:!1,label:!0});const c=new To("","Compare",Dn.asClassName(fe.compareChanges),!0,()=>{this._editor.focus(),this._diffModel.movedTextToCompare.set(this._diffModel.movedTextToCompare.get()===i?void 0:this._move,void 0)});this._register(Q(u=>{const f=this._diffModel.movedTextToCompare.read(u)===i;c.checked=f})),l.push(c,{icon:!1,label:!0})}}class qg extends U{constructor(e,t,i){super(),this._editor=e,this._domNode=t,this.itemProvider=i,this.scrollTop=ce(this,this._editor.onDidScrollChange,o=>this._editor.getScrollTop()),this.isScrollTopZero=this.scrollTop.map(o=>o===0),this.modelAttached=ce(this,this._editor.onDidChangeModel,o=>this._editor.hasModel()),this.editorOnDidChangeViewZones=Ne("onDidChangeViewZones",this._editor.onDidChangeViewZones),this.editorOnDidContentSizeChange=Ne("onDidContentSizeChange",this._editor.onDidContentSizeChange),this.domNodeSizeChanged=Ks("domNodeSizeChanged"),this.views=new Map,this._domNode.className="gutter monaco-editor";const n=this._domNode.appendChild(k("div.scroll-decoration",{role:"presentation",ariaHidden:"true",style:{width:"100%"}}).root),s=new ResizeObserver(()=>{Ce(o=>{this.domNodeSizeChanged.trigger(o)})});s.observe(this._domNode),this._register(be(()=>s.disconnect())),this._register(Q(o=>{n.className=this.isScrollTopZero.read(o)?"":"scroll-decoration"})),this._register(Q(o=>this.render(o)))}dispose(){super.dispose(),ss(this._domNode)}render(e){if(!this.modelAttached.read(e))return;this.domNodeSizeChanged.read(e),this.editorOnDidChangeViewZones.read(e),this.editorOnDidContentSizeChange.read(e);const t=this.scrollTop.read(e),i=this._editor.getVisibleRanges(),n=new Set(this.views.keys()),s=Ze.ofStartAndLength(0,this._domNode.clientHeight);if(!s.isEmpty)for(const o of i){const r=new ee(o.startLineNumber,o.endLineNumber+1),d=this.itemProvider.getIntersectingGutterItems(r,e);Ce(l=>{for(const h of d){if(!h.range.intersect(r))continue;n.delete(h.id);let c=this.views.get(h.id);if(c)c.item.set(h,l);else{const C=document.createElement("div");this._domNode.appendChild(C);const w=$("item",h),p=this.itemProvider.createView(w,C);c=new Qg(w,p,C),this.views.set(h.id,c)}const u=h.range.startLineNumber<=this._editor.getModel().getLineCount()?this._editor.getTopForLineNumber(h.range.startLineNumber,!0)-t:this._editor.getBottomForLineNumber(h.range.startLineNumber-1,!1)-t,_=(h.range.endLineNumberExclusive===1?Math.max(u,this._editor.getTopForLineNumber(h.range.startLineNumber,!1)-t):Math.max(u,this._editor.getBottomForLineNumber(h.range.endLineNumberExclusive-1,!0)-t))-u;c.domNode.style.top=`${u}px`,c.domNode.style.height=`${_}px`,c.gutterItemView.layout(Ze.ofStartAndLength(u,_),s)}})}for(const o of n){const r=this.views.get(o);r.gutterItemView.dispose(),r.domNode.remove(),this.views.delete(o)}}}class Qg{constructor(e,t,i){this.item=e,this.gutterItemView=t,this.domNode=i}}class za extends Sd{constructor(e){super(),this._getContext=e}runAction(e,t){const i=this._getContext();return super.runAction(e,i)}}var $a=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},zi=function(a,e){return function(t,i){e(t,i,a)}};const qn=[],ki=35;let Ps=class extends U{constructor(e,t,i,n,s,o,r,d,l){super(),this._diffModel=t,this._editors=i,this._options=n,this._sashLayout=s,this._boundarySashes=o,this._instantiationService=r,this._contextKeyService=d,this._menuService=l,this._menu=this._register(this._menuService.createMenu(se.DiffEditorHunkToolbar,this._contextKeyService)),this._actions=ce(this,this._menu.onDidChange,()=>this._menu.getActions()),this._hasActions=this._actions.map(h=>h.length>0),this._showSash=I(this,h=>this._options.renderSideBySide.read(h)&&this._hasActions.read(h)),this.width=I(this,h=>this._hasActions.read(h)?ki:0),this.elements=k("div.gutter@gutter",{style:{position:"absolute",height:"100%",width:ki+"px"}},[]),this._currentDiff=I(this,h=>{var _;const c=this._diffModel.read(h);if(!c)return;const u=(_=c.diff.read(h))==null?void 0:_.mappings,f=this._editors.modifiedCursor.read(h);if(f)return u==null?void 0:u.find(C=>C.lineRangeMapping.modified.contains(f.lineNumber))}),this._selectedDiffs=I(this,h=>{const c=this._diffModel.read(h),u=c==null?void 0:c.diff.read(h);if(!u)return qn;const f=this._editors.modifiedSelections.read(h);if(f.every(p=>p.isEmpty()))return qn;const _=new io(f.map(p=>ee.fromRangeInclusive(p))),w=u.mappings.filter(p=>p.lineRangeMapping.innerChanges&&_.intersects(p.lineRangeMapping.modified)).map(p=>({mapping:p,rangeMappings:p.lineRangeMapping.innerChanges.filter(g=>f.some(v=>A.areIntersecting(g.modifiedRange,v)))}));return w.length===0||w.every(p=>p.rangeMappings.length===0)?qn:w}),this._register(kg(e,this.elements.root)),this._register(O(this.elements.root,"click",()=>{this._editors.modified.focus()})),this._register(Yt(this.elements.root,{display:this._hasActions.map(h=>h?"block":"none")})),He(this,h=>this._showSash.read(h)?new Sa(e,this._sashLayout.dimensions,this._options.enableSplitViewResizing,this._boundarySashes,ea(this,u=>this._sashLayout.sashLeft.read(u)-ki,(u,f)=>this._sashLayout.sashLeft.set(u+ki,f)),()=>this._sashLayout.resetSash()):void 0).recomputeInitiallyAndOnChange(this._store),this._register(new qg(this._editors.modified,this.elements.root,{getIntersectingGutterItems:(h,c)=>{const u=this._diffModel.read(c);if(!u)return[];const f=u.diff.read(c);if(!f)return[];const _=this._selectedDiffs.read(c);if(_.length>0){const w=xi.fromRangeMappings(_.flatMap(p=>p.rangeMappings));return[new Wr(w,!0,se.DiffEditorSelectionToolbar,void 0,u.model.original.uri,u.model.modified.uri)]}const C=this._currentDiff.read(c);return f.mappings.map(w=>new Wr(w.lineRangeMapping.withInnerChangesFromLineRanges(),w.lineRangeMapping===(C==null?void 0:C.lineRangeMapping),se.DiffEditorHunkToolbar,void 0,u.model.original.uri,u.model.modified.uri))},createView:(h,c)=>this._instantiationService.createInstance(Ws,h,c,this)})),this._register(O(this.elements.gutter,K.MOUSE_WHEEL,h=>{this._editors.modified.getOption(104).handleMouseWheel&&this._editors.modified.delegateScrollFromMouseWheelEvent(h)},{passive:!1}))}computeStagedValue(e){const t=e.innerChanges??[],i=new Zo(this._editors.modifiedModel.get()),n=new Zo(this._editors.original.getModel());return new rh(t.map(r=>r.toTextEdit(i))).apply(n)}layout(e){this.elements.gutter.style.left=e+"px"}};Ps=$a([zi(6,me),zi(7,ye),zi(8,xh)],Ps);class Wr{constructor(e,t,i,n,s,o){this.mapping=e,this.showAlways=t,this.menuId=i,this.rangeOverride=n,this.originalUri=s,this.modifiedUri=o}get id(){return this.mapping.modified.toString()}get range(){return this.rangeOverride??this.mapping.modified}}let Ws=class extends U{constructor(e,t,i,n){super(),this._item=e,this._elements=k("div.gutterItem",{style:{height:"20px",width:"34px"}},[k("div.background@background",{},[]),k("div.buttons@buttons",{},[])]),this._showAlways=this._item.map(this,o=>o.showAlways),this._menuId=this._item.map(this,o=>o.menuId),this._isSmall=$(this,!1),this._lastItemRange=void 0,this._lastViewRange=void 0;const s=this._register(n.createInstance(Rh,"element",!0,{position:{hoverPosition:1}}));this._register(di(t,this._elements.root)),this._register(Q(o=>{const r=this._showAlways.read(o);this._elements.root.classList.toggle("noTransition",!0),this._elements.root.classList.toggle("showAlways",r),setTimeout(()=>{this._elements.root.classList.toggle("noTransition",!1)},0)})),this._register(Fe((o,r)=>{this._elements.buttons.replaceChildren();const d=r.add(n.createInstance(_a,this._elements.buttons,this._menuId.read(o),{orientation:1,hoverDelegate:s,toolbarOptions:{primaryGroup:l=>l.startsWith("primary")},overflowBehavior:{maxItems:this._isSmall.read(o)?1:3},hiddenItemStrategy:0,actionRunner:new za(()=>{const l=this._item.get(),h=l.mapping;return{mapping:h,originalWithModifiedChanges:i.computeStagedValue(h),originalUri:l.originalUri,modifiedUri:l.modifiedUri}}),menuOptions:{shouldForwardArgs:!0}}));r.add(d.onDidChangeMenuItems(()=>{this._lastItemRange&&this.layout(this._lastItemRange,this._lastViewRange)}))}))}layout(e,t){this._lastItemRange=e,this._lastViewRange=t;let i=this._elements.buttons.clientHeight;this._isSmall.set(this._item.get().mapping.original.startLineNumber===1&&e.length<30,void 0),i=this._elements.buttons.clientHeight;const n=e.length/2-i/2,s=i;let o=e.start+n;const r=Ze.tryCreate(s,t.endExclusive-s-i),d=Ze.tryCreate(e.start+s,e.endExclusive-i-s);d&&r&&d.start<d.endExclusive&&(o=r.clip(o),o=d.clip(o)),this._elements.buttons.style.top=`${o-e.start}px`}};Ws=$a([zi(3,me)],Ws);function Hs(a){return ks.get(a)}const Je=class Je extends U{static get(e){let t=Je._map.get(e);if(!t){t=new Je(e),Je._map.set(e,t);const i=e.onDidDispose(()=>{const n=Je._map.get(e);n&&(Je._map.delete(e),n.dispose(),i.dispose())})}return t}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&(this._currentTransaction=new Ld(()=>{}))}_endUpdate(){if(this._updateCounter--,this._updateCounter===0){const e=this._currentTransaction;this._currentTransaction=void 0,e.finish()}}constructor(e){var t;super(),this.editor=e,this._updateCounter=0,this._currentTransaction=void 0,this._model=$(this,this.editor.getModel()),this.model=this._model,this.isReadonly=ce(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(92)),this._versionId=Io({owner:this,lazy:!0},((t=this.editor.getModel())==null?void 0:t.getVersionId())??null),this.versionId=this._versionId,this._selections=Io({owner:this,equalsFn:Oo(Dd(we.selectionsEqual)),lazy:!0},this.editor.getSelections()??null),this.selections=this._selections,this.isFocused=ce(this,i=>{const n=this.editor.onDidFocusEditorWidget(i),s=this.editor.onDidBlurEditorWidget(i);return{dispose(){n.dispose(),s.dispose()}}},()=>this.editor.hasWidgetFocus()),this.value=ea(this,i=>{var n;return this.versionId.read(i),((n=this.model.read(i))==null?void 0:n.getValue())??""},(i,n)=>{const s=this.model.get();s!==null&&i!==s.getValue()&&s.setValue(i)}),this.valueIsEmpty=I(this,i=>{var n;return this.versionId.read(i),((n=this.editor.getModel())==null?void 0:n.getValueLength())===0}),this.cursorSelection=Nd({owner:this,equalsFn:Oo(we.selectionsEqual)},i=>{var n;return((n=this.selections.read(i))==null?void 0:n[0])??null}),this.onDidType=Ks(this),this.scrollTop=ce(this.editor.onDidScrollChange,()=>this.editor.getScrollTop()),this.scrollLeft=ce(this.editor.onDidScrollChange,()=>this.editor.getScrollLeft()),this.layoutInfo=ce(this.editor.onDidLayoutChange,()=>this.editor.getLayoutInfo()),this.layoutInfoContentLeft=this.layoutInfo.map(i=>i.contentLeft),this.layoutInfoDecorationsLeft=this.layoutInfo.map(i=>i.decorationsLeft),this.contentWidth=ce(this.editor.onDidContentSizeChange,()=>this.editor.getContentWidth()),this._overlayWidgetCounter=0,this._register(this.editor.onBeginUpdate(()=>this._beginUpdate())),this._register(this.editor.onEndUpdate(()=>this._endUpdate())),this._register(this.editor.onDidChangeModel(()=>{this._beginUpdate();try{this._model.set(this.editor.getModel(),this._currentTransaction),this._forceUpdate()}finally{this._endUpdate()}})),this._register(this.editor.onDidType(i=>{this._beginUpdate();try{this._forceUpdate(),this.onDidType.trigger(this._currentTransaction,i)}finally{this._endUpdate()}})),this._register(this.editor.onDidChangeModelContent(i=>{var n;this._beginUpdate();try{this._versionId.set(((n=this.editor.getModel())==null?void 0:n.getVersionId())??null,this._currentTransaction,i),this._forceUpdate()}finally{this._endUpdate()}})),this._register(this.editor.onDidChangeCursorSelection(i=>{this._beginUpdate();try{this._selections.set(this.editor.getSelections(),this._currentTransaction,i),this._forceUpdate()}finally{this._endUpdate()}}))}forceUpdate(e){this._beginUpdate();try{return this._forceUpdate(),e?e(this._currentTransaction):void 0}finally{this._endUpdate()}}_forceUpdate(){var e;this._beginUpdate();try{this._model.set(this.editor.getModel(),this._currentTransaction),this._versionId.set(((e=this.editor.getModel())==null?void 0:e.getVersionId())??null,this._currentTransaction,void 0),this._selections.set(this.editor.getSelections(),this._currentTransaction,void 0)}finally{this._endUpdate()}}getOption(e){return ce(this,t=>this.editor.onDidChangeConfiguration(i=>{i.hasChanged(e)&&t(void 0)}),()=>this.editor.getOption(e))}setDecorations(e){const t=new Me,i=this.editor.createDecorationsCollection();return t.add(Jr({owner:this,debugName:()=>`Apply decorations from ${e.debugName}`},n=>{const s=e.read(n);i.set(s)})),t.add({dispose:()=>{i.clear()}}),t}createOverlayWidget(e){const t="observableOverlayWidget"+this._overlayWidgetCounter++,i={getDomNode:()=>e.domNode,getPosition:()=>e.position.get(),getId:()=>t,allowEditorOverflow:e.allowEditorOverflow,getMinContentWidthInPx:()=>e.minContentWidthInPx.get()};this.editor.addOverlayWidget(i);const n=Q(s=>{e.position.read(s),e.minContentWidthInPx.read(s),this.editor.layoutOverlayWidget(i)});return be(()=>{n.dispose(),this.editor.removeOverlayWidget(i)})}};Je._map=new Map;let ks=Je;function Xg(a,e){return Md({createEmptyChangeSummary:()=>({deltas:[],didChange:!1}),handleChange:(t,i)=>{if(t.didChange(a)){const n=t.change;n!==void 0&&i.deltas.push(n),i.didChange=!0}return!0}},(t,i)=>{const n=a.read(t);i.didChange&&e(n,i.deltas)})}function Rm(a,e){const t=new Me,i=Xg(a,(n,s)=>{t.clear(),e(n,s,t)});return{dispose(){i.dispose(),t.dispose()}}}var Jg=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},ef=function(a,e){return function(t,i){e(t,i,a)}},$i,vt;let Fs=(vt=class extends U{static setBreadcrumbsSourceFactory(e){this._breadcrumbsSourceFactory.set(e,void 0)}get isUpdatingHiddenAreas(){return this._isUpdatingHiddenAreas}constructor(e,t,i,n){super(),this._editors=e,this._diffModel=t,this._options=i,this._instantiationService=n,this._modifiedOutlineSource=He(this,d=>{const l=this._editors.modifiedModel.read(d),h=$i._breadcrumbsSourceFactory.read(d);return!l||!h?void 0:h(l,this._instantiationService)}),this._isUpdatingHiddenAreas=!1,this._register(this._editors.original.onDidChangeCursorPosition(d=>{if(d.reason===1)return;const l=this._diffModel.get();Ce(h=>{for(const c of this._editors.original.getSelections()||[])l==null||l.ensureOriginalLineIsVisible(c.getStartPosition().lineNumber,0,h),l==null||l.ensureOriginalLineIsVisible(c.getEndPosition().lineNumber,0,h)})})),this._register(this._editors.modified.onDidChangeCursorPosition(d=>{if(d.reason===1)return;const l=this._diffModel.get();Ce(h=>{for(const c of this._editors.modified.getSelections()||[])l==null||l.ensureModifiedLineIsVisible(c.getStartPosition().lineNumber,0,h),l==null||l.ensureModifiedLineIsVisible(c.getEndPosition().lineNumber,0,h)})}));const s=this._diffModel.map((d,l)=>{var c;const h=(d==null?void 0:d.unchangedRegions.read(l))??[];return h.length===1&&h[0].modifiedLineNumber===1&&h[0].lineCount===((c=this._editors.modifiedModel.read(l))==null?void 0:c.getLineCount())?[]:h});this.viewZones=Nn(this,(d,l)=>{const h=this._modifiedOutlineSource.read(d);if(!h)return{origViewZones:[],modViewZones:[]};const c=[],u=[],f=this._options.renderSideBySide.read(d),_=this._options.compactMode.read(d),C=s.read(d);for(let w=0;w<C.length;w++){const p=C[w];if(!p.shouldHideControls(d)&&!(_&&(w===0||w===C.length-1)))if(_){{const g=I(this,m=>p.getHiddenOriginalRange(m).startLineNumber-1),v=new At(g,12);c.push(v),l.add(new Hr(this._editors.original,v,p,!f))}{const g=I(this,m=>p.getHiddenModifiedRange(m).startLineNumber-1),v=new At(g,12);u.push(v),l.add(new Hr(this._editors.modified,v,p))}}else{{const g=I(this,m=>p.getHiddenOriginalRange(m).startLineNumber-1),v=new At(g,24);c.push(v),l.add(new kr(this._editors.original,v,p,p.originalUnchangedRange,!f,h,m=>this._diffModel.get().ensureModifiedLineIsVisible(m,2,void 0),this._options))}{const g=I(this,m=>p.getHiddenModifiedRange(m).startLineNumber-1),v=new At(g,24);u.push(v),l.add(new kr(this._editors.modified,v,p,p.modifiedUnchangedRange,!1,h,m=>this._diffModel.get().ensureModifiedLineIsVisible(m,2,void 0),this._options))}}}return{origViewZones:c,modViewZones:u}});const o={description:"unchanged lines",className:"diff-unchanged-lines",isWholeLine:!0},r={description:"Fold Unchanged",glyphMarginHoverMessage:new xd(void 0,{isTrusted:!0,supportThemeIcons:!0}).appendMarkdown(F("foldUnchanged","Fold Unchanged Region")),glyphMarginClassName:"fold-unchanged "+Dn.asClassName(fe.fold),zIndex:10001};this._register(Ir(this._editors.original,I(this,d=>{const l=s.read(d),h=l.map(c=>({range:c.originalUnchangedRange.toInclusiveRange(),options:o}));for(const c of l)c.shouldHideControls(d)&&h.push({range:A.fromPositions(new T(c.originalLineNumber,1)),options:r});return h}))),this._register(Ir(this._editors.modified,I(this,d=>{const l=s.read(d),h=l.map(c=>({range:c.modifiedUnchangedRange.toInclusiveRange(),options:o}));for(const c of l)c.shouldHideControls(d)&&h.push({range:ee.ofLength(c.modifiedLineNumber,1).toInclusiveRange(),options:r});return h}))),this._register(Q(d=>{const l=s.read(d);this._isUpdatingHiddenAreas=!0;try{this._editors.original.setHiddenAreas(l.map(h=>h.getHiddenOriginalRange(d).toInclusiveRange()).filter(Gt)),this._editors.modified.setHiddenAreas(l.map(h=>h.getHiddenModifiedRange(d).toInclusiveRange()).filter(Gt))}finally{this._isUpdatingHiddenAreas=!1}})),this._register(this._editors.modified.onMouseUp(d=>{var l;if(!d.event.rightButton&&d.target.position&&((l=d.target.element)!=null&&l.className.includes("fold-unchanged"))){const h=d.target.position.lineNumber,c=this._diffModel.get();if(!c)return;const u=c.unchangedRegions.get().find(f=>f.modifiedUnchangedRange.includes(h));if(!u)return;u.collapseAll(void 0),d.event.stopPropagation(),d.event.preventDefault()}})),this._register(this._editors.original.onMouseUp(d=>{var l;if(!d.event.rightButton&&d.target.position&&((l=d.target.element)!=null&&l.className.includes("fold-unchanged"))){const h=d.target.position.lineNumber,c=this._diffModel.get();if(!c)return;const u=c.unchangedRegions.get().find(f=>f.originalUnchangedRange.includes(h));if(!u)return;u.collapseAll(void 0),d.event.stopPropagation(),d.event.preventDefault()}}))}},$i=vt,vt._breadcrumbsSourceFactory=$($i,()=>({dispose(){},getBreadcrumbItems(e,t){return[]}})),vt);Fs=$i=Jg([ef(3,me)],Fs);class Hr extends vo{constructor(e,t,i,n=!1){const s=k("div.diff-hidden-lines-widget");super(e,t,s.root),this._unchangedRegion=i,this._hide=n,this._nodes=k("div.diff-hidden-lines-compact",[k("div.line-left",[]),k("div.text@text",[]),k("div.line-right",[])]),s.root.appendChild(this._nodes.root),this._hide&&this._nodes.root.replaceChildren(),this._register(Q(o=>{if(!this._hide){const r=this._unchangedRegion.getHiddenModifiedRange(o).length,d=F("hiddenLines","{0} hidden lines",r);this._nodes.text.innerText=d}}))}}class kr extends vo{constructor(e,t,i,n,s,o,r,d){const l=k("div.diff-hidden-lines-widget");super(e,t,l.root),this._editor=e,this._unchangedRegion=i,this._unchangedRegionRange=n,this._hide=s,this._modifiedOutlineSource=o,this._revealModifiedHiddenLine=r,this._options=d,this._nodes=k("div.diff-hidden-lines",[k("div.top@top",{title:F("diff.hiddenLines.top","Click or drag to show more above")}),k("div.center@content",{style:{display:"flex"}},[k("div@first",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexShrink:"0"}},[Bi("a",{title:F("showUnchangedRegion","Show Unchanged Region"),role:"button",onclick:()=>{this._unchangedRegion.showAll(void 0)}},...gc("$(unfold)"))]),k("div@others",{style:{display:"flex",justifyContent:"center",alignItems:"center"}})]),k("div.bottom@bottom",{title:F("diff.bottom","Click or drag to show more below"),role:"button"})]),l.root.appendChild(this._nodes.root),this._hide?ss(this._nodes.first):this._register(Yt(this._nodes.first,{width:Hs(this._editor).layoutInfoContentLeft})),this._register(Q(c=>{const u=this._unchangedRegion.visibleLineCountTop.read(c)+this._unchangedRegion.visibleLineCountBottom.read(c)===this._unchangedRegion.lineCount;this._nodes.bottom.classList.toggle("canMoveTop",!u),this._nodes.bottom.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(c)>0),this._nodes.top.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(c)>0),this._nodes.top.classList.toggle("canMoveBottom",!u);const f=this._unchangedRegion.isDragged.read(c),_=this._editor.getDomNode();_&&(_.classList.toggle("draggingUnchangedRegion",!!f),f==="top"?(_.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(c)>0),_.classList.toggle("canMoveBottom",!u)):f==="bottom"?(_.classList.toggle("canMoveTop",!u),_.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(c)>0)):(_.classList.toggle("canMoveTop",!1),_.classList.toggle("canMoveBottom",!1)))}));const h=this._editor;this._register(O(this._nodes.top,"mousedown",c=>{if(c.button!==0)return;this._nodes.top.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),c.preventDefault();const u=c.clientY;let f=!1;const _=this._unchangedRegion.visibleLineCountTop.get();this._unchangedRegion.isDragged.set("top",void 0);const C=G(this._nodes.top),w=O(C,"mousemove",g=>{const m=g.clientY-u;f=f||Math.abs(m)>2;const b=Math.round(m/h.getOption(67)),y=Math.max(0,Math.min(_+b,this._unchangedRegion.getMaxVisibleLineCountTop()));this._unchangedRegion.visibleLineCountTop.set(y,void 0)}),p=O(C,"mouseup",g=>{f||this._unchangedRegion.showMoreAbove(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0),this._nodes.top.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),this._unchangedRegion.isDragged.set(void 0,void 0),w.dispose(),p.dispose()})})),this._register(O(this._nodes.bottom,"mousedown",c=>{if(c.button!==0)return;this._nodes.bottom.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),c.preventDefault();const u=c.clientY;let f=!1;const _=this._unchangedRegion.visibleLineCountBottom.get();this._unchangedRegion.isDragged.set("bottom",void 0);const C=G(this._nodes.bottom),w=O(C,"mousemove",g=>{const m=g.clientY-u;f=f||Math.abs(m)>2;const b=Math.round(m/h.getOption(67)),y=Math.max(0,Math.min(_-b,this._unchangedRegion.getMaxVisibleLineCountBottom())),N=this._unchangedRegionRange.endLineNumberExclusive>h.getModel().getLineCount()?h.getContentHeight():h.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.visibleLineCountBottom.set(y,void 0);const S=this._unchangedRegionRange.endLineNumberExclusive>h.getModel().getLineCount()?h.getContentHeight():h.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);h.setScrollTop(h.getScrollTop()+(S-N))}),p=O(C,"mouseup",g=>{if(this._unchangedRegion.isDragged.set(void 0,void 0),!f){const v=h.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.showMoreBelow(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0);const m=h.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);h.setScrollTop(h.getScrollTop()+(m-v))}this._nodes.bottom.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),w.dispose(),p.dispose()})})),this._register(Q(c=>{const u=[];if(!this._hide){const f=i.getHiddenModifiedRange(c).length,_=F("hiddenLines","{0} hidden lines",f),C=Bi("span",{title:F("diff.hiddenLines.expandAll","Double click to unfold")},_);C.addEventListener("dblclick",g=>{g.button===0&&(g.preventDefault(),this._unchangedRegion.showAll(void 0))}),u.push(C);const w=this._unchangedRegion.getHiddenModifiedRange(c),p=this._modifiedOutlineSource.getBreadcrumbItems(w,c);if(p.length>0){u.push(Bi("span",void 0,"  |  "));for(let g=0;g<p.length;g++){const v=p[g],m=ah.toIcon(v.kind),b=k("div.breadcrumb-item",{style:{display:"flex",alignItems:"center"}},[os(m)," ",v.name,...g===p.length-1?[]:[os(fe.chevronRight)]]).root;u.push(b),b.onclick=()=>{this._revealModifiedHiddenLine(v.startLineNumber)}}}}ss(this._nodes.others,...u)}))}}var tf=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},nf=function(a,e){return function(t,i){e(t,i,a)}},Te,Ye;let Vs=(Ye=class extends U{constructor(e,t,i,n,s,o,r){super(),this._editors=e,this._rootElement=t,this._diffModel=i,this._rootWidth=n,this._rootHeight=s,this._modifiedEditorLayoutInfo=o,this._themeService=r,this.width=Te.ENTIRE_DIFF_OVERVIEW_WIDTH;const d=ce(this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme()),l=I(u=>{const f=d.read(u),_=f.getColor(Eh)||(f.getColor(Ih)||Th).transparent(2),C=f.getColor(Oh)||(f.getColor(Ph)||Ah).transparent(2);return{insertColor:_,removeColor:C}}),h=V(document.createElement("div"));h.setClassName("diffViewport"),h.setPosition("absolute");const c=k("div.diffOverview",{style:{position:"absolute",top:"0px",width:Te.ENTIRE_DIFF_OVERVIEW_WIDTH+"px"}}).root;this._register(di(c,h.domNode)),this._register(fi(c,K.POINTER_DOWN,u=>{this._editors.modified.delegateVerticalScrollbarPointerDown(u)})),this._register(O(c,K.MOUSE_WHEEL,u=>{this._editors.modified.delegateScrollFromMouseWheelEvent(u)},{passive:!1})),this._register(di(this._rootElement,c)),this._register(Fe((u,f)=>{const _=this._diffModel.read(u),C=this._editors.original.createOverviewRuler("original diffOverviewRuler");C&&(f.add(C),f.add(di(c,C.getDomNode())));const w=this._editors.modified.createOverviewRuler("modified diffOverviewRuler");if(w&&(f.add(w),f.add(di(c,w.getDomNode()))),!C||!w)return;const p=Ne("viewZoneChanged",this._editors.original.onDidChangeViewZones),g=Ne("viewZoneChanged",this._editors.modified.onDidChangeViewZones),v=Ne("hiddenRangesChanged",this._editors.original.onDidChangeHiddenAreas),m=Ne("hiddenRangesChanged",this._editors.modified.onDidChangeHiddenAreas);f.add(Q(b=>{var x;p.read(b),g.read(b),v.read(b),m.read(b);const y=l.read(b),N=(x=_==null?void 0:_.diff.read(b))==null?void 0:x.mappings;function S(M,P,z){const B=z._getViewModel();return B?M.filter(j=>j.length>0).map(j=>{const ie=B.coordinatesConverter.convertModelPositionToViewPosition(new T(j.startLineNumber,1)),ne=B.coordinatesConverter.convertModelPositionToViewPosition(new T(j.endLineNumberExclusive,1)),Y=ne.lineNumber-ie.lineNumber;return new dh(ie.lineNumber,ne.lineNumber,Y,P.toString())}):[]}const L=S((N||[]).map(M=>M.lineRangeMapping.original),y.removeColor,this._editors.original),R=S((N||[]).map(M=>M.lineRangeMapping.modified),y.insertColor,this._editors.modified);C==null||C.setZones(L),w==null||w.setZones(R)})),f.add(Q(b=>{const y=this._rootHeight.read(b),N=this._rootWidth.read(b),S=this._modifiedEditorLayoutInfo.read(b);if(S){const L=Te.ENTIRE_DIFF_OVERVIEW_WIDTH-2*Te.ONE_OVERVIEW_WIDTH;C.setLayout({top:0,height:y,right:L+Te.ONE_OVERVIEW_WIDTH,width:Te.ONE_OVERVIEW_WIDTH}),w.setLayout({top:0,height:y,right:0,width:Te.ONE_OVERVIEW_WIDTH});const R=this._editors.modifiedScrollTop.read(b),x=this._editors.modifiedScrollHeight.read(b),M=this._editors.modified.getOption(104),P=new fc(M.verticalHasArrows?M.arrowSize:0,M.verticalScrollbarSize,0,S.height,x,R);h.setTop(P.getSliderPosition()),h.setHeight(P.getSliderSize())}else h.setTop(0),h.setHeight(0);c.style.height=y+"px",c.style.left=N-Te.ENTIRE_DIFF_OVERVIEW_WIDTH+"px",h.setWidth(Te.ENTIRE_DIFF_OVERVIEW_WIDTH)}))}))}},Te=Ye,Ye.ONE_OVERVIEW_WIDTH=15,Ye.ENTIRE_DIFF_OVERVIEW_WIDTH=Ye.ONE_OVERVIEW_WIDTH*2,Ye);Vs=Te=tf([nf(6,Tn)],Vs);const Qn=[];class sf extends U{constructor(e,t,i,n){super(),this._editors=e,this._diffModel=t,this._options=i,this._widget=n,this._selectedDiffs=I(this,s=>{const o=this._diffModel.read(s),r=o==null?void 0:o.diff.read(s);if(!r)return Qn;const d=this._editors.modifiedSelections.read(s);if(d.every(u=>u.isEmpty()))return Qn;const l=new io(d.map(u=>ee.fromRangeInclusive(u))),c=r.mappings.filter(u=>u.lineRangeMapping.innerChanges&&l.intersects(u.lineRangeMapping.modified)).map(u=>({mapping:u,rangeMappings:u.lineRangeMapping.innerChanges.filter(f=>d.some(_=>A.areIntersecting(f.modifiedRange,_)))}));return c.length===0||c.every(u=>u.rangeMappings.length===0)?Qn:c}),this._register(Fe((s,o)=>{if(!this._options.shouldRenderOldRevertArrows.read(s))return;const r=this._diffModel.read(s),d=r==null?void 0:r.diff.read(s);if(!r||!d||r.movedTextToCompare.read(s))return;const l=[],h=this._selectedDiffs.read(s),c=new Set(h.map(u=>u.mapping));if(h.length>0){const u=this._editors.modifiedSelections.read(s),f=o.add(new an(u[u.length-1].positionLineNumber,this._widget,h.flatMap(_=>_.rangeMappings),!0));this._editors.modified.addGlyphMarginWidget(f),l.push(f)}for(const u of d.mappings)if(!c.has(u)&&!u.lineRangeMapping.modified.isEmpty&&u.lineRangeMapping.innerChanges){const f=o.add(new an(u.lineRangeMapping.modified.startLineNumber,this._widget,u.lineRangeMapping,!1));this._editors.modified.addGlyphMarginWidget(f),l.push(f)}o.add(be(()=>{for(const u of l)this._editors.modified.removeGlyphMarginWidget(u)}))}))}}const wn=class wn extends U{getId(){return this._id}constructor(e,t,i,n){super(),this._lineNumber=e,this._widget=t,this._diffs=i,this._revertSelection=n,this._id=`revertButton${wn.counter++}`,this._domNode=k("div.revertButton",{title:this._revertSelection?F("revertSelectedChanges","Revert Selected Changes"):F("revertChange","Revert Change")},[os(fe.arrowRight)]).root,this._register(O(this._domNode,K.MOUSE_DOWN,s=>{s.button!==2&&(s.stopPropagation(),s.preventDefault())})),this._register(O(this._domNode,K.MOUSE_UP,s=>{s.stopPropagation(),s.preventDefault()})),this._register(O(this._domNode,K.CLICK,s=>{this._diffs instanceof ci?this._widget.revert(this._diffs):this._widget.revertRangeMappings(this._diffs),s.stopPropagation(),s.preventDefault()}))}getDomNode(){return this._domNode}getPosition(){return{lane:to.Right,range:{startColumn:1,startLineNumber:this._lineNumber,endColumn:1,endLineNumber:this._lineNumber},zIndex:10001}}};wn.counter=0;let an=wn;const bn=class bn extends U{constructor(){super(...arguments),this._id=++bn.idCounter,this._onDidDispose=this._register(new W),this.onDidDispose=this._onDidDispose.event}getId(){return this.getEditorType()+":v2:"+this._id}getVisibleColumnFromPosition(e){return this._targetEditor.getVisibleColumnFromPosition(e)}getPosition(){return this._targetEditor.getPosition()}setPosition(e,t="api"){this._targetEditor.setPosition(e,t)}revealLine(e,t=0){this._targetEditor.revealLine(e,t)}revealLineInCenter(e,t=0){this._targetEditor.revealLineInCenter(e,t)}revealLineInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealLineInCenterIfOutsideViewport(e,t)}revealLineNearTop(e,t=0){this._targetEditor.revealLineNearTop(e,t)}revealPosition(e,t=0){this._targetEditor.revealPosition(e,t)}revealPositionInCenter(e,t=0){this._targetEditor.revealPositionInCenter(e,t)}revealPositionInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealPositionInCenterIfOutsideViewport(e,t)}revealPositionNearTop(e,t=0){this._targetEditor.revealPositionNearTop(e,t)}getSelection(){return this._targetEditor.getSelection()}getSelections(){return this._targetEditor.getSelections()}setSelection(e,t="api"){this._targetEditor.setSelection(e,t)}setSelections(e,t="api"){this._targetEditor.setSelections(e,t)}revealLines(e,t,i=0){this._targetEditor.revealLines(e,t,i)}revealLinesInCenter(e,t,i=0){this._targetEditor.revealLinesInCenter(e,t,i)}revealLinesInCenterIfOutsideViewport(e,t,i=0){this._targetEditor.revealLinesInCenterIfOutsideViewport(e,t,i)}revealLinesNearTop(e,t,i=0){this._targetEditor.revealLinesNearTop(e,t,i)}revealRange(e,t=0,i=!1,n=!0){this._targetEditor.revealRange(e,t,i,n)}revealRangeInCenter(e,t=0){this._targetEditor.revealRangeInCenter(e,t)}revealRangeInCenterIfOutsideViewport(e,t=0){this._targetEditor.revealRangeInCenterIfOutsideViewport(e,t)}revealRangeNearTop(e,t=0){this._targetEditor.revealRangeNearTop(e,t)}revealRangeNearTopIfOutsideViewport(e,t=0){this._targetEditor.revealRangeNearTopIfOutsideViewport(e,t)}revealRangeAtTop(e,t=0){this._targetEditor.revealRangeAtTop(e,t)}getSupportedActions(){return this._targetEditor.getSupportedActions()}focus(){this._targetEditor.focus()}trigger(e,t,i){this._targetEditor.trigger(e,t,i)}createDecorationsCollection(e){return this._targetEditor.createDecorationsCollection(e)}changeDecorations(e){return this._targetEditor.changeDecorations(e)}};bn.idCounter=0;let Bs=bn;var of=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},rf=function(a,e){return function(t,i){e(t,i,a)}};let Us=class{get editorOptions(){return this._options}constructor(e,t){this._accessibilityService=t,this._diffEditorWidth=$(this,0),this._screenReaderMode=ce(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this.couldShowInlineViewBecauseOfSize=I(this,n=>this._options.read(n).renderSideBySide&&this._diffEditorWidth.read(n)<=this._options.read(n).renderSideBySideInlineBreakpoint),this.renderOverviewRuler=I(this,n=>this._options.read(n).renderOverviewRuler),this.renderSideBySide=I(this,n=>this.compactMode.read(n)&&this.shouldRenderInlineViewInSmartMode.read(n)?!1:this._options.read(n).renderSideBySide&&!(this._options.read(n).useInlineViewWhenSpaceIsLimited&&this.couldShowInlineViewBecauseOfSize.read(n)&&!this._screenReaderMode.read(n))),this.readOnly=I(this,n=>this._options.read(n).readOnly),this.shouldRenderOldRevertArrows=I(this,n=>!(!this._options.read(n).renderMarginRevertIcon||!this.renderSideBySide.read(n)||this.readOnly.read(n)||this.shouldRenderGutterMenu.read(n))),this.shouldRenderGutterMenu=I(this,n=>this._options.read(n).renderGutterMenu),this.renderIndicators=I(this,n=>this._options.read(n).renderIndicators),this.enableSplitViewResizing=I(this,n=>this._options.read(n).enableSplitViewResizing),this.splitViewDefaultRatio=I(this,n=>this._options.read(n).splitViewDefaultRatio),this.ignoreTrimWhitespace=I(this,n=>this._options.read(n).ignoreTrimWhitespace),this.maxComputationTimeMs=I(this,n=>this._options.read(n).maxComputationTime),this.showMoves=I(this,n=>this._options.read(n).experimental.showMoves&&this.renderSideBySide.read(n)),this.isInEmbeddedEditor=I(this,n=>this._options.read(n).isInEmbeddedEditor),this.diffWordWrap=I(this,n=>this._options.read(n).diffWordWrap),this.originalEditable=I(this,n=>this._options.read(n).originalEditable),this.diffCodeLens=I(this,n=>this._options.read(n).diffCodeLens),this.accessibilityVerbose=I(this,n=>this._options.read(n).accessibilityVerbose),this.diffAlgorithm=I(this,n=>this._options.read(n).diffAlgorithm),this.showEmptyDecorations=I(this,n=>this._options.read(n).experimental.showEmptyDecorations),this.onlyShowAccessibleDiffViewer=I(this,n=>this._options.read(n).onlyShowAccessibleDiffViewer),this.compactMode=I(this,n=>this._options.read(n).compactMode),this.trueInlineDiffRenderingEnabled=I(this,n=>this._options.read(n).experimental.useTrueInlineView),this.useTrueInlineDiffRendering=I(this,n=>!this.renderSideBySide.read(n)&&this.trueInlineDiffRenderingEnabled.read(n)),this.hideUnchangedRegions=I(this,n=>this._options.read(n).hideUnchangedRegions.enabled),this.hideUnchangedRegionsRevealLineCount=I(this,n=>this._options.read(n).hideUnchangedRegions.revealLineCount),this.hideUnchangedRegionsContextLineCount=I(this,n=>this._options.read(n).hideUnchangedRegions.contextLineCount),this.hideUnchangedRegionsMinimumLineCount=I(this,n=>this._options.read(n).hideUnchangedRegions.minimumLineCount),this._model=$(this,void 0),this.shouldRenderInlineViewInSmartMode=this._model.map(this,n=>Rd(this,s=>{const o=n==null?void 0:n.diff.read(s);return o?af(o,this.trueInlineDiffRenderingEnabled.read(s)):void 0})).flatten().map(this,n=>!!n),this.inlineViewHideOriginalLineNumbers=this.compactMode;const i={...e,...Fr(e,hh)};this._options=$(this,i)}updateOptions(e){const t=Fr(e,this._options.get()),i={...this._options.get(),...e,...t};this._options.set(i,void 0,{changedOptions:e})}setWidth(e){this._diffEditorWidth.set(e,void 0)}setModel(e){this._model.set(e,void 0)}};Us=of([rf(1,yt)],Us);function af(a,e){return a.mappings.every(t=>df(t.lineRangeMapping)||lf(t.lineRangeMapping)||e&&pc(t.lineRangeMapping))}function df(a){return a.original.length===0}function lf(a){return a.modified.length===0}function Fr(a,e){var t,i,n,s,o,r,d,l;return{enableSplitViewResizing:re(a.enableSplitViewResizing,e.enableSplitViewResizing),splitViewDefaultRatio:lh(a.splitViewDefaultRatio,.5,.1,.9),renderSideBySide:re(a.renderSideBySide,e.renderSideBySide),renderMarginRevertIcon:re(a.renderMarginRevertIcon,e.renderMarginRevertIcon),maxComputationTime:Nt(a.maxComputationTime,e.maxComputationTime,0,1073741824),maxFileSize:Nt(a.maxFileSize,e.maxFileSize,0,1073741824),ignoreTrimWhitespace:re(a.ignoreTrimWhitespace,e.ignoreTrimWhitespace),renderIndicators:re(a.renderIndicators,e.renderIndicators),originalEditable:re(a.originalEditable,e.originalEditable),diffCodeLens:re(a.diffCodeLens,e.diffCodeLens),renderOverviewRuler:re(a.renderOverviewRuler,e.renderOverviewRuler),diffWordWrap:Ko(a.diffWordWrap,e.diffWordWrap,["off","on","inherit"]),diffAlgorithm:Ko(a.diffAlgorithm,e.diffAlgorithm,["legacy","advanced"],{smart:"legacy",experimental:"advanced"}),accessibilityVerbose:re(a.accessibilityVerbose,e.accessibilityVerbose),experimental:{showMoves:re((t=a.experimental)==null?void 0:t.showMoves,e.experimental.showMoves),showEmptyDecorations:re((i=a.experimental)==null?void 0:i.showEmptyDecorations,e.experimental.showEmptyDecorations),useTrueInlineView:re((n=a.experimental)==null?void 0:n.useTrueInlineView,e.experimental.useTrueInlineView)},hideUnchangedRegions:{enabled:re(((s=a.hideUnchangedRegions)==null?void 0:s.enabled)??((o=a.experimental)==null?void 0:o.collapseUnchangedRegions),e.hideUnchangedRegions.enabled),contextLineCount:Nt((r=a.hideUnchangedRegions)==null?void 0:r.contextLineCount,e.hideUnchangedRegions.contextLineCount,0,1073741824),minimumLineCount:Nt((d=a.hideUnchangedRegions)==null?void 0:d.minimumLineCount,e.hideUnchangedRegions.minimumLineCount,0,1073741824),revealLineCount:Nt((l=a.hideUnchangedRegions)==null?void 0:l.revealLineCount,e.hideUnchangedRegions.revealLineCount,0,1073741824)},isInEmbeddedEditor:re(a.isInEmbeddedEditor,e.isInEmbeddedEditor),onlyShowAccessibleDiffViewer:re(a.onlyShowAccessibleDiffViewer,e.onlyShowAccessibleDiffViewer),renderSideBySideInlineBreakpoint:Nt(a.renderSideBySideInlineBreakpoint,e.renderSideBySideInlineBreakpoint,0,1073741824),useInlineViewWhenSpaceIsLimited:re(a.useInlineViewWhenSpaceIsLimited,e.useInlineViewWhenSpaceIsLimited),renderGutterMenu:re(a.renderGutterMenu,e.renderGutterMenu),compactMode:re(a.compactMode,e.compactMode)}}var hf=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},si=function(a,e){return function(t,i){e(t,i,a)}};let ot=class extends Bs{get onDidContentSizeChange(){return this._editors.onDidContentSizeChange}constructor(e,t,i,n,s,o,r,d){super(),this._domElement=e,this._parentContextKeyService=n,this._parentInstantiationService=s,this._accessibilitySignalService=r,this._editorProgressService=d,this.elements=k("div.monaco-diff-editor.side-by-side",{style:{position:"relative",height:"100%"}},[k("div.editor.original@original",{style:{position:"absolute",height:"100%"}}),k("div.editor.modified@modified",{style:{position:"absolute",height:"100%"}}),k("div.accessibleDiffViewer@accessibleDiffViewer",{style:{position:"absolute",height:"100%"}})]),this._diffModelSrc=this._register(ta(this,void 0)),this._diffModel=I(this,m=>{var b;return(b=this._diffModelSrc.read(m))==null?void 0:b.object}),this.onDidChangeModel=ri.fromObservableLight(this._diffModel),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._domElement)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new An([ye,this._contextKeyService]))),this._boundarySashes=$(this,void 0),this._accessibleDiffViewerShouldBeVisible=$(this,!1),this._accessibleDiffViewerVisible=I(this,m=>this._options.onlyShowAccessibleDiffViewer.read(m)?!0:this._accessibleDiffViewerShouldBeVisible.read(m)),this._movedBlocksLinesPart=$(this,void 0),this._layoutInfo=I(this,m=>{var ie,ne;const b=this._rootSizeObserver.width.read(m),y=this._rootSizeObserver.height.read(m);this._rootSizeObserver.automaticLayout?this.elements.root.style.height="100%":this.elements.root.style.height=y+"px";const N=this._sash.read(m),S=this._gutter.read(m),L=(S==null?void 0:S.width.read(m))??0,R=((ie=this._overviewRulerPart.read(m))==null?void 0:ie.width)??0;let x,M,P,z,B;if(!!N){const Y=N.sashLeft.read(m),Pe=((ne=this._movedBlocksLinesPart.read(m))==null?void 0:ne.width.read(m))??0;x=0,M=Y-L-Pe,B=Y-L,P=Y,z=b-P-R}else{B=0;const Y=this._options.inlineViewHideOriginalLineNumbers.read(m);x=L,Y?M=0:M=Math.max(5,this._editors.originalObs.layoutInfoDecorationsLeft.read(m)),P=L+M,z=b-P-R}return this.elements.original.style.left=x+"px",this.elements.original.style.width=M+"px",this._editors.original.layout({width:M,height:y},!0),S==null||S.layout(B),this.elements.modified.style.left=P+"px",this.elements.modified.style.width=z+"px",this._editors.modified.layout({width:z,height:y},!0),{modifiedEditor:this._editors.modified.getLayoutInfo(),originalEditor:this._editors.original.getLayoutInfo()}}),this._diffValue=this._diffModel.map((m,b)=>m==null?void 0:m.diff.read(b)),this.onDidUpdateDiff=ri.fromObservableLight(this._diffValue),o.willCreateDiffEditor(),this._contextKeyService.createKey("isInDiffEditor",!0),this._domElement.appendChild(this.elements.root),this._register(be(()=>this.elements.root.remove())),this._rootSizeObserver=this._register(new Va(this.elements.root,t.dimension)),this._rootSizeObserver.setAutomaticLayout(t.automaticLayout??!1),this._options=this._instantiationService.createInstance(Us,t),this._register(Q(m=>{this._options.setWidth(this._rootSizeObserver.width.read(m))})),this._contextKeyService.createKey(D.isEmbeddedDiffEditor.key,!1),this._register(Ue(D.isEmbeddedDiffEditor,this._contextKeyService,m=>this._options.isInEmbeddedEditor.read(m))),this._register(Ue(D.comparingMovedCode,this._contextKeyService,m=>{var b;return!!((b=this._diffModel.read(m))!=null&&b.movedTextToCompare.read(m))})),this._register(Ue(D.diffEditorRenderSideBySideInlineBreakpointReached,this._contextKeyService,m=>this._options.couldShowInlineViewBecauseOfSize.read(m))),this._register(Ue(D.diffEditorInlineMode,this._contextKeyService,m=>!this._options.renderSideBySide.read(m))),this._register(Ue(D.hasChanges,this._contextKeyService,m=>{var b,y;return(((y=(b=this._diffModel.read(m))==null?void 0:b.diff.read(m))==null?void 0:y.mappings.length)??0)>0})),this._editors=this._register(this._instantiationService.createInstance(vc,this.elements.original,this.elements.modified,this._options,i,(m,b,y,N)=>this._createInnerEditor(m,b,y,N))),this._register(Ue(D.diffEditorOriginalWritable,this._contextKeyService,m=>this._options.originalEditable.read(m))),this._register(Ue(D.diffEditorModifiedWritable,this._contextKeyService,m=>!this._options.readOnly.read(m))),this._register(Ue(D.diffEditorOriginalUri,this._contextKeyService,m=>{var b;return((b=this._diffModel.read(m))==null?void 0:b.model.original.uri.toString())??""})),this._register(Ue(D.diffEditorModifiedUri,this._contextKeyService,m=>{var b;return((b=this._diffModel.read(m))==null?void 0:b.model.modified.uri.toString())??""})),this._overviewRulerPart=He(this,m=>this._options.renderOverviewRuler.read(m)?this._instantiationService.createInstance(Le(Vs,m),this._editors,this.elements.root,this._diffModel,this._rootSizeObserver.width,this._rootSizeObserver.height,this._layoutInfo.map(b=>b.modifiedEditor)):void 0).recomputeInitiallyAndOnChange(this._store);const l={height:this._rootSizeObserver.height,width:this._rootSizeObserver.width.map((m,b)=>{var y;return m-(((y=this._overviewRulerPart.read(b))==null?void 0:y.width)??0)})};this._sashLayout=new Cc(this._options,l),this._sash=He(this,m=>{const b=this._options.renderSideBySide.read(m);return this.elements.root.classList.toggle("side-by-side",b),b?new Sa(this.elements.root,l,this._options.enableSplitViewResizing,this._boundarySashes,this._sashLayout.sashLeft,()=>this._sashLayout.resetSash()):void 0}).recomputeInitiallyAndOnChange(this._store);const h=He(this,m=>this._instantiationService.createInstance(Le(Fs,m),this._editors,this._diffModel,this._options)).recomputeInitiallyAndOnChange(this._store);He(this,m=>this._instantiationService.createInstance(Le(wc,m),this._editors,this._diffModel,this._options,this)).recomputeInitiallyAndOnChange(this._store);const c=new Set,u=new Set;let f=!1;const _=He(this,m=>this._instantiationService.createInstance(Le(bc,m),G(this._domElement),this._editors,this._diffModel,this._options,this,()=>f||h.get().isUpdatingHiddenAreas,c,u)).recomputeInitiallyAndOnChange(this._store),C=I(this,m=>{const b=_.read(m).viewZones.read(m).orig,y=h.read(m).viewZones.read(m).origViewZones;return b.concat(y)}),w=I(this,m=>{const b=_.read(m).viewZones.read(m).mod,y=h.read(m).viewZones.read(m).modViewZones;return b.concat(y)});this._register(on(this._editors.original,C,m=>{f=m},c));let p;this._register(on(this._editors.modified,w,m=>{f=m,f?p=sn.capture(this._editors.modified):(p==null||p.restore(this._editors.modified),p=void 0)},u)),this._accessibleDiffViewer=He(this,m=>this._instantiationService.createInstance(Le(yc,m),this.elements.accessibleDiffViewer,this._accessibleDiffViewerVisible,(b,y)=>this._accessibleDiffViewerShouldBeVisible.set(b,y),this._options.onlyShowAccessibleDiffViewer.map(b=>!b),this._rootSizeObserver.width,this._rootSizeObserver.height,this._diffModel.map((b,y)=>{var N;return(N=b==null?void 0:b.diff.read(y))==null?void 0:N.mappings.map(S=>S.lineRangeMapping)}),new Sc(this._editors))).recomputeInitiallyAndOnChange(this._store);const g=this._accessibleDiffViewerVisible.map(m=>m?"hidden":"visible");this._register(Yt(this.elements.modified,{visibility:g})),this._register(Yt(this.elements.original,{visibility:g})),this._createDiffEditorContributions(),o.addDiffEditor(this),this._gutter=He(this,m=>this._options.shouldRenderGutterMenu.read(m)?this._instantiationService.createInstance(Le(Ps,m),this.elements.root,this._diffModel,this._editors,this._options,this._sashLayout,this._boundarySashes):void 0),this._register(Ys(this._layoutInfo)),He(this,m=>new(Le(As,m))(this.elements.root,this._diffModel,this._layoutInfo.map(b=>b.originalEditor),this._layoutInfo.map(b=>b.modifiedEditor),this._editors)).recomputeInitiallyAndOnChange(this._store,m=>{this._movedBlocksLinesPart.set(m,void 0)}),this._register(ri.runAndSubscribe(this._editors.modified.onDidChangeCursorPosition,m=>this._handleCursorPositionChange(m,!0))),this._register(ri.runAndSubscribe(this._editors.original.onDidChangeCursorPosition,m=>this._handleCursorPositionChange(m,!1)));const v=this._diffModel.map(this,(m,b)=>{if(m)return m.diff.read(b)===void 0&&!m.isDiffUpToDate.read(b)});this._register(Fe((m,b)=>{if(v.read(m)===!0){const y=this._editorProgressService.show(!0,1e3);b.add(be(()=>y.done()))}})),this._register(Fe((m,b)=>{b.add(new(Le(sf,m))(this._editors,this._diffModel,this._options,this))})),this._register(Fe((m,b)=>{const y=this._diffModel.read(m);if(y)for(const N of[y.model.original,y.model.modified])b.add(N.onWillDispose(S=>{xe(new et("TextModel got disposed before DiffEditorWidget model got reset")),this.setModel(null)}))})),this._register(Q(m=>{this._options.setModel(this._diffModel.read(m))}))}_createInnerEditor(e,t,i,n){return e.createInstance(nn,t,i,n)}_createDiffEditorContributions(){const e=Ft.getDiffEditorContributions();for(const t of e)try{this._register(this._instantiationService.createInstance(t.ctor,this))}catch(i){xe(i)}}get _targetEditor(){return this._editors.modified}getEditorType(){return xn.IDiffEditor}layout(e){this._rootSizeObserver.observe(e)}hasTextFocus(){return this._editors.original.hasTextFocus()||this._editors.modified.hasTextFocus()}saveViewState(){var i;const e=this._editors.original.saveViewState(),t=this._editors.modified.saveViewState();return{original:e,modified:t,modelState:(i=this._diffModel.get())==null?void 0:i.serializeState()}}restoreViewState(e){var t;if(e&&e.original&&e.modified){const i=e;this._editors.original.restoreViewState(i.original),this._editors.modified.restoreViewState(i.modified),i.modelState&&((t=this._diffModel.get())==null||t.restoreSerializedState(i.modelState))}}handleInitialized(){this._editors.original.handleInitialized(),this._editors.modified.handleInitialized()}createViewModel(e){return this._instantiationService.createInstance(Os,e,this._options)}getModel(){var e;return((e=this._diffModel.get())==null?void 0:e.model)??null}setModel(e){const t=e?"model"in e?rn.create(e).createNewRef(this):rn.create(this.createViewModel(e),this):null;this.setDiffModel(t)}setDiffModel(e,t){const i=this._diffModel.get();!e&&i&&this._accessibleDiffViewer.get().close(),this._diffModel.get()!==(e==null?void 0:e.object)&&Ed(t,n=>{var r;const s=e==null?void 0:e.object;ce.batchEventsGlobally(n,()=>{this._editors.original.setModel(s?s.model.original:null),this._editors.modified.setModel(s?s.model.modified:null)});const o=(r=this._diffModelSrc.get())==null?void 0:r.createNewRef(this);this._diffModelSrc.set(e==null?void 0:e.createNewRef(this),n),setTimeout(()=>{o==null||o.dispose()},0)})}updateOptions(e){this._options.updateOptions(e)}getContainerDomNode(){return this._domElement}getOriginalEditor(){return this._editors.original}getModifiedEditor(){return this._editors.modified}getLineChanges(){var t;const e=(t=this._diffModel.get())==null?void 0:t.diff.get();return e?cf(e):null}revert(e){const t=this._diffModel.get();!t||!t.isDiffUpToDate.get()||this._editors.modified.executeEdits("diffEditor",[{range:e.modified.toExclusiveRange(),text:t.model.original.getValueInRange(e.original.toExclusiveRange())}])}revertRangeMappings(e){const t=this._diffModel.get();if(!t||!t.isDiffUpToDate.get())return;const i=e.map(n=>({range:n.modifiedRange,text:t.model.original.getValueInRange(n.originalRange)}));this._editors.modified.executeEdits("diffEditor",i)}_goTo(e){this._editors.modified.setPosition(new T(e.lineRangeMapping.modified.startLineNumber,1)),this._editors.modified.revealRangeInCenter(e.lineRangeMapping.modified.toExclusiveRange())}goToDiff(e){var s,o;const t=(o=(s=this._diffModel.get())==null?void 0:s.diff.get())==null?void 0:o.mappings;if(!t||t.length===0)return;const i=this._editors.modified.getPosition().lineNumber;let n;e==="next"?n=t.find(r=>r.lineRangeMapping.modified.startLineNumber>i)??t[0]:n=ts(t,r=>r.lineRangeMapping.modified.startLineNumber<i)??t[t.length-1],this._goTo(n),n.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(Mt.diffLineDeleted,{source:"diffEditor.goToDiff"}):n.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(Mt.diffLineInserted,{source:"diffEditor.goToDiff"}):n&&this._accessibilitySignalService.playSignal(Mt.diffLineModified,{source:"diffEditor.goToDiff"})}revealFirstDiff(){const e=this._diffModel.get();e&&this.waitForDiff().then(()=>{var i;const t=(i=e.diff.get())==null?void 0:i.mappings;!t||t.length===0||this._goTo(t[0])})}accessibleDiffViewerNext(){this._accessibleDiffViewer.get().next()}accessibleDiffViewerPrev(){this._accessibleDiffViewer.get().prev()}async waitForDiff(){const e=this._diffModel.get();e&&await e.waitForDiff()}mapToOtherSide(){var o,r;const e=this._editors.modified.hasWidgetFocus(),t=e?this._editors.modified:this._editors.original,i=e?this._editors.original:this._editors.modified;let n;const s=t.getSelection();if(s){const d=(r=(o=this._diffModel.get())==null?void 0:o.diff.get())==null?void 0:r.mappings.map(l=>e?l.lineRangeMapping.flip():l.lineRangeMapping);if(d){const l=Or(s.getStartPosition(),d),h=Or(s.getEndPosition(),d);n=A.plusRange(l,h)}}return{destination:i,destinationSelection:n}}switchSide(){const{destination:e,destinationSelection:t}=this.mapToOtherSide();e.focus(),t&&e.setSelection(t)}exitCompareMove(){const e=this._diffModel.get();e&&e.movedTextToCompare.set(void 0,void 0)}collapseAllUnchangedRegions(){var t;const e=(t=this._diffModel.get())==null?void 0:t.unchangedRegions.get();e&&Ce(i=>{for(const n of e)n.collapseAll(i)})}showAllUnchangedRegions(){var t;const e=(t=this._diffModel.get())==null?void 0:t.unchangedRegions.get();e&&Ce(i=>{for(const n of e)n.showAll(i)})}_handleCursorPositionChange(e,t){var i,n;if((e==null?void 0:e.reason)===3){const s=(n=(i=this._diffModel.get())==null?void 0:i.diff.get())==null?void 0:n.mappings.find(o=>t?o.lineRangeMapping.modified.contains(e.position.lineNumber):o.lineRangeMapping.original.contains(e.position.lineNumber));s!=null&&s.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(Mt.diffLineDeleted,{source:"diffEditor.cursorPositionChanged"}):s!=null&&s.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(Mt.diffLineInserted,{source:"diffEditor.cursorPositionChanged"}):s&&this._accessibilitySignalService.playSignal(Mt.diffLineModified,{source:"diffEditor.cursorPositionChanged"})}}};ot=hf([si(3,ye),si(4,me),si(5,Re),si(6,Wh),si(7,Hh)],ot);function cf(a){return a.mappings.map(e=>{const t=e.lineRangeMapping;let i,n,s,o,r=t.innerChanges;return t.original.isEmpty?(i=t.original.startLineNumber-1,n=0,r=void 0):(i=t.original.startLineNumber,n=t.original.endLineNumberExclusive-1),t.modified.isEmpty?(s=t.modified.startLineNumber-1,o=0,r=void 0):(s=t.modified.startLineNumber,o=t.modified.endLineNumberExclusive-1),{originalStartLineNumber:i,originalEndLineNumber:n,modifiedStartLineNumber:s,modifiedEndLineNumber:o,charChanges:r==null?void 0:r.map(d=>({originalStartLineNumber:d.originalRange.startLineNumber,originalStartColumn:d.originalRange.startColumn,originalEndLineNumber:d.originalRange.endLineNumber,originalEndColumn:d.originalRange.endColumn,modifiedStartLineNumber:d.modifiedRange.startLineNumber,modifiedStartColumn:d.modifiedRange.startColumn,modifiedEndLineNumber:d.modifiedRange.endLineNumber,modifiedEndColumn:d.modifiedRange.endColumn}))}})}var uf=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Vr=function(a,e){return function(t,i){e(t,i,a)}};class gf{constructor(e,t){this.viewModel=e,this.deltaScrollVertical=t}getId(){return this.viewModel}}let dn=class extends U{constructor(e,t,i,n,s){super(),this._container=e,this._overflowWidgetsDomNode=t,this._workbenchUIElementFactory=i,this._instantiationService=n,this._viewModel=$(this,void 0),this._collapsed=I(this,d=>{var l;return(l=this._viewModel.read(d))==null?void 0:l.collapsed.read(d)}),this._editorContentHeight=$(this,500),this.contentHeight=I(this,d=>(this._collapsed.read(d)?0:this._editorContentHeight.read(d))+this._outerEditorHeight),this._modifiedContentWidth=$(this,0),this._modifiedWidth=$(this,0),this._originalContentWidth=$(this,0),this._originalWidth=$(this,0),this.maxScroll=I(this,d=>{const l=this._modifiedContentWidth.read(d)-this._modifiedWidth.read(d),h=this._originalContentWidth.read(d)-this._originalWidth.read(d);return l>h?{maxScroll:l,width:this._modifiedWidth.read(d)}:{maxScroll:h,width:this._originalWidth.read(d)}}),this._elements=k("div.multiDiffEntry",[k("div.header@header",[k("div.header-content",[k("div.collapse-button@collapseButton"),k("div.file-path",[k("div.title.modified.show-file-icons@primaryPath",[]),k("div.status.deleted@status",["R"]),k("div.title.original.show-file-icons@secondaryPath",[])]),k("div.actions@actions")])]),k("div.editorParent",[k("div.editorContainer@editor")])]),this.editor=this._register(this._instantiationService.createInstance(ot,this._elements.editor,{overflowWidgetsDomNode:this._overflowWidgetsDomNode},{})),this.isModifedFocused=Hs(this.editor.getModifiedEditor()).isFocused,this.isOriginalFocused=Hs(this.editor.getOriginalEditor()).isFocused,this.isFocused=I(this,d=>this.isModifedFocused.read(d)||this.isOriginalFocused.read(d)),this._resourceLabel=this._workbenchUIElementFactory.createResourceLabel?this._register(this._workbenchUIElementFactory.createResourceLabel(this._elements.primaryPath)):void 0,this._resourceLabel2=this._workbenchUIElementFactory.createResourceLabel?this._register(this._workbenchUIElementFactory.createResourceLabel(this._elements.secondaryPath)):void 0,this._dataStore=this._register(new Me),this._headerHeight=40,this._lastScrollTop=-1,this._isSettingScrollTop=!1;const o=new mc(this._elements.collapseButton,{});this._register(Q(d=>{o.element.className="",o.icon=this._collapsed.read(d)?fe.chevronRight:fe.chevronDown})),this._register(o.onDidClick(()=>{var d;(d=this._viewModel.get())==null||d.collapsed.set(!this._collapsed.get(),void 0)})),this._register(Q(d=>{this._elements.editor.style.display=this._collapsed.read(d)?"none":"block"})),this._register(this.editor.getModifiedEditor().onDidLayoutChange(d=>{const l=this.editor.getModifiedEditor().getLayoutInfo().contentWidth;this._modifiedWidth.set(l,void 0)})),this._register(this.editor.getOriginalEditor().onDidLayoutChange(d=>{const l=this.editor.getOriginalEditor().getLayoutInfo().contentWidth;this._originalWidth.set(l,void 0)})),this._register(this.editor.onDidContentSizeChange(d=>{ai(l=>{this._editorContentHeight.set(d.contentHeight,l),this._modifiedContentWidth.set(this.editor.getModifiedEditor().getContentWidth(),l),this._originalContentWidth.set(this.editor.getOriginalEditor().getContentWidth(),l)})})),this._register(this.editor.getOriginalEditor().onDidScrollChange(d=>{if(this._isSettingScrollTop||!d.scrollTopChanged||!this._data)return;const l=d.scrollTop-this._lastScrollTop;this._data.deltaScrollVertical(l)})),this._register(Q(d=>{var h;const l=(h=this._viewModel.read(d))==null?void 0:h.isActive.read(d);this._elements.root.classList.toggle("active",l)})),this._container.appendChild(this._elements.root),this._outerEditorHeight=this._headerHeight,this._contextKeyService=this._register(s.createScoped(this._elements.actions));const r=this._register(this._instantiationService.createChild(new An([ye,this._contextKeyService])));this._register(r.createInstance(_a,this._elements.actions,se.MultiDiffEditorFileToolbar,{actionRunner:this._register(new za(()=>{var d;return(d=this._viewModel.get())==null?void 0:d.modifiedUri})),menuOptions:{shouldForwardArgs:!0},toolbarOptions:{primaryGroup:d=>d.startsWith("navigation")},actionViewItemProvider:(d,l)=>kh(r,d,l)}))}setScrollLeft(e){this._modifiedContentWidth.get()-this._modifiedWidth.get()>this._originalContentWidth.get()-this._originalWidth.get()?this.editor.getModifiedEditor().setScrollLeft(e):this.editor.getOriginalEditor().setScrollLeft(e)}setData(e){this._data=e;function t(n){return{...n,scrollBeyondLastLine:!1,hideUnchangedRegions:{enabled:!0},scrollbar:{vertical:"hidden",horizontal:"hidden",handleMouseWheel:!1,useShadows:!1},renderOverviewRuler:!1,fixedOverflowWidgets:!0,overviewRulerBorder:!1}}if(!e){ai(n=>{this._viewModel.set(void 0,n),this.editor.setDiffModel(null,n),this._dataStore.clear()});return}const i=e.viewModel.documentDiffItem;if(ai(n=>{var l,h;(l=this._resourceLabel)==null||l.setUri(e.viewModel.modifiedUri??e.viewModel.originalUri,{strikethrough:e.viewModel.modifiedUri===void 0});let s=!1,o=!1,r=!1,d="";e.viewModel.modifiedUri&&e.viewModel.originalUri&&e.viewModel.modifiedUri.path!==e.viewModel.originalUri.path?(d="R",s=!0):e.viewModel.modifiedUri?e.viewModel.originalUri||(d="A",r=!0):(d="D",o=!0),this._elements.status.classList.toggle("renamed",s),this._elements.status.classList.toggle("deleted",o),this._elements.status.classList.toggle("added",r),this._elements.status.innerText=d,(h=this._resourceLabel2)==null||h.setUri(s?e.viewModel.originalUri:void 0,{strikethrough:!0}),this._dataStore.clear(),this._viewModel.set(e.viewModel,n),this.editor.setDiffModel(e.viewModel.diffEditorViewModelRef,n),this.editor.updateOptions(t(i.options??{}))}),i.onOptionsDidChange&&this._dataStore.add(i.onOptionsDidChange(()=>{this.editor.updateOptions(t(i.options??{}))})),e.viewModel.isAlive.recomputeInitiallyAndOnChange(this._dataStore,n=>{n||this.setData(void 0)}),e.viewModel.documentDiffItem.contextKeys)for(const[n,s]of Object.entries(e.viewModel.documentDiffItem.contextKeys))this._contextKeyService.createKey(n,s)}render(e,t,i,n){this._elements.root.style.visibility="visible",this._elements.root.style.top=`${e.start}px`,this._elements.root.style.height=`${e.length}px`,this._elements.root.style.width=`${t}px`,this._elements.root.style.position="absolute";const s=e.length-this._headerHeight,o=Math.max(0,Math.min(n.start-e.start,s));this._elements.header.style.transform=`translateY(${o}px)`,ai(r=>{this.editor.layout({width:t-2*8-2*1,height:e.length-this._outerEditorHeight})});try{this._isSettingScrollTop=!0,this._lastScrollTop=i,this.editor.getOriginalEditor().setScrollTop(i)}finally{this._isSettingScrollTop=!1}this._elements.header.classList.toggle("shadow",o>0||i>0),this._elements.header.classList.toggle("collapsed",o===s)}hide(){this._elements.root.style.top="-100000px",this._elements.root.style.visibility="hidden"}};dn=uf([Vr(3,me),Vr(4,ye)],dn);class ff{constructor(e){this._create=e,this._unused=new Set,this._used=new Set,this._itemData=new Map}getUnusedObj(e){let t;if(this._unused.size===0)t=this._create(e),this._itemData.set(t,e);else{const i=[...this._unused.values()];t=i.find(n=>this._itemData.get(n).getId()===e.getId())??i[0],this._unused.delete(t),this._itemData.set(t,e),t.setData(e)}return this._used.add(t),{object:t,dispose:()=>{this._used.delete(t),this._unused.size>5?t.dispose():this._unused.add(t)}}}dispose(){for(const e of this._used)e.dispose();for(const e of this._unused)e.dispose();this._used.clear(),this._unused.clear()}}var mf=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},Br=function(a,e){return function(t,i){e(t,i,a)}};let zs=class extends U{constructor(e,t,i,n,s,o){super(),this._element=e,this._dimension=t,this._viewModel=i,this._workbenchUIElementFactory=n,this._parentContextKeyService=s,this._parentInstantiationService=o,this._scrollableElements=k("div.scrollContent",[k("div@content",{style:{overflow:"hidden"}}),k("div.monaco-editor@overflowWidgetsDomNode",{})]),this._scrollable=this._register(new Td({forceIntegerValues:!1,scheduleAtNextAnimationFrame:d=>yi(G(this._element),d),smoothScrollDuration:100})),this._scrollableElement=this._register(new ya(this._scrollableElements.root,{vertical:1,horizontal:1,useShadows:!1},this._scrollable)),this._elements=k("div.monaco-component.multiDiffEditor",{},[k("div",{},[this._scrollableElement.getDomNode()]),k("div.placeholder@placeholder",{},[k("div",[F("noChangedFiles","No Changed Files")])])]),this._sizeObserver=this._register(new Va(this._element,void 0)),this._objectPool=this._register(new ff(d=>{const l=this._instantiationService.createInstance(dn,this._scrollableElements.content,this._scrollableElements.overflowWidgetsDomNode,this._workbenchUIElementFactory);return l.setData(d),l})),this.scrollTop=ce(this,this._scrollableElement.onScroll,()=>this._scrollableElement.getScrollPosition().scrollTop),this.scrollLeft=ce(this,this._scrollableElement.onScroll,()=>this._scrollableElement.getScrollPosition().scrollLeft),this._viewItemsInfo=Nn(this,(d,l)=>{const h=this._viewModel.read(d);if(!h)return{items:[],getItem:_=>{throw new et}};const c=h.items.read(d),u=new Map;return{items:c.map(_=>{var p;const C=l.add(new _f(_,this._objectPool,this.scrollLeft,g=>{this._scrollableElement.setScrollPosition({scrollTop:this._scrollableElement.getScrollPosition().scrollTop+g})})),w=(p=this._lastDocStates)==null?void 0:p[C.getKey()];return w&&Ce(g=>{C.setViewState(w,g)}),u.set(_,C),C}),getItem:_=>u.get(_)}}),this._viewItems=this._viewItemsInfo.map(this,d=>d.items),this._spaceBetweenPx=0,this._totalHeight=this._viewItems.map(this,(d,l)=>d.reduce((h,c)=>h+c.contentHeight.read(l)+this._spaceBetweenPx,0)),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._element)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new An([ye,this._contextKeyService]))),this._lastDocStates={},this._contextKeyService.createKey(D.inMultiDiffEditor.key,!0),this._register(Fe((d,l)=>{const h=this._viewModel.read(d);if(h&&h.contextKeys)for(const[c,u]of Object.entries(h.contextKeys)){const f=this._contextKeyService.createKey(c,void 0);f.set(u),l.add(be(()=>f.reset()))}}));const r=this._parentContextKeyService.createKey(D.multiDiffEditorAllCollapsed.key,!1);this._register(Q(d=>{const l=this._viewModel.read(d);if(l){const h=l.items.read(d).every(c=>c.collapsed.read(d));r.set(h)}})),this._register(Q(d=>{const l=this._dimension.read(d);this._sizeObserver.observe(l)})),this._register(Q(d=>{const l=this._viewItems.read(d);this._elements.placeholder.classList.toggle("visible",l.length===0)})),this._scrollableElements.content.style.position="relative",this._register(Q(d=>{const l=this._sizeObserver.height.read(d);this._scrollableElements.root.style.height=`${l}px`;const h=this._totalHeight.read(d);this._scrollableElements.content.style.height=`${h}px`;const c=this._sizeObserver.width.read(d);let u=c;const f=this._viewItems.read(d),_=Id(f,Gi(C=>C.maxScroll.read(d).maxScroll,qs));if(_){const C=_.maxScroll.read(d);u=c+C.maxScroll}this._scrollableElement.setScrollDimensions({width:c,height:l,scrollHeight:h,scrollWidth:u})})),e.replaceChildren(this._elements.root),this._register(be(()=>{e.replaceChildren()})),this._register(this._register(Q(d=>{ai(l=>{this.render(d)})})))}render(e){const t=this.scrollTop.read(e);let i=0,n=0,s=0;const o=this._sizeObserver.height.read(e),r=Ze.ofStartAndLength(t,o),d=this._sizeObserver.width.read(e);for(const l of this._viewItems.read(e)){const h=l.contentHeight.read(e),c=Math.min(h,o),u=Ze.ofStartAndLength(n,c),f=Ze.ofStartAndLength(s,h);if(f.isBefore(r))i-=h-c,l.hide();else if(f.isAfter(r))l.hide();else{const _=Math.max(0,Math.min(r.start-f.start,h-c));i-=_;const C=Ze.ofStartAndLength(t+i,o);l.render(u,_,d,C)}n+=c+this._spaceBetweenPx,s+=h+this._spaceBetweenPx}this._scrollableElements.content.style.transform=`translateY(${-(t+i)}px)`}};zs=mf([Br(4,ye),Br(5,me)],zs);class _f extends U{constructor(e,t,i,n){super(),this.viewModel=e,this._objectPool=t,this._scrollLeft=i,this._deltaScrollVertical=n,this._templateRef=this._register(ta(this,void 0)),this.contentHeight=I(this,s=>{var o,r;return((r=(o=this._templateRef.read(s))==null?void 0:o.object.contentHeight)==null?void 0:r.read(s))??this.viewModel.lastTemplateData.read(s).contentHeight}),this.maxScroll=I(this,s=>{var o;return((o=this._templateRef.read(s))==null?void 0:o.object.maxScroll.read(s))??{maxScroll:0,scrollWidth:0}}),this.template=I(this,s=>{var o;return(o=this._templateRef.read(s))==null?void 0:o.object}),this._isHidden=$(this,!1),this._isFocused=I(this,s=>{var o;return((o=this.template.read(s))==null?void 0:o.isFocused.read(s))??!1}),this.viewModel.setIsFocused(this._isFocused,void 0),this._register(Q(s=>{var r;const o=this._scrollLeft.read(s);(r=this._templateRef.read(s))==null||r.object.setScrollLeft(o)})),this._register(Q(s=>{const o=this._templateRef.read(s);!o||!this._isHidden.read(s)||o.object.isFocused.read(s)||this._clear()}))}dispose(){this._clear(),super.dispose()}toString(){var e;return`VirtualViewItem(${(e=this.viewModel.documentDiffItem.modified)==null?void 0:e.uri.toString()})`}getKey(){return this.viewModel.getKey()}setViewState(e,t){var o;this.viewModel.collapsed.set(e.collapsed,t),this._updateTemplateData(t);const i=this.viewModel.lastTemplateData.get(),n=(o=e.selections)==null?void 0:o.map(we.liftSelection);this.viewModel.lastTemplateData.set({...i,selections:n},t);const s=this._templateRef.get();s&&n&&s.object.editor.setSelections(n)}_updateTemplateData(e){const t=this._templateRef.get();t&&this.viewModel.lastTemplateData.set({contentHeight:t.object.contentHeight.get(),selections:t.object.editor.getSelections()??void 0},e)}_clear(){const e=this._templateRef.get();e&&Ce(t=>{this._updateTemplateData(t),e.object.hide(),this._templateRef.set(void 0,t)})}hide(){this._isHidden.set(!0,void 0)}render(e,t,i,n){this._isHidden.set(!1,void 0);let s=this._templateRef.get();if(!s){s=this._objectPool.getUnusedObj(new gf(this.viewModel,this._deltaScrollVertical)),this._templateRef.set(s,void 0);const o=this.viewModel.lastTemplateData.get().selections;o&&s.object.editor.setSelections(o)}s.object.render(e,i,t,n)}}qt("multiDiffEditor.headerBackground",{dark:"#262626",light:"tab.inactiveBackground",hcDark:"tab.inactiveBackground",hcLight:"tab.inactiveBackground"},F("multiDiffEditor.headerBackground","The background color of the diff editor's header"));qt("multiDiffEditor.background",Fh,F("multiDiffEditor.background","The background color of the multi file diff editor"));qt("multiDiffEditor.border",{dark:"sideBarSectionHeader.border",light:"#cccccc",hcDark:"sideBarSectionHeader.border",hcLight:"#cccccc"},F("multiDiffEditor.border","The border color of the multi file diff editor"));var pf=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},vf=function(a,e){return function(t,i){e(t,i,a)}};let Ur=class extends U{constructor(e,t,i){super(),this._element=e,this._workbenchUIElementFactory=t,this._instantiationService=i,this._dimension=$(this,void 0),this._viewModel=$(this,void 0),this._widgetImpl=Nn(this,(n,s)=>(Le(dn,n),s.add(this._instantiationService.createInstance(Le(zs,n),this._element,this._dimension,this._viewModel,this._workbenchUIElementFactory)))),this._register(Ys(this._widgetImpl))}};Ur=pf([vf(2,me)],Ur);function zr(a){return a&&typeof a.getEditorType=="function"?a.getEditorType()===xn.ICodeEditor:!1}function Cf(a){return a&&typeof a.getEditorType=="function"?a.getEditorType()===xn.IDiffEditor:!1}function wf(a){return!!a&&typeof a=="object"&&typeof a.onDidChangeActiveEditor=="function"}function Pm(a){return zr(a)?a:Cf(a)?a.getModifiedEditor():wf(a)&&zr(a.activeCodeEditor)?a.activeCodeEditor:null}class bf extends bt{constructor(){super({id:"diffEditor.toggleCollapseUnchangedRegions",title:Ee("toggleCollapseUnchangedRegions","Toggle Collapse Unchanged Regions"),icon:fe.map,toggled:X.has("config.diffEditor.hideUnchangedRegions.enabled"),precondition:X.has("isInDiffEditor"),menu:{when:X.has("isInDiffEditor"),id:se.EditorTitle,order:22,group:"navigation"}})}run(e,...t){const i=e.get(In),n=!i.getValue("diffEditor.hideUnchangedRegions.enabled");i.updateValue("diffEditor.hideUnchangedRegions.enabled",n)}}class Ga extends bt{constructor(){super({id:"diffEditor.toggleShowMovedCodeBlocks",title:Ee("toggleShowMovedCodeBlocks","Toggle Show Moved Code Blocks"),precondition:X.has("isInDiffEditor")})}run(e,...t){const i=e.get(In),n=!i.getValue("diffEditor.experimental.showMoves");i.updateValue("diffEditor.experimental.showMoves",n)}}class ja extends bt{constructor(){super({id:"diffEditor.toggleUseInlineViewWhenSpaceIsLimited",title:Ee("toggleUseInlineViewWhenSpaceIsLimited","Toggle Use Inline View When Space Is Limited"),precondition:X.has("isInDiffEditor")})}run(e,...t){const i=e.get(In),n=!i.getValue("diffEditor.useInlineViewWhenSpaceIsLimited");i.updateValue("diffEditor.useInlineViewWhenSpaceIsLimited",n)}}const Ti=Ee("diffEditor","Diff Editor");class yf extends Hn{constructor(){super({id:"diffEditor.switchSide",title:Ee("switchSide","Switch Side"),icon:fe.arrowSwap,precondition:X.has("isInDiffEditor"),f1:!0,category:Ti})}runEditorCommand(e,t,i){const n=Xt(e);if(n instanceof ot){if(i&&i.dryRun)return{destinationSelection:n.mapToOtherSide().destinationSelection};n.switchSide()}}}class Sf extends Hn{constructor(){super({id:"diffEditor.exitCompareMove",title:Ee("exitCompareMove","Exit Compare Move"),icon:fe.close,precondition:D.comparingMovedCode,f1:!1,category:Ti,keybinding:{weight:1e4,primary:9}})}runEditorCommand(e,t,...i){const n=Xt(e);n instanceof ot&&n.exitCompareMove()}}class Lf extends Hn{constructor(){super({id:"diffEditor.collapseAllUnchangedRegions",title:Ee("collapseAllUnchangedRegions","Collapse All Unchanged Regions"),icon:fe.fold,precondition:X.has("isInDiffEditor"),f1:!0,category:Ti})}runEditorCommand(e,t,...i){const n=Xt(e);n instanceof ot&&n.collapseAllUnchangedRegions()}}class Df extends Hn{constructor(){super({id:"diffEditor.showAllUnchangedRegions",title:Ee("showAllUnchangedRegions","Show All Unchanged Regions"),icon:fe.unfold,precondition:X.has("isInDiffEditor"),f1:!0,category:Ti})}runEditorCommand(e,t,...i){const n=Xt(e);n instanceof ot&&n.showAllUnchangedRegions()}}class $s extends bt{constructor(){super({id:"diffEditor.revert",title:Ee("revert","Revert"),f1:!1,category:Ti})}run(e,t){const i=Nf(e,t.originalUri,t.modifiedUri);i instanceof ot&&i.revertRangeMappings(t.mapping.innerChanges??[])}}const Za=Ee("accessibleDiffViewer","Accessible Diff Viewer"),yn=class yn extends bt{constructor(){super({id:yn.id,title:Ee("editor.action.accessibleDiffViewer.next","Go to Next Difference"),category:Za,precondition:X.has("isInDiffEditor"),keybinding:{primary:65,weight:100},f1:!0})}run(e){const t=Xt(e);t==null||t.accessibleDiffViewerNext()}};yn.id="editor.action.accessibleDiffViewer.next";let Mi=yn;const Sn=class Sn extends bt{constructor(){super({id:Sn.id,title:Ee("editor.action.accessibleDiffViewer.prev","Go to Previous Difference"),category:Za,precondition:X.has("isInDiffEditor"),keybinding:{primary:1089,weight:100},f1:!0})}run(e){const t=Xt(e);t==null||t.accessibleDiffViewerPrev()}};Sn.id="editor.action.accessibleDiffViewer.prev";let ln=Sn;function Nf(a,e,t){return a.get(Re).listDiffEditors().find(s=>{var d,l;const o=s.getModifiedEditor(),r=s.getOriginalEditor();return o&&((d=o.getModel())==null?void 0:d.uri.toString())===t.toString()&&r&&((l=r.getModel())==null?void 0:l.uri.toString())===e.toString()})||null}function Xt(a){const t=a.get(Re).listDiffEditors(),i=wt();if(i)for(const n of t){const s=n.getContainerDomNode();if(Mf(s,i))return n}return null}function Mf(a,e){let t=e;for(;t;){if(t===a)return!0;t=t.parentElement}return!1}Ve(bf);Ve(Ga);Ve(ja);jt.appendMenuItem(se.EditorTitle,{command:{id:new ja().desc.id,title:F("useInlineViewWhenSpaceIsLimited","Use Inline View When Space Is Limited"),toggled:X.has("config.diffEditor.useInlineViewWhenSpaceIsLimited"),precondition:X.has("isInDiffEditor")},order:11,group:"1_diff",when:X.and(D.diffEditorRenderSideBySideInlineBreakpointReached,X.has("isInDiffEditor"))});jt.appendMenuItem(se.EditorTitle,{command:{id:new Ga().desc.id,title:F("showMoves","Show Moved Code Blocks"),icon:fe.move,toggled:Vh.create("config.diffEditor.experimental.showMoves",!0),precondition:X.has("isInDiffEditor")},order:10,group:"1_diff",when:X.has("isInDiffEditor")});Ve($s);for(const a of[{icon:fe.arrowRight,key:D.diffEditorInlineMode.toNegated()},{icon:fe.discard,key:D.diffEditorInlineMode}])jt.appendMenuItem(se.DiffEditorHunkToolbar,{command:{id:new $s().desc.id,title:F("revertHunk","Revert Block"),icon:a.icon},when:X.and(D.diffEditorModifiedWritable,a.key),order:5,group:"primary"}),jt.appendMenuItem(se.DiffEditorSelectionToolbar,{command:{id:new $s().desc.id,title:F("revertSelection","Revert Selection"),icon:a.icon},when:X.and(D.diffEditorModifiedWritable,a.key),order:5,group:"primary"});Ve(yf);Ve(Sf);Ve(Lf);Ve(Df);jt.appendMenuItem(se.EditorTitle,{command:{id:Mi.id,title:F("Open Accessible Diff Viewer","Open Accessible Diff Viewer"),precondition:X.has("isInDiffEditor")},order:10,group:"2_diff",when:X.and(D.accessibleDiffViewerVisible.negate(),X.has("isInDiffEditor"))});En.registerCommandAlias("editor.action.diffReview.next",Mi.id);Ve(Mi);En.registerCommandAlias("editor.action.diffReview.prev",ln.id);Ve(ln);function xf(a){const e=new Od;for(const t of a.items){const i=t.type;if(t.kind==="string"){const n=new Promise(s=>t.getAsString(s));e.append(i,ia(n))}else if(t.kind==="file"){const n=t.getAsFile();n&&e.append(i,Rf(n))}}return e}function Rf(a){const e=a.path?Qe.parse(a.path):void 0;return Pd(a.name,e,async()=>new Uint8Array(await a.arrayBuffer()))}const Ef=Object.freeze([Qo.EDITORS,Qo.FILES,ns.RESOURCES,ns.INTERNAL_URI_LIST]);function Wm(a,e=!1){const t=xf(a),i=t.get(ns.INTERNAL_URI_LIST);if(i)t.replace(li.uriList,i);else if(e||!t.has(li.uriList)){const n=[];for(const s of a.items){const o=s.getAsFile();if(o){const r=o.path;try{r?n.push(Qe.file(r).toString()):n.push(Qe.parse(o.name,!0).toString())}catch{}}}n.length&&t.replace(li.uriList,ia(Ad.create(n)))}for(const n of Ef)t.delete(n);return t}var Tf=function(a,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,i);else for(var r=a.length-1;r>=0;r--)(o=a[r])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s},$e=function(a,e){return function(t,i){e(t,i,a)}};let $r=class extends nn{constructor(e,t,i,n,s,o,r,d,l,h,c,u,f){super(e,{...n.getRawOptions(),overflowWidgetsDomNode:n.getOverflowWidgetsDomNode()},i,s,o,r,d,l,h,c,u,f),this._parentEditor=n,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(n.onDidChangeConfiguration(_=>this._onParentConfigurationChanged(_)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){Wd(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};$r=Tf([$e(4,me),$e(5,Re),$e(6,On),$e(7,ye),$e(8,Tn),$e(9,fa),$e(10,yt),$e(11,Qs),$e(12,Xs)],$r);export{Cf as $,Re as A,Xi as B,pr as C,Yg as D,Zt as E,Su as F,ur as G,Kf as H,sm as I,hs as J,$r as K,Hn as L,As as M,qf as N,Vs as O,Zf as P,Qf as Q,Vt as R,sn as S,Xg as T,wr as U,Rm as V,Ua as W,Ft as X,di as Y,Oa as Z,qi as _,Yt as a,Fs as a0,fm as a1,Pm as a2,or as a3,xa as a4,sr as a5,hr as a6,ds as a7,nn as a8,ot as a9,Ur as aa,ir as ab,ge as b,gm as c,ym as d,$g as e,_m as f,vm as g,mm as h,pm as i,um as j,Sm as k,wm as l,Lm as m,bm as n,Cm as o,Ir as p,Hs as q,E as r,zr as s,Rc as t,Yf as u,ho as v,Ma as w,xf as x,Wm as y,lo as z};
//# sourceMappingURL=monaco-editor-esm-vs-editor-browser-08DDlf1h.js.map
