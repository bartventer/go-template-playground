import{i as w,a as E,j as O}from"./monaco-editor-esm-vs-base-browser-dom-CW6twH0t.js";import{m as Y}from"./monaco-editor-esm-vs-base-browser-DUVYE87s.js";import{c as C,T as D,j as A,Q as X,t as S,V as c,W as L}from"./monaco-editor-esm-vs-base-YIFfhEJQ.js";var b=function(u,t,a,i){var o=arguments.length,e=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,a):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")e=Reflect.decorate(u,t,a,i);else for(var l=u.length-1;l>=0;l--)(s=u[l])&&(e=(o<3?s(e):o>3?s(t,a,e):s(t,a))||e);return o>3&&e&&Object.defineProperty(t,a,e),e},g;(function(u){u.Tap="-monaco-gesturetap",u.Change="-monaco-gesturechange",u.Start="-monaco-gesturestart",u.End="-monaco-gesturesend",u.Contextmenu="-monaco-gesturecontextmenu"})(g||(g={}));const r=class r extends C{constructor(){super(),this.dispatched=!1,this.targets=new D,this.ignoreTargets=new D,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(A.runAndSubscribe(w,({window:t,disposables:a})=>{a.add(E(t.document,"touchstart",i=>this.onTouchStart(i),{passive:!1})),a.add(E(t.document,"touchend",i=>this.onTouchEnd(t,i))),a.add(E(t.document,"touchmove",i=>this.onTouchMove(i),{passive:!1}))},{window:Y,disposables:this._store}))}static addTarget(t){if(!r.isTouchDevice())return C.None;r.INSTANCE||(r.INSTANCE=X(new r));const a=r.INSTANCE.targets.push(t);return S(a)}static ignoreTarget(t){if(!r.isTouchDevice())return C.None;r.INSTANCE||(r.INSTANCE=X(new r));const a=r.INSTANCE.ignoreTargets.push(t);return S(a)}static isTouchDevice(){return"ontouchstart"in Y||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(t){const a=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let i=0,o=t.targetTouches.length;i<o;i++){const e=t.targetTouches.item(i);this.activeTouches[e.identifier]={id:e.identifier,initialTarget:e.target,initialTimeStamp:a,initialPageX:e.pageX,initialPageY:e.pageY,rollingTimestamps:[a],rollingPageX:[e.pageX],rollingPageY:[e.pageY]};const s=this.newGestureEvent(g.Start,e.target);s.pageX=e.pageX,s.pageY=e.pageY,this.dispatchEvent(s)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}onTouchEnd(t,a){const i=Date.now(),o=Object.keys(this.activeTouches).length;for(let e=0,s=a.changedTouches.length;e<s;e++){const l=a.changedTouches.item(e);if(!this.activeTouches.hasOwnProperty(String(l.identifier))){console.warn("move of an UNKNOWN touch",l);continue}const n=this.activeTouches[l.identifier],v=Date.now()-n.initialTimeStamp;if(v<r.HOLD_DELAY&&Math.abs(n.initialPageX-c(n.rollingPageX))<30&&Math.abs(n.initialPageY-c(n.rollingPageY))<30){const h=this.newGestureEvent(g.Tap,n.initialTarget);h.pageX=c(n.rollingPageX),h.pageY=c(n.rollingPageY),this.dispatchEvent(h)}else if(v>=r.HOLD_DELAY&&Math.abs(n.initialPageX-c(n.rollingPageX))<30&&Math.abs(n.initialPageY-c(n.rollingPageY))<30){const h=this.newGestureEvent(g.Contextmenu,n.initialTarget);h.pageX=c(n.rollingPageX),h.pageY=c(n.rollingPageY),this.dispatchEvent(h)}else if(o===1){const h=c(n.rollingPageX),p=c(n.rollingPageY),d=c(n.rollingTimestamps)-n.rollingTimestamps[0],T=h-n.rollingPageX[0],f=p-n.rollingPageY[0],m=[...this.targets].filter(P=>n.initialTarget instanceof Node&&P.contains(n.initialTarget));this.inertia(t,m,i,Math.abs(T)/d,T>0?1:-1,h,Math.abs(f)/d,f>0?1:-1,p)}this.dispatchEvent(this.newGestureEvent(g.End,n.initialTarget)),delete this.activeTouches[l.identifier]}this.dispatched&&(a.preventDefault(),a.stopPropagation(),this.dispatched=!1)}newGestureEvent(t,a){const i=document.createEvent("CustomEvent");return i.initEvent(t,!1,!0),i.initialTarget=a,i.tapCount=0,i}dispatchEvent(t){if(t.type===g.Tap){const a=new Date().getTime();let i=0;a-this._lastSetTapCountTime>r.CLEAR_TAP_COUNT_TIME?i=1:i=2,this._lastSetTapCountTime=a,t.tapCount=i}else(t.type===g.Change||t.type===g.Contextmenu)&&(this._lastSetTapCountTime=0);if(t.initialTarget instanceof Node){for(const i of this.ignoreTargets)if(i.contains(t.initialTarget))return;const a=[];for(const i of this.targets)if(i.contains(t.initialTarget)){let o=0,e=t.initialTarget;for(;e&&e!==i;)o++,e=e.parentElement;a.push([o,i])}a.sort((i,o)=>i[0]-o[0]);for(const[i,o]of a)o.dispatchEvent(t),this.dispatched=!0}}inertia(t,a,i,o,e,s,l,n,v){this.handle=O(t,()=>{const h=Date.now(),p=h-i;let d=0,T=0,f=!0;o+=r.SCROLL_FRICTION*p,l+=r.SCROLL_FRICTION*p,o>0&&(f=!1,d=e*o*p),l>0&&(f=!1,T=n*l*p);const m=this.newGestureEvent(g.Change);m.translationX=d,m.translationY=T,a.forEach(P=>P.dispatchEvent(m)),f||this.inertia(t,a,h,o,e,s+d,l,n,v+T)})}onTouchMove(t){const a=Date.now();for(let i=0,o=t.changedTouches.length;i<o;i++){const e=t.changedTouches.item(i);if(!this.activeTouches.hasOwnProperty(String(e.identifier))){console.warn("end of an UNKNOWN touch",e);continue}const s=this.activeTouches[e.identifier],l=this.newGestureEvent(g.Change,s.initialTarget);l.translationX=e.pageX-c(s.rollingPageX),l.translationY=e.pageY-c(s.rollingPageY),l.pageX=e.pageX,l.pageY=e.pageY,this.dispatchEvent(l),s.rollingPageX.length>3&&(s.rollingPageX.shift(),s.rollingPageY.shift(),s.rollingTimestamps.shift()),s.rollingPageX.push(e.pageX),s.rollingPageY.push(e.pageY),s.rollingTimestamps.push(a)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}};r.SCROLL_FRICTION=-.005,r.HOLD_DELAY=700,r.CLEAR_TAP_COUNT_TIME=400;let N=r;b([L],N,"isTouchDevice",null);export{g as E,N as G};
//# sourceMappingURL=monaco-editor-esm-vs-base-browser-touch-ENPaa6IX.js.map
